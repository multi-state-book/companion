{
  "hash": "79bfed1be37013c300d93f3986b0629c",
  "result": {
    "markdown": "# Intuition for models for intensities\n\n\n::: {.cell hash='Ch2_cache/html/unnamed-chunk-1_1f18510ac8ac5c30d1f813a3ad907d05'}\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: survival\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: tidyverse\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──\n✔ dplyr     1.1.0     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.1     ✔ tibble    3.1.8\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\nLoading required package: timereg\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'timereg' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: gridExtra\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'gridExtra' was built under R version\n4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'gridExtra'\n\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n:::\n:::\n\n\n$$\\alpha(t)=\\alpha_0(t)\\exp(\\beta Z)$$\n\n<!-- ## Hazard models for homogeneous groups {#homogeneous-groups} -->\n\n## Figure 2.2 {#fig2-2 .unnumbered}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npbc3<-readRDS(\"data/pbc3.rds\")\nnafit <- survfit(Surv(followup, status != 0) ~ tment, data = pbc3)\nnadata <- data.frame(cumhaz = nafit$cumhaz, \n                     cumhaz_se = nafit$std.err, \n                     time = nafit$time, \n                     tment = c(rep(names(nafit$strata)[1], nafit$strata[1]), \n                               rep(names(nafit$strata)[2], nafit$strata[2])))\n\n# Create Figure 2.2\nggplot(aes(x = time, y = cumhaz, linetype = tment), data = nadata) + \n          geom_step(size = 1) + \n          scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\")) + \n          xlab(\"Time since randomization (years)\") + \n          ylab(\"Cumulative hazard\") + \n          scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)), ) + \n          scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n          theme_general\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2\n3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n<!-- ### Piece-wise constant hazards -->\n\n## Figure 2.3 {#fig2-3 .unnumbered}\n\n\n::: {.cell file='R/2/pcwplot.r'}\n\n```{.r .cell-code}\nrateCyA <- c(8.1,13.1,9.6)\nratePbo <- c(9.4,12.5,8.5)\npcwtime <- c(0,2,4,5)\n\n# Collect data\nplotdata <- data.frame(rates = c(rateCyA, ratePbo),\n                       tment = c(rep(\"CyA\", length(rateCyA)), rep(\"Placebo\", length(ratePbo))),\n                       times_s = rep(pcwtime[-4], 2),\n                       times = rep(pcwtime[-1], 2))\n\n# Create Figure 2.3\nggplot(aes(x = time, y = rates, linetype = tment),\n                data = plotdata) +\n  geom_segment(aes(x = times_s, y = rates, xend = times, yend = rates), size = 1) +\n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\"))  +\n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Estimated hazard function (per 100 years)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0,14), breaks = seq(0, 14, 2)) +\n  theme_general\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Cox model {#cox-models .unnumbered}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibname h \"data\";\ndata pbc3;\n  set h.pbc3;\n  event=status ne 0; * Binary variable for events for later use;\nrun;\nproc phreg data=pbc3;\n  class tment(ref=\"0\") / param=ref;\n  model years*status(0)=tment;\nrun;\n```\n:::\n\n::: {.cell engine.path='C:\\Program Files\\SASHome\\SASFoundation\\9.4\\sas.exe' hash='Ch2_cache/html/unnamed-chunk-4_d8e29c88f2bc466b7d219833e31ba40f'}\n::: {.cell-output .cell-output-stdout}\n```\n                                      The PHREG Procedure\n\n                                       Model Information\n\n                               Data Set                 WORK.PBC3\n                               Dependent Variable       years    \n                               Censoring Variable       status   \n                               Censoring Value(s)       0        \n                               Ties Handling            BRESLOW  \n\n                            Number of Observations Read         349\n                            Number of Observations Used         349\n\n                                    Class Level Information\n \n                                                       Design\n                                 Class     Value     Variables\n\n                                 tment     0                 0\n                                           1                 1\n\n                       Summary of the Number of Event and Censored Values\n \n                                                               Percent\n                             Total       Event    Censored    Censored\n\n                               349          90         259       74.21\n\n                                       Convergence Status\n\n                         Convergence criterion (GCONV=1E-8) satisfied.          \n\n                                     Model Fit Statistics\n \n                                             Without           With\n                            Criterion     Covariates     Covariates\n\n                            -2 LOG L         948.259        948.182\n                            AIC              948.259        950.182\n                            SBC              948.259        952.682\n\n                            Testing Global Null Hypothesis: BETA=0\n \n                    Test                 Chi-Square       DF     Pr > ChiSq\n\n                    Likelihood Ratio         0.0771        1         0.7813\n                    Score                    0.0771        1         0.7813\n                    Wald                     0.0770        1         0.7814\n\n                                          Type 3 Tests\n \n                                                   Wald\n                           Effect      DF    Chi-Square    Pr > ChiSq\n\n                           tment        1        0.0770        0.7814\n\n                            Analysis of Maximum Likelihood Estimates\n \n                      Parameter      Standard                                  Hazard\nParameter      DF      Estimate         Error    Chi-Square    Pr > ChiSq       Ratio    Label\n\ntment     1     1      -0.05853       0.21092        0.0770        0.7814       0.943    tment 1\n```\n:::\n:::\n\n\n## Exercises\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}