{
  "hash": "ddb5f3309d97e9bda88d1b2ebfeeca35",
  "result": {
    "markdown": "# Intuition for intensity models\n\n## PBC3 trial {.unnumbered}\n\n\n\n::: {.cell file='R/chapter2_pbc3.r' hash='Ch2_cache/html/pbc3_4d4bc846de31c86c01fef6bd89b3e102'}\n\n```{.r .cell-code}\n# Read data\npbc3 <- data.frame(read.csv(\"data/pbc3.csv\"))\npbc3$fail <- ifelse(pbc3$status != 0, 1, 0) # event/failure indicator\npbc3$tment_char <- ifelse(pbc3$tment == 0, \"Placebo\", \"CyA\")\n\n#------------------------------------------------------------------#\n# General plotting style \n#------------------------------------------------------------------#\nlibrary(ggplot2)\ntheme_general <- theme_bw() +\n  theme(text = element_text(size = 20), \n        axis.text.x = element_text(size = 20), \n        axis.text.y = element_text(size = 20),\n        legend.position = \"bottom\", \n        legend.title=element_blank(),\n        legend.text = element_text(size = 20),\n        legend.key.size = unit(2,\"line\")\n  ) \n\n\n#------------------------------------------------------------------#\n# Figure 2.1 \n#------------------------------------------------------------------#\n\n# Nelson Aalen estimate by treatment\nlibrary(survival)\nnafit <- survfit(Surv(days, status != 0) ~ tment, data = pbc3)\n# Collect data for plot\nnadata <- data.frame(cumhaz = nafit$cumhaz, time = nafit$time, \n                     tment = c(rep(names(nafit$strata)[1], nafit$strata[1]), \n                               rep(names(nafit$strata)[2], nafit$strata[2])))\n\n# Create Figure 2.1\nlibrary(ggplot2)\nfig2.1 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = tment), data = nadata) + \n  geom_step(size = 1) + \n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\")) + \n  xlab(\"Time since randomization (years)\") + \n  ylab(\"Cumulative hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 6), breaks = seq(0, 6, 1))  + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general \n\nfig2.1\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-1.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# In-text: Nelson-Aalen estimates at 2 years\n#------------------------------------------------------------------#\ntail(subset(nadata, nadata$time <= 2*365.25 & nadata$tment == \"tment=0\"),1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     cumhaz time   tment\n60 0.183065  724 tment=0\n```\n:::\n\n```{.r .cell-code}\ntail(subset(nadata, nadata$time <= 2*365.25 & nadata$tment == \"tment=1\"),1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       cumhaz time   tment\n209 0.1668539  725 tment=1\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.1 \n#------------------------------------------------------------------#\n\n# Data for Table 2.1\ncuts <- c(0, 2, 4) * 365.25\n# Make the data ready using survSplit from survival package\nlibrary(survival)\npbc3mult <- as.data.frame(survSplit(Surv(days, fail) ~ ., pbc3,\n                      cut = cuts[-1], \n                      episode = \"timegroup\"))\npbc3mult$risktime <- pbc3mult$days - cuts[pbc3mult$timegroup] \npbc3mult$timegroup <- as.factor(pbc3mult$timegroup)\n\nlibrary(dplyr)\npcwdata <- pbc3mult %>% \n  group_by(tment, timegroup) %>% \n  summarise(fail = sum(fail), risktime = sum(days - cuts[timegroup]))\npcwdata$risktimeyrs <- pcwdata$risktime/365.25\npcwdata$hazard <- 36525*pcwdata$fail/pcwdata$risktime\npcwdata$SD <- 36525*sqrt(pcwdata$fail)/pcwdata$risktime\ndata.frame(pcwdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  tment timegroup fail risktime risktimeyrs    hazard       SD\n1     0         1   27 104856.0   287.08008  9.405041 1.810001\n2     0         2   17  49673.0   135.99726 12.500252 3.031756\n3     0         3    2   8642.0    23.66051  8.452904 5.977106\n4     1         1   24 107931.5   295.50034  8.121818 1.657859\n5     1         2   18  50284.5   137.67146 13.074605 3.081714\n6     1         3    2   7599.0    20.80493  9.613107 6.797493\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.2 \n#------------------------------------------------------------------#\n\n# Rates + cuts from Table 2.1\nrateCyA <- c(8.1,13.1,9.6)\nratePbo <- c(9.4,12.5,8.5)\npcwtime <- c(0,2,4,5)\n# Collect data\nplotdata <- data.frame(rates = c(rateCyA, ratePbo),\n                       tment = c(rep(\"CyA\", length(rateCyA)), \n                                 rep(\"Placebo\", length(ratePbo))),\n                       times_s = rep(pcwtime[-4], 2),\n                       times = rep(pcwtime[-1], 2))\n\n# Create Figure 2.2\nfig2.2 <- ggplot(aes(x = time, y = rates, linetype = tment), data = plotdata) +\n  geom_segment(aes(x = times_s, y = rates, xend = times, yend = rates), size = 1) +\n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\"))  +\n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Estimated hazard function (per 100 years)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 5),\n                     breaks = seq(0, 5, 1))  +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0,14), breaks = seq(0, 14, 2)) +\n  theme_general\n\nfig2.2\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-2.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# In-text: LRT test using piece-wise exponential model \n#------------------------------------------------------------------#\n \nlibrary(stats)\npoisfull <- glm(fail ~ - 1 + tment + timegroup + tment:timegroup +\n                  offset(log(risktime/36525)), data = pbc3mult, family = poisson)\npoisred <- glm(fail ~ - 1 + timegroup +\n                 offset(log(risktime/36525)), data = pbc3mult, family = poisson)\nanova(poisred,poisfull,test=\"LRT\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n\nModel 1: fail ~ -1 + timegroup + offset(log(risktime/36525))\nModel 2: fail ~ -1 + tment + timegroup + tment:timegroup + offset(log(risktime/36525))\n  Resid. Df Resid. Dev Df Deviance Pr(>Chi)\n1       620     459.66                     \n2       617     459.35  3  0.30813   0.9585\n```\n:::\n\n```{.r .cell-code}\n# or\nlibrary(lmtest)\nlrtest(poisred,poisfull)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ -1 + timegroup + offset(log(risktime/36525))\nModel 2: fail ~ -1 + tment + timegroup + tment:timegroup + offset(log(risktime/36525))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   3 -319.83                     \n2   6 -319.68  3 0.3081     0.9585\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# In-text: Logrank test and p-value                        \n#------------------------------------------------------------------#\n\nlibrary(survival)\nlr<-survdiff(Surv(days, status != 0) ~ tment, data = pbc3)\nc(lr$chisq,lr$pvalue)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.07708002 0.78129419\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.3 \n#------------------------------------------------------------------#\n\n# NA data from figure 2.1 model fit\ntment1 <- subset(nadata, tment == \"tment=1\")\n# Estimated hazard per time group\npcwdata$hazard_timegroup <- pcwdata$fail / pcwdata$risktime\n# Add a numeric version of the treatment to the NA estimates\nnadata$tmentnum <- ifelse(nadata$tment == \"tment=1\", 1, 0)\n# Add piecewise constant hazard to data\nnadata$pwch <- NULL\n# Between time 0 and 2\nnadata$pwch[nadata$time <= 2 * 365.25] <- nadata$time[nadata$time <= 2 * 365.25] * \n                                 (pcwdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time <= 2 * 365.25]) + \n                                  pcwdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time <= 2 * 365.25]))\n# Between time 2 and 4\nnadata$pwch[nadata$time > 2 * 365.25 & nadata$time <= 4* 365.25 ] <- 2 * 365.25 * \n  (pcwdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]) + \n     pcwdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25])) + \n  (nadata$time[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25] - 2 * 365.25) * \n  (pcwdata$hazard_timegroup[2] * (1-nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]) + \n     pcwdata$hazard_timegroup[5] * (nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]))\n# After time 4\nnadata$pwch[nadata$time > 4 * 365.25] <- 2 * 365.25 * \n  (pcwdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     pcwdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time > 4 * 365.25])) + \n   2 * 365.25 * \n  (pcwdata$hazard_timegroup[2] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     pcwdata$hazard_timegroup[5] * (nadata$tmentnum[nadata$time > 4 * 365.25])) + \n  (nadata$time[nadata$time > 4 * 365.25] - 4 * 365.25) * \n  (pcwdata$hazard_timegroup[3] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     pcwdata$hazard_timegroup[6] * (nadata$tmentnum[nadata$time > 4 * 365.25]))\n# Reformat for plot\npiecepdata <- data.frame(cumhaz = c(nadata$cumhaz, nadata$pwch), \n                         time = rep(nadata$time, 2),\n                         tmentnum = rep(nadata$tmentnum, 2),\n                         type = c(rep(\"Nelson-Aalen\", length(nadata$time)), \n                                  rep(\"Piece-wise exponential\", length(nadata$time))))\n# Only for treatment 1\npiecepdata1 <- subset(piecepdata, tmentnum == 1)\n\n# Create Figure 2.3\nfig2.3 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = type), \n                data = subset(piecepdata1, type == \"Nelson-Aalen\")) + \n  geom_step(size = 1) + \n  geom_line(aes(x = time / 365.25, y = cumhaz, linetype = type), size = 1,\n            data = subset(piecepdata1, type == \"Piece-wise exponential\")) + \n  labs(linetype = \"Type\") + \n  xlab(\"Time since randomization (years)\") + \n  ylab(\"Cumulative hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1))  + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general+\n  theme(legend.title=element_blank(),\n        legend.text = element_text(size = 20),\n        legend.key.size = unit(2,\"line\"))\n\nfig2.3\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-3.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# In-text: Cox model \n#------------------------------------------------------------------#\n\n# Fit a Cox model using the pbc3 data with treatment as a covariate\nlibrary(survival)\ncoxfit <- coxph(Surv(days, status != 0) ~ tment, data = pbc3, method = \"breslow\")\nsummary(coxfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment, data = pbc3, \n    method = \"breslow\")\n\n  n= 349, number of events= 90 \n\n          coef exp(coef) se(coef)      z Pr(>|z|)\ntment -0.05854   0.94314  0.21092 -0.278    0.781\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntment    0.9431       1.06    0.6238     1.426\n\nConcordance= 0.517  (se = 0.029 )\nLikelihood ratio test= 0.08  on 1 df,   p=0.8\nWald test            = 0.08  on 1 df,   p=0.8\nScore (logrank) test = 0.08  on 1 df,   p=0.8\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.5 \n#------------------------------------------------------------------#\n\n# Extract cumulative baseline hazard\ncoxcumhaz <- basehaz(coxfit, centered = FALSE)\n# Collect data for plot (Breslow estimate)\ncoxdata <- data.frame(cumhaz = coxcumhaz$hazard, \n                      time = coxcumhaz$time, \n                      tment = rep(\"0\", nrow(coxcumhaz)), \n                      type = rep(\"Breslow estimate\", nrow(coxcumhaz)))\n\n# Create Figure 2.5\nfig2.5 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = tment), data = coxdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") + \n  ylab(\"Cumulative baseline hazard\") + \n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\")) + \n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general+theme(legend.position = \"none\")\n\nfig2.5\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-4.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.3 \n#------------------------------------------------------------------#\n\n# Average covariate values of albumin and bilirubin per treatment \nlibrary(dplyr)\ntabledata <- pbc3 %>% \n  group_by(tment, tment_char) %>% \n  summarise(n = sum(id != 0),  \n            average_albumin = mean(alb, na.rm = TRUE), # NOTE: Removes missing observations from mean computation\n            average_bilirubin = mean(bili, na.rm = TRUE), \n            )\ndata.frame(tabledata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  tment tment_char   n average_albumin average_bilirubin\n1     0    Placebo 173        39.26101          42.33674\n2     1        CyA 176        37.50731          48.55540\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.4 \n#------------------------------------------------------------------#\n\n# Cox model with treatment, albumin and bilirubin as covariates \nlibrary(survival)\ncoxfit <- coxph(Surv(days, status != 0) ~ tment + alb + bili,\n                data = pbc3)\nsummary(coxfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + bili, \n    data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n            coef  exp(coef)   se(coef)      z Pr(>|z|)    \ntment -0.4965639  0.6086184  0.2256162 -2.201   0.0277 *  \nalb   -0.1156596  0.8907784  0.0212810 -5.435 5.48e-08 ***\nbili   0.0089494  1.0089895  0.0009801  9.131  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntment    0.6086     1.6431    0.3911    0.9471\nalb      0.8908     1.1226    0.8544    0.9287\nbili     1.0090     0.9911    1.0071    1.0109\n\nConcordance= 0.806  (se = 0.021 )\nLikelihood ratio test= 99.06  on 3 df,   p=<2e-16\nWald test            = 121  on 3 df,   p=<2e-16\nScore (logrank) test = 172.3  on 3 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# In-text: Poisson model with treatment\n#------------------------------------------------------------------#\n\nlibrary(stats)\nlibrary(broom) # For using tidy() function\npoism <- glm(fail ~ tment + timegroup-1 +\n               offset(log(risktime/365.25)), data = pbc3mult,family = poisson)\ntidy(poism, exponentiate = T, conf.int = T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 7\n  term       estimate std.error statistic  p.value conf.low conf.high\n  <chr>         <dbl>     <dbl>     <dbl>    <dbl>    <dbl>     <dbl>\n1 tment        0.942      0.211    -0.284 7.76e- 1   0.622      1.43 \n2 timegroup1   0.0902     0.174   -13.8   2.51e-43   0.0631     0.125\n3 timegroup2   0.132      0.198   -10.2   1.29e-24   0.0876     0.191\n4 timegroup3   0.0925     0.509    -4.68  2.91e- 6   0.0283     0.220\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.5 \n#------------------------------------------------------------------#\n\n# Poisson model with treatment, albumin and bilirubin as covariates\n\n\npoismod_t25 <- glm(fail ~ tment + alb + bili+ timegroup-1 +\n                      offset(log(risktime/365.25)), data = pbc3mult, family = poisson)\ntidy(poismod_t25)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  term       estimate std.error statistic  p.value\n  <chr>         <dbl>     <dbl>     <dbl>    <dbl>\n1 tment      -0.475    0.224        -2.12 3.39e- 2\n2 alb        -0.112    0.0213       -5.28 1.30e- 7\n3 bili        0.00846  0.000939      9.01 2.12e-19\n4 timegroup1  1.29     0.806         1.60 1.10e- 1\n5 timegroup2  2.15     0.833         2.58 9.99e- 3\n6 timegroup3  1.61     1.01          1.59 1.12e- 1\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.6 \n#------------------------------------------------------------------#\n\n# Add transformations of covariates \npbc3$albnorm <- with(pbc3, (alb-35)*(alb>35))\n\npbc3$bilihigh <- with(pbc3, (bili-17.1)*(bili>17.1))\npbc3$bilitoohigh <- with(pbc3, (bili-34.2)*(bili>34.2))\npbc3$bilimuchtoohigh <- with(pbc3, (bili-51.3)*(bili>51.3))\n\npbc3$log2bili <- with(pbc3, log2(bili))\npbc3$log2bili2 <- with(pbc3, log2bili*log2bili)\n\npbc3$logbilihigh <- with(pbc3, (log2bili-log2(17.1))*(bili>17.1))\npbc3$logbilitoohigh <- with(pbc3, (log2bili-log2(34.2))*(bili>34.2))\npbc3$logbilimuchtoohigh <- with(pbc3, (log2bili-log2(51.3))*(bili>51.3))\n\n#------------------------------------------------------------------#\n# Table 2.6 Cox models \n#------------------------------------------------------------------#\n\n# Models for LR tests\nlibrary(lmtest)\nbase_coxmod <- coxph(Surv(days, status != 0) ~ tment + alb + bili, \n                     eps = 1e-8, method = \"breslow\", data = pbc3)\nbase_coxmod_log <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                         eps = 1e-8, method = \"breslow\", data = pbc3)\n\n# Splines Cox 1\ncoxmod_t26_l1 <- coxph(Surv(days, status != 0) ~ tment + alb + albnorm + bili,\n                       eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t26_l1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term    estimate std.error statistic  p.value\n  <chr>      <dbl>     <dbl>     <dbl>    <dbl>\n1 tment   -0.475    0.226       -2.10  3.57e- 2\n2 alb     -0.0854   0.0453      -1.89  5.94e- 2\n3 albnorm -0.0557   0.0726      -0.767 4.43e- 1\n4 bili     0.00898  0.000984     9.12  7.24e-20\n```\n:::\n\n```{.r .cell-code}\nlrtest(coxmod_t26_l1, base_coxmod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + albnorm + bili\nModel 2: Surv(days, status != 0) ~ tment + alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   4 -413.12                     \n2   3 -413.42 -1 0.6001     0.4386\n```\n:::\n\n```{.r .cell-code}\n# Quadratic Cox 1\ncoxmod_t26_q1 <- coxph(Surv(days, status != 0) ~ tment + alb + I(alb*alb) + bili ,\n                       eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t26_q1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term          estimate std.error statistic  p.value\n  <chr>            <dbl>     <dbl>     <dbl>    <dbl>\n1 tment        -0.498     0.227      -2.19   2.84e- 2\n2 alb          -0.130     0.213      -0.608  5.43e- 1\n3 I(alb * alb)  0.000194  0.00298     0.0653 9.48e- 1\n4 bili          0.00895   0.000980    9.13   6.74e-20\n```\n:::\n\n```{.r .cell-code}\nlrtest(coxmod_t26_q1, base_coxmod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + I(alb * alb) + bili\nModel 2: Surv(days, status != 0) ~ tment + alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   4 -413.41                     \n2   3 -413.42 -1 0.0042      0.948\n```\n:::\n\n```{.r .cell-code}\n# Splines Cox 2\ncoxmod_t26_l2 <- coxph(Surv(days, status != 0) ~ tment + alb + \n                         bili + bilihigh + bilitoohigh + bilimuchtoohigh,\n                       eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t26_l2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  term            estimate std.error statistic   p.value\n  <chr>              <dbl>     <dbl>     <dbl>     <dbl>\n1 tment           -0.598      0.230    -2.61   0.00915  \n2 alb             -0.0910     0.0219   -4.15   0.0000325\n3 bili             0.0624     0.0623    1.00   0.316    \n4 bilihigh        -0.0146     0.0853   -0.171  0.864    \n5 bilitoohigh     -0.00258    0.0530   -0.0488 0.961    \n6 bilimuchtoohigh -0.0400     0.0265   -1.51   0.131    \n```\n:::\n\n```{.r .cell-code}\nlrtest(coxmod_t26_l2, base_coxmod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + \n    bilimuchtoohigh\nModel 2: Surv(days, status != 0) ~ tment + alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   6 -401.22                         \n2   3 -413.42 -3 24.396  2.064e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Quadratic Cox 2\ncoxmod_t26_q2 <- coxph(Surv(days, status != 0) ~ tment + alb + bili + I(bili*bili),\n                       eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t26_q2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term             estimate  std.error statistic  p.value\n  <chr>               <dbl>      <dbl>     <dbl>    <dbl>\n1 tment          -0.521     0.223          -2.33 1.96e- 2\n2 alb            -0.102     0.0217         -4.70 2.56e- 6\n3 bili            0.0200    0.00326         6.12 9.21e-10\n4 I(bili * bili) -0.0000305 0.00000910     -3.35 7.98e- 4\n```\n:::\n\n```{.r .cell-code}\nlrtest(coxmod_t26_q2, base_coxmod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + bili + I(bili * bili)\nModel 2: Surv(days, status != 0) ~ tment + alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   4 -407.24                         \n2   3 -413.42 -1 12.351  0.0004408 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Splines Cox 3\ncoxmod_t26_l3 <- coxph(Surv(days, status != 0) ~ tment + alb + \n                         log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh,\n                       eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t26_l3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  term               estimate std.error statistic   p.value\n  <chr>                 <dbl>     <dbl>     <dbl>     <dbl>\n1 tment               -0.580     0.230     -2.53  0.0115   \n2 alb                 -0.0885    0.0218    -4.06  0.0000499\n3 log2bili             0.201     0.465      0.433 0.665    \n4 logbilihigh          0.936     0.915      1.02  0.307    \n5 logbilitoohigh      -0.386     1.29      -0.299 0.765    \n6 logbilimuchtoohigh  -0.181     0.988     -0.184 0.854    \n```\n:::\n\n```{.r .cell-code}\nlrtest(coxmod_t26_l3, base_coxmod_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + \n    logbilitoohigh + logbilimuchtoohigh\nModel 2: Surv(days, status != 0) ~ tment + alb + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -402.13                     \n2   3 -402.94 -3 1.6144     0.6561\n```\n:::\n\n```{.r .cell-code}\n# Quadratic Cox 3\ncoxmod_t26_q3 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili + log2bili2,\n                       eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t26_q3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term      estimate std.error statistic   p.value\n  <chr>        <dbl>     <dbl>     <dbl>     <dbl>\n1 tment     -0.574      0.225     -2.56  0.0106   \n2 alb       -0.0915     0.0219    -4.17  0.0000298\n3 log2bili   0.582      0.500      1.16  0.244    \n4 log2bili2  0.00715    0.0428     0.167 0.867    \n```\n:::\n\n```{.r .cell-code}\nlrtest(coxmod_t26_q3, base_coxmod_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + log2bili + log2bili2\nModel 2: Surv(days, status != 0) ~ tment + alb + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   4 -402.93                     \n2   3 -402.94 -1 0.0277     0.8677\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.6 Poisson models \n#------------------------------------------------------------------#\n\n# Make the data ready for Poisson models using survSplit from survival package\nlibrary(survival)\npbc3mult <- as.data.frame(survSplit(Surv(days, fail) ~ ., pbc3,\n                                    cut = cuts[-1], \n                                    episode = \"timegroup\"))\npbc3mult$risktime <- pbc3mult$days - cuts[pbc3mult$timegroup] \npbc3mult$timegroup <- as.factor(pbc3mult$timegroup)\n\n# Models for LR test\nbase_poismod <- glm(fail ~ timegroup + tment + alb + bili +\n                      offset(log(risktime)), data = pbc3mult, family = poisson)\nbase_poismod_log <- glm(fail ~ timegroup + tment + alb + log2bili +\n                          offset(log(risktime)), data = pbc3mult, family = poisson)\n\n# Splines Poisson 1\npoismod_t26_l1 <- glm(fail ~ timegroup + tment + alb + albnorm + bili +\n                        offset(log(risktime)), data = pbc3mult, family = poisson)\ntidy(poismod_t26_l1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept) -5.12     1.63        -3.14  1.66e- 3\n2 timegroup1  -0.311    0.604       -0.514 6.07e- 1\n3 timegroup2   0.543    0.602        0.902 3.67e- 1\n4 tment       -0.458    0.225       -2.04  4.17e- 2\n5 alb         -0.0864   0.0452      -1.91  5.57e- 2\n6 albnorm     -0.0474   0.0720      -0.658 5.11e- 1\n7 bili         0.00848  0.000942     9.00  2.24e-19\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t26_l1, base_poismod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ timegroup + tment + alb + albnorm + bili + offset(log(risktime))\nModel 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -263.14                     \n2   6 -263.36 -1 0.4404     0.5069\n```\n:::\n\n```{.r .cell-code}\n# Quadratic Poisson 1\npoismod_t26_q1 <- glm(fail ~ timegroup + tment + alb + I(alb*alb) + bili +\n                        offset(log(risktime)), data = pbc3mult, family = poisson)\ntidy(poismod_t26_q1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term          estimate std.error statistic  p.value\n  <chr>            <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)  -3.83      3.81        -1.00  3.16e- 1\n2 timegroup1   -0.323     0.605       -0.534 5.94e- 1\n3 timegroup2    0.536     0.602        0.890 3.73e- 1\n4 tment        -0.479     0.226       -2.12  3.41e- 2\n5 alb          -0.139     0.210       -0.660 5.09e- 1\n6 I(alb * alb)  0.000371  0.00293      0.126 8.99e- 1\n7 bili          0.00846   0.000939     9.01  2.05e-19\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t26_q1, base_poismod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ timegroup + tment + alb + I(alb * alb) + bili + offset(log(risktime))\nModel 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -263.36                     \n2   6 -263.36 -1 0.0158     0.8999\n```\n:::\n\n```{.r .cell-code}\n# Splines Poisson 2\npoismod_t26_l2 <- glm(fail ~ timegroup + tment + alb + \n                        bili + bilihigh + bilitoohigh + bilimuchtoohigh +\n                        offset(log(risktime)), data = pbc3mult, family = poisson)\ntidy(poismod_t26_l2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 × 5\n  term            estimate std.error statistic    p.value\n  <chr>              <dbl>     <dbl>     <dbl>      <dbl>\n1 (Intercept)     -6.45       1.37     -4.72   0.00000240\n2 timegroup1      -0.427      0.605    -0.707  0.480     \n3 timegroup2       0.425      0.604     0.705  0.481     \n4 tment           -0.569      0.227    -2.51   0.0121    \n5 alb             -0.0865     0.0219   -3.95   0.0000770 \n6 bili             0.0617     0.0623    0.989  0.322     \n7 bilihigh        -0.0168     0.0852   -0.197  0.844     \n8 bilitoohigh      0.00265    0.0526    0.0504 0.960     \n9 bilimuchtoohigh -0.0428     0.0262   -1.63   0.102     \n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t26_l2, base_poismod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ timegroup + tment + alb + bili + bilihigh + bilitoohigh + \n    bilimuchtoohigh + offset(log(risktime))\nModel 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   9 -251.09                         \n2   6 -263.36 -3 24.545  1.922e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Quadratic Poisson 2\npoismod_t26_q2 <- glm(fail ~ timegroup + tment + alb + bili + I(bili*bili) +\n                        offset(log(risktime)), data = pbc3mult, family = poisson)\ntidy(poismod_t26_q2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term             estimate  std.error statistic  p.value\n  <chr>               <dbl>      <dbl>     <dbl>    <dbl>\n1 (Intercept)    -5.16      1.05          -4.90  9.47e- 7\n2 timegroup1     -0.382     0.605         -0.631 5.28e- 1\n3 timegroup2      0.455     0.603          0.755 4.50e- 1\n4 tment          -0.499     0.222         -2.25  2.45e- 2\n5 alb            -0.0977    0.0216        -4.52  6.24e- 6\n6 bili            0.0200    0.00327        6.12  9.49e-10\n7 I(bili * bili) -0.0000315 0.00000907    -3.48  5.10e- 4\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t26_q2, base_poismod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ timegroup + tment + alb + bili + I(bili * bili) + offset(log(risktime))\nModel 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   7 -256.69                         \n2   6 -263.36 -1 13.345  0.0002591 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Splines Poisson 3\npoismod_t26_l3 <- glm(fail ~ timegroup + tment + alb + \n                        log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh +\n                        offset(log(risktime)), data = pbc3mult, family = poisson)\ntidy(poismod_t26_l3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 × 5\n  term               estimate std.error statistic  p.value\n  <chr>                 <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)         -6.52      2.00      -3.27  0.00109 \n2 timegroup1          -0.407     0.604     -0.674 0.501   \n3 timegroup2           0.418     0.604      0.693 0.488   \n4 tment               -0.556     0.227     -2.45  0.0144  \n5 alb                 -0.0844    0.0218    -3.87  0.000109\n6 log2bili             0.198     0.465      0.425 0.671   \n7 logbilihigh          0.882     0.912      0.967 0.334   \n8 logbilitoohigh      -0.234     1.28      -0.183 0.855   \n9 logbilimuchtoohigh  -0.314     0.971     -0.323 0.746   \n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t26_l3, base_poismod_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ timegroup + tment + alb + log2bili + logbilihigh + logbilitoohigh + \n    logbilimuchtoohigh + offset(log(risktime))\nModel 2: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   9 -251.77                     \n2   6 -252.62 -3 1.7135     0.6339\n```\n:::\n\n```{.r .cell-code}\n# Quadratic Poisson 3\npoismod_t26_q3 <- glm(fail ~ timegroup + tment + alb + log2bili + log2bili2 +\n                        offset(log(risktime)), data = pbc3mult, family = poisson)\ntidy(poismod_t26_q3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term        estimate std.error statistic   p.value\n  <chr>          <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept) -7.86       1.85     -4.25   0.0000218\n2 timegroup1  -0.406      0.605    -0.672  0.502    \n3 timegroup2   0.439      0.603     0.728  0.467    \n4 tment       -0.545      0.223    -2.45   0.0143   \n5 alb         -0.0871     0.0219   -3.98   0.0000692\n6 log2bili     0.628      0.497     1.26   0.207    \n7 log2bili2    0.00164    0.0424    0.0387 0.969    \n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t26_q3, base_poismod_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ timegroup + tment + alb + log2bili + log2bili2 + offset(log(risktime))\nModel 2: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -252.62                     \n2   6 -252.62 -1 0.0015     0.9691\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.6 \n#------------------------------------------------------------------#\n\n# The below linear predictors include estimates from the following models\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npbc3mult$tment_char <- as.factor(pbc3mult$tment_char)\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\nbase_poismod <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili,\n                    data = pbc3mult, family = poisson)\npoismod_t26_l1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili + albnorm,\n                      data = pbc3mult, family = poisson)\npoismod_t26_l3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                        bili + bilihigh + bilitoohigh + bilimuchtoohigh,\n                      data = pbc3mult,family = poisson)\n# Make a dataset with linear predictor information\nlin2 <- pbc3\nlin2$lp1 <- with(pbc3, 1.6076-0.1123*alb)\nlin2$lp2 <- with(pbc3, 0.7828-0.0864*alb-0.0474*albnorm)\nlin2$lp3 <- with(pbc3, 1.6076+0.0085*bili-38.7*0.1123)\nlin2$lp4 <- with(pbc3, -0.5534+0.0617*bili-0.0168*bilihigh+0.0027*bilitoohigh-0.0428*bilimuchtoohigh-0.0865*38.7)\nlin2row <- data.frame(effect = c(rep(\"Linear effect\", nrow(lin2)),\n                                 rep(\"Effect as linear spline\", nrow(lin2))), \n                      lp = c(lin2$lp1, lin2$lp2), alb = c(lin2$alb, lin2$alb))\nlibrary(ggplot2)\nfig2.6 <- ggplot(aes(x = alb, y = lp, linetype = effect), data = lin2row) +\n  geom_line(size = 1) + \n  xlab(\"Albumin\") + \n  ylab(\"Linear predictor\") + \n  scale_linetype_discrete(\"Effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig2.6\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-5.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.7 \n#------------------------------------------------------------------#\n\n# bilirubin and the two last linear predictors\nlin2row2 <- data.frame(effect = c(rep(\"Linear effect\", nrow(lin2)),\n                                  rep(\"Effect as linear spline\", nrow(lin2))), \n                      lp = c(lin2$lp3, lin2$lp4),\n                      bili = c(lin2$bili, lin2$bili))\n\nfig2.7 <- ggplot(aes(x = bili, y = lp, linetype = effect), data = lin2row2) + \n  geom_line(size = 1) + \n  xlab(\"Bilirubin\") + \n  ylab(\"Linear predictor\") + \n  scale_linetype_discrete(\"Effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig2.7\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-6.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.8\n#------------------------------------------------------------------#\n\n# The below linear predictors include estimates from the following models\nbase_poismod2_log <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                         data = pbc3mult, family = poisson)\npoismod_t26_l3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                        log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh,\n                        data = pbc3mult, family = poisson)\n# Make a dataset with linear predictor information\nlog2 <- pbc3\nlog2$lp3 <- with(pbc3, -2.0162+0.6469*log2bili-38.7*0.087)\nlog2$lp4 <- with(pbc3, -0.6194+0.198*log2bili+0.8815*logbilihigh-0.2336*logbilitoohigh\n                 -0.3139*logbilimuchtoohigh-0.0844*38.7)\nlog2row <- data.frame(effect = c(rep(\"Linear effect\", nrow(log2)),\n                                 rep(\"Effect as linear spline\", nrow(log2))), \n                      lp = c(log2$lp3, log2$lp4),log2bili = c(log2$log2bili, log2$log2bili))\n\nfig2.8 <- ggplot(aes(x = log2bili, y = lp, linetype = effect), data = log2row) + \n  geom_line(size = 1) + \n  xlab(expression(log[2] * \"(bilirubin)\")) +\n  ylab(\"Linear predictor\") + \n  scale_linetype_discrete(\"Effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig2.8\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-7.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.7\n#------------------------------------------------------------------#\n\n# Cox model\ncoxmod_t27 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                    eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t27)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 5\n  term     estimate std.error statistic  p.value\n  <chr>       <dbl>     <dbl>     <dbl>    <dbl>\n1 tment     -0.574     0.224      -2.56 1.05e- 2\n2 alb       -0.0909    0.0216     -4.20 2.65e- 5\n3 log2bili   0.665     0.0744      8.93 4.08e-19\n```\n:::\n\n```{.r .cell-code}\n# Poisson model\npoismod_t27 <- glm(fail ~ tment + alb + log2bili + timegroup + offset(log(risktime)),\n                   data = pbc3mult, family = poisson)\ntidy(poismod_t27) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)  -7.48      0.976     -7.66  1.81e-14\n2 tment        -0.545     0.223     -2.45  1.43e- 2\n3 alb          -0.0870    0.0216    -4.02  5.73e- 5\n4 log2bili      0.647     0.0733     8.83  1.04e-18\n5 timegroup3   -0.439     0.603     -0.727 4.67e- 1\n6 timegroup1   -0.844     0.229     -3.69  2.23e- 4\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.8 \n#------------------------------------------------------------------#\n\n# Cox models\n# Model for LR comparison\ncoxmod_t28_base <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\", data = pbc3)\n# Cox model 1\npbc3$alb0 <- (pbc3$tment==0)*pbc3$alb\npbc3$alb1 <- (pbc3$tment==1)*pbc3$alb\ncoxmod_t28_1 <- coxph(Surv(days, status != 0) ~ tment + alb0 + alb1 + log2bili,\n                      eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t28_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term     estimate std.error statistic  p.value\n  <chr>       <dbl>     <dbl>     <dbl>    <dbl>\n1 tment    -0.00974    1.56    -0.00624 9.95e- 1\n2 alb0     -0.0813     0.0340  -2.39    1.69e- 2\n3 alb1     -0.0970     0.0273  -3.55    3.87e- 4\n4 log2bili  0.664      0.0745   8.92    4.71e-19\n```\n:::\n\n```{.r .cell-code}\nlrtest(coxmod_t28_1, coxmod_t28_base)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb0 + alb1 + log2bili\nModel 2: Surv(days, status != 0) ~ tment + alb + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   4 -402.87                     \n2   3 -402.94 -1 0.1338     0.7145\n```\n:::\n\n```{.r .cell-code}\n# Cox model 2\npbc3$bili0 <- (pbc3$tment==0)*pbc3$log2bili\npbc3$bili1 <- (pbc3$tment==1)*pbc3$log2bili\ncoxmod_t28_2 <- coxph(Surv(days, status != 0) ~ tment + alb + bili0 + bili1,\n                      eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_t28_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term  estimate std.error statistic  p.value\n  <chr>    <dbl>     <dbl>     <dbl>    <dbl>\n1 tment   0.199     0.857      0.232 8.16e- 1\n2 alb    -0.0933    0.0219    -4.26  2.05e- 5\n3 bili0   0.726     0.0987     7.36  1.91e-13\n4 bili1   0.593     0.106      5.60  2.19e- 8\n```\n:::\n\n```{.r .cell-code}\nlrtest(coxmod_t28_2, coxmod_t28_base)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + bili0 + bili1\nModel 2: Surv(days, status != 0) ~ tment + alb + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   4 -402.51                     \n2   3 -402.94 -1 0.8644     0.3525\n```\n:::\n\n```{.r .cell-code}\n# Poisson models\n# Model for LR comparison - no interaction\npoismod_t28_base <- glm(fail ~ timegroup + tment + alb + log2bili+\n                          offset(log(risktime)), data = pbc3mult, family = poisson)\n\n# Poisson model 1\npbc3mult$alb0 <- (pbc3mult$tment==0)*pbc3mult$alb\npbc3mult$alb1 <- (pbc3mult$tment==1)*pbc3mult$alb\npoismod_t28_1 <- glm(fail ~ tment + alb0 + alb1 + log2bili + timegroup +\n                       offset(log(risktime)), data = pbc3mult, family = poisson)\ntidy(poismod_t28_1) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)  -7.87      1.36     -5.78   7.54e- 9\n2 tment         0.0920    1.55      0.0593 9.53e- 1\n3 alb0         -0.0763    0.0336   -2.27   2.32e- 2\n4 alb1         -0.0941    0.0275   -3.41   6.39e- 4\n5 log2bili      0.646     0.0733    8.81   1.23e-18\n6 timegroup3   -0.431     0.604    -0.714  4.75e- 1\n7 timegroup1   -0.844     0.229    -3.69   2.20e- 4\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t28_base, poismod_t28_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))\nModel 2: fail ~ tment + alb0 + alb1 + log2bili + timegroup + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   7 -252.54  1 0.1723      0.678\n```\n:::\n\n```{.r .cell-code}\n# Poisson model 2\npbc3mult$bili0 <- (pbc3mult$tment==0)*pbc3mult$log2bili\npbc3mult$bili1 <- (pbc3mult$tment==1)*pbc3mult$log2bili\npoismod_t28_2 <- glm(fail ~ tment + alb + bili0 + bili1 + timegroup +\n                       offset(log(risktime)), data = pbc3mult, family = poisson)\ntidy(poismod_t28_2) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)  -7.72      1.02      -7.59  3.10e-14\n2 tment         0.181     0.848      0.213 8.31e- 1\n3 alb          -0.0891    0.0218    -4.08  4.54e- 5\n4 bili0         0.704     0.0972     7.24  4.42e-13\n5 bili1         0.580     0.105      5.54  3.08e- 8\n6 timegroup3   -0.417     0.604     -0.691 4.90e- 1\n7 timegroup1   -0.857     0.229     -3.74  1.86e- 4\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t28_base, poismod_t28_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))\nModel 2: fail ~ tment + alb + bili0 + bili1 + timegroup + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   7 -252.24  1 0.7787     0.3775\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.9\n#------------------------------------------------------------------#\n\npbc3mult$tment1 <- (pbc3mult$timegroup==1)*pbc3mult$tment\npbc3mult$tment2 <- (pbc3mult$timegroup==2)*pbc3mult$tment\npbc3mult$tment3 <- (pbc3mult$timegroup==3)*pbc3mult$tment\npbc3mult$alb1 <- (pbc3mult$timegroup==1)*pbc3mult$alb\npbc3mult$alb2 <- (pbc3mult$timegroup==2)*pbc3mult$alb\npbc3mult$alb3 <- (pbc3mult$timegroup==3)*pbc3mult$alb\npbc3mult$bili1 <- (pbc3mult$timegroup==1)*pbc3mult$log2bili\npbc3mult$bili2 <- (pbc3mult$timegroup==2)*pbc3mult$log2bili\npbc3mult$bili3 <- (pbc3mult$timegroup==3)*pbc3mult$log2bili\n\npoismod_t29_base <- glm(fail ~ tment+alb+log2bili+timegroup+offset(log(risktime)),\n                     data = pbc3mult, family = poisson)\n\n# Treatment\npoismod_t29_tment <- glm(fail ~ tment1 + tment2 + tment3 + alb + log2bili+\n                       timegroup + offset(log(risktime)),\n                     data = pbc3mult, family = poisson)\ntidy(poismod_t29_tment) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)  -7.55      0.983     -7.68  1.62e-14\n2 tment1       -0.562     0.291     -1.93  5.35e- 2\n3 tment2       -0.462     0.345     -1.34  1.80e- 1\n4 tment3       -1.27      1.23      -1.03  3.03e- 1\n5 alb          -0.0864    0.0217    -3.99  6.65e- 5\n6 log2bili      0.649     0.0737     8.81  1.30e-18\n7 timegroup3   -0.0954    0.750     -0.127 8.99e- 1\n8 timegroup1   -0.794     0.319     -2.49  1.29e- 2\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t29_base, poismod_t29_tment)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))\nModel 2: fail ~ tment1 + tment2 + tment3 + alb + log2bili + timegroup + \n    offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   8 -252.41  2 0.4312     0.8061\n```\n:::\n\n```{.r .cell-code}\n# Albumin\npoismod_t29_alb <- glm(fail ~ tment + alb1 + alb2 + alb3 + log2bili+\n                       timegroup + offset(log(risktime)),\n                     data = pbc3mult, family = poisson)\ntidy(poismod_t29_alb) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)  -8.75      1.42    -6.18    6.41e-10\n2 tment        -0.561     0.223   -2.52    1.18e- 2\n3 alb1         -0.110     0.0279  -3.95    7.79e- 5\n4 alb2         -0.0523    0.0347  -1.51    1.32e- 1\n5 alb3         -0.0654    0.153   -0.427   6.70e- 1\n6 log2bili      0.646     0.0736   8.78    1.68e-18\n7 timegroup3    0.0143    6.09     0.00235 9.98e- 1\n8 timegroup1    1.24      1.60     0.776   4.38e- 1\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t29_base, poismod_t29_alb)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))\nModel 2: fail ~ tment + alb1 + alb2 + alb3 + log2bili + timegroup + offset(log(risktime))\n  #Df  LogLik Df Chisq Pr(>Chisq)\n1   6 -252.62                    \n2   8 -251.72  2 1.803      0.406\n```\n:::\n\n```{.r .cell-code}\n# Bilirubin\npoismod_t29_bili <- glm(fail ~ tment + alb + bili1 + bili2 + bili3 +\n                       timegroup + offset(log(risktime)),\n                     data = pbc3mult, family = poisson)\ntidy(poismod_t29_bili) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)  -7.06      1.10      -6.40  1.55e-10\n2 tment        -0.515     0.224     -2.30  2.15e- 2\n3 alb          -0.0857    0.0217    -3.94  8.10e- 5\n4 bili1         0.710     0.0926     7.67  1.69e-14\n5 bili2         0.557     0.121      4.60  4.18e- 6\n6 bili3         0.305     0.482      0.633 5.26e- 1\n7 timegroup3    0.696     2.32       0.300 7.64e- 1\n8 timegroup1   -1.72      0.888     -1.94  5.21e- 2\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t29_base, poismod_t29_bili)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))\nModel 2: fail ~ tment + alb + bili1 + bili2 + bili3 + timegroup + offset(log(risktime))\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   8 -251.84  2 1.5777     0.4544\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# In-text: Stratified Cox model\n#------------------------------------------------------------------#\n\ncoxmod_f29 <- coxph(Surv(days, status != 0) ~ strata(tment) + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\", data = pbc3)\ntidy(coxmod_f29)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term     estimate std.error statistic  p.value\n  <chr>       <dbl>     <dbl>     <dbl>    <dbl>\n1 alb       -0.0900    0.0217     -4.15 3.28e- 5\n2 log2bili   0.663     0.0753      8.81 1.28e-18\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.10 \n#------------------------------------------------------------------#\n\n# Extracting cumulative baseline hazards per treatment\ncumhaz_treat <- basehaz(coxmod_f29, centered = FALSE)\ncumhaz_treat <- as.data.frame(cumhaz_treat)\n# Per treatment\nhazard_t0 <- cumhaz_treat[cumhaz_treat$strata == \"tment=0\",]\nhazard_t0[1,] <- c(0, 0, \"tment=0\")\nhazard_t0$time<- as.numeric(hazard_t0$time)\nhazard_t0$hazard <- as.numeric(hazard_t0$hazard)\nhazard_t1 <- cumhaz_treat[cumhaz_treat$strata == \"tment=1\",]\n# Match times\nalltimes <- sort(unique(cumhaz_treat$time))\nhazard_t0_allt <- as.numeric(sapply(1:length(alltimes), function(k) tail(hazard_t0$hazard[hazard_t0$time <= alltimes[k]], 1)))\nhazard_t1_allt <- as.numeric(sapply(1:length(alltimes), function(k) tail(hazard_t1$hazard[hazard_t1$time <= alltimes[k]], 1))) \nhazards <- data.frame(hazard_t0_allt, hazard_t1_allt)\n# Extract coefficient\ncoxmod_f29_t <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\", data = pbc3)\n# Make plot\nfig2.10 <- ggplot(aes(x = hazard_t0_allt, y = hazard_t1_allt), data = hazards) + \n  geom_step(size = 1) + \n  geom_abline(intercept = 0, slope = exp(coef(coxmod_f29_t)[[\"tment\"]]), linetype = \"dashed\", size = 1) + \n  xlab(\"Cumulative baseline hazard: placebo\") +\n  ylab(\"Cumulative baseline hazard: CyA\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig2.10\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-8.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.11 \n#------------------------------------------------------------------#\n\n# Additive Aalen models - available with timereg\nlibrary(timereg)\nnonparmod <- aalen(Surv(days, status != 0) ~ tment, data = pbc3)\nsummary(nonparmod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          5.96               0.000\ntment                                1.60               0.734\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.107                       0.561\ntment                               0.136                       0.591\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          7.62                       0.413\ntment                                4.54                       0.684\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)\n```\n:::\n\n```{.r .cell-code}\ncumhazdata <- data.frame(eventtimes = nonparmod$cum[,1],\n                         basecumhaz = nonparmod$cum[,2], \n                         cumhaztreat = nonparmod$cum[,3], \n                         cumhaztreat_ll = nonparmod$cum[,3]-1.96*sqrt(nonparmod$var.cum[,3]),\n                         cumhaztreat_ul = nonparmod$cum[,3]+1.96*sqrt(nonparmod$var.cum[,3]))\n# Extend lines to last observed time\ncumhazdata[nrow(cumhazdata)+1,] <- c(max(pbc3$days), tail(cumhazdata, 1)[-1])\n\n# Left figure\nfig2.11.left <- ggplot(aes(x = eventtimes / 365.25, y = basecumhaz), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative baseline hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig2.11.left\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-9.png){width=90%}\n:::\n\n```{.r .cell-code}\n# Right figure\nfig2.11.right <- ggplot(aes(x = eventtimes / 365.25, y = cumhaztreat), data = cumhazdata) + \n  geom_step(size = 1) + \n  geom_step(size = 1, aes(x = eventtimes / 365.25, y = cumhaztreat_ll), linetype = \"dashed\") +  \n  geom_step(size = 1, aes(x = eventtimes / 365.25, y = cumhaztreat_ul), linetype = \"dashed\") +\n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative treatment effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6), breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig2.11.right\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-10.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.12 \n#------------------------------------------------------------------#\n\n# Make Aalen model fit\nnonparmod2 <- aalen(Surv(days, status != 0) ~ tment + alb + bili, data = pbc3) \ncumhazdata <- data.frame(eventtimes = nonparmod2$cum[,1],\n                         basecumhaz = nonparmod2$cum[,2], \n                         cumhaztreat = nonparmod2$cum[,3], \n                         cumhazalb = nonparmod2$cum[,4], \n                         cumhazbili= nonparmod2$cum[,5])\n# Extend lines to last observed time\ncumhazdata[nrow(cumhazdata)+1,] <- c(max(pbc3$days), tail(cumhazdata, 1)[-1])\n\n# Figure treatment\nfig2.12.1 <- ggplot(aes(x = eventtimes / 365.25, y = cumhaztreat), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative treatment effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6), breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\n# Figure albumin\nfig2.12.2 <- ggplot(aes(x = eventtimes / 365.25, y = cumhazalb), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative albumin effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6), breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\n# Figure bilirubin\nfig2.12.3 <- ggplot(aes(x = eventtimes / 365.25, y = cumhazbili), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative bilirubin effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)),\n                     limits = c(0, 6), breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig2.12.1\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-11.png){width=90%}\n:::\n\n```{.r .cell-code}\nfig2.12.2\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-12.png){width=90%}\n:::\n\n```{.r .cell-code}\nfig2.12.3\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/pbc3-13.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.10 and in-text results\n#------------------------------------------------------------------#\n\n# Additive model treatment only\n# p-values not exactly as in book because seed changes\nnonparmod0 <- aalen(Surv(days, status != 0) ~ tment, data = pbc3) \nsummary(nonparmod0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          5.96               0.000\ntment                                1.60               0.759\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.107                       0.568\ntment                               0.136                       0.626\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          7.62                       0.432\ntment                                4.54                       0.731\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# Constant effect of treatment per year\nnonparmod01 <- aalen(Surv(days/365.25, status != 0) ~ const(tment), data = pbc3) \nsummary(nonparmod01)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          6.62                   0\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                        0.0914                       0.405\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                        0.0136                       0.279\n\nParametric terms :     \n                Coef.    SE Robust SE     z P-val lower2.5% upper97.5%\nconst(tment) -0.00587 0.021     0.021 -0.28 0.779    -0.047     0.0353\n   \n  Call: \naalen(formula = Surv(days/365.25, status != 0) ~ const(tment), \n    data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# Additive model with treatment, albumin, bilirubin\n# Table 2.10, first two columns\n# p-values not exactly as in book because seed changes\nnonparmod1 <- aalen(Surv(days, status != 0) ~ tment + alb + bili, data = pbc3) \nsummary(nonparmod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.62               0.005\ntment                                2.66               0.123\nalb                                  3.82               0.003\nbili                                 4.83               0.000\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                       0.30300                       0.936\ntment                             0.12100                       0.677\nalb                               0.00666                       0.965\nbili                              0.00300                       0.193\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                      14.20000                       0.990\ntment                             3.29000                       0.796\nalb                               0.00826                       0.993\nbili                              0.00203                       0.336\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment + alb + bili, \n    data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# Table 2.10, last columns\nnonparmod2 <- aalen(Surv(days/365.25, status != 0) ~ \n                      const(tment) + const(alb) + const(bili), data = pbc3) \nsummary(nonparmod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          4.03                   0\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.119                       0.202\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                        0.0263                       0.128\n\nParametric terms :     \n                Coef.       SE Robust SE     z    P-val lower2.5% upper97.5%\nconst(tment) -0.04130 0.021600  0.020100 -2.05 4.02e-02  -0.08360    0.00104\nconst(alb)   -0.00842 0.002290  0.002230 -3.77 1.63e-04  -0.01290   -0.00393\nconst(bili)   0.00230 0.000483  0.000384  5.98 2.17e-09   0.00135    0.00325\n   \n  Call: \naalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + \n    const(alb) + const(bili), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# In-text\n# Constant effect of treatment, adjusted for albumin and bilirubin\nnonparmod3 <- aalen(Surv(days/365.25, status != 0) ~ \n                      const(tment) + alb + bili, data = pbc3) \nsummary(nonparmod3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.60               0.013\nalb                                  3.80               0.006\nbili                                 4.83               0.000\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                       0.28500                       0.936\nalb                               0.00954                       0.795\nbili                              0.00315                       0.147\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                      3.16e-02                       0.991\nalb                              5.26e-05                       0.897\nbili                             6.52e-06                       0.286\n\nParametric terms :     \n               Coef.     SE Robust SE     z P-val lower2.5% upper97.5%\nconst(tment) -0.0401 0.0216    0.0204 -1.97 0.049   -0.0824    0.00224\n   \n  Call: \naalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + \n    alb + bili, data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# Quadratic effect for albumin; p-values not exactly as in book because seed changes\nnonparmod44 <- aalen(Surv(days/365.25, status != 0) ~ \n                       const(tment) + I(alb/10) + I(bili/100) + I((alb/10)^2), data = pbc3) \nsummary(nonparmod44)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n              Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                            3.23               0.012\nI(alb/10)                              3.00               0.035\nI(bili/100)                            4.88               0.001\nI((alb/10)^2)                          2.77               0.075\n\nTest for time invariant effects \n                    Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                           9.420                       0.218\nI(alb/10)                             4.950                       0.220\nI(bili/100)                           0.366                       0.066\nI((alb/10)^2)                         0.635                       0.222\n                      Cramer von Mises test p-value H_0:constant effect\n(Intercept)                         83.6000                       0.326\nI(alb/10)                           24.4000                       0.321\nI(bili/100)                          0.0948                       0.171\nI((alb/10)^2)                        0.4160                       0.320\n\nParametric terms :     \n               Coef.     SE Robust SE     z  P-val lower2.5% upper97.5%\nconst(tment) -0.0421 0.0215    0.0201 -2.09 0.0366   -0.0842   3.92e-05\n   \n  Call: \naalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + \n    I(alb/10) + I(bili/100) + I((alb/10)^2), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# Quadratic effect for bilirubin; p-values not exactly as in book because seed changes\nnonparmod43 <- aalen(Surv(days/365.25, status != 0) ~ \n                       const(tment) + I(alb/10) + I(bili/100) + I((bili/100)^2), data = pbc3) \nsummary(nonparmod43)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n                Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                              3.82               0.001\nI(alb/10)                                4.02               0.001\nI(bili/100)                              3.85               0.004\nI((bili/100)^2)                          3.01               0.048\n\nTest for time invariant effects \n                      Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                             0.440                       0.687\nI(alb/10)                               0.117                       0.643\nI(bili/100)                             0.612                       0.405\nI((bili/100)^2)                         0.515                       0.145\n                        Cramer von Mises test p-value H_0:constant effect\n(Intercept)                            0.1320                       0.764\nI(alb/10)                              0.0124                       0.648\nI(bili/100)                            0.4640                       0.302\nI((bili/100)^2)                        0.2880                       0.144\n\nParametric terms :     \n               Coef.     SE Robust SE     z  P-val lower2.5% upper97.5%\nconst(tment) -0.0395 0.0213    0.0208 -1.89 0.0582   -0.0812    0.00225\n   \n  Call: \naalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + \n    I(alb/10) + I(bili/100) + I((bili/100)^2), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# Interactions\nnonparmod51 <- aalen(Surv(days/365.25, status != 0) ~\n                       const(tment) + const(alb) + const(bili) + const(tment * bili), data = pbc3) \nsummary(nonparmod51)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          4.03                   0\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.123                       0.187\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                        0.0287                       0.121\n\nParametric terms :     \n                       Coef.       SE Robust SE       z    P-val lower2.5%\nconst(tment)        -0.00194 0.029400  0.022800 -0.0851 9.32e-01  -0.05960\nconst(alb)          -0.00859 0.002260  0.002200 -3.9000 9.69e-05  -0.01300\nconst(bili)          0.00299 0.000869  0.000437  6.8400 7.77e-12   0.00129\nconst(tment * bili) -0.00116 0.001020  0.000658 -1.7600 7.92e-02  -0.00316\n                    upper97.5%\nconst(tment)          0.055700\nconst(alb)           -0.004160\nconst(bili)           0.004690\nconst(tment * bili)   0.000839\n   \n  Call: \naalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + \n    const(alb) + const(bili) + const(tment * bili), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\nnonparmod52 <- aalen(Surv(days/365.25, status != 0) ~\n                       const(tment) + const(alb) + const(bili) + const(tment * alb), data = pbc3) \nsummary(nonparmod52)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.06               0.004\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                          0.12                       0.177\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                        0.0265                       0.106\n\nParametric terms :     \n                      Coef.       SE Robust SE       z    P-val lower2.5%\nconst(tment)        0.01010 0.199000  0.176000  0.0576 9.54e-01  -0.38000\nconst(alb)         -0.00771 0.003150  0.002780 -2.7700 5.54e-03  -0.01390\nconst(bili)         0.00230 0.000482  0.000385  5.9600 2.45e-09   0.00136\nconst(tment * alb) -0.00132 0.004790  0.004300 -0.3060 7.59e-01  -0.01070\n                   upper97.5%\nconst(tment)          0.40000\nconst(alb)           -0.00154\nconst(bili)           0.00324\nconst(tment * alb)    0.00807\n   \n  Call: \naalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + \n    const(alb) + const(bili) + const(tment * alb), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.11 and in-text results\n#------------------------------------------------------------------#\n\n# Additive hazards model with piecewise constant baseline hazards\n# Model with only treatment as covariate\n# update data set\npbc3add <- pbc3mult\npbc3add$time1 <-  with(pbc3add, (timegroup == 1)*risktime/365.25)\npbc3add$time2 <-  with(pbc3add, (timegroup == 2)*risktime/365.25)\npbc3add$time3 <-  with(pbc3add, (timegroup == 3)*risktime/365.25)\npbc3add$tment0 <- with(pbc3add, (tment == 0)*risktime/365.25)\npbc3add$tment1 <- with(pbc3add, (tment == 1)*risktime/365.25)\npbc3add$albny <-  with(pbc3add, ((alb-35)/100)*risktime/365.25)\npbc3add$biliny <- with(pbc3add, ((bili-50)/1000)*risktime/365.25)\n\n# In-text\nadditive_pcw <- glm(fail ~ time1 + time2 + time3 + tment1 - 1,\n                    data = pbc3add, start = c(0.1, 0.1, 0.1, 0),\n                    family = poisson(link = \"identity\"))\ntidy(additive_pcw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term   estimate std.error statistic      p.value\n  <chr>     <dbl>     <dbl>     <dbl>        <dbl>\n1 time1   0.0911     0.0164     5.55  0.0000000293\n2 time2   0.132      0.0241     5.46  0.0000000487\n3 time3   0.0937     0.0462     2.03  0.0423      \n4 tment1 -0.00726    0.0208    -0.350 0.726       \n```\n:::\n\n```{.r .cell-code}\n# Table 2.11 - questionable fit\nadditive_pcw2.11 <- glm(fail ~ time1 + time2 + time3 + tment1 + albny + biliny -1,\n                    data = pbc3add, start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2),\n                    family = poisson(link = \"identity\"))\ntidy(additive_pcw2.11)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  term   estimate std.error statistic  p.value\n  <chr>     <dbl>     <dbl>     <dbl>    <dbl>\n1 time1    0.185     0.0213      8.67 4.46e-18\n2 time2    0.241     0.0258      9.32 1.21e-20\n3 time3    0.229     0.0544      4.22 2.48e- 5\n4 tment1  -0.0224    0.0173     -1.30 1.95e- 1\n5 albny   -0.436     0.128      -3.40 6.79e- 4\n6 biliny   2.22      0.408       5.45 4.98e- 8\n```\n:::\n\n```{.r .cell-code}\nadditive_pcw2.11 <- glm(fail ~ time1 + time2 + time3 + tment1 + albny + biliny -1,\n                        data = pbc3add, start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2.1),\n                        family = poisson(link = \"identity\"))\ntidy(additive_pcw2.11)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  term   estimate std.error statistic  p.value\n  <chr>     <dbl>     <dbl>     <dbl>    <dbl>\n1 time1    0.186     0.0214      8.68 4.08e-18\n2 time2    0.242     0.0259      9.32 1.14e-20\n3 time3    0.231     0.0548      4.22 2.45e- 5\n4 tment1  -0.0223    0.0174     -1.28 2.00e- 1\n5 albny   -0.436     0.129      -3.37 7.63e- 4\n6 biliny   2.25      0.411       5.48 4.21e- 8\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.13\n#------------------------------------------------------------------#\n\n# Death without transplantation\ntidy(coxph(Surv(days, status == 2) ~ tment + alb + log2bili + sex + age,\n           method = \"breslow\", data = pbc3)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 5\n  term     estimate std.error statistic  p.value\n  <chr>       <dbl>     <dbl>     <dbl>    <dbl>\n1 tment     -0.420     0.268      -1.57 1.17e- 1\n2 alb       -0.0699    0.0291     -2.41 1.61e- 2\n3 log2bili   0.692     0.0930      7.44 1.04e-13\n4 sex        0.486     0.319       1.52 1.28e- 1\n5 age        0.0733    0.0162      4.52 6.06e- 6\n```\n:::\n\n```{.r .cell-code}\n# Transplantation\ntidy(coxph(Surv(days, status == 1) ~ tment + alb + log2bili + sex + age,\n           method = \"breslow\", data = pbc3)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 5\n  term     estimate std.error statistic      p.value\n  <chr>       <dbl>     <dbl>     <dbl>        <dbl>\n1 tment     -0.673     0.413     -1.63  0.103       \n2 alb       -0.0940    0.0387    -2.43  0.0152      \n3 log2bili   0.832     0.147      5.68  0.0000000136\n4 sex        0.204     0.563      0.362 0.718       \n5 age       -0.0480    0.0214    -2.25  0.0246      \n```\n:::\n\n```{.r .cell-code}\n# Failure of medical treatment\ntidy(coxph(Surv(days, status != 0) ~ tment + alb + log2bili + sex + age,\n           method = \"breslow\", data = pbc3)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 5\n  term     estimate std.error statistic  p.value\n  <chr>       <dbl>     <dbl>     <dbl>    <dbl>\n1 tment     -0.510     0.223      -2.28 2.25e- 2\n2 alb       -0.0714    0.0229     -3.11 1.86e- 3\n3 log2bili   0.738     0.0777      9.50 2.16e-21\n4 sex        0.585     0.267       2.19 2.86e- 2\n5 age        0.0308    0.0120      2.57 1.03e- 2\n```\n:::\n:::\n\n\n## Guinea-Bissau study {.unnumbered}\n\n\n\n::: {.cell file='R/chapter2_bissau.r' hash='Ch2_cache/html/bissau_2602e29a6f840493a9a84bee7c81953b'}\n\n```{.r .cell-code}\nbissau <- data.frame(read.csv(\"data/bissau.csv\"))\n\n#------------------------------------------------------------------#\n# General plotting style \n#------------------------------------------------------------------#\nlibrary(ggplot2)\ntheme_general <- theme_bw() +\n  theme(text = element_text(size = 20), \n        axis.text.x = element_text(size = 20), \n        axis.text.y = element_text(size = 20),\n        legend.position = \"bottom\", \n        legend.title=element_blank(),\n        legend.text = element_text(size = 20),\n        legend.key.size = unit(2,\"line\")\n  ) \n\n#------------------------------------------------------------------#\n# Table 2.12 and in-text estimate\n#------------------------------------------------------------------#\n\n# Cox model in column 1\nbissau$agem <- as.integer(bissau$age/30.44)\ncoxfit0 <- coxph(Surv(fuptime, dead) ~ bcg, \n                 data = bissau, method = \"breslow\")\ntidy(coxfit0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bcg     -0.282     0.135     -2.08  0.0371\n```\n:::\n\n```{.r .cell-code}\n# Cox model in column 1\ncoxfit1 <- coxph(Surv(fuptime, dead) ~ bcg + agem, \n                 data = bissau, method = \"breslow\")\ntidy(coxfit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bcg    -0.352     0.144      -2.44  0.0147\n2 agem    0.0538    0.0386      1.39  0.163 \n```\n:::\n\n```{.r .cell-code}\n# Make age the time variable instead\nbissau$agein <- bissau$age/(365.24/12)\nbissau$ageout <- bissau$agein + bissau$fuptime/(365.24/12)\n\n# Cox model in column 2\ncoxfit2 <- coxph(Surv(agein, ageout, dead) ~ bcg, \n                 data = bissau, method = \"breslow\")\ntidy(coxfit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bcg     -0.355     0.141     -2.52  0.0116\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Figure 2.12 -------------------------------------#\n#------------------------------------------------------------------#\n\n# Extract cumulative baseline hazard\ncoxcumhaz <- basehaz(coxfit1, centered = FALSE)\n\n# Collect data for plot\ncoxdata <- data.frame(cumhaz = coxcumhaz$hazard, \n                      time = coxcumhaz$time, \n                      bcg = rep(\"1\", nrow(coxcumhaz)), \n                      type = rep(\"Breslow estimate\", nrow(coxcumhaz)))\n\n# Create figure\nfig2.12 <- ggplot(aes(x = time / (365.24/12), y = cumhaz), data = coxdata) + \n  geom_step(size = 1) + \n  xlab(\"Follow-up time (months)\") + \n  ylab(\"Cumulative hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)), breaks = seq(0, 7, by = 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general\n\nfig2.12\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/bissau-1.png){width=90%}\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Figure 2.13 \n#------------------------------------------------------------------#\n\n# Extract cumulative baseline hazard\ncoxcumhaz <- basehaz(coxfit2, centered = FALSE)\n# Collect data for plot\ncoxdata <- data.frame(cumhaz = coxcumhaz$hazard, \n                      time = coxcumhaz$time, \n                      bcg = rep(\"1\", nrow(coxcumhaz)), \n                      type = rep(\"Breslow estimate\", nrow(coxcumhaz)))\n\n# Create figure\nfig2.13 <- ggplot(aes(x = time, y = cumhaz), data = coxdata) + \n  geom_step(size = 1) + \n  xlab(\"Age (months)\") + \n  ylab(\"Cumulative hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)), breaks = seq(0, 15, by = 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.1)), breaks = seq(0, 0.15, by = 0.05), \n                     labels = c(\"0\", \"0.05\", \"0.10\", \"0.15\")) +\n  theme_general\n\nfig2.13\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/bissau-2.png){width=90%}\n:::\n:::\n\n\n## Recurrent episodes in affective disorders {.unnumbered}\n\n\n\n::: {.cell file='R/chapter2_affective.r' hash='Ch2_cache/html/affective_5111495e25dbfd9f01a4f74c4fe13623'}\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n# Table 2.13 \n#------------------------------------------------------------------#\n\naffective <- data.frame(read.csv(\"data/affective.csv\"))\naffective$wait <- with(affective, stop - start)\n\n\n# Cox model for 1., 2., 3., 4. episode 'Markov': Column 1\nlibrary(survival)\ntidy(coxph(Surv(start, stop, status == 1) ~ bip, \n                        data = subset(affective, episode == 1 & state == 0), \n                        method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip      0.355     0.250      1.42   0.155\n```\n:::\n\n```{.r .cell-code}\ntidy(coxph(Surv(start, stop, status == 1) ~ bip, \n                        data = subset(affective, episode == 2 & state == 0), \n                        method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip      0.189     0.260     0.726   0.468\n```\n:::\n\n```{.r .cell-code}\ntidy(coxph(Surv(start, stop, status == 1) ~ bip, \n                        data = subset(affective, episode == 3 & state == 0), \n                        method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip     -0.117     0.301    -0.391   0.696\n```\n:::\n\n```{.r .cell-code}\ntidy(coxph(Surv(start, stop, status == 1) ~ bip, \n                        data = subset(affective, episode == 4 & state == 0), \n                        method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip       1.15     0.354      3.25 0.00114\n```\n:::\n\n```{.r .cell-code}\n# Cox model for 1., 2., 3., 4. episode 'Gap time': Column 2\ntidy(coxph(Surv(wait, status == 1) ~ bip, \n                        data = subset(affective, episode == 1 & state == 0), \n                        method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip      0.399     0.249      1.60   0.109\n```\n:::\n\n```{.r .cell-code}\ntidy(coxph(Surv(wait, status == 1) ~ bip, \n                     data = subset(affective, episode == 2 & state == 0), \n                     method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip      0.217     0.258     0.840   0.401\n```\n:::\n\n```{.r .cell-code}\ntidy(coxph(Surv(wait, status == 1) ~ bip, \n                     data = subset(affective, episode == 3 & state == 0), \n                     method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip     -0.111     0.287    -0.389   0.698\n```\n:::\n\n```{.r .cell-code}\ntidy(coxph(Surv(wait, status == 1) ~ bip, \n                     data = subset(affective, episode == 4 & state == 0), \n                     method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip      0.596     0.318      1.87  0.0610\n```\n:::\n\n```{.r .cell-code}\n# AG cox model, total time\ntidy(coxph(Surv(start, stop, status == 1) ~ bip, \n                        data = subset(affective, state == 0), \n                        method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic  p.value\n  <chr>    <dbl>     <dbl>     <dbl>    <dbl>\n1 bip      0.366    0.0945      3.87 0.000107\n```\n:::\n\n```{.r .cell-code}\n# AG cox model, gap time\ntidy(coxph(Surv(wait, status == 1) ~ bip, \n                   data = subset(affective, state == 0), \n                   method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip      0.126    0.0945      1.33   0.184\n```\n:::\n\n```{.r .cell-code}\n# PWP cox model, total time\ntidy(coxph(Surv(start, stop, status == 1) ~ strata(episode) + bip, \n                   data = subset(affective, state == 0), \n                   method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip      0.242     0.112      2.16  0.0310\n```\n:::\n\n```{.r .cell-code}\n# PWP cox model, gap time\ntidy(coxph(Surv(wait, status == 1) ~ strata(episode) + bip, \n                    data = subset(affective, state == 0), \n                    method = \"breslow\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n  term  estimate std.error statistic p.value\n  <chr>    <dbl>     <dbl>     <dbl>   <dbl>\n1 bip     0.0278     0.100     0.277   0.782\n```\n:::\n:::\n\n\n## Exercises {.unnumbered}\n\n### Exercise 2.1 {.unnumbered}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}