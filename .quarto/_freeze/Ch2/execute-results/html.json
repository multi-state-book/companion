{
  "hash": "807d06177ae7f1a7e1654b3d72907002",
  "result": {
    "markdown": "# Intuition for intensity models\n\n\n::: {.cell hash='Ch2_cache/html/unnamed-chunk-1_1f18510ac8ac5c30d1f813a3ad907d05'}\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: survival\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: tidyverse\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──\n✔ dplyr     1.1.0     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.1     ✔ tibble    3.1.8\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\nLoading required package: timereg\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'timereg' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: gridExtra\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'gridExtra' was built under R version\n4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'gridExtra'\n\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n:::\n:::\n\n\nArgue (intuitively) how the martingale property $E(M(t)\\mid  {\\cal H}_{s})=M(s)$ follows from $E(dM(t)\\mid {\\cal H}_{t-})=0$\n\n<!-- ## Hazard models for homogeneous groups {#homogeneous-groups} -->\n\n## Figure 2.2 {#fig2-2 .unnumbered}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npbc3<-readRDS(\"data/pbc3.rds\")\nlibrary(survival)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'survival' was built under R version 4.2.3\n```\n:::\n\n```{.r .cell-code}\nrequire(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: tidyverse\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.0     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.1     ✔ tibble    3.1.8\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nnafit <- survfit(Surv(followup, status != 0) ~ tment, data = pbc3)\nnadata <- data.frame(cumhaz = nafit$cumhaz, \n                     cumhaz_se = nafit$std.err, \n                     time = nafit$time, \n                     tment = c(rep(names(nafit$strata)[1], nafit$strata[1]), \n                               rep(names(nafit$strata)[2], nafit$strata[2])))\n\n# Create Figure 2.2\nggplot(aes(x = time, y = cumhaz, linetype = tment), data = nadata) + \n          geom_step(size = 1) + \n          scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\")) + \n          xlab(\"Time since randomization (years)\") + \n          ylab(\"Cumulative hazard\") + \n          scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)), ) + \n          scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n          theme_general\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n<!-- ### Piece-wise constant hazards -->\n\n## Figure 2.3 {#fig2-3 .unnumbered}\n\n\n::: {.cell file='R/2/pcwplot.r'}\n\n```{.r .cell-code}\nrateCyA <- c(8.1,13.1,9.6)\nratePbo <- c(9.4,12.5,8.5)\npcwtime <- c(0,2,4,5)\n\n# Collect data\nplotdata <- data.frame(rates = c(rateCyA, ratePbo),\n                       tment = c(rep(\"CyA\", length(rateCyA)), rep(\"Placebo\", length(ratePbo))),\n                       times_s = rep(pcwtime[-4], 2),\n                       times = rep(pcwtime[-1], 2))\n\n# Create Figure 2.3\nggplot(aes(x = time, y = rates, linetype = tment),\n                data = plotdata) +\n  geom_segment(aes(x = times_s, y = rates, xend = times, yend = rates), size = 1) +\n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\"))  +\n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Estimated hazard function (per 100 years)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0,14), breaks = seq(0, 14, 2)) +\n  theme_general\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Cox model {#cox-models .unnumbered}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibname h \"data\";\ndata pbc3;\n  set h.pbc3;\n  event=status ne 0; * Binary variable for events for later use;\nrun;\nproc phreg data=pbc3;\n  class tment(ref=\"0\") / param=ref;\n  model years*status(0)=tment;\nrun;\n```\n:::\n\n::: {.cell file='R/2/chapter2_pbc3.R'}\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#------- Chapter 2, R code, PBC3 data  ----------------------------#\n#------------------------------------------------------------------#\n\n# Load required packages (should be installed if not already)\nrequire(haven)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: haven\n```\n:::\n\n```{.r .cell-code}\nrequire(survival)\nrequire(ggplot2)\nrequire(timereg)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: timereg\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'timereg' was built under R version 4.2.3\n```\n:::\n\n```{.r .cell-code}\nrequire(gridExtra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: gridExtra\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'gridExtra' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'gridExtra'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n:::\n\n```{.r .cell-code}\n# Read pcb data and create a data frame\npbc3 <- read.csv(\"data/pbc3.csv\")\npbc3 <- data.frame(pbc3)\n\n# See the head of the data\nhead(pbc3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id unit days status tment sex age  bili   alb stage\n1  1    5 1168      1     1   0  58 52.04 36.00     4\n2  2    4  405      0     1   1  54 14.82 38.00     2\n3  3    3 1735      0     0   1  54  7.00 42.71     2\n4  4    2  241      0     1   0  57 95.50 36.00     4\n5  5    3  754      0     1   0  64 12.00 42.23     3\n6  6    1 1593      0     0   0  63 11.33 38.16     2\n```\n:::\n\n```{.r .cell-code}\n# Summary of the data\nsummary(pbc3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       id           unit            days            status      \n Min.   :  1   Min.   :1.000   Min.   :   1.0   Min.   :0.0000  \n 1st Qu.: 88   1st Qu.:2.000   1st Qu.: 509.0   1st Qu.:0.0000  \n Median :175   Median :3.000   Median : 929.0   Median :0.0000  \n Mean   :175   Mean   :3.037   Mean   : 942.7   Mean   :0.4327  \n 3rd Qu.:262   3rd Qu.:4.000   3rd Qu.:1290.0   3rd Qu.:1.0000  \n Max.   :349   Max.   :6.000   Max.   :2146.0   Max.   :2.0000  \n                                                                \n     tment             sex              age             bili        \n Min.   :0.0000   Min.   :0.0000   Min.   :26.00   Min.   :  2.333  \n 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:47.00   1st Qu.: 11.330  \n Median :1.0000   Median :0.0000   Median :55.00   Median : 19.270  \n Mean   :0.5043   Mean   :0.1461   Mean   :54.09   Mean   : 45.473  \n 3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:62.00   3rd Qu.: 42.330  \n Max.   :1.0000   Max.   :1.0000   Max.   :75.00   Max.   :453.100  \n                                                                    \n      alb            stage      \n Min.   :20.63   Min.   :2.000  \n 1st Qu.:35.00   1st Qu.:2.000  \n Median :38.71   Median :3.000  \n Mean   :38.37   Mean   :2.852  \n 3rd Qu.:42.00   3rd Qu.:4.000  \n Max.   :58.00   Max.   :4.000  \n NA's   :6       NA's   :58     \n```\n:::\n\n```{.r .cell-code}\n# Note that status represents status at exit \n# (0: censored, 1: liver transpl, 2 : dead)\n# Per example 1.1.1, the main event of interest is \"failure of medical treatment\" \n# this is either death or liver transplant (status %in% c(1,2))\n\n\n# tment = 0 (placebo), tment = 1 (cyA)\nwith(pbc3, table(status, tment))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      tment\nstatus   0   1\n     0 127 132\n     1  15  14\n     2  31  30\n```\n:::\n\n```{.r .cell-code}\npbc3$tment_char <- ifelse(pbc3$tment == 0, \"Placebo\", \"CyA\")\n\n#------------------------------------------------------------------#\n# -------- General plotting style ---------------------------------# \n#------------------------------------------------------------------#\n\n# # Empty data example\n# pdata <- data.frame()\n# \n# playout <- ggplot(pdata) + \n#            scale_x_continuous(expand = expansion(mult = c(0, 0))) + \n#            scale_y_continuous(expand = expansion(mult = c(0, 0))) \n# playout\n\n# Extra wishes from PKA & HNRV to be added here\ntheme_general <- theme_bw() +\n                 theme(legend.position = \"bottom\", \n                       text = element_text(size = 20), \n                       axis.text.x = element_text(size = 20), \n                       axis.text.y = element_text(size = 20)) \n                 \ntheme_general\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nList of 97\n $ line                      :List of 6\n  ..$ colour       : chr \"black\"\n  ..$ linewidth    : num 0.5\n  ..$ linetype     : num 1\n  ..$ lineend      : chr \"butt\"\n  ..$ arrow        : logi FALSE\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_line\" \"element\"\n $ rect                      :List of 5\n  ..$ fill         : chr \"white\"\n  ..$ colour       : chr \"black\"\n  ..$ linewidth    : num 0.5\n  ..$ linetype     : num 1\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_rect\" \"element\"\n $ text                      :List of 11\n  ..$ family       : chr \"\"\n  ..$ face         : chr \"plain\"\n  ..$ colour       : chr \"black\"\n  ..$ size         : num 20\n  ..$ hjust        : num 0.5\n  ..$ vjust        : num 0.5\n  ..$ angle        : num 0\n  ..$ lineheight   : num 0.9\n  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : logi FALSE\n  ..$ inherit.blank: logi FALSE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ title                     : NULL\n $ aspect.ratio              : NULL\n $ axis.title                : NULL\n $ axis.title.x              :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : NULL\n  ..$ vjust        : num 1\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 2.75points 0points 0points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.title.x.top          :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : NULL\n  ..$ vjust        : num 0\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 0points 0points 2.75points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.title.x.bottom       : NULL\n $ axis.title.y              :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : NULL\n  ..$ vjust        : num 1\n  ..$ angle        : num 90\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 0points 2.75points 0points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.title.y.left         : NULL\n $ axis.title.y.right        :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : NULL\n  ..$ vjust        : num 0\n  ..$ angle        : num -90\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 2.75points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.text                 :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : chr \"grey30\"\n  ..$ size         : 'rel' num 0.8\n  ..$ hjust        : NULL\n  ..$ vjust        : NULL\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : NULL\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.text.x               :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : num 20\n  ..$ hjust        : NULL\n  ..$ vjust        : num 1\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 2.2points 0points 0points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi FALSE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.text.x.top           :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : NULL\n  ..$ vjust        : num 0\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 0points 0points 2.2points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.text.x.bottom        : NULL\n $ axis.text.y               :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : num 20\n  ..$ hjust        : num 1\n  ..$ vjust        : NULL\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 0points 2.2points 0points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi FALSE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.text.y.left          : NULL\n $ axis.text.y.right         :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : num 0\n  ..$ vjust        : NULL\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 2.2points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ axis.ticks                :List of 6\n  ..$ colour       : chr \"grey20\"\n  ..$ linewidth    : NULL\n  ..$ linetype     : NULL\n  ..$ lineend      : NULL\n  ..$ arrow        : logi FALSE\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_line\" \"element\"\n $ axis.ticks.x              : NULL\n $ axis.ticks.x.top          : NULL\n $ axis.ticks.x.bottom       : NULL\n $ axis.ticks.y              : NULL\n $ axis.ticks.y.left         : NULL\n $ axis.ticks.y.right        : NULL\n $ axis.ticks.length         : 'simpleUnit' num 2.75points\n  ..- attr(*, \"unit\")= int 8\n $ axis.ticks.length.x       : NULL\n $ axis.ticks.length.x.top   : NULL\n $ axis.ticks.length.x.bottom: NULL\n $ axis.ticks.length.y       : NULL\n $ axis.ticks.length.y.left  : NULL\n $ axis.ticks.length.y.right : NULL\n $ axis.line                 : list()\n  ..- attr(*, \"class\")= chr [1:2] \"element_blank\" \"element\"\n $ axis.line.x               : NULL\n $ axis.line.x.top           : NULL\n $ axis.line.x.bottom        : NULL\n $ axis.line.y               : NULL\n $ axis.line.y.left          : NULL\n $ axis.line.y.right         : NULL\n $ legend.background         :List of 5\n  ..$ fill         : NULL\n  ..$ colour       : logi NA\n  ..$ linewidth    : NULL\n  ..$ linetype     : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_rect\" \"element\"\n $ legend.margin             : 'margin' num [1:4] 5.5points 5.5points 5.5points 5.5points\n  ..- attr(*, \"unit\")= int 8\n $ legend.spacing            : 'simpleUnit' num 11points\n  ..- attr(*, \"unit\")= int 8\n $ legend.spacing.x          : NULL\n $ legend.spacing.y          : NULL\n $ legend.key                :List of 5\n  ..$ fill         : chr \"white\"\n  ..$ colour       : logi NA\n  ..$ linewidth    : NULL\n  ..$ linetype     : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_rect\" \"element\"\n $ legend.key.size           : 'simpleUnit' num 1.2lines\n  ..- attr(*, \"unit\")= int 3\n $ legend.key.height         : NULL\n $ legend.key.width          : NULL\n $ legend.text               :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : 'rel' num 0.8\n  ..$ hjust        : NULL\n  ..$ vjust        : NULL\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : NULL\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ legend.text.align         : NULL\n $ legend.title              :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : num 0\n  ..$ vjust        : NULL\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : NULL\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ legend.title.align        : NULL\n $ legend.position           : chr \"bottom\"\n $ legend.direction          : NULL\n $ legend.justification      : chr \"center\"\n $ legend.box                : NULL\n $ legend.box.just           : NULL\n $ legend.box.margin         : 'margin' num [1:4] 0cm 0cm 0cm 0cm\n  ..- attr(*, \"unit\")= int 1\n $ legend.box.background     : list()\n  ..- attr(*, \"class\")= chr [1:2] \"element_blank\" \"element\"\n $ legend.box.spacing        : 'simpleUnit' num 11points\n  ..- attr(*, \"unit\")= int 8\n $ panel.background          :List of 5\n  ..$ fill         : chr \"white\"\n  ..$ colour       : logi NA\n  ..$ linewidth    : NULL\n  ..$ linetype     : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_rect\" \"element\"\n $ panel.border              :List of 5\n  ..$ fill         : logi NA\n  ..$ colour       : chr \"grey20\"\n  ..$ linewidth    : NULL\n  ..$ linetype     : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_rect\" \"element\"\n $ panel.spacing             : 'simpleUnit' num 5.5points\n  ..- attr(*, \"unit\")= int 8\n $ panel.spacing.x           : NULL\n $ panel.spacing.y           : NULL\n $ panel.grid                :List of 6\n  ..$ colour       : chr \"grey92\"\n  ..$ linewidth    : NULL\n  ..$ linetype     : NULL\n  ..$ lineend      : NULL\n  ..$ arrow        : logi FALSE\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_line\" \"element\"\n $ panel.grid.major          : NULL\n $ panel.grid.minor          :List of 6\n  ..$ colour       : NULL\n  ..$ linewidth    : 'rel' num 0.5\n  ..$ linetype     : NULL\n  ..$ lineend      : NULL\n  ..$ arrow        : logi FALSE\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_line\" \"element\"\n $ panel.grid.major.x        : NULL\n $ panel.grid.major.y        : NULL\n $ panel.grid.minor.x        : NULL\n $ panel.grid.minor.y        : NULL\n $ panel.ontop               : logi FALSE\n $ plot.background           :List of 5\n  ..$ fill         : NULL\n  ..$ colour       : chr \"white\"\n  ..$ linewidth    : NULL\n  ..$ linetype     : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_rect\" \"element\"\n $ plot.title                :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : 'rel' num 1.2\n  ..$ hjust        : num 0\n  ..$ vjust        : num 1\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 0points 0points 5.5points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ plot.title.position       : chr \"panel\"\n $ plot.subtitle             :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : num 0\n  ..$ vjust        : num 1\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 0points 0points 5.5points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ plot.caption              :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : 'rel' num 0.8\n  ..$ hjust        : num 1\n  ..$ vjust        : num 1\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 5.5points 0points 0points 0points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ plot.caption.position     : chr \"panel\"\n $ plot.tag                  :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : 'rel' num 1.2\n  ..$ hjust        : num 0.5\n  ..$ vjust        : num 0.5\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : NULL\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ plot.tag.position         : chr \"topleft\"\n $ plot.margin               : 'margin' num [1:4] 5.5points 5.5points 5.5points 5.5points\n  ..- attr(*, \"unit\")= int 8\n $ strip.background          :List of 5\n  ..$ fill         : chr \"grey85\"\n  ..$ colour       : chr \"grey20\"\n  ..$ linewidth    : NULL\n  ..$ linetype     : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_rect\" \"element\"\n $ strip.background.x        : NULL\n $ strip.background.y        : NULL\n $ strip.clip                : chr \"inherit\"\n $ strip.placement           : chr \"inside\"\n $ strip.text                :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : chr \"grey10\"\n  ..$ size         : 'rel' num 0.8\n  ..$ hjust        : NULL\n  ..$ vjust        : NULL\n  ..$ angle        : NULL\n  ..$ lineheight   : NULL\n  ..$ margin       : 'margin' num [1:4] 4.4points 4.4points 4.4points 4.4points\n  .. ..- attr(*, \"unit\")= int 8\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ strip.text.x              : NULL\n $ strip.text.x.bottom       : NULL\n $ strip.text.x.top          : NULL\n $ strip.text.y              :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : NULL\n  ..$ vjust        : NULL\n  ..$ angle        : num -90\n  ..$ lineheight   : NULL\n  ..$ margin       : NULL\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ strip.text.y.left         :List of 11\n  ..$ family       : NULL\n  ..$ face         : NULL\n  ..$ colour       : NULL\n  ..$ size         : NULL\n  ..$ hjust        : NULL\n  ..$ vjust        : NULL\n  ..$ angle        : num 90\n  ..$ lineheight   : NULL\n  ..$ margin       : NULL\n  ..$ debug        : NULL\n  ..$ inherit.blank: logi TRUE\n  ..- attr(*, \"class\")= chr [1:2] \"element_text\" \"element\"\n $ strip.text.y.right        : NULL\n $ strip.switch.pad.grid     : 'simpleUnit' num 2.75points\n  ..- attr(*, \"unit\")= int 8\n $ strip.switch.pad.wrap     : 'simpleUnit' num 2.75points\n  ..- attr(*, \"unit\")= int 8\n - attr(*, \"class\")= chr [1:2] \"theme\" \"gg\"\n - attr(*, \"complete\")= logi TRUE\n - attr(*, \"validate\")= logi TRUE\n```\n:::\n\n```{.r .cell-code}\n# Question: Legend position?\n\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.1 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Fit a Nelson Aalen estimate of the cumulative hazard using the pbc3 data\n# Stratifying on treatment (i.e. doing it per treatment)\nnafit <- survfit(Surv(days, status != 0) ~ tment, data = pbc3)\n\n# Summary of fit\nsummary(nafit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(days, status != 0) ~ tment, data = pbc3)\n\n                tment=0 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n   24    173       1    0.994 0.00576        0.983        1.000\n   98    171       1    0.988 0.00815        0.973        1.000\n  114    170       1    0.983 0.00996        0.963        1.000\n  117    169       1    0.977 0.01148        0.955        1.000\n  133    167       1    0.971 0.01281        0.946        0.996\n  169    165       1    0.965 0.01402        0.938        0.993\n  193    164       1    0.959 0.01512        0.930        0.989\n  199    162       1    0.953 0.01614        0.922        0.985\n  213    160       1    0.947 0.01711        0.914        0.981\n  249    159       1    0.941 0.01801        0.907        0.977\n  254    158       1    0.935 0.01885        0.899        0.973\n  261    157       1    0.929 0.01965        0.892        0.969\n  339    153       1    0.923 0.02044        0.884        0.964\n  351    152       1    0.917 0.02119        0.877        0.960\n  366    146       1    0.911 0.02196        0.869        0.955\n  368    145       1    0.905 0.02269        0.861        0.950\n  371    144       1    0.898 0.02338        0.854        0.945\n  379    143       1    0.892 0.02405        0.846        0.941\n  396    139       1    0.886 0.02472        0.839        0.936\n  413    138       1    0.879 0.02536        0.831        0.930\n  425    137       1    0.873 0.02597        0.823        0.925\n  429    136       1    0.866 0.02656        0.816        0.920\n  430    135       1    0.860 0.02713        0.808        0.915\n  487    131       1    0.853 0.02770        0.801        0.910\n  489    130       1    0.847 0.02826        0.793        0.904\n  592    122       1    0.840 0.02887        0.785        0.898\n  714    108       1    0.832 0.02963        0.776        0.892\n  786    102       1    0.824 0.03044        0.766        0.886\n  791    100       1    0.816 0.03123        0.757        0.879\n  821     93       1    0.807 0.03210        0.746        0.872\n  865     92       1    0.798 0.03293        0.736        0.865\n  928     87       1    0.789 0.03381        0.726        0.858\n  945     85       1    0.780 0.03466        0.715        0.851\n  985     80       1    0.770 0.03557        0.703        0.843\n  995     79       1    0.760 0.03643        0.692        0.835\n 1046     76       1    0.750 0.03730        0.681        0.827\n 1105     73       1    0.740 0.03818        0.669        0.819\n 1127     69       1    0.729 0.03910        0.657        0.810\n 1198     61       1    0.717 0.04025        0.643        0.801\n 1265     50       1    0.703 0.04192        0.625        0.790\n 1324     40       1    0.685 0.04441        0.604        0.778\n 1325     39       2    0.650 0.04859        0.562        0.753\n 1423     33       1    0.631 0.05096        0.538        0.739\n 1647     20       1    0.599 0.05734        0.497        0.723\n 1859      7       1    0.513 0.09323        0.360        0.733\n\n                tment=1 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n   35    172       1    0.994  0.0058        0.983        1.000\n  107    170       1    0.988  0.0082        0.972        1.000\n  146    168       1    0.982  0.0100        0.963        1.000\n  156    167       1    0.977  0.0116        0.954        1.000\n  195    165       1    0.971  0.0129        0.946        0.996\n  221    164       1    0.965  0.0141        0.937        0.993\n  235    163       1    0.959  0.0152        0.929        0.989\n  264    159       1    0.953  0.0163        0.921        0.985\n  280    158       1    0.947  0.0173        0.913        0.981\n  286    157       1    0.941  0.0182        0.906        0.977\n  347    154       1    0.935  0.0191        0.898        0.973\n  362    151       1    0.928  0.0199        0.890        0.968\n  367    148       1    0.922  0.0207        0.882        0.964\n  378    147       1    0.916  0.0215        0.875        0.959\n  461    140       1    0.909  0.0224        0.867        0.954\n  472    138       1    0.903  0.0231        0.859        0.949\n  562    134       1    0.896  0.0239        0.850        0.944\n  612    128       1    0.889  0.0247        0.842        0.939\n  625    127       1    0.882  0.0255        0.833        0.933\n  639    125       2    0.868  0.0270        0.817        0.922\n  669    119       1    0.861  0.0277        0.808        0.917\n  679    117       1    0.853  0.0285        0.799        0.911\n  691    114       1    0.846  0.0292        0.790        0.905\n  743    111       1    0.838  0.0299        0.782        0.899\n  766    104       1    0.830  0.0307        0.772        0.892\n  916     91       1    0.821  0.0317        0.761        0.885\n  931     88       1    0.812  0.0326        0.750        0.878\n  962     83       1    0.802  0.0337        0.738        0.871\n  978     80       1    0.792  0.0347        0.727        0.863\n 1043     77       1    0.782  0.0358        0.715        0.855\n 1066     74       1    0.771  0.0368        0.702        0.847\n 1134     69       1    0.760  0.0379        0.689        0.838\n 1166     64       1    0.748  0.0392        0.675        0.829\n 1168     63       1    0.736  0.0403        0.661        0.819\n 1169     62       1    0.724  0.0414        0.648        0.810\n 1171     61       1    0.712  0.0423        0.634        0.800\n 1238     57       1    0.700  0.0434        0.620        0.790\n 1249     55       1    0.687  0.0444        0.605        0.780\n 1290     46       1    0.672  0.0459        0.588        0.768\n 1391     37       1    0.654  0.0481        0.566        0.755\n 1433     34       1    0.635  0.0504        0.543        0.742\n 1547     24       1    0.608  0.0548        0.510        0.726\n 1703     14       1    0.565  0.0659        0.449        0.710\n```\n:::\n\n```{.r .cell-code}\n# Collect data for plot\n# Note that the standard errors produced by survfit are for the cumulative hazard\nnadata <- data.frame(cumhaz = nafit$cumhaz, \n                     cumhaz_se = nafit$std.err, \n                     time = nafit$time, \n                     tment = c(rep(names(nafit$strata)[1], nafit$strata[1]), \n                               rep(names(nafit$strata)[2], nafit$strata[2])))\n\n# Create Figure 2.1\nfig21 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = tment), data = nadata) + \n          geom_step(size = 1) + \n          scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\")) + \n          xlab(\"Time since randomization (years)\") + \n          ylab(\"Cumulative hazard\") + \n          scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                             limits = c(0, 6),\n                             breaks = seq(0, 6, 1))  + \n          scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n          theme_general + \n      theme(legend.position=\"bottom\",\n            legend.box=\"vertical\")\n\nfig21\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3NAatreat.pdf\", plot = fig21, \n       width = 29.7, height = 21, units = \"cm\")\n\n# Estimates after two years\n# Treatment 0, observation after two years\ntail(subset(nadata, nadata$time <= 2 & nadata$tment == \"tment=0\"),1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] cumhaz    cumhaz_se time      tment    \n<0 rows> (or 0-length row.names)\n```\n:::\n\n```{.r .cell-code}\n# Treatment 1, observation after two years\ntail(subset(nadata, nadata$time <= 2 & nadata$tment == \"tment=1\"),1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    cumhaz cumhaz_se time   tment\n151      0         0    1 tment=1\n```\n:::\n\n```{.r .cell-code}\n# Log rank test for treatment \nsurvdiff(Surv(days, status != 0) ~ tment, data = pbc3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(days, status != 0) ~ tment, data = pbc3)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ntment=0 173       46     44.7    0.0388    0.0771\ntment=1 176       44     45.3    0.0382    0.0771\n\n Chisq= 0.1  on 1 degrees of freedom, p= 0.8 \n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Table 2.1 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Descriptive statistics\nwith(pbc3, table(tment, status))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     status\ntment   0   1   2\n    0 127  15  31\n    1 132  14  30\n```\n:::\n\n```{.r .cell-code}\n# Cuts\ncuts <- c(0, 2, 4) * 365.25\n\n# event/failure indicator\npbc3$fail <- ifelse(pbc3$status != 0, 1, 0)\n\n# Make the data ready using survSplit\npbc3mult <- survSplit(Surv(days, fail) ~ ., \n                      pbc3,\n                      cut = cuts[-1], \n                      episode = \"timegroup\")\n\n# Number of observations per interval (timegroup)\nwith(pbc3mult, table(tment, timegroup))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     timegroup\ntment   1   2   3\n    0 173 106  29\n    1 176 111  28\n```\n:::\n\n```{.r .cell-code}\n# Risk time\npbc3mult$risktime <- pbc3mult$days - cuts[pbc3mult$timegroup] \n\n\n# Summarize\nrequire(dplyr)\nsumdata <- pbc3mult %>% \n  group_by(tment, timegroup) %>% \n  summarise(fail = sum(fail), \n            risktime = sum(days - cuts[timegroup])#,\n            #logrisktime = sum(log(days))\n            )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'tment'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nsumdata <- as.data.frame(sumdata)\nsumdata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  tment timegroup fail risktime\n1     0         1   27 104856.0\n2     0         2   17  49673.0\n3     0         3    2   8642.0\n4     1         1   24 107931.5\n5     1         2   18  50284.5\n6     1         3    2   7599.0\n```\n:::\n\n```{.r .cell-code}\n# Poisson model for treatment = 1\nrequire(stats)\npoismod_trt1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) - 1, \n                    data = subset(pbc3mult, tment == 1), \n                    family = poisson)\n\nsummary(poismod_trt1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) - \n    1, family = poisson, data = subset(pbc3mult, tment == 1))\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-0.7232  -0.5700  -0.5700  -0.3295   2.9711  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \nas.factor(timegroup)1  -8.4112     0.2041  -41.21   <2e-16 ***\nas.factor(timegroup)2  -7.9351     0.2357  -33.67   <2e-16 ***\nas.factor(timegroup)3  -8.2426     0.7071  -11.66   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 331041.87  on 315  degrees of freedom\nResidual deviance:    222.24  on 312  degrees of freedom\nAIC: 316.24\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# Transform back to original scale (delta method)\nexp(poismod_trt1$coefficients)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nas.factor(timegroup)1 as.factor(timegroup)2 as.factor(timegroup)3 \n         0.0002223633          0.0003579632          0.0002631925 \n```\n:::\n\n```{.r .cell-code}\n# Standard errors\nsqrt(diag(vcov(poismod_trt1))) * exp(poismod_trt1$coefficients)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nas.factor(timegroup)1 as.factor(timegroup)2 as.factor(timegroup)3 \n         4.538928e-05          8.437217e-05          1.861008e-04 \n```\n:::\n\n```{.r .cell-code}\n# Poisson model for treatment = 0\npoismod_trt0 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) - 1, \n                    data = subset(pbc3mult, tment == 0), \n                    family = poisson)\n\nsummary(poismod_trt0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) - \n    1, family = poisson, data = subset(pbc3mult, tment == 0))\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-0.7071  -0.6133  -0.6000  -0.3545   2.8610  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \nas.factor(timegroup)1  -8.2645     0.1924  -42.95   <2e-16 ***\nas.factor(timegroup)2  -7.9800     0.2425  -32.90   <2e-16 ***\nas.factor(timegroup)3  -8.3712     0.7071  -11.84   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 325736.02  on 308  degrees of freedom\nResidual deviance:    237.11  on 305  degrees of freedom\nAIC: 335.11\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# Transform back to original scale (delta method)\nexp(poismod_trt0$coefficients)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nas.factor(timegroup)1 as.factor(timegroup)2 as.factor(timegroup)3 \n         0.0002574960          0.0003422382          0.0002314279 \n```\n:::\n\n```{.r .cell-code}\n# Standard errors\nsqrt(diag(vcov(poismod_trt0))) * exp(poismod_trt0$coefficients)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nas.factor(timegroup)1 as.factor(timegroup)2 as.factor(timegroup)3 \n         4.955403e-05          8.300432e-05          1.636441e-04 \n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Figure 2.3 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Rates + cuts from Table 2.1\nrateCyA <- c(8.1,13.1,9.6)\nratePbo <- c(9.4,12.5,8.5)\npcwtime <- c(0,2,4,5)\n\n# Collect data\nplotdata <- data.frame(rates = c(rateCyA, ratePbo),\n                       tment = c(rep(\"CyA\", length(rateCyA)), rep(\"Placebo\", length(ratePbo))),\n                       times_s = rep(pcwtime[-4], 2),\n                       times = rep(pcwtime[-1], 2))\n\n\n# Create Figure 2.3\nfig23 <- ggplot(aes(x = time, y = rates, linetype = tment),\n                data = plotdata) +\n  geom_segment(aes(x = times_s, y = rates, xend = times, yend = rates), size = 1) +\n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\"))  +\n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Estimated hazard function (per 100 years)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 5),\n                     breaks = seq(0, 5, 1))  +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0,14), breaks = seq(0, 14, 2)) +\n  theme_general\n\nfig23\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3pwchestimates.pdf\", plot = fig23, \n       width = 29.7, height = 21, units = \"cm\")\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.4 --------------------------------------#\n#------------------------------------------------------------------#\n\n# NA data from figure 2.1 model fit\ntment1 <- subset(nadata, tment == \"tment=1\")\n\n# Estimated hazard per time group\nsumdata$hazard_timegroup <- sumdata$fail / sumdata$risktime\n\n# View data\nhead(sumdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  tment timegroup fail risktime hazard_timegroup\n1     0         1   27 104856.0     0.0002574960\n2     0         2   17  49673.0     0.0003422382\n3     0         3    2   8642.0     0.0002314279\n4     1         1   24 107931.5     0.0002223633\n5     1         2   18  50284.5     0.0003579632\n6     1         3    2   7599.0     0.0002631925\n```\n:::\n\n```{.r .cell-code}\n# Add a numeric version of the treatment to the NA estimates\nnadata$tmentnum <- ifelse(nadata$tment == \"tment=1\", 1, 0)\n\nhead(nadata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       cumhaz   cumhaz_se time   tment tmentnum\n1 0.005780347 0.005797126   24 tment=0        0\n2 0.005780347 0.005797126   87 tment=0        0\n3 0.011628300 0.008246599   98 tment=0        0\n4 0.017510653 0.010139685  114 tment=0        0\n5 0.023427813 0.011748804  117 tment=0        0\n6 0.023427813 0.011748804  130 tment=0        0\n```\n:::\n\n```{.r .cell-code}\n# Add piecewise constant hazard to data\nnadata$pwch <- NULL\n\n# Between time 0 and 2\nnadata$pwch[nadata$time <= 2 * 365.25] <- nadata$time[nadata$time <= 2 * 365.25] * \n                                 (sumdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time <= 2 * 365.25]) + \n                                  sumdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time <= 2 * 365.25]))\n# Between time 2 and 4\nnadata$pwch[nadata$time > 2 * 365.25 & nadata$time <= 4* 365.25 ] <- 2 * 365.25 * \n  (sumdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]) + \n     sumdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25])) + \n  (nadata$time[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25] - 2 * 365.25) * \n  (sumdata$hazard_timegroup[2] * (1-nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]) + \n     sumdata$hazard_timegroup[5] * (nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]))\n  \n# After time 4\nnadata$pwch[nadata$time > 4 * 365.25] <- 2 * 365.25 * \n  (sumdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     sumdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time > 4 * 365.25])) + \n   2 * 365.25 * \n  (sumdata$hazard_timegroup[2] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     sumdata$hazard_timegroup[5] * (nadata$tmentnum[nadata$time > 4 * 365.25])) + \n  (nadata$time[nadata$time > 4 * 365.25] - 4 * 365.25) * \n  (sumdata$hazard_timegroup[3] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     sumdata$hazard_timegroup[6] * (nadata$tmentnum[nadata$time > 4 * 365.25]))\n\n# View the data \nhead(nadata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       cumhaz   cumhaz_se time   tment tmentnum        pwch\n1 0.005780347 0.005797126   24 tment=0        0 0.006179904\n2 0.005780347 0.005797126   87 tment=0        0 0.022402152\n3 0.011628300 0.008246599   98 tment=0        0 0.025234607\n4 0.017510653 0.010139685  114 tment=0        0 0.029354543\n5 0.023427813 0.011748804  117 tment=0        0 0.030127031\n6 0.023427813 0.011748804  130 tment=0        0 0.033474479\n```\n:::\n\n```{.r .cell-code}\n# Reformat for plot\npiecepdata <- data.frame(cumhaz = c(nadata$cumhaz, nadata$pwch), \n                         time = rep(nadata$time, 2),\n                         tmentnum = rep(nadata$tmentnum, 2),\n                         type = c(rep(\"Nelson-Aalen\", length(nadata$time)), \n                                  rep(\"Piece-wise exponential\", length(nadata$time))))\n# Only for treatment 1\npiecepdata1 <- subset(piecepdata, tmentnum == 1)\n\n\n# Create Figure 2.4\nfig24 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = type), \n                data = subset(piecepdata1, type == \"Nelson-Aalen\")) + \n  geom_step(size = 1) + \n  geom_line(aes(x = time / 365.25, y = cumhaz, linetype = type), size = 1,\n            data = subset(piecepdata1, type == \"Piece-wise exponential\")) + \n  labs(linetype = \"Type\") + \n  xlab(\"Time since randomization (years)\") + \n  ylab(\"Cumulative hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1))  + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general\n\nfig24\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-3.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3pwchplac.pdf\", plot = fig24, \n       width = 29.7, height = 21, units = \"cm\")\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.5 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Fit a Cox model using the pbc3 data with treatment as a covariate\ncoxfit <- coxph(Surv(days, status != 0) ~ tment, data = pbc3, method = \"breslow\")\n\n# Summary of fit\nsummary(coxfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment, data = pbc3, \n    method = \"breslow\")\n\n  n= 349, number of events= 90 \n\n          coef exp(coef) se(coef)      z Pr(>|z|)\ntment -0.05854   0.94314  0.21092 -0.278    0.781\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntment    0.9431       1.06    0.6238     1.426\n\nConcordance= 0.517  (se = 0.029 )\nLikelihood ratio test= 0.08  on 1 df,   p=0.8\nWald test            = 0.08  on 1 df,   p=0.8\nScore (logrank) test = 0.08  on 1 df,   p=0.8\n```\n:::\n\n```{.r .cell-code}\n# Extract cumulative baseline hazard\ncoxcumhaz <- basehaz(coxfit, centered = FALSE)\n\n# Collect data for plot\ncoxdata <- data.frame(cumhaz = coxcumhaz$hazard, \n                      time = coxcumhaz$time, \n                      tment = rep(\"0\", nrow(coxcumhaz)), \n                      type = rep(\"Breslow estimate\", nrow(coxcumhaz)))\n\n# Create Figure 2.5\nfig25 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = tment), data = coxdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") + \n  ylab(\"Cumulative baseline hazard\") + \n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\")) + \n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general\n\nfig25\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-4.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3breslow.pdf\", plot = fig25, \n       width = 29.7, height = 21, units = \"cm\")\n\n\n#------------------------------------------------------------------#\n#---------------- Table 2.3 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Calculate average covariate values of albumin and bilirubin per treatment group\n\n# Summarize\nrequire(dplyr)\nsumdata <- pbc3 %>% \n  group_by(tment, tment_char) %>% \n  summarise(n = sum(id != 0),  \n            average_albumin = mean(alb, na.rm = TRUE), # NOTE: Removes missing observations from mean computation\n            average_bilirubin = mean(bili, na.rm = TRUE), \n            )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'tment'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nsumdata <- as.data.frame(sumdata)\nsumdata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  tment tment_char   n average_albumin average_bilirubin\n1     0    Placebo 173        39.26101          42.33674\n2     1        CyA 176        37.50731          48.55540\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Table 2.4 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Cox model with treatment, albumin and bilirubin as covariates \n\ncoxfit <- coxph(Surv(days, status != 0) ~ tment + alb + bili,\n                data = pbc3)\n\nsummary(coxfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + bili, \n    data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n            coef  exp(coef)   se(coef)      z Pr(>|z|)    \ntment -0.4965639  0.6086184  0.2256162 -2.201   0.0277 *  \nalb   -0.1156596  0.8907784  0.0212810 -5.435 5.48e-08 ***\nbili   0.0089494  1.0089895  0.0009801  9.131  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntment    0.6086     1.6431    0.3911    0.9471\nalb      0.8908     1.1226    0.8544    0.9287\nbili     1.0090     0.9911    1.0071    1.0109\n\nConcordance= 0.806  (se = 0.021 )\nLikelihood ratio test= 99.06  on 3 df,   p=<2e-16\nWald test            = 121  on 3 df,   p=<2e-16\nScore (logrank) test = 172.3  on 3 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Table 2.5 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Poisson model with treatment, albumin and bilirubin as covariates\n\npbc3mult$tment_char <- as.factor(pbc3mult$tment_char)\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\n\npoismod_t25 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili,\n                   data = pbc3mult,\n                   family = poisson)\n\nsummary(poismod_t25)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.4119  -0.5253  -0.3722  -0.2312   2.8728  \n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -4.7682896  0.9749615  -4.891  1.0e-06 ***\nas.factor(timegroup)1 -0.3196440  0.6042836  -0.529   0.5968    \nas.factor(timegroup)2  0.5381074  0.6022200   0.894   0.3716    \ntment_charPlacebo      0.4753406  0.2240970   2.121   0.0339 *  \nalb                   -0.1123359  0.0212829  -5.278  1.3e-07 ***\nbili                   0.0084593  0.0009392   9.007  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.73  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 538.73\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Table 2.6 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Add transformations of covariates \npbc3$albnorm <- with(pbc3, (alb-35)*(alb>35))\npbc3$alb10 <- with(pbc3, alb/10)\npbc3$alb2 <- with(pbc3, alb10*alb10)\n\npbc3$bilihigh <- with(pbc3, (bili-17.1)*(bili>17.1))\npbc3$bilitoohigh <- with(pbc3, (bili-34.2)*(bili>34.2))\npbc3$bilimuchtoohigh <- with(pbc3, (bili-51.3)*(bili>51.3))\npbc3$bili100 <- with(pbc3, bili/100)\npbc3$bili2 <- with(pbc3, bili100*bili100)\n\npbc3$log2bili <- with(pbc3, log2(bili))\npbc3$logbilihigh <- with(pbc3, (log2bili-log2(17.1))*(bili>17.1))\npbc3$logbilitoohigh <- with(pbc3, (log2bili-log2(34.2))*(bili>34.2))\npbc3$logbilimuchtoohigh <- with(pbc3, (log2bili-log2(51.3))*(bili>51.3))\npbc3$log2bili2 <- with(pbc3, log2bili*log2bili)\n\n\n\n# Make the data ready using survSplit\npbc3mult <- survSplit(Surv(days, fail) ~ ., \n                      pbc3,\n                      cut = cuts[-1], \n                      episode = \"timegroup\")\n\n# Risk time\npbc3mult$risktime <- pbc3mult$days - cuts[pbc3mult$timegroup] \n\n\n## Poisson models ##\n\n# For comparison, LR test\nbase_poismod <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili,\n                data = pbc3mult,\n                family = poisson)\n\nbase_poismod_log <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                    data = pbc3mult,\n                    family = poisson)\n\n## Linear effects \n# Poisson model 1\npoismod_t26_l1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili + albnorm,\n                   data = pbc3mult,\n                   family = poisson)\n\nsummary(poismod_t26_l1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili + albnorm, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.3941  -0.5301  -0.3640  -0.2200   2.9953  \n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -5.1177409  1.6273358  -3.145  0.00166 ** \nas.factor(timegroup)1 -0.3106216  0.6042733  -0.514  0.60722    \nas.factor(timegroup)2  0.5433694  0.6022062   0.902  0.36690    \ntment_charCyA         -0.4576984  0.2247281  -2.037  0.04168 *  \nalb                   -0.0864388  0.0451742  -1.913  0.05569 .  \nbili                   0.0084777  0.0009419   9.001  < 2e-16 ***\nalbnorm               -0.0473832  0.0720301  -0.658  0.51065    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.28  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 540.28\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# LR test\nrequire(lmtest)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: lmtest\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'lmtest' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'zoo' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n```{.r .cell-code}\nlrtest(poismod_t26_l1, \n       base_poismod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + bili + albnorm\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -263.14                     \n2   6 -263.36 -1 0.4404     0.5069\n```\n:::\n\n```{.r .cell-code}\n# Small error in table, test statistic = 0.44 (not 0.43)\n\n\n# Poisson model 2\npoismod_t26_l2 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                       bili + bilihigh + bilitoohigh + bilimuchtoohigh,\n                     data = pbc3mult,\n                     family = poisson)\n\nsummary(poismod_t26_l2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh, \n    family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8952  -0.4629  -0.2866  -0.1828   2.8580  \n\nCoefficients:\n                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.453990   1.368380  -4.717  2.4e-06 ***\nas.factor(timegroup)1 -0.427435   0.604700  -0.707   0.4797    \nas.factor(timegroup)2  0.425435   0.603554   0.705   0.4809    \ntment_charCyA         -0.569111   0.226892  -2.508   0.0121 *  \nalb                   -0.086487   0.021876  -3.954  7.7e-05 ***\nbili                   0.061654   0.062308   0.989   0.3224    \nbilihigh              -0.016757   0.085194  -0.197   0.8441    \nbilitoohigh            0.002652   0.052566   0.050   0.9598    \nbilimuchtoohigh       -0.042801   0.026193  -1.634   0.1022    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 326.18  on 602  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.18\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(poismod_t26_l2, \n       base_poismod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   9 -251.09                         \n2   6 -263.36 -3 24.545  1.922e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Poisson model 3\npoismod_t26_l3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                       log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh,\n                     data = pbc3mult,\n                     family = poisson)\n\nsummary(poismod_t26_l3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + logbilihigh + logbilitoohigh + \n    logbilimuchtoohigh, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.7543  -0.4596  -0.2891  -0.1818   2.8323  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.52003    1.99572  -3.267 0.001087 ** \nas.factor(timegroup)1 -0.40679    0.60392  -0.674 0.500579    \nas.factor(timegroup)2  0.41834    0.60355   0.693 0.488223    \ntment_charCyA         -0.55563    0.22703  -2.447 0.014390 *  \nalb                   -0.08440    0.02181  -3.870 0.000109 ***\nlog2bili               0.19800    0.46549   0.425 0.670583    \nlogbilihigh            0.88154    0.91202   0.967 0.333756    \nlogbilitoohigh        -0.23363    1.27745  -0.183 0.854884    \nlogbilimuchtoohigh    -0.31390    0.97076  -0.323 0.746425    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.54  on 602  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 521.54\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(poismod_t26_l3, \n       base_poismod_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   9 -251.77                     \n2   6 -252.62 -3 1.7135     0.6339\n```\n:::\n\n```{.r .cell-code}\n## Quadratic effects\n\n# For comparison, LR test\nbase_poismod2 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + bili100,\n                    data = pbc3mult,\n                    family = poisson)\n\nbase_poismod2_log <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + log2bili,\n                        data = pbc3mult,\n                        family = poisson)\n\n\n\n# Poisson model 1\npoismod_t26_q1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + alb2 + bili100,\n                     data = pbc3mult,\n                     family = poisson)\n\nsummary(poismod_t26_q1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb10 + alb2 + bili100, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.4115  -0.5237  -0.3725  -0.2325   2.8197  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -3.82798    3.81418  -1.004   0.3156    \nas.factor(timegroup)1 -0.32278    0.60484  -0.534   0.5936    \nas.factor(timegroup)2  0.53621    0.60243   0.890   0.3734    \ntment_charCyA         -0.47868    0.22585  -2.119   0.0341 *  \nalb10                 -1.38772    2.10146  -0.660   0.5090    \nalb2                   0.03705    0.29295   0.126   0.8993    \nbili100                0.84614    0.09391   9.010   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.71  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 540.71\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(poismod_t26_q1, \n       base_poismod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + alb2 + bili100\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + bili100\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -263.36                     \n2   6 -263.36 -1 0.0158     0.8999\n```\n:::\n\n```{.r .cell-code}\n# Poisson model 2\npoismod_t26_q2 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + bili2 + bili100,\n                      data = pbc3mult,\n                      family = poisson)\n\nsummary(poismod_t26_q2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb10 + bili2 + bili100, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.0659  -0.4868  -0.3398  -0.2141   2.8447  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -5.16310    1.05317  -4.902 9.47e-07 ***\nas.factor(timegroup)1 -0.38186    0.60472  -0.631  0.52774    \nas.factor(timegroup)2  0.45545    0.60332   0.755  0.45030    \ntment_charCyA         -0.49873    0.22169  -2.250  0.02447 *  \nalb10                 -0.97736    0.21632  -4.518 6.24e-06 ***\nbili2                 -0.31517    0.09069  -3.475  0.00051 ***\nbili100                1.99829    0.32664   6.118 9.49e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 337.38  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 527.38\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(poismod_t26_q2, \n       base_poismod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + bili2 + bili100\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + bili100\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   7 -256.69                         \n2   6 -263.36 -1 13.345  0.0002591 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Poisson model 3\npoismod_t26_q3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + log2bili + log2bili2,\n                      data = pbc3mult,\n                      family = poisson)\n\nsummary(poismod_t26_q3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb10 + log2bili + log2bili2, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8927  -0.4832  -0.2981  -0.1830   2.9953  \n\nCoefficients:\n                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -7.860086   1.851557  -4.245 2.18e-05 ***\nas.factor(timegroup)1 -0.406020   0.604625  -0.672   0.5019    \nas.factor(timegroup)2  0.439074   0.603467   0.728   0.4669    \ntment_charCyA         -0.545495   0.222667  -2.450   0.0143 *  \nalb10                 -0.871058   0.218920  -3.979 6.92e-05 ***\nlog2bili               0.627828   0.497489   1.262   0.2070    \nlog2bili2              0.001641   0.042356   0.039   0.9691    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.25  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.25\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(poismod_t26_q3, \n       base_poismod2_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + log2bili + log2bili2\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -252.62                     \n2   6 -252.62 -1 0.0015     0.9691\n```\n:::\n\n```{.r .cell-code}\n## Cox models ##\n\n# Models for LR tests\n\nbase_coxmod <- coxph(Surv(days, status != 0) ~ tment + alb + bili, eps = 1e-8, method = \"breslow\",\n                       data = pbc3)\n\nbase_coxmod_log <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili, eps = 1e-8, method = \"breslow\",\n                     data = pbc3)\n\n\n## Linear effects \n# Cox model 1\ncoxmod_t26_l1 <- coxph(Surv(days, status != 0) ~ tment + alb + bili + albnorm, eps = 1e-8, method = \"breslow\",\n                 data = pbc3)\n\nsummary(coxmod_t26_l1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + bili + \n    albnorm, data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n              coef  exp(coef)   se(coef)      z Pr(>|z|)    \ntment   -0.4750722  0.6218402  0.2261462 -2.101   0.0357 *  \nalb     -0.0854244  0.9181225  0.0453150 -1.885   0.0594 .  \nbili     0.0089810  1.0090214  0.0009843  9.124   <2e-16 ***\nalbnorm -0.0557001  0.9458228  0.0726447 -0.767   0.4432    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n        exp(coef) exp(-coef) lower .95 upper .95\ntment      0.6218     1.6081    0.3992    0.9687\nalb        0.9181     1.0892    0.8401    1.0034\nbili       1.0090     0.9911    1.0071    1.0110\nalbnorm    0.9458     1.0573    0.8203    1.0905\n\nConcordance= 0.806  (se = 0.021 )\nLikelihood ratio test= 99.66  on 4 df,   p=<2e-16\nWald test            = 118.5  on 4 df,   p=<2e-16\nScore (logrank) test = 175.5  on 4 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(coxmod_t26_l1, base_coxmod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + bili + albnorm\nModel 2: Surv(days, status != 0) ~ tment + alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   4 -413.12                     \n2   3 -413.42 -1 0.6001     0.4386\n```\n:::\n\n```{.r .cell-code}\n# or alternatively anova(coxmod_t26_l1)\n\n# Cox model 2\ncoxmod_t26_l2 <- coxph(Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh,\n                       eps = 1e-8, method = \"breslow\",\n                       data = pbc3)\n\nsummary(coxmod_t26_l2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + bili + \n    bilihigh + bilitoohigh + bilimuchtoohigh, data = pbc3, method = \"breslow\", \n    eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n                     coef exp(coef)  se(coef)      z Pr(>|z|)    \ntment           -0.598494  0.549639  0.229637 -2.606  0.00915 ** \nalb             -0.090970  0.913045  0.021894 -4.155 3.25e-05 ***\nbili             0.062425  1.064414  0.062296  1.002  0.31631    \nbilihigh        -0.014631  0.985476  0.085327 -0.171  0.86386    \nbilitoohigh     -0.002584  0.997419  0.052961 -0.049  0.96109    \nbilimuchtoohigh -0.040017  0.960773  0.026486 -1.511  0.13082    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                exp(coef) exp(-coef) lower .95 upper .95\ntment              0.5496     1.8194    0.3504    0.8621\nalb                0.9130     1.0952    0.8747    0.9531\nbili               1.0644     0.9395    0.9421    1.2026\nbilihigh           0.9855     1.0147    0.8337    1.1649\nbilitoohigh        0.9974     1.0026    0.8991    1.1065\nbilimuchtoohigh    0.9608     1.0408    0.9122    1.0120\n\nConcordance= 0.825  (se = 0.021 )\nLikelihood ratio test= 123.5  on 6 df,   p=<2e-16\nWald test            = 110.8  on 6 df,   p=<2e-16\nScore (logrank) test = 173.9  on 6 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(coxmod_t26_l2, base_coxmod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + \n    bilimuchtoohigh\nModel 2: Surv(days, status != 0) ~ tment + alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   6 -401.22                         \n2   3 -413.42 -3 24.396  2.064e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Cox model 3\ncoxmod_t26_l3 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh,\n                       eps = 1e-8, method = \"breslow\",\n                       data = pbc3)\n\nsummary(coxmod_t26_l3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + \n    logbilihigh + logbilitoohigh + logbilimuchtoohigh, data = pbc3, \n    method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n                       coef exp(coef) se(coef)      z Pr(>|z|)    \ntment              -0.58019   0.55979  0.22957 -2.527   0.0115 *  \nalb                -0.08852   0.91528  0.02182 -4.056 4.99e-05 ***\nlog2bili            0.20135   1.22306  0.46511  0.433   0.6651    \nlogbilihigh         0.93567   2.54893  0.91503  1.023   0.3065    \nlogbilitoohigh     -0.38647   0.67945  1.29333 -0.299   0.7651    \nlogbilimuchtoohigh -0.18140   0.83410  0.98801 -0.184   0.8543    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                   exp(coef) exp(-coef) lower .95 upper .95\ntment                 0.5598     1.7864   0.35696    0.8779\nalb                   0.9153     1.0926   0.87696    0.9553\nlog2bili              1.2231     0.8176   0.49152    3.0433\nlogbilihigh           2.5489     0.3923   0.42412   15.3191\nlogbilitoohigh        0.6794     1.4718   0.05386    8.5712\nlogbilimuchtoohigh    0.8341     1.1989   0.12029    5.7838\n\nConcordance= 0.823  (se = 0.021 )\nLikelihood ratio test= 121.6  on 6 df,   p=<2e-16\nWald test            = 108.5  on 6 df,   p=<2e-16\nScore (logrank) test = 164.3  on 6 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(coxmod_t26_l3, base_coxmod_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + \n    logbilitoohigh + logbilimuchtoohigh\nModel 2: Surv(days, status != 0) ~ tment + alb + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -402.13                     \n2   3 -402.94 -3 1.6144     0.6561\n```\n:::\n\n```{.r .cell-code}\n## Quadratic effects \n# Cox model 1\ncoxmod_t26_q1 <- coxph(Surv(days, status != 0) ~ tment + alb10 + bili100 + alb2,\n                       data = pbc3)\n\nsummary(coxmod_t26_q1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb10 + bili100 + \n    alb2, data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n            coef exp(coef) se(coef)      z Pr(>|z|)    \ntment   -0.49840   0.60750  0.22743 -2.191   0.0284 *  \nalb10   -1.29704   0.27334  2.13031 -0.609   0.5426    \nbili100  0.89502   2.44739  0.09800  9.133   <2e-16 ***\nalb2     0.01971   1.01991  0.29751  0.066   0.9472    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n        exp(coef) exp(-coef) lower .95 upper .95\ntment      0.6075     1.6461  0.389011    0.9487\nalb10      0.2733     3.6584  0.004201   17.7838\nbili100    2.4474     0.4086  2.019676    2.9657\nalb2       1.0199     0.9805  0.569276    1.8273\n\nConcordance= 0.806  (se = 0.021 )\nLikelihood ratio test= 99.06  on 4 df,   p=<2e-16\nWald test            = 121.2  on 4 df,   p=<2e-16\nScore (logrank) test = 178.8  on 4 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# Cox model 2\ncoxmod_t26_q2 <- coxph(Surv(days, status != 0) ~ tment + alb10 + bili100 + bili2,\n                       data = pbc3)\n\nsummary(coxmod_t26_q2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb10 + bili100 + \n    bili2, data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n            coef exp(coef) se(coef)      z Pr(>|z|)    \ntment   -0.52111   0.59386  0.22330 -2.334 0.019613 *  \nalb10   -1.01919   0.36089  0.21675 -4.702 2.57e-06 ***\nbili100  1.99811   7.37511  0.32629  6.124 9.14e-10 ***\nbili2   -0.30520   0.73698  0.09098 -3.355 0.000795 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n        exp(coef) exp(-coef) lower .95 upper .95\ntment      0.5939     1.6839    0.3834    0.9199\nalb10      0.3609     2.7709    0.2360    0.5519\nbili100    7.3751     0.1356    3.8907   13.9800\nbili2      0.7370     1.3569    0.6166    0.8808\n\nConcordance= 0.815  (se = 0.021 )\nLikelihood ratio test= 111.4  on 4 df,   p=<2e-16\nWald test            = 121.6  on 4 df,   p=<2e-16\nScore (logrank) test = 172.5  on 4 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# Cox model 3\ncoxmod_t26_q3 <- coxph(Surv(days, status != 0) ~ tment + alb10 + log2bili + log2bili2,\n                       data = pbc3)\n\nsummary(coxmod_t26_q3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb10 + log2bili + \n    log2bili2, data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n               coef exp(coef)  se(coef)      z Pr(>|z|)    \ntment     -0.574344  0.563074  0.224533 -2.558   0.0105 *  \nalb10     -0.914495  0.400719  0.219173 -4.172 3.01e-05 ***\nlog2bili   0.583636  1.792545  0.500009  1.167   0.2431    \nlog2bili2  0.007044  1.007069  0.042774  0.165   0.8692    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n          exp(coef) exp(-coef) lower .95 upper .95\ntment        0.5631     1.7760    0.3626    0.8744\nalb10        0.4007     2.4955    0.2608    0.6157\nlog2bili     1.7925     0.5579    0.6728    4.7762\nlog2bili2    1.0071     0.9930    0.9261    1.0951\n\nConcordance= 0.819  (se = 0.022 )\nLikelihood ratio test= 120.1  on 4 df,   p=<2e-16\nWald test            = 111.9  on 4 df,   p=<2e-16\nScore (logrank) test = 169.6  on 4 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Figure 2.6 --------------------------------------#\n#------------------------------------------------------------------#\n\n# The below linear predictors include estimates from the following models, \n\n\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npbc3mult$tment_char <- as.factor(pbc3mult$tment_char)\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\n\nbase_poismod <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili,\n                    data = pbc3mult,\n                    family = poisson)\nsummary(base_poismod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.4119  -0.5253  -0.3722  -0.2312   2.8728  \n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -4.2301822  0.7855195  -5.385 7.24e-08 ***\nas.factor(timegroup)3 -0.5381074  0.6022200  -0.894 0.371568    \nas.factor(timegroup)1 -0.8577514  0.2361480  -3.632 0.000281 ***\ntment_charPlacebo      0.4753406  0.2240970   2.121 0.033910 *  \nalb                   -0.1123359  0.0212829  -5.278 1.30e-07 ***\nbili                   0.0084593  0.0009392   9.007  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.73  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 538.73\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npoismod_t26_l1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili + albnorm,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t26_l1) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili + albnorm, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.3941  -0.5301  -0.3640  -0.2200   2.9953  \n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -5.0320699  1.4715432  -3.420 0.000627 ***\nas.factor(timegroup)3 -0.5433694  0.6022062  -0.902 0.366899    \nas.factor(timegroup)1 -0.8539910  0.2362103  -3.615 0.000300 ***\ntment_charPlacebo      0.4576984  0.2247281   2.037 0.041683 *  \nalb                   -0.0864388  0.0451742  -1.913 0.055690 .  \nbili                   0.0084777  0.0009419   9.001  < 2e-16 ***\nalbnorm               -0.0473832  0.0720301  -0.658 0.510651    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.28  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 540.28\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npoismod_t26_l3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                        bili + bilihigh + bilitoohigh + bilimuchtoohigh,\n                      data = pbc3mult,\n                      family = poisson)\n\nsummary(poismod_t26_l3) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh, \n    family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8952  -0.4629  -0.2866  -0.1828   2.8580  \n\nCoefficients:\n                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.597666   1.204436  -5.478 4.31e-08 ***\nas.factor(timegroup)3 -0.425435   0.603554  -0.705  0.48088    \nas.factor(timegroup)1 -0.852870   0.231526  -3.684  0.00023 ***\ntment_charPlacebo      0.569111   0.226892   2.508  0.01213 *  \nalb                   -0.086487   0.021876  -3.954 7.70e-05 ***\nbili                   0.061654   0.062308   0.989  0.32242    \nbilihigh              -0.016757   0.085194  -0.197  0.84406    \nbilitoohigh            0.002652   0.052566   0.050  0.95977    \nbilimuchtoohigh       -0.042801   0.026193  -1.634  0.10224    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 326.18  on 602  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.18\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# Make a dataset with linear predictor information\nlin2 <- pbc3\n\nlin2$lp1 <- with(pbc3, 1.6076-0.1123*alb)\nlin2$lp2 <- with(pbc3, 0.7828-0.0864*alb-0.0474*albnorm)\nlin2$lp3 <- with(pbc3, 1.6076+0.0085*bili-38.7*0.1123)\nlin2$lp4 <- with(pbc3, -0.5534+0.0617*bili-0.0168*bilihigh+0.0027*bilitoohigh\n                 -0.0428*bilimuchtoohigh-0.0865*38.7)\n\n\nlin2row <- data.frame(effect = c(rep(\"Linear effect\", nrow(lin2)),\n                                 rep(\"Effect as linear spline\", nrow(lin2))), \n                      lp = c(lin2$lp1, lin2$lp2),\n                      alb = c(lin2$alb, lin2$alb))\n\nrequire(ggplot2)\n\nfig26 <- ggplot(aes(x = alb, y = lp, linetype = effect), data = lin2row) + \n         geom_line(size = 1) + \n         xlab(\"Albumin\") + \n         ylab(\"Linear predictor\") + \n         scale_linetype_discrete(\"Effect\") + \n         scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n         scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n         theme_general\n\nfig26\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 12 rows containing missing values (`geom_line()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-5.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3linalb.pdf\", plot = fig26, \n       width = 29.7, height = 21, units = \"cm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 12 rows containing missing values (`geom_line()`).\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Figure 2.7 --------------------------------------#\n#------------------------------------------------------------------#\n\n# bilirubin and the two last linear predictors\nlin2row2 <- data.frame(effect = c(rep(\"Linear effect\", nrow(lin2)),\n                                  rep(\"Effect as linear spline\", nrow(lin2))), \n                      lp = c(lin2$lp3, lin2$lp4),\n                      bili = c(lin2$bili, lin2$bili))\n\nrequire(ggplot2)\n\nfig27 <- ggplot(aes(x = bili, y = lp, linetype = effect), data = lin2row2) + \n  geom_line(size = 1) + \n  xlab(\"Bilirubin\") + \n  ylab(\"Linear predictor\") + \n  scale_linetype_discrete(\"Effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig27\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-6.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3linbili.pdf\", plot = fig27, \n       width = 29.7, height = 21, units = \"cm\")\n\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.8 --------------------------------------#\n#------------------------------------------------------------------#\n\n\n# The below linear predictors include estimates from the following models, \n\nbase_poismod2_log <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + log2bili,\n                         data = pbc3mult,\n                         family = poisson)\nsummary(base_poismod2_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb10 + log2bili, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8855  -0.4833  -0.2974  -0.1822   3.0017  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -8.02328    0.95100  -8.437  < 2e-16 ***\nas.factor(timegroup)3 -0.43894    0.60346  -0.727 0.466999    \nas.factor(timegroup)1 -0.84401    0.22867  -3.691 0.000223 ***\ntment_charPlacebo      0.54549    0.22265   2.450 0.014288 *  \nalb10                 -0.86972    0.21615  -4.024 5.73e-05 ***\nlog2bili               0.64689    0.07326   8.830  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.25  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 517.25\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npoismod_t26_l3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                        log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh,\n                        data = pbc3mult,\n                        family = poisson)\n\nsummary(poismod_t26_l3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + logbilihigh + logbilitoohigh + \n    logbilimuchtoohigh, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.7543  -0.4596  -0.2891  -0.1818   2.8323  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.65731    1.88624  -3.529 0.000416 ***\nas.factor(timegroup)3 -0.41834    0.60355  -0.693 0.488223    \nas.factor(timegroup)1 -0.82513    0.22932  -3.598 0.000320 ***\ntment_charPlacebo      0.55563    0.22703   2.447 0.014390 *  \nalb                   -0.08440    0.02181  -3.870 0.000109 ***\nlog2bili               0.19800    0.46549   0.425 0.670583    \nlogbilihigh            0.88154    0.91202   0.967 0.333756    \nlogbilitoohigh        -0.23363    1.27745  -0.183 0.854884    \nlogbilimuchtoohigh    -0.31390    0.97076  -0.323 0.746425    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.54  on 602  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 521.54\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# Make a dataset with linear predictor information\nlog2 <- pbc3\n\nlog2$lp3 <- with(pbc3, -2.0162+0.6469*log2bili-38.7*0.087)\nlog2$lp4 <- with(pbc3, -0.6194+0.198*log2bili+0.8815*logbilihigh-0.2336*logbilitoohigh\n                 -0.3139*logbilimuchtoohigh-0.0844*38.7)\n\n\nlog2row <- data.frame(effect = c(rep(\"Linear effect\", nrow(log2)),\n                                 rep(\"Effect as linear spline\", nrow(log2))), \n                      lp = c(log2$lp3, log2$lp4),\n                      log2bili = c(log2$log2bili, log2$log2bili))\n\n# Make plot\nfig28 <- ggplot(aes(x = log2bili, y = lp, linetype = effect), data = log2row) + \n  geom_line(size = 1) + \n  xlab(expression(log[2] * \"(bilirubin)\")) +\n  ylab(\"Linear predictor\") + \n  scale_linetype_discrete(\"Effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig28\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-7.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3linlogbili.pdf\", plot = fig28, \n       width = 29.7, height = 21, units = \"cm\")\n\n\n\n#------------------------------------------------------------------#\n#---------------- Table 2.7 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Cox model\ncoxmod_t27 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                    eps = 1e-8, method = \"breslow\",\n                    data = pbc3)\n\nsummary(coxmod_t27)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, \n    data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n             coef exp(coef) se(coef)      z Pr(>|z|)    \ntment    -0.57406   0.56323  0.22447 -2.557   0.0105 *  \nalb      -0.09093   0.91308  0.02164 -4.201 2.65e-05 ***\nlog2bili  0.66500   1.94449  0.07443  8.935  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\ntment       0.5632     1.7755    0.3628    0.8745\nalb         0.9131     1.0952    0.8752    0.9526\nlog2bili    1.9445     0.5143    1.6805    2.2499\n\nConcordance= 0.819  (se = 0.022 )\nLikelihood ratio test= 120  on 3 df,   p=<2e-16\nWald test            = 110.4  on 3 df,   p=<2e-16\nScore (logrank) test = 133.7  on 3 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# Poisson model\npoismod_t27 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                   data = pbc3mult,\n                   family = poisson)\nsummary(poismod_t27) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8855  -0.4833  -0.2974  -0.1822   3.0017  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -8.02328    0.95100  -8.437  < 2e-16 ***\nas.factor(timegroup)3 -0.43894    0.60346  -0.727 0.466999    \nas.factor(timegroup)1 -0.84401    0.22867  -3.691 0.000223 ***\ntment_charPlacebo      0.54549    0.22265   2.450 0.014288 *  \nalb                   -0.08697    0.02162  -4.024 5.73e-05 ***\nlog2bili               0.64689    0.07326   8.830  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.25  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 517.25\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Table 2.8 ---------------------------------------#\n#------------------------------------------------------------------#\n\n\n## Cox models\n\n# Model for LR comparison\ncoxmod_t28_base <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\n\n# Cox model 1\ncoxmod_t28_1 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili + tment*alb,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\nsummary(coxmod_t28_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + \n    tment * alb, data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n               coef exp(coef)  se(coef)      z Pr(>|z|)    \ntment     -0.009736  0.990312  1.559670 -0.006   0.9950    \nalb       -0.081319  0.921900  0.034031 -2.390   0.0169 *  \nlog2bili   0.664413  1.943350  0.074494  8.919   <2e-16 ***\ntment:alb -0.015725  0.984398  0.042980 -0.366   0.7145    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n          exp(coef) exp(-coef) lower .95 upper .95\ntment        0.9903     1.0098   0.04658   21.0555\nalb          0.9219     1.0847   0.86242    0.9855\nlog2bili     1.9434     0.5146   1.67935    2.2489\ntment:alb    0.9844     1.0158   0.90487    1.0709\n\nConcordance= 0.819  (se = 0.022 )\nLikelihood ratio test= 120.2  on 4 df,   p=<2e-16\nWald test            = 111.2  on 4 df,   p=<2e-16\nScore (logrank) test = 134.3  on 4 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# LR test\nanova(coxmod_t28_1, \n      coxmod_t28_base)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n Cox model: response is  Surv(days, status != 0)\n Model 1: ~ tment + alb + log2bili + tment * alb\n Model 2: ~ tment + alb + log2bili\n   loglik  Chisq Df Pr(>|Chi|)\n1 -402.87                     \n2 -402.94 0.1338  1     0.7145\n```\n:::\n\n```{.r .cell-code}\n# Cox model 2\ncoxmod_t28_2 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili + tment*log2bili,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\nsummary(coxmod_t28_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + \n    tment * log2bili, data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n                   coef exp(coef) se(coef)      z Pr(>|z|)    \ntment           0.19880   1.21994  0.85653  0.232    0.816    \nalb            -0.09331   0.91091  0.02191 -4.260 2.05e-05 ***\nlog2bili        0.72558   2.06593  0.09865  7.355 1.91e-13 ***\ntment:log2bili -0.13213   0.87623  0.14180 -0.932    0.351    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\ntment             1.2199     0.8197    0.2276    6.5375\nalb               0.9109     1.0978    0.8726    0.9509\nlog2bili          2.0659     0.4840    1.7027    2.5066\ntment:log2bili    0.8762     1.1413    0.6636    1.1570\n\nConcordance= 0.821  (se = 0.022 )\nLikelihood ratio test= 120.9  on 4 df,   p=<2e-16\nWald test            = 112.9  on 4 df,   p=<2e-16\nScore (logrank) test = 136.9  on 4 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# LR test\nanova(coxmod_t28_2, \n      coxmod_t28_base)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n Cox model: response is  Surv(days, status != 0)\n Model 1: ~ tment + alb + log2bili + tment * log2bili\n Model 2: ~ tment + alb + log2bili\n   loglik  Chisq Df Pr(>|Chi|)\n1 -402.51                     \n2 -402.94 0.8644  1     0.3525\n```\n:::\n\n```{.r .cell-code}\n## Poisson models\n\n# Model for LR comparison - no interaction\npoismod_t28_base <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                     data = pbc3mult,\n                     family = poisson)\n\n# Poisson model 1\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\npoismod_t28_1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*alb,\n                    data = pbc3mult,\n                    family = poisson)\nsummary(poismod_t28_1) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * alb, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9119  -0.4864  -0.3014  -0.1816   2.9760  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -7.77706    1.11741  -6.960 3.41e-12 ***\nas.factor(timegroup)3 -0.43125    0.60379  -0.714 0.475080    \nas.factor(timegroup)1 -0.84426    0.22851  -3.695 0.000220 ***\ntment_charPlacebo     -0.09200    1.55226  -0.059 0.952738    \nalb                   -0.09406    0.02755  -3.414 0.000639 ***\nlog2bili               0.64624    0.07334   8.812  < 2e-16 ***\ntment_charPlacebo:alb  0.01778    0.04281   0.415 0.677959    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.08  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.08\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"CyA\")\npoismod_t28_11 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*alb,\n                     data = pbc3mult,\n                     family = poisson)\nsummary(poismod_t28_11) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * alb, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9119  -0.4864  -0.3014  -0.1816   2.9760  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -7.86906    1.36181  -5.778 7.54e-09 ***\nas.factor(timegroup)3 -0.43125    0.60379  -0.714  0.47508    \nas.factor(timegroup)1 -0.84426    0.22851  -3.695  0.00022 ***\ntment_charCyA          0.09200    1.55226   0.059  0.95274    \nalb                   -0.07628    0.03359  -2.271  0.02316 *  \nlog2bili               0.64624    0.07334   8.812  < 2e-16 ***\ntment_charCyA:alb     -0.01778    0.04281  -0.415  0.67796    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.08  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.08\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(poismod_t28_base, \n       poismod_t28_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili + tment_char * alb\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   7 -252.54  1 0.1723      0.678\n```\n:::\n\n```{.r .cell-code}\n# Poisson model 2\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\npoismod_t28_2 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*log2bili,\n                     data = pbc3mult,\n                     family = poisson)\nsummary(poismod_t28_2) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * log2bili, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.7460  -0.4807  -0.3003  -0.1858   3.0728  \n\nCoefficients:\n                           Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                -7.53457    1.09655  -6.871 6.37e-12 ***\nas.factor(timegroup)3      -0.41713    0.60400  -0.691 0.489808    \nas.factor(timegroup)1      -0.85694    0.22932  -3.737 0.000186 ***\ntment_charPlacebo          -0.18058    0.84828  -0.213 0.831422    \nalb                        -0.08909    0.02185  -4.078 4.54e-05 ***\nlog2bili                    0.57982    0.10472   5.537 3.08e-08 ***\ntment_charPlacebo:log2bili  0.12386    0.14006   0.884 0.376511    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.47  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 518.47\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"CyA\")\npoismod_t28_21 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*log2bili,\n                     data = pbc3mult,\n                     family = poisson)\nsummary(poismod_t28_21) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * log2bili, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.7460  -0.4807  -0.3003  -0.1858   3.0728  \n\nCoefficients:\n                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)            -7.71515    1.01592  -7.594 3.10e-14 ***\nas.factor(timegroup)3  -0.41713    0.60400  -0.691 0.489808    \nas.factor(timegroup)1  -0.85694    0.22932  -3.737 0.000186 ***\ntment_charCyA           0.18058    0.84828   0.213 0.831422    \nalb                    -0.08909    0.02185  -4.078 4.54e-05 ***\nlog2bili                0.70368    0.09717   7.242 4.42e-13 ***\ntment_charCyA:log2bili -0.12386    0.14006  -0.884 0.376511    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.47  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 518.47\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# LR test\nlrtest(poismod_t28_base, \n       poismod_t28_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili + tment_char * log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   7 -252.24  1 0.7787     0.3775\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Table 2.9 ---------------------------------------#\n#------------------------------------------------------------------#\n\n\n# Column 1; \npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"1\")\n\npoismod_t29_11 <- glm(fail ~ offset(log(risktime)) + timegroup + tment_char + alb + log2bili + tment_char*timegroup,\n                     data = pbc3mult,\n                     family = poisson)\nsummary(poismod_t29_11) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + \n    alb + log2bili + tment_char * timegroup, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8788  -0.4885  -0.3022  -0.1818   3.0164  \n\nCoefficients:\n                             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                  -8.01250    0.97312  -8.234  < 2e-16 ***\ntimegroup1                   -0.89421    0.31710  -2.820   0.0048 ** \ntimegroup3                   -0.89971    1.02908  -0.874   0.3820    \ntment_charPlacebo             0.46193    0.34460   1.340   0.1801    \nalb                          -0.08640    0.02166  -3.988 6.65e-05 ***\nlog2bili                      0.64871    0.07367   8.806  < 2e-16 ***\ntimegroup1:tment_charPlacebo  0.09973    0.44250   0.225   0.8217    \ntimegroup3:tment_charPlacebo  0.80434    1.27283   0.632   0.5274    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.82  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.82\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"2\")\npoismod_t29_12 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_12) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * timegroup, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8788  -0.4885  -0.3022  -0.1818   3.0164  \n\nCoefficients: (2 not defined because of singularities)\n                              Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                  -8.912206   1.410958  -6.316 2.68e-10 ***\nas.factor(timegroup)2         0.899710   1.029079   0.874    0.382    \nas.factor(timegroup)1         0.005499   1.026826   0.005    0.996    \ntment_charPlacebo             1.266273   1.229390   1.030    0.303    \nalb                          -0.086405   0.021665  -3.988 6.65e-05 ***\nlog2bili                      0.648711   0.073669   8.806  < 2e-16 ***\ntimegroup2                          NA         NA      NA       NA    \ntimegroup1                          NA         NA      NA       NA    \ntment_charPlacebo:timegroup2 -0.804338   1.272830  -0.632    0.527    \ntment_charPlacebo:timegroup1 -0.704610   1.262063  -0.558    0.577    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.82  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.82\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npoismod_t29_13 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_13) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * timegroup, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8788  -0.4885  -0.3022  -0.1818   3.0164  \n\nCoefficients: (2 not defined because of singularities)\n                              Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                  -8.906706   0.949577  -9.380  < 2e-16 ***\nas.factor(timegroup)3        -0.005499   1.026826  -0.005   0.9957    \nas.factor(timegroup)2         0.894211   0.317101   2.820   0.0048 ** \ntment_charPlacebo             0.561662   0.290915   1.931   0.0535 .  \nalb                          -0.086405   0.021665  -3.988 6.65e-05 ***\nlog2bili                      0.648711   0.073669   8.806  < 2e-16 ***\ntimegroup3                          NA         NA      NA       NA    \ntimegroup2                          NA         NA      NA       NA    \ntment_charPlacebo:timegroup3  0.704610   1.262063   0.558   0.5766    \ntment_charPlacebo:timegroup2 -0.099728   0.442503  -0.225   0.8217    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.82  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.82\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# Column 2; \npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"1\")\npoismod_t29_21 <- glm(fail ~ offset(log(risktime)) + timegroup + tment_char + alb + log2bili + alb*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_21) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + \n    alb + log2bili + alb * timegroup, family = poisson, data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9765  -0.4756  -0.2941  -0.1722   2.9166  \n\nCoefficients:\n                  Estimate Std. Error z value Pr(>|z|)    \n(Intercept)       -9.30795    1.40949  -6.604 4.01e-11 ***\ntimegroup1         1.24042    1.59864   0.776   0.4378    \ntimegroup3         0.01433    6.09060   0.002   0.9981    \ntment_charPlacebo  0.56130    0.22300   2.517   0.0118 *  \nalb               -0.05231    0.03472  -1.507   0.1319    \nlog2bili           0.64608    0.07361   8.777  < 2e-16 ***\ntimegroup1:alb    -0.05795    0.04376  -1.324   0.1854    \ntimegroup3:alb    -0.01311    0.15739  -0.083   0.9336    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.45  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.45\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"2\")\npoismod_t29_22 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + alb*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_22) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + alb * timegroup, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9765  -0.4756  -0.2941  -0.1722   2.9166  \n\nCoefficients: (2 not defined because of singularities)\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -9.29362    5.94435  -1.563   0.1179    \nas.factor(timegroup)2 -0.01433    6.09060  -0.002   0.9981    \nas.factor(timegroup)1  1.22609    6.02995   0.203   0.8389    \ntment_charPlacebo      0.56130    0.22300   2.517   0.0118 *  \nalb                   -0.06542    0.15336  -0.427   0.6697    \nlog2bili               0.64608    0.07361   8.777   <2e-16 ***\ntimegroup2                  NA         NA      NA       NA    \ntimegroup1                  NA         NA      NA       NA    \nalb:timegroup2         0.01311    0.15739   0.083   0.9336    \nalb:timegroup1        -0.04484    0.15605  -0.287   0.7739    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.45  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.45\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npoismod_t29_23 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + alb*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_23) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + alb * timegroup, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9765  -0.4756  -0.2941  -0.1722   2.9166  \n\nCoefficients: (2 not defined because of singularities)\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -8.06752    1.11184  -7.256 3.99e-13 ***\nas.factor(timegroup)3 -1.22609    6.02995  -0.203   0.8389    \nas.factor(timegroup)2 -1.24042    1.59864  -0.776   0.4378    \ntment_charPlacebo      0.56130    0.22300   2.517   0.0118 *  \nalb                   -0.11026    0.02791  -3.951 7.79e-05 ***\nlog2bili               0.64608    0.07361   8.777  < 2e-16 ***\ntimegroup3                  NA         NA      NA       NA    \ntimegroup2                  NA         NA      NA       NA    \nalb:timegroup3         0.04484    0.15605   0.287   0.7739    \nalb:timegroup2         0.05795    0.04376   1.324   0.1854    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.45  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.45\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n# Column 3; \npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"1\")\npoismod_t29_31 <- glm(fail ~ offset(log(risktime)) + timegroup + tment_char + alb + log2bili + log2bili*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_31) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + \n    alb + log2bili + log2bili * timegroup, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.0280  -0.4825  -0.2965  -0.1821   2.9014  \n\nCoefficients:\n                    Estimate Std. Error z value Pr(>|z|)    \n(Intercept)         -7.57166    1.08557  -6.975 3.06e-12 ***\ntimegroup1          -1.72397    0.88760  -1.942   0.0521 .  \ntimegroup3           0.69600    2.32124   0.300   0.7643    \ntment_charPlacebo    0.51454    0.22373   2.300   0.0215 *  \nalb                 -0.08570    0.02174  -3.942 8.10e-05 ***\nlog2bili             0.55747    0.12113   4.602 4.18e-06 ***\ntimegroup1:log2bili  0.15296    0.15024   1.018   0.3086    \ntimegroup3:log2bili -0.25235    0.49539  -0.509   0.6105    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.67  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.67\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"2\")\npoismod_t29_32 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + log2bili*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_32) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + log2bili * timegroup, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.0280  -0.4825  -0.2965  -0.1821   2.9014  \n\nCoefficients: (2 not defined because of singularities)\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.87566    2.36338  -2.909  0.00362 ** \nas.factor(timegroup)2 -0.69600    2.32124  -0.300  0.76430    \nas.factor(timegroup)1 -2.41998    2.30859  -1.048  0.29452    \ntment_charPlacebo      0.51454    0.22373   2.300  0.02146 *  \nalb                   -0.08570    0.02174  -3.942  8.1e-05 ***\nlog2bili               0.30512    0.48171   0.633  0.52646    \ntimegroup2                  NA         NA      NA       NA    \ntimegroup1                  NA         NA      NA       NA    \nlog2bili:timegroup2    0.25235    0.49539   0.509  0.61047    \nlog2bili:timegroup1    0.40532    0.49015   0.827  0.40828    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.67  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.67\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npoismod_t29_33 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + log2bili*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_33) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + log2bili * timegroup, family = poisson, \n    data = pbc3mult)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.0280  -0.4825  -0.2965  -0.1821   2.9014  \n\nCoefficients: (2 not defined because of singularities)\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -9.29563    1.02069  -9.107  < 2e-16 ***\nas.factor(timegroup)3  2.41998    2.30859   1.048   0.2945    \nas.factor(timegroup)2  1.72397    0.88760   1.942   0.0521 .  \ntment_charPlacebo      0.51454    0.22373   2.300   0.0215 *  \nalb                   -0.08570    0.02174  -3.942 8.10e-05 ***\nlog2bili               0.71044    0.09260   7.672 1.69e-14 ***\ntimegroup3                  NA         NA      NA       NA    \ntimegroup2                  NA         NA      NA       NA    \nlog2bili:timegroup3   -0.40532    0.49015  -0.827   0.4083    \nlog2bili:timegroup2   -0.15296    0.15024  -1.018   0.3086    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.67  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.67\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\n## LR tests \n\n# Base model; no interaction\n\npoismod_t29_base <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                      data = pbc3mult,\n                      family = poisson)\n# Column 1\nlrtest(poismod_t29_base, \n       poismod_t29_11)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + \n    log2bili + tment_char * timegroup\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   8 -252.41  2 0.4312     0.8061\n```\n:::\n\n```{.r .cell-code}\n# Column 2\nlrtest(poismod_t29_base, \n       poismod_t29_21)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + \n    log2bili + alb * timegroup\n  #Df  LogLik Df Chisq Pr(>Chisq)\n1   6 -252.62                    \n2   8 -251.72  2 1.803      0.406\n```\n:::\n\n```{.r .cell-code}\n# Column 3\nlrtest(poismod_t29_base, \n       poismod_t29_31)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + \n    log2bili + log2bili * timegroup\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   8 -251.84  2 1.5777     0.4544\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Figure 2.9 --------------------------------------#\n#------------------------------------------------------------------#\n\ncoxmod_f29 <- coxph(Surv(days, status != 0) ~ strata(tment) + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\nsummary(coxmod_f29)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ strata(tment) + alb + \n    log2bili, data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n             coef exp(coef) se(coef)      z Pr(>|z|)    \nalb      -0.09002   0.91391  0.02168 -4.153 3.28e-05 ***\nlog2bili  0.66328   1.94114  0.07531  8.807  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\nalb         0.9139     1.0942    0.8759    0.9536\nlog2bili    1.9411     0.5152    1.6748    2.2499\n\nConcordance= 0.818  (se = 0.022 )\nLikelihood ratio test= 119.3  on 2 df,   p=<2e-16\nWald test            = 109.1  on 2 df,   p=<2e-16\nScore (logrank) test = 133.5  on 2 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# Extracting cumulative baseline hazards per treatment\ncumhaz_treat <- basehaz(coxmod_f29, centered = FALSE)\ncumhaz_treat <- as.data.frame(cumhaz_treat)\n\n# Per treatment\nhazard_t0 <- cumhaz_treat[cumhaz_treat$strata == \"tment=0\",]\nhazard_t0[1,] <- c(0, 0, \"tment=0\")\nhazard_t0$time<- as.numeric(hazard_t0$time)\nhazard_t0$hazard <- as.numeric(hazard_t0$hazard)\nhazard_t1 <- cumhaz_treat[cumhaz_treat$strata == \"tment=1\",]\n\n# Match times\nalltimes <- sort(unique(cumhaz_treat$time))\n\nhazard_t0_allt <- as.numeric(sapply(1:length(alltimes), function(k) tail(hazard_t0$hazard[hazard_t0$time <= alltimes[k]], 1)))\nhazard_t1_allt <- as.numeric(sapply(1:length(alltimes), function(k) tail(hazard_t1$hazard[hazard_t1$time <= alltimes[k]], 1))) \n\nhazards <- data.frame(hazard_t0_allt, \n                      hazard_t1_allt)\n\n# Extract coefficient\ncoxmod_f29_t <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\nsummary(coxmod_f29_t)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, \n    data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n             coef exp(coef) se(coef)      z Pr(>|z|)    \ntment    -0.57406   0.56323  0.22447 -2.557   0.0105 *  \nalb      -0.09093   0.91308  0.02164 -4.201 2.65e-05 ***\nlog2bili  0.66500   1.94449  0.07443  8.935  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\ntment       0.5632     1.7755    0.3628    0.8745\nalb         0.9131     1.0952    0.8752    0.9526\nlog2bili    1.9445     0.5143    1.6805    2.2499\n\nConcordance= 0.819  (se = 0.022 )\nLikelihood ratio test= 120  on 3 df,   p=<2e-16\nWald test            = 110.4  on 3 df,   p=<2e-16\nScore (logrank) test = 133.7  on 3 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\n# Make plot\nfig29 <- ggplot(aes(x = hazard_t0_allt, y = hazard_t1_allt), data = hazards) + \n  geom_step(size = 1) + \n  geom_abline(intercept = 0, slope = exp(coef(coxmod_f29_t)[[\"tment\"]]), linetype = \"dashed\", size = 1) + \n  xlab(\"Cumulative baseline hazard: placebo\") +\n  ylab(\"Cumulative baseline hazard: CyA\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig29\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-8.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3gofplot.pdf\", plot = fig29, \n       width = 29.7, height = 21, units = \"cm\")\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.10 -------------------------------------#\n#------------------------------------------------------------------#\n\n# Additive Aalen models - available with timereg\nrequire(timereg)\n\n# Fit model\nnonparmod <- aalen(Surv(days, status != 0) ~ tment, data = pbc3)\n\n\ncumhazdata <- data.frame(eventtimes = nonparmod$cum[,1],\n                         basecumhaz = nonparmod$cum[,2], \n                         cumhaztreat = nonparmod$cum[,3], \n                         cumhaztreat_ll = nonparmod$cum[,3]-1.96*sqrt(nonparmod$var.cum[,3]),\n                         cumhaztreat_ul = nonparmod$cum[,3]+1.96*sqrt(nonparmod$var.cum[,3])\n                         )\ncumhazdata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   eventtimes  basecumhaz   cumhaztreat cumhaztreat_ll cumhaztreat_ul\n1      0.0000 0.000000000  0.000000e+00     0.00000000    0.000000000\n2     24.0000 0.005780347 -5.780347e-03    -0.01710983    0.005549133\n3     35.0000 0.005780347  3.360667e-05    -0.01603534    0.016102555\n4     98.0000 0.011628300 -5.814347e-03    -0.02555234    0.013923644\n5    107.0000 0.011628300  6.800639e-05    -0.02279059    0.022926606\n6    114.0000 0.017510653 -5.814347e-03    -0.03141597    0.019787273\n7    117.0000 0.023427813 -1.173151e-02    -0.03983752    0.016374508\n8    133.0000 0.029415837 -1.771953e-02    -0.04817760    0.012738541\n9    146.0000 0.029415837 -1.176715e-02    -0.04438318    0.020848877\n10   156.0000 0.029415837 -5.779125e-03    -0.04044252    0.028884274\n11   169.0000 0.035476443 -1.183973e-02    -0.04848201    0.024802551\n12   193.0000 0.041574004 -1.793729e-02    -0.05647933    0.020604743\n13   195.0000 0.041574004 -1.187669e-02    -0.05220774    0.028454370\n14   199.0000 0.047746843 -1.804953e-02    -0.06015623    0.024057175\n15   213.0000 0.053996843 -2.429953e-02    -0.06815197    0.019552917\n16   221.0000 0.053996843 -1.820196e-02    -0.06365379    0.027249860\n17   235.0000 0.053996843 -1.206700e-02    -0.05908250    0.034948512\n18   249.0000 0.060286151 -1.835630e-02    -0.06696097    0.030248366\n19   254.0000 0.066615265 -2.468542e-02    -0.07484815    0.025477313\n20   261.0000 0.072984692 -3.105484e-02    -0.08274770    0.020638015\n21   264.0000 0.072984692 -2.476554e-02    -0.07790787    0.028376799\n22   280.0000 0.072984692 -1.843642e-02    -0.07300742    0.036134571\n23   286.0000 0.072984692 -1.206700e-02    -0.06804776    0.043913765\n24   339.0000 0.079520640 -1.860294e-02    -0.07603075    0.038824866\n25   347.0000 0.079520640 -1.210944e-02    -0.07093066    0.046711791\n26   351.0000 0.086099587 -1.868838e-02    -0.07890641    0.041529645\n27   362.0000 0.086099587 -1.206587e-02    -0.07366696    0.049535227\n28   366.0000 0.092948902 -1.891518e-02    -0.08196212    0.044131755\n29   367.0000 0.092948902 -1.215843e-02    -0.07658125    0.052264395\n30   368.0000 0.099845454 -1.905498e-02    -0.08488062    0.046770668\n31   371.0000 0.106789898 -2.599942e-02    -0.09321756    0.041218715\n32   378.0000 0.106789898 -1.919670e-02    -0.08772447    0.049331072\n33   379.0000 0.113782905 -2.618971e-02    -0.09607474    0.043695328\n34   396.0000 0.120977150 -3.338395e-02    -0.10467735    0.037909445\n35   413.0000 0.128223527 -4.063033e-02    -0.11332470    0.032064037\n36   425.0000 0.135522797 -4.792960e-02    -0.12201839    0.026159190\n37   429.0000 0.142875738 -5.528254e-02    -0.13076001    0.020194924\n38   430.0000 0.150283145 -6.268995e-02    -0.13955109    0.014171194\n39   461.0000 0.150283145 -5.554709e-02    -0.13367286    0.022578674\n40   472.0000 0.150283145 -4.830071e-02    -0.12770699    0.031105567\n41   487.0000 0.157916733 -5.593430e-02    -0.13673785    0.024869249\n42   489.0000 0.165609041 -6.362661e-02    -0.14582471    0.018571489\n43   562.0000 0.165609041 -5.616392e-02    -0.13965328    0.027325434\n44   592.0000 0.173805762 -6.436064e-02    -0.14938167    0.020660384\n45   612.0000 0.173805762 -5.654814e-02    -0.14293708    0.029840790\n46   625.0000 0.173805762 -4.867413e-02    -0.13643077    0.039082510\n47   639.0000 0.173805762 -4.067413e-02    -0.12982058    0.048472324\n48   639.1446 0.173805762 -3.260961e-02    -0.12314653    0.057927308\n49   669.0000 0.173805762 -2.420625e-02    -0.11622915    0.067816650\n50   679.0000 0.173805762 -1.565924e-02    -0.10919452    0.077876036\n51   691.0000 0.173805762 -6.887313e-03    -0.10198961    0.088214985\n52   714.0000 0.183065022 -1.614657e-02    -0.11296497    0.080671826\n53   743.0000 0.183065022 -7.137563e-03    -0.10555298    0.091277858\n54   766.0000 0.183065022  2.477822e-03    -0.09772583    0.102681477\n55   786.0000 0.192868943 -7.326100e-03    -0.10935558    0.094703382\n56   791.0000 0.202868943 -1.732610e-02    -0.12122112    0.086568920\n57   821.0000 0.213621631 -2.807879e-02    -0.13408984    0.077932259\n58   865.0000 0.224491196 -3.894835e-02    -0.14707891    0.069182204\n59   916.0000 0.224491196 -2.795934e-02    -0.13821415    0.082295466\n60   928.0000 0.235985449 -3.945360e-02    -0.15198655    0.073079363\n61   931.0000 0.235985449 -2.808996e-02    -0.14280587    0.086625956\n62   945.0000 0.247750155 -3.985466e-02    -0.15686514    0.077155807\n63   962.0000 0.247750155 -2.780647e-02    -0.14717604    0.091563093\n64   978.0000 0.247750155 -1.530647e-02    -0.13716435    0.106551409\n65   985.0000 0.260250155 -2.780647e-02    -0.15210286    0.096489920\n66   995.0000 0.272908383 -4.046470e-02    -0.16721301    0.086283615\n67  1043.0000 0.272908383 -2.747769e-02    -0.15675672    0.101801350\n68  1046.0000 0.286066278 -4.063558e-02    -0.17246185    0.091190691\n69  1066.0000 0.286066278 -2.712207e-02    -0.16158284    0.107338708\n70  1105.0000 0.299764908 -4.082070e-02    -0.17793593    0.096294531\n71  1127.0000 0.314257662 -5.531345e-02    -0.19534015    0.084713243\n72  1134.0000 0.314257662 -4.082070e-02    -0.18369954    0.102058148\n73  1166.0000 0.314257662 -2.519570e-02    -0.17131981    0.120928411\n74  1168.0000 0.314257662 -9.322682e-03    -0.15872200    0.140076636\n75  1169.0000 0.314257662  6.806350e-03    -0.14590099    0.159513691\n76  1171.0000 0.314257662  2.319979e-02    -0.13285130    0.179250883\n77  1198.0000 0.330651104  6.806350e-03    -0.15251833    0.166131029\n78  1238.0000 0.330651104  2.435021e-02    -0.13864288    0.187343301\n79  1249.0000 0.330651104  4.253203e-02    -0.12431131    0.209375363\n80  1265.0000 0.350651104  2.253203e-02    -0.14885449    0.193918545\n81  1290.0000 0.350651104  4.427116e-02    -0.13233246    0.220874780\n82  1324.0000 0.375651104  1.927116e-02    -0.16400415    0.202546468\n83  1325.0000 0.401292130 -6.369867e-03    -0.19641077    0.183671039\n84  1325.0584 0.427607919 -3.268566e-02    -0.22960171    0.164230401\n85  1391.0000 0.427607919 -5.658630e-03    -0.20957545    0.198258191\n86  1423.0000 0.457910950 -3.596166e-02    -0.24835213    0.176428805\n87  1433.0000 0.457910950 -6.549895e-03    -0.22662464    0.213524849\n88  1547.0000 0.457910950  3.511677e-02    -0.19962210    0.269855642\n89  1647.0000 0.507910950 -1.488323e-02    -0.26925763    0.239491176\n90  1703.0000 0.507910950  5.654534e-02    -0.23381019    0.346900879\n91  1859.0000 0.650768092 -8.631180e-02    -0.48968054    0.317056936\n```\n:::\n\n```{.r .cell-code}\n# Extend lines to last observed time\ncumhazdata[nrow(cumhazdata)+1,] <- c(max(pbc3$days), tail(cumhazdata, 1)[-1])\n\n\n\n# Figure LHS\ncumhazplot1 <- ggplot(aes(x = eventtimes / 365.25, y = basecumhaz), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative baseline hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot1\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-9.png){width=672}\n:::\n\n```{.r .cell-code}\n# Figure RHS\ncumhazplot2 <- ggplot(aes(x = eventtimes / 365.25, y = cumhaztreat), data = cumhazdata) + \n  geom_step(size = 1) + \n  geom_step(size = 1, aes(x = eventtimes / 365.25, y = cumhaztreat_ll), linetype = \"dashed\") +  \n  geom_step(size = 1, aes(x = eventtimes / 365.25, y = cumhaztreat_ul), linetype = \"dashed\") +\n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative treatment effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot2\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-10.png){width=672}\n:::\n\n```{.r .cell-code}\n# Combine plots\nrequire(gridExtra)\nfig210 <- grid.arrange(cumhazplot1, cumhazplot2, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-11.png){width=672}\n:::\n\n```{.r .cell-code}\nfig210\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTableGrob (1 x 2) \"arrange\": 2 grobs\n  z     cells    name           grob\n1 1 (1-1,1-1) arrange gtable[layout]\n2 2 (1-1,2-2) arrange gtable[layout]\n```\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3aalen1.pdf\", plot = fig210, \n       width = 29.7, height = 12, units = \"cm\")\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.11 -------------------------------------#\n#------------------------------------------------------------------#\n\n# Make Aalen model fit\nnonparmod2 <- aalen(Surv(days, status != 0) ~ tment + alb + bili, data = pbc3) \n\nsummary(nonparmod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.62               0.005\ntment                                2.66               0.113\nalb                                  3.82               0.001\nbili                                 4.83               0.000\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                       0.30300                       0.919\ntment                             0.12100                       0.713\nalb                               0.00666                       0.963\nbili                              0.00300                       0.195\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                      14.20000                       0.988\ntment                             3.29000                       0.817\nalb                               0.00826                       0.988\nbili                              0.00203                       0.336\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment + alb + bili, \n    data = pbc3)\n```\n:::\n\n```{.r .cell-code}\ncumhazdata <- data.frame(eventtimes = nonparmod2$cum[,1],\n                         basecumhaz = nonparmod2$cum[,2], \n                         cumhaztreat = nonparmod2$cum[,3], \n                         cumhazalb = nonparmod2$cum[,4], \n                         cumhazbili= nonparmod2$cum[,5]\n)\ncumhazdata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   eventtimes basecumhaz  cumhaztreat     cumhazalb   cumhazbili\n1      0.0000 0.00000000  0.000000000  0.0000000000 0.000000e+00\n2     24.0000 0.01394856 -0.006536732 -0.0002312332 2.575134e-05\n3     35.0000 0.05505071 -0.003100732 -0.0013425129 8.683128e-05\n4     98.0000 0.06313545 -0.009151576 -0.0013874940 7.981313e-05\n5    107.0000 0.08137463 -0.004399829 -0.0018992146 1.242734e-04\n6    117.0000 0.11673266 -0.012216073 -0.0027148804 1.897775e-04\n7    133.0000 0.13592196 -0.018931704 -0.0030478453 1.910280e-04\n8    146.0000 0.15737571 -0.014404836 -0.0036495267 2.456382e-04\n9    156.0000 0.15068362 -0.009035299 -0.0035946125 3.559986e-04\n10   169.0000 0.17518948 -0.015979791 -0.0040533669 3.503438e-04\n11   193.0000 0.17051313 -0.023117904 -0.0039640705 5.303750e-04\n12   195.0000 0.19035814 -0.018560390 -0.0045410175 6.038375e-04\n13   199.0000 0.21444700 -0.025421238 -0.0049642809 5.767757e-04\n14   213.0000 0.20586013 -0.031654919 -0.0046450674 6.367504e-04\n15   221.0000 0.23347482 -0.026498602 -0.0053163474 6.087024e-04\n16   235.0000 0.25120325 -0.021679924 -0.0058322742 6.760557e-04\n17   249.0000 0.30445715 -0.029864050 -0.0069953862 6.540405e-04\n18   254.0000 0.27819742 -0.036549109 -0.0063789377 8.667842e-04\n19   261.0000 0.32464930 -0.044805140 -0.0073905938 8.695868e-04\n20   264.0000 0.31911654 -0.038283205 -0.0072558982 8.748555e-04\n21   280.0000 0.29445634 -0.033543989 -0.0069037140 1.162220e-03\n22   286.0000 0.28199753 -0.027882467 -0.0067592094 1.343011e-03\n23   339.0000 0.31916304 -0.035826493 -0.0075141713 1.328938e-03\n24   347.0000 0.30684384 -0.030821463 -0.0075259875 1.671314e-03\n25   351.0000 0.33480179 -0.038349568 -0.0080210016 1.629667e-03\n26   362.0000 0.34369203 -0.032089062 -0.0082417308 1.626681e-03\n27   366.0000 0.34773280 -0.040167535 -0.0084568922 1.932495e-03\n28   367.0000 0.39589557 -0.035992756 -0.0097142953 1.985947e-03\n29   368.0000 0.40776564 -0.043482197 -0.0098639556 2.019059e-03\n30   371.0000 0.33482667 -0.049784256 -0.0083101921 2.531948e-03\n31   378.0000 0.34985392 -0.043285733 -0.0086557176 2.492621e-03\n32   379.0000 0.36429108 -0.050885783 -0.0088453362 2.501961e-03\n33   396.0000 0.35926868 -0.057866175 -0.0085465404 2.518705e-03\n34   413.0000 0.36761269 -0.066228105 -0.0086544047 2.622622e-03\n35   425.0000 0.42283298 -0.076646031 -0.0099133607 2.695856e-03\n36   429.0000 0.44909623 -0.085151706 -0.0103828183 2.696553e-03\n37   430.0000 0.48413820 -0.095493519 -0.0111819801 2.837722e-03\n38   461.0000 0.53533962 -0.092690779 -0.0125892097 3.000203e-03\n39   472.0000 0.56737001 -0.087319612 -0.0134164878 3.033231e-03\n40   487.0000 0.53866641 -0.097182730 -0.0128214316 3.444202e-03\n41   489.0000 0.53351934 -0.107689662 -0.0127052807 3.733721e-03\n42   562.0000 0.58610439 -0.101482575 -0.0139826798 3.666665e-03\n43   592.0000 0.58251710 -0.113880257 -0.0139272990 4.017576e-03\n44   612.0000 0.62319515 -0.107111037 -0.0149201008 3.972993e-03\n45   625.0000 0.64342124 -0.101755836 -0.0155075715 4.093118e-03\n46   639.0000 0.63768797 -0.092664358 -0.0153248930 4.035067e-03\n47   639.4567 0.65118267 -0.086979550 -0.0157542874 4.170827e-03\n48   669.0000 0.65736651 -0.079157726 -0.0159255387 4.196680e-03\n49   679.0000 0.67946177 -0.071373308 -0.0164825299 4.199068e-03\n50   691.0000 0.75117715 -0.066358538 -0.0183532863 4.306614e-03\n51   714.0000 0.73883144 -0.076210756 -0.0178327842 4.359437e-03\n52   743.0000 0.74097543 -0.078116312 -0.0183029153 5.035831e-03\n53   766.0000 0.80849863 -0.070080180 -0.0199997693 5.032725e-03\n54   786.0000 0.81604632 -0.080317612 -0.0199372448 5.039767e-03\n55   791.0000 0.83140680 -0.097192484 -0.0203516039 5.510749e-03\n56   821.0000 0.81126754 -0.106712019 -0.0195421464 5.461508e-03\n57   865.0000 0.82833258 -0.118498611 -0.0197087330 5.497339e-03\n58   916.0000 0.85313518 -0.106514302 -0.0202471664 5.354417e-03\n59   928.0000 0.91727524 -0.119789600 -0.0215708150 5.374453e-03\n60   931.0000 0.74542033 -0.105260476 -0.0172998663 5.437190e-03\n61   945.0000 0.86520466 -0.119396326 -0.0199562753 5.367788e-03\n62   962.0000 0.89584063 -0.107483475 -0.0206925611 5.317068e-03\n63   978.0000 0.93519258 -0.096095065 -0.0216971115 5.349221e-03\n64   985.0000 0.99853344 -0.108765416 -0.0229077903 5.248875e-03\n65   995.0000 1.03401121 -0.121959180 -0.0234665990 5.235302e-03\n66  1043.0000 1.08883557 -0.113395990 -0.0250020013 5.513700e-03\n67  1046.0000 1.15524266 -0.128520304 -0.0263560860 5.561507e-03\n68  1066.0000 1.12865955 -0.116321503 -0.0258105743 5.760109e-03\n69  1105.0000 1.19514484 -0.130058834 -0.0270568853 5.638252e-03\n70  1127.0000 1.19486602 -0.146169108 -0.0267768164 5.795780e-03\n71  1134.0000 1.14990633 -0.137553360 -0.0260202214 6.415745e-03\n72  1166.0000 1.15592311 -0.126984246 -0.0264454044 6.880237e-03\n73  1168.0000 1.19637644 -0.112710233 -0.0275101283 6.974088e-03\n74  1169.0000 1.17582347 -0.094993323 -0.0269427028 6.881702e-03\n75  1171.0000 1.09677175 -0.085982218 -0.0255422063 7.846707e-03\n76  1198.0000 1.04530794 -0.105101425 -0.0241851646 8.413561e-03\n77  1238.0000 1.22942219 -0.094443867 -0.0291546713 9.014195e-03\n78  1249.0000 1.22898854 -0.076702236 -0.0292297612 9.159891e-03\n79  1265.0000 1.46822406 -0.097938251 -0.0346505444 9.035487e-03\n80  1290.0000 1.49332680 -0.073382184 -0.0351487048 8.787001e-03\n81  1324.0000 1.49117976 -0.121225972 -0.0354543606 1.066349e-02\n82  1325.0000 1.43574645 -0.152542745 -0.0336213105 1.109927e-02\n83  1325.4402 1.34613247 -0.183348544 -0.0308925452 1.148428e-02\n84  1391.0000 1.39460106 -0.150791553 -0.0320020495 1.122368e-02\n85  1423.0000 1.20182334 -0.183531461 -0.0265037833 1.136448e-02\n86  1433.0000 1.57913646 -0.162852451 -0.0362662229 1.204427e-02\n87  1647.0000 1.59429369 -0.217581833 -0.0354699184 1.225969e-02\n88  1703.0000 1.87059343 -0.133270967 -0.0422965549 1.180620e-02\n89  1859.0000 1.96610225 -0.277665109 -0.0411412321 1.189387e-02\n```\n:::\n\n```{.r .cell-code}\n# Extend lines to last observed time\ncumhazdata[nrow(cumhazdata)+1,] <- c(max(pbc3$days), tail(cumhazdata, 1)[-1])\n\n\n# Figure treat\ncumhazplot1 <- ggplot(aes(x = eventtimes / 365.25, y = cumhaztreat), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative treatment effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot1\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-12.png){width=672}\n:::\n\n```{.r .cell-code}\n# Figure albumin\ncumhazplot2 <- ggplot(aes(x = eventtimes / 365.25, y = cumhazalb), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative albumin effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot2\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-13.png){width=672}\n:::\n\n```{.r .cell-code}\n# Figure bilirubin\ncumhazplot3 <- ggplot(aes(x = eventtimes / 365.25, y = cumhazbili), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative bilirubin effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot3\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-14.png){width=672}\n:::\n\n```{.r .cell-code}\n# Combine plots\nrequire(gridExtra)\nfig211 <- grid.arrange(cumhazplot1, cumhazplot2, cumhazplot3, ncol = 1)\n```\n\n::: {.cell-output-display}\n![](Ch2_files/figure-html/chapter2_pbc3-15.png){width=672}\n:::\n\n```{.r .cell-code}\nfig211\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTableGrob (3 x 1) \"arrange\": 3 grobs\n  z     cells    name           grob\n1 1 (1-1,1-1) arrange gtable[layout]\n2 2 (2-2,1-1) arrange gtable[layout]\n3 3 (3-3,1-1) arrange gtable[layout]\n```\n:::\n\n```{.r .cell-code}\nggsave(\"figures/j_pbc3aalen3.pdf\", plot = fig211, \n       width = 29.7, height = 35, units = \"cm\")\n\n\n\n\n#------------------------------------------------------------------#\n#---------------- Table 2.10 --------------------------------------#\n#------------------------------------------------------------------#\n\n# -- Only treatment -- #\n# In text p-values prior to Table 2.10\nnonparmod0 <- aalen(Surv(days, status != 0) ~ tment, data = pbc3) \nsummary(nonparmod0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          5.96               0.000\ntment                                1.60               0.726\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.107                       0.529\ntment                               0.136                       0.586\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          7.62                       0.412\ntment                                4.54                       0.691\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# Hypothesis of a time-constant hazard difference for treatment\n\n# Constant effect of treatment\nnonparmod01 <- aalen(Surv(days, status != 0) ~ const(tment), data = pbc3) \nsummary(nonparmod01)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          6.62                   0\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                        0.0914                       0.398\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          4.97                        0.27\n\nParametric terms :     \n                 Coef.       SE Robust SE     z P-val lower2.5% upper97.5%\nconst(tment) -1.61e-05 5.75e-05  5.74e-05 -0.28 0.779 -0.000129   9.66e-05\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# -- Treatment, albumin, bilirubin -- #\n# Table 2.10, first two columns\nnonparmod1 <- aalen(Surv(days, status != 0) ~ tment + alb + bili, data = pbc3) \nsummary(nonparmod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.62               0.005\ntment                                2.66               0.147\nalb                                  3.82               0.002\nbili                                 4.83               0.000\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                       0.30300                       0.924\ntment                             0.12100                       0.709\nalb                               0.00666                       0.962\nbili                              0.00301                       0.184\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                      14.20000                       0.988\ntment                             3.29000                       0.804\nalb                               0.00826                       0.986\nbili                              0.00203                       0.324\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment + alb + bili, \n    data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# Table 2.10, last columns\nnonparmod2 <- aalen(Surv(days, status != 0) ~ const(tment) + const(alb) + const(bili), data = pbc3) \nsummary(nonparmod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          4.03               0.001\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.119                       0.194\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                           9.6                       0.125\n\nParametric terms :     \n                 Coef.       SE Robust SE     z    P-val lower2.5% upper97.5%\nconst(tment) -1.13e-04 5.90e-05  5.51e-05 -2.05 4.01e-02 -2.29e-04   2.64e-06\nconst(alb)   -2.30e-05 6.28e-06  6.11e-06 -3.77 1.63e-04 -3.53e-05  -1.07e-05\nconst(bili)   6.30e-06 1.32e-06  1.05e-06  5.98 2.17e-09  3.71e-06   8.89e-06\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + \n    const(bili), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# In-text\nnonparmod3 <- aalen(Surv(days, status != 0) ~ const(tment) + alb + bili, data = pbc3) \nsummary(nonparmod3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.60               0.005\nalb                                  3.80               0.002\nbili                                 4.83               0.000\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                       0.28500                       0.945\nalb                               0.00954                       0.811\nbili                              0.00315                       0.156\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                      11.50000                       0.989\nalb                               0.01920                       0.903\nbili                              0.00238                       0.276\n\nParametric terms :     \n                Coef.       SE Robust SE     z P-val lower2.5% upper97.5%\nconst(tment) -0.00011 5.92e-05  5.58e-05 -1.97 0.049 -0.000226   6.03e-06\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + alb + \n    bili, data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# -- Quadratic effects -- #\nnonparmod41 <- aalen(Surv(days, status != 0) ~ tment + I(alb/10) + I(bili/100) + I((bili/100)^2), data = pbc3) \nsummary(nonparmod41)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n                Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                              3.94               0.001\ntment                                    2.59               0.135\nI(alb/10)                                4.04               0.001\nI(bili/100)                              3.82               0.000\nI((bili/100)^2)                          3.02               0.042\n\nTest for time invariant effects \n                      Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                            0.3080                       0.935\ntment                                  0.1230                       0.685\nI(alb/10)                              0.0912                       0.834\nI(bili/100)                            0.6370                       0.424\nI((bili/100)^2)                        0.5160                       0.156\n                        Cramer von Mises test p-value H_0:constant effect\n(Intercept)                             24.00                       0.941\ntment                                    3.94                       0.756\nI(alb/10)                                2.38                       0.864\nI(bili/100)                            188.00                       0.309\nI((bili/100)^2)                        101.00                       0.183\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment + I(alb/10) + \n    I(bili/100) + I((bili/100)^2), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\nnonparmod42 <- aalen(Surv(days, status != 0) ~ tment + I(alb/10) + I(bili/100) + I((alb/10)^2), data = pbc3) \nsummary(nonparmod42)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n              Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                            3.25               0.024\ntment                                  2.74               0.097\nI(alb/10)                              3.02               0.046\nI(bili/100)                            4.86               0.000\nI((alb/10)^2)                          2.79               0.086\n\nTest for time invariant effects \n                    Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                           9.260                       0.194\ntment                                 0.096                       0.818\nI(alb/10)                             4.880                       0.210\nI(bili/100)                           0.371                       0.050\nI((alb/10)^2)                         0.626                       0.216\n                      Cramer von Mises test p-value H_0:constant effect\n(Intercept)                        28500.00                       0.310\ntment                                  1.78                       0.915\nI(alb/10)                           8370.00                       0.309\nI(bili/100)                           32.00                       0.160\nI((alb/10)^2)                        144.00                       0.305\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment + I(alb/10) + \n    I(bili/100) + I((alb/10)^2), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\nnonparmod43 <- aalen(Surv(days, status != 0) ~ const(tment) + I(alb/10) + I(bili/100) + I((bili/100)^2), data = pbc3) \nsummary(nonparmod43)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n                Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                              3.82               0.000\nI(alb/10)                                4.02               0.001\nI(bili/100)                              3.85               0.002\nI((bili/100)^2)                          3.01               0.047\n\nTest for time invariant effects \n                      Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                             0.440                       0.662\nI(alb/10)                               0.117                       0.616\nI(bili/100)                             0.612                       0.428\nI((bili/100)^2)                         0.515                       0.169\n                        Cramer von Mises test p-value H_0:constant effect\n(Intercept)                             48.20                       0.757\nI(alb/10)                                4.51                       0.601\nI(bili/100)                            169.00                       0.327\nI((bili/100)^2)                        105.00                       0.169\n\nParametric terms :     \n                 Coef.       SE Robust SE     z  P-val lower2.5% upper97.5%\nconst(tment) -0.000108 5.83e-05   5.7e-05 -1.89 0.0582 -0.000222   6.27e-06\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + I(alb/10) + \n    I(bili/100) + I((bili/100)^2), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\nnonparmod44 <- aalen(Surv(days, status != 0) ~ const(tment) + I(alb/10) + I(bili/100) + I((alb/10)^2), data = pbc3) \nsummary(nonparmod44)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n              Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                            3.23               0.017\nI(alb/10)                              3.00               0.038\nI(bili/100)                            4.88               0.000\nI((alb/10)^2)                          2.77               0.082\n\nTest for time invariant effects \n                    Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                           9.420                       0.239\nI(alb/10)                             4.950                       0.241\nI(bili/100)                           0.366                       0.061\nI((alb/10)^2)                         0.635                       0.248\n                      Cramer von Mises test p-value H_0:constant effect\n(Intercept)                         30500.0                       0.337\nI(alb/10)                            8910.0                       0.332\nI(bili/100)                            34.6                       0.158\nI((alb/10)^2)                         152.0                       0.333\n\nParametric terms :     \n                 Coef.       SE Robust SE     z  P-val lower2.5% upper97.5%\nconst(tment) -0.000115 5.89e-05  5.51e-05 -2.09 0.0366  -0.00023   4.42e-07\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + I(alb/10) + \n    I(bili/100) + I((alb/10)^2), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n# -- Interactions -- #\nnonparmod51 <- aalen(Surv(days, status != 0) ~ const(tment) + const(alb) + const(bili) + const(tment * bili), data = pbc3) \nsummary(nonparmod51)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          4.03                   0\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.123                       0.165\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          10.5                       0.099\n\nParametric terms :     \n                        Coef.       SE Robust SE       z    P-val lower2.5%\nconst(tment)        -5.30e-06 8.06e-05  6.23e-05 -0.0851 9.32e-01 -1.63e-04\nconst(alb)          -2.35e-05 6.20e-06  6.04e-06 -3.9000 9.69e-05 -3.57e-05\nconst(bili)          8.18e-06 2.38e-06  1.20e-06  6.8400 7.77e-12  3.52e-06\nconst(tment * bili) -3.16e-06 2.79e-06  1.80e-06 -1.7600 7.92e-02 -8.63e-06\n                    upper97.5%\nconst(tment)          1.53e-04\nconst(alb)           -1.13e-05\nconst(bili)           1.28e-05\nconst(tment * bili)   2.31e-06\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + \n    const(bili) + const(tment * bili), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\nnonparmod52 <- aalen(Surv(days, status != 0) ~ const(tment) + const(alb) + const(bili) + const(tment * alb), data = pbc3) \nsummary(nonparmod52)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.06               0.007\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                          0.12                       0.186\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          9.68                       0.111\n\nParametric terms :     \n                       Coef.       SE Robust SE       z    P-val lower2.5%\nconst(tment)        2.77e-05 5.45e-04  4.81e-04  0.0576 9.54e-01 -1.04e-03\nconst(alb)         -2.11e-05 8.63e-06  7.61e-06 -2.7700 5.54e-03 -3.80e-05\nconst(bili)         6.29e-06 1.32e-06  1.05e-06  5.9600 2.45e-09  3.70e-06\nconst(tment * alb) -3.60e-06 1.31e-05  1.18e-05 -0.3060 7.59e-01 -2.93e-05\n                   upper97.5%\nconst(tment)         1.10e-03\nconst(alb)          -4.19e-06\nconst(bili)          8.88e-06\nconst(tment * alb)   2.21e-05\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + \n    const(bili) + const(tment * alb), data = pbc3)\n```\n:::\n\n```{.r .cell-code}\n#------------------------------------------------------------------#\n#---------------- Table 2.11 --------------------------------------#\n#------------------------------------------------------------------#\n\n\n# -- In-text -- #\n\n# Additive hazards model with piecewise constant baseline hazards\n# Model with only treatment as covariate\n\nhead(pbc3mult)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id unit status tment sex age  bili   alb stage tment_char albnorm alb10\n1  1    5      1     1   0  58 52.04 36.00     4        CyA    1.00 3.600\n2  1    5      1     1   0  58 52.04 36.00     4        CyA    1.00 3.600\n3  2    4      0     1   1  54 14.82 38.00     2        CyA    3.00 3.800\n4  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271\n5  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271\n6  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271\n      alb2 bilihigh bilitoohigh bilimuchtoohigh bili100      bili2 log2bili\n1 12.96000    34.94       17.84            0.74  0.5204 0.27081616 5.701549\n2 12.96000    34.94       17.84            0.74  0.5204 0.27081616 5.701549\n3 14.44000     0.00        0.00            0.00  0.1482 0.02196324 3.889474\n4 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355\n5 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355\n6 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355\n  logbilihigh logbilitoohigh logbilimuchtoohigh log2bili2 tstart   days fail\n1    1.605625      0.6056246         0.02066214 32.507662    0.0  730.5    0\n2    1.605625      0.6056246         0.02066214 32.507662  730.5 1168.0    1\n3    0.000000      0.0000000         0.00000000 15.128004    0.0  405.0    0\n4    0.000000      0.0000000         0.00000000  7.881242    0.0  730.5    0\n5    0.000000      0.0000000         0.00000000  7.881242  730.5 1461.0    0\n6    0.000000      0.0000000         0.00000000  7.881242 1461.0 1735.0    0\n  timegroup risktime\n1         1    730.5\n2         2    437.5\n3         1    405.0\n4         1    730.5\n5         2    730.5\n6         3    274.0\n```\n:::\n\n```{.r .cell-code}\n# update data set\npbc3add <- pbc3mult\npbc3add$time1 <- with(pbc3add, (timegroup == 1)*risktime)\npbc3add$time2 <- with(pbc3add, (timegroup == 2)*risktime)\npbc3add$time3 <- with(pbc3add, (timegroup == 3)*risktime)\npbc3add$tment0 <- with(pbc3add, (tment == 0)*risktime)\npbc3add$tment1 <- with(pbc3add, (tment == 1)*risktime)\npbc3add$albny <- with(pbc3add, (alb-35)/100*risktime)\npbc3add$biliny <- with(pbc3add, (bili-50)/1000*risktime)\n\n\n# In-text\npiece_aalen1 <- glm(fail ~ time1 + time2 + time3 + tment1 - 1,\n                    data = pbc3add, start = c(0.1, 0.1, 0.1, 0),\n                    family = poisson(link = \"identity\"))\nsummary(piece_aalen1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ time1 + time2 + time3 + tment1 - 1, family = poisson(link = \"identity\"), \n    data = pbc3add, start = c(0.1, 0.1, 0.1, 0))\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-0.7259  -0.6037  -0.5791  -0.3327   2.9876  \n\nCoefficients:\n         Estimate Std. Error z value Pr(>|z|)    \ntime1   2.494e-04  4.498e-05   5.546 2.93e-08 ***\ntime2   3.607e-04  6.610e-05   5.456 4.87e-08 ***\ntime3   2.566e-04  1.264e-04   2.031   0.0423 *  \ntment1 -1.988e-05  5.683e-05  -0.350   0.7265    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance:    Inf  on 623  degrees of freedom\nResidual deviance: 459.54  on 619  degrees of freedom\nAIC: 647.54\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\n# Table 2.11 - questionable fit\npiece_aalen2 <- glm(fail ~ time1 + time2 + time3 + tment1 + albny + biliny -1,\n                    data = pbc3add, start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2),\n                    family = poisson(link = \"identity\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: step size truncated: out of bounds\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n\nWarning: step size truncated: out of bounds\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: glm.fit: algorithm did not converge\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: glm.fit: algorithm stopped at boundary value\n```\n:::\n\n```{.r .cell-code}\nsummary(piece_aalen2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = fail ~ time1 + time2 + time3 + tment1 + albny + \n    biliny - 1, family = poisson(link = \"identity\"), data = pbc3add, \n    start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2))\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.2780  -0.8521  -0.6455  -0.4069   2.2893  \n\nCoefficients:\n         Estimate Std. Error z value Pr(>|z|)    \ntime1   7.925e-04  7.346e-05  10.788  < 2e-16 ***\ntime2   1.029e-03  8.866e-05  11.608  < 2e-16 ***\ntime3   9.910e-04  1.890e-04   5.244 1.57e-07 ***\ntment1 -1.023e-04  6.006e-05  -1.704   0.0883 .  \nalbny  -1.902e-03  4.274e-04  -4.451 8.56e-06 ***\nbiliny  9.328e-03  1.360e-03   6.860 6.89e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance:    Inf  on 611  degrees of freedom\nResidual deviance: 432.31  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 620.31\n\nNumber of Fisher Scoring iterations: 25\n```\n:::\n:::\n\n\n\n## Exercises\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}