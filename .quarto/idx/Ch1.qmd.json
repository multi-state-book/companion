{"title":"Introduction and data sets","markdown":{"headingText":"Introduction and data sets","containsRefs":false,"markdown":"\nIn the book, examples of event history data are used to illustrate different methods, models and approaches. All the data sets, except the LEADER data, are available for download as CSV files and description of the variables is given below.\n\n```{r alldata, echo=FALSE}\nlibrary(downloadthis)\ndownload_dir(\n  path = \"data\",\n  output_name = \"DataFromMSB\",\n  button_label = \"Download data sets\",\n  button_type = \"success\",\n  has_icon = TRUE,\n  icon = \"fa fa-save\",\n  self_contained = FALSE\n)\n```\n\n## PBC3 trial in liver cirrhosis (`pbc3.csv`)\n\n| Variable name | Description                                                           |\n|-------------------------|----------------------------------------------|\n| `id`          | patient id                                                            |\n| `unit`        | hospital                                                              |\n| `days`        | follow-up time in days                                                |\n| `status`      | 0 = censoring, 1 = transplantation, 2 = death without transplantation |\n| `tment`       | 0 = placebo, 1 = CyA                                                  |\n| `sex`         | 0 = female, 1 = male                                                  |\n| `age`         | age (years)                                                           |\n| `bili`        | bilirubin (micromoles/L)                                              |\n| `alb`         | albumin (g/L)                                                         |\n| `stage`       | disease stage: 2 = I-II, 3 = III, 4 = IV                              |\n\n## Guinea-Bissau childhood vaccination study (`bissau.csv`)\n\n| Variable name | Description                                              |\n|---------------|----------------------------------------------------------|\n| `id`          | child id                                                 |\n| `cluster`     | cluster id                                               |\n| `fuptime`     | follow-up time (days)                                    |\n| `dead`        | 0 = alive, 1 = dead                                      |\n| `bcg`         | bcg vaccination status at initial visit: 1 = yes, 2 = no |\n| `dtp`         | dtp vaccination status at initial visit: 1 = yes, 2 = no |\n| `sex`         | 0 = female, 1 = male                                     |\n| `age`         | age in days at initial visit                             |\n\n## Testis cancer incidence and maternal parity (`testis.csv`)\n\n| Variable name | Description |\n|---------------|-------------|\n| `age`         |             |\n| `pyrs`        |             |\n| `cases`       |             |\n| `semi`        |             |\n| `nonsemi`     |             |\n| `parity`      |             |\n| `cohort`      |             |\n| `motherage`   |             |\n\n## PROVA trial in liver cirrhosis (`prova.csv`)\n\n| Variable name | Description          |\n|---------------|----------------------|\n| `id`          | patient id           |\n| `timedeath`   |                      |\n| `death`       |                      |\n| `timebleed`   |                      |\n| `bleed`       |                      |\n| `beta`        |                      |\n| `scle`        |                      |\n| `sex`         | 0 = female, 1 = male |\n| `age`         |                      |\n| `bili`        |                      |\n| `coag`        |                      |\n| `varsize`     |                      |\n| `beh`         |                      |\n\n## Recurrent episodes in affective disorders (`affective.csv`)\n\n| Variable name | Description |\n|---------------|-------------|\n| `id`          | patient id  |\n| `episode`     |             |\n| `state`       |             |\n| `start`       |             |\n| `stop`        |             |\n| `status`      |             |\n| `bip`         |             |\n| `sex`         | 0 = female, 1 = male             |\n| `age`         |             |\n| `year`        |             |\n| `wait`        |             |\n\n## LEADER cardiovascular trial in type 2 Diabetes\n\nData not available.\n\n## Bone marrow transplantation in acute leukemia (`bmt.csv`)\n\n| Variable name | Description |\n|---------------|-------------|\n| `id`          | patient id  |\n| `team`        |             |\n| `timedeath`   |             |\n| `death`       |             |\n| `timerel`     |             |\n| `rel`         |             |\n| `timegvhd`    |             |\n| `gvhd`        |             |\n| `timeanc500`  |             |\n| `anc500`      |             |\n| `sex`         | 0 = female, 1 = male             |\n| `age`         |             |\n| `all`         |             |\n| `bmonly`      |             |\n\n## The Copenhagen Holter study (`cphholter.csv`)\n\n| Variable name | Description |\n|---------------|-------------|\n| `id`          | patient id  |\n| `timedeath`   |             |\n| `death`       |             |\n| `timeafib`    |             |\n| `afib`        |             |\n| `timestroke`  |             |\n| `stroke`      |             |\n| `sex`         | 0 = female, 1 = male             |\n| `age`         |             |\n| `smkoer`      |             |\n| `esvea`       |             |\n| `chol`        |             |\n| `diabet`      |             |\n| `bmi`         |             |\n| `aspirin`     |             |\n| `probnp`      |             |\n| `sbp`         |             |\n\n## Small set of survival data\n\nData from Table 1.6.\n\n```{r simpledata, file = \"R/chapter1_simpledata.r\",message=FALSE,warning=FALSE,cache=TRUE, fig.height = 8.27, fig.width = 8.27, out.width = \"70%\"}\n```\n\n## Exercises {.unnumbered}\n\n### Exercise 1.1 {.unnumbered}\n\n#### *Consider the small data set in Table 1.6 and argue why both the average of all (12) observation times and the average of the (7) uncensored times will likely underestimate the true mean survival time from entry into the study*. {.unnumbered}\n\nThe average of all 12 observation times: $$\\frac{5+6+7+8+9+12+13+15+16+20+22+23}{12} = \\frac{156}{12} = 13.00$$ will under-estimate the mean survival time because 5 of the terms in the sum, i.e., those corresponding to right-censored observations, are known to be smaller than the true survival times.\n\nThe average of the 7 uncensored observations: $$\\frac{5+7+8+13+15+16+23}{7}=\\frac{87}{7} = 12.43$$ is also likely to under-estimate the mean because right-censoring will typically cause the longer survival times in the population to be incompletely observed. E.g., survival times longer than the time elapsed from the beginning of the study to its end will always be right-censored.\n\n### Exercise 1.2 {.unnumbered}\n\n#### 1. *Consider the following records mimicking the Copenhagen Holter study (Example 1.1.8) in wide format and transform them into long format, i.e., create one data set for each of the possible six transitions in Figure 1.7.* {.unnumbered}\n\nData can be converted to long format using the **msprep** function from the **mstate** package. However, we must first add indicators of whether the subjects transitioned to AF, stroke and death during the study. Furthermore, we have to fill in **timeafib**, **timestroke** and **timedeath** for all subjects, such that they correspond to the last time where transitions to the states AF, stroke and death are possible. Lastly, we need to specify a transition matrix.\n\n```{r packages, warning = FALSE, message=FALSE}\nchs_data <- read.csv(\"data/cphholter.csv\")\nlibrary(tidyverse)\nlibrary(survival)\nlibrary(mstate)\n```\n\n```{r}\n# The table from the exercise\nid <- factor(1:8)\ntimeafib <- c(NA, 10, NA, 15, NA, 30, NA, 25)\ntimestroke <- c(NA, NA, 20, 30, NA, NA, 35, 50)\ntimedeath <- c(NA, NA, NA, NA, 70, 75, 95, 65)\nlastobs <- c(100, 90, 80, 85, 70, 75, 95, 65)\ncbind(id, timeafib, timestroke, timedeath, lastobs)\n\n# Creating status indicators\nafib <- ifelse(is.na(timeafib), 0, 1)\nstroke <- ifelse(is.na(timestroke), 0, 1)\ndeath <- ifelse(is.na(timedeath), 0, 1)\n\n# Last time point at risk for a transition to each state\ntimedeath <- lastobs\ntimestroke <- ifelse(is.na(timestroke), timedeath, timestroke)\ntimeafib <- ifelse(is.na(timeafib), timestroke, timeafib)\nwide_data <- as.data.frame(cbind(id, timeafib, timestroke, \n                                 timedeath, afib, stroke, death))\n\n# Creating the transition matrix\ntmat <- matrix(NA,4,4)\ntmat[1, 2:4] <- 1:3\ntmat[2, 3:4] <- 4:5\ntmat[3, 4] <- 6\ndimnames(tmat) <- list(from = c(\"No event\", \"AF\", \"Stroke\", \"Death\"), \n                       to = c(\"No event\", \"AF\", \"Stroke\", \"Death\"))\ntmat\n\n# Using msprep to create data in long format\nlong_data <- msprep(time = c(NA, \"timeafib\", \"timestroke\", \"timedeath\"),\n                    status = c(NA, \"afib\", \"stroke\", \"death\"),\n                    trans = tmat, data = wide_data) \nlong_data\n```\n\n#### 2. *Do the same for the entire data set*. {.unnumbered}\n\nWe can then repeat the procedure for the Copenhagen Holter Study data set.\n\n```{r}\nchs_data$timestroke <- ifelse(is.na(chs_data$timestroke),\n                              chs_data$timedeath, chs_data$timestroke)\nchs_data$timeafib <- ifelse(is.na(chs_data$timeafib),\n                            chs_data$timestroke, chs_data$timeafib)\n\nchs_long <- msprep(time = c(NA, \"timeafib\", \"timestroke\", \"timedeath\"),\n                   status = c(NA, \"afib\", \"stroke\", \"death\"),\n                   trans = tmat, data = chs_data)\n```\n\nNB: We get a warning because 5 subjects have two events on the same day. This will be handled if necessary for further analyses.\n\n### Exercise 1.3 {.unnumbered}\n\n#### 1. *Derive Equations (1.2) and (1.3) for, respectively, the survival function in the two-state model (Figure 1.1) and the cumulative incidence function in the competing risks model (Figure 1.2).* {.unnumbered}\n\nThe hazard function $$\\alpha(t)=\\lim_{dt\\rightarrow 0}P(T\\leq t+dt\\mid T>t)/dt$$ equals $$\\alpha(t)=\\frac{f(t)}{S(t)}=\\frac{-(d/dt) S(t)}{S(t)}=-(d/dt)\\log S(t)$$ where $f(t)$ is the density function for $T$ and, thereby, $S(t)=\\int_0^t\\alpha(u)du$.\n\nThe cause $h$ cumulative incidence is the probability of failing from cause $h$ during $[0,t]$. This is the integral of the infinitesimal probabilities of failing in $(u,u+du)$ for $0\\leq u\\leq t$. The probability of failing in $(u,u+du)$ is, by definition of the cause-$h$-specific hazard, equal to $S(u)\\alpha_h(u)du$ and the desired result $$Q_h(t)=\\int_0^tS(u)\\alpha_h(u)du$$ follows.\n\n#### 2. *Show, for the Markov illness-death model (Figure 1.3), that the state occupation probability for state 1 at time* $t$*,* $Q_1(t)$*, is* $$\\int_0^t\\exp\\left(-\\int_0^u(\\alpha_{01}(x)+\\alpha_{02}(x))dx\\right)\\alpha_{01}(u)\\exp\\left(-\\int_u^t\\alpha_{12}(x)dx\\right)du.$$ {.unnumbered}\n\nThe probability $P_{11}(u,t)$ of staying in state 1 from time $u$ to time $t$ is given by $\\exp(-\\int_u^t\\alpha_{12}(x)dx)$ and combining this with the argument from the previous question, i.e., that the (infinitesimal) probability $\\exp(-\\int_0^u(\\alpha_{01}(x)+\\alpha_{02}(x))dx)\\alpha_{01}(u)du$, of moving from state 0 to state 1 during $(u, u+du)$, the desired result is obtained by integration over $u$ from 0 to $t$.\n\n### Exercise 1.4 (\\*) {.unnumbered}\n\n#### *Argue (intuitively) how the martingale property* $E(M(t)\\mid {\\cal H}_{s})=M(s)$ *follows from* $E(dM(t)\\mid {\\cal H}_{t-})=0$ *(Section 1.4.3).* {.unnumbered}\n\n\nBecause $M(s)$ is adapted to the history ${\\cal H}_s$ we get\n$$E(M(t)\\mid {\\cal F}_s)-M(s)=E(M(t)-M(s)\\mid {\\cal H}_s).$$\nWe write the difference $M(t)-M(s)$ as the sum of increments $$=E(\\int_{(s,t]}dM(u)\\mid {\\cal H}_s)$$ and change the order of integration and expectation $$=\\int_{(s,t]}E(dM(u)\\mid {\\cal H}_s).$$ We finally use the \\`principle of repeated conditioning' to obtain the desired result of 0 $$=\\int_{(s,t]}E(E(dM(u)\\mid {\\cal H}_{u-})\\mid {\\cal H}_s)=0.$$\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"Ch1.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","editor":"source","theme":["cosmo","msb.scss"]},"extensions":{"book":{"multiFile":true}}}}}