[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values",
    "section": "",
    "text": "This is the companion website to our book published by Chapman & Hall (link).\nR code for the analyses and plots presented in the book is given, except for analyses on the LEADER data. SAS code is available for the analyses only.\nSolutions to the exercises in the book are available at the end of each chapter.\nThe code is neither optimized nor prettified but we hope you will find them helpful anyway.\nThis companion was created with R version …, Rstudio version …, Quarto version …, and SAS version …"
  },
  {
    "objectID": "index.html#acknowledgements",
    "href": "index.html#acknowledgements",
    "title": "Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values",
    "section": "Acknowledgements",
    "text": "Acknowledgements\nSincerely thanks to Julie K. Furberg who carefully created figures and validated analyses quoted in the book. Eva N.S. Wandall thoroughly created solutions to practical exercises and contributed to some of the examples."
  },
  {
    "objectID": "Ch1.html#pbc3-trial-in-liver-cirrhosis-pbc3.csv",
    "href": "Ch1.html#pbc3-trial-in-liver-cirrhosis-pbc3.csv",
    "title": "1  Introduction and data sets",
    "section": "1.1 PBC3 trial in liver cirrhosis (pbc3.csv)",
    "text": "1.1 PBC3 trial in liver cirrhosis (pbc3.csv)\n\n\n\n\n\n\n\nVariable name\nDescription\n\n\n\n\nid\npatient id\n\n\nunit\nhospital\n\n\ndays\nfollow-up time in days\n\n\nstatus\n0 = censoring, 1 = transplantation, 2 = death without transplantation\n\n\ntment\n0 = placebo, 1 = CyA\n\n\nsex\n0 = female, 1 = male\n\n\nage\nage (years)\n\n\nbili\nbilirubin (micromoles/L)\n\n\nalb\nalbumin (g/L)\n\n\nstage\ndisease stage: 2 = I-II, 3 = III, 4 = IV"
  },
  {
    "objectID": "Ch1.html#guinea-bissau-childhood-vaccination-study-bissau.csv",
    "href": "Ch1.html#guinea-bissau-childhood-vaccination-study-bissau.csv",
    "title": "1  Introduction and data sets",
    "section": "1.2 Guinea-Bissau childhood vaccination study (bissau.csv)",
    "text": "1.2 Guinea-Bissau childhood vaccination study (bissau.csv)\n\n\n\n\n\n\n\nVariable name\nDescription\n\n\n\n\nid\nchild id\n\n\ncluster\ncluster id\n\n\nfuptime\nfollow-up time (days)\n\n\ndead\n0 = alive, 1 = dead\n\n\nbcg\nbcg vaccination status at initial visit: 1 = yes, 2 = no\n\n\ndtp\ndtp vaccination status at initial visit: 1 = yes, 2 = no\n\n\nsex\n0 = female, 1 = male\n\n\nage\nage in days at initial visit"
  },
  {
    "objectID": "Ch1.html#testis-cancer-incidence-and-maternal-parity-testis.csv",
    "href": "Ch1.html#testis-cancer-incidence-and-maternal-parity-testis.csv",
    "title": "1  Introduction and data sets",
    "section": "1.3 Testis cancer incidence and maternal parity (testis.csv)",
    "text": "1.3 Testis cancer incidence and maternal parity (testis.csv)\n\n\n\nVariable name\nDescription\n\n\n\n\nage\n\n\n\npyrs\n\n\n\ncases\n\n\n\nsemi\n\n\n\nnonsemi\n\n\n\nparity\n\n\n\ncohort\n\n\n\nmotherage"
  },
  {
    "objectID": "Ch1.html#prova-trial-in-liver-cirrhosis-prova.csv",
    "href": "Ch1.html#prova-trial-in-liver-cirrhosis-prova.csv",
    "title": "1  Introduction and data sets",
    "section": "1.4 PROVA trial in liver cirrhosis (prova.csv)",
    "text": "1.4 PROVA trial in liver cirrhosis (prova.csv)\n\n\n\nVariable name\nDescription\n\n\n\n\nid\npatient id\n\n\ntimedeath\n\n\n\ndeath\n\n\n\ntimebleed\n\n\n\nbleed\n\n\n\nbeta\n\n\n\nscle\n\n\n\nsex\n0 = female, 1 = male\n\n\nage\n\n\n\nbili\n\n\n\ncoag\n\n\n\nvarsize\n\n\n\nbeh"
  },
  {
    "objectID": "Ch1.html#recurrent-episodes-in-affective-disorders-affective.csv",
    "href": "Ch1.html#recurrent-episodes-in-affective-disorders-affective.csv",
    "title": "1  Introduction and data sets",
    "section": "1.5 Recurrent episodes in affective disorders (affective.csv)",
    "text": "1.5 Recurrent episodes in affective disorders (affective.csv)\n\n\n\nVariable name\nDescription\n\n\n\n\nid\npatient id\n\n\nepisode\n\n\n\nstate\n\n\n\nstart\n\n\n\nstop\n\n\n\nstatus\n\n\n\nbip\n\n\n\nsex\n0 = female, 1 = male\n\n\nage\n\n\n\nyear\n\n\n\nwait"
  },
  {
    "objectID": "Ch1.html#leader-cardiovascular-trial-in-type-2-diabetes",
    "href": "Ch1.html#leader-cardiovascular-trial-in-type-2-diabetes",
    "title": "1  Introduction and data sets",
    "section": "1.6 LEADER cardiovascular trial in type 2 Diabetes",
    "text": "1.6 LEADER cardiovascular trial in type 2 Diabetes\nData not available."
  },
  {
    "objectID": "Ch1.html#bone-marrow-transplantation-in-acute-leukemia-bmt.csv",
    "href": "Ch1.html#bone-marrow-transplantation-in-acute-leukemia-bmt.csv",
    "title": "1  Introduction and data sets",
    "section": "1.7 Bone marrow transplantation in acute leukemia (bmt.csv)",
    "text": "1.7 Bone marrow transplantation in acute leukemia (bmt.csv)\n\n\n\nVariable name\nDescription\n\n\n\n\nid\npatient id\n\n\nteam\n\n\n\ntimedeath\n\n\n\ndeath\n\n\n\ntimerel\n\n\n\nrel\n\n\n\ntimegvhd\n\n\n\ngvhd\n\n\n\ntimeanc500\n\n\n\nanc500\n\n\n\nsex\n0 = female, 1 = male\n\n\nage\n\n\n\nall\n\n\n\nbmonly"
  },
  {
    "objectID": "Ch1.html#the-copenhagen-holter-study-cphholter.csv",
    "href": "Ch1.html#the-copenhagen-holter-study-cphholter.csv",
    "title": "1  Introduction and data sets",
    "section": "1.8 The Copenhagen Holter study (cphholter.csv)",
    "text": "1.8 The Copenhagen Holter study (cphholter.csv)\n\n\n\nVariable name\nDescription\n\n\n\n\nid\npatient id\n\n\ntimedeath\n\n\n\ndeath\n\n\n\ntimeafib\n\n\n\nafib\n\n\n\ntimestroke\n\n\n\nstroke\n\n\n\nsex\n0 = female, 1 = male\n\n\nage\n\n\n\nsmkoer\n\n\n\nesvea\n\n\n\nchol\n\n\n\ndiabet\n\n\n\nbmi\n\n\n\naspirin\n\n\n\nprobnp\n\n\n\nsbp"
  },
  {
    "objectID": "Ch1.html#small-set-of-survival-data",
    "href": "Ch1.html#small-set-of-survival-data",
    "title": "1  Introduction and data sets",
    "section": "1.9 Small set of survival data",
    "text": "1.9 Small set of survival data\nData from Table 1.6.\n\n# Load packages\nlibrary(ggplot2)\nlibrary(datasets)\nlibrary(survival)\n\n#------------------------------------------------------------------#\n#---------------- General plotting styles -------------------------# \n#------------------------------------------------------------------#\n\ntheme_general <- theme_bw() +\n  theme(legend.position = \"bottom\", \n        text = element_text(size = 20), \n        axis.text.x = element_text(size = 20), \n        axis.text.y = element_text(size = 20)) \n\ntheme_general_x <- theme_bw() +\n  theme(legend.position = \"bottom\", \n        text = element_text(size = 26), \n        axis.text.x = element_text(size = 26), \n        axis.text.y = element_text(size = 26)) \n\n#------------------------------------------------------------------#\n#---------------- Figure 1.8 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Create example data\ntimes <- c(5,6,7,8,9,12,13,15,16,20,22,23)\nage <- c(12,0,0,10,6,6,9,3,8,0,0,2)\nevent <- c(1,0,1,1,0,0,1,1,1,0,0,1)\nid <- 1:12\nexitage <- age + times\nsimpledata <- as.data.frame(cbind(id, times, event, age, exitage))\n\n# Create Figure 1.8, part (a)\nfig1.8a <- ggplot(aes(x = times, y = id), data = simpledata) +\n  geom_segment(aes(x = 0, y = id, xend = times - 0.25, yend = id), size = 1) +\n  geom_point(aes(x = times, y = id), data = subset(simpledata,event==0), shape = 21, size = 6, color='black', fill='white') +\n  geom_point(aes(x = times, y = id), data = subset(simpledata,event==1), shape = 16, size = 6) +\n  xlab(\"Time (t)\") +\n  ylab(\"Subject number\") +\n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0, 25)) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0.5, 12), breaks = seq(1, 12, 1)) +\n  theme_general_x +\n  theme(legend.position = \"none\")+\n  theme(\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor.y = element_blank()\n  )\n\n# Create Figure 1.8, part (b)\nfig1.8b <- ggplot(aes(x = exitage, y = id), data = simpledata) +\n  geom_segment(aes(x = age, y = id, xend = exitage - 0.25, yend = id), size = 1) +\n  geom_point(aes(x = exitage, y = id), data = subset(simpledata,event==0), shape = 21, size = 6, color='black', fill='white') +\n  geom_point(aes(x = exitage, y = id), data = subset(simpledata,event==1), shape = 16, size = 6) +\n  xlab(\"Age\") +\n  ylab(\"Subject number\") +\n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0, 25)) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0.5, 12), breaks = seq(1, 12, 1)) +\n  theme_general_x + \n  theme(legend.position = \"none\")+\n  theme(\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor.y = element_blank()\n  )\n\n\nfig1.8a\n\n\n\nfig1.8b\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 1.9 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Kaplan-Meier time as time variable\nkmfit <- survfit(Surv(times, event) ~ 1)\nsimpledata_km <- data.frame(surv = c(1, kmfit$surv), \n                            time = c(0, kmfit$time))\n\n# Create Figure 1.9, part (a)\nfig1.9a <- ggplot(aes(x = time, y = surv), data = simpledata_km) +\n  geom_step(size = 1) +\n  xlab(\"Time (t)\") +\n  ylab(\"Estimate of S(t)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 25)) +\n  scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 1), breaks = seq(0, 1, 0.1)) +\n  theme_general_x + \n  theme(legend.position = \"none\")\n\n# Kaplan-Meier age as time variable\nkmfit2 <- survfit(Surv(age, exitage, event) ~ 1)\n\nsimpledata_km_age <- data.frame(surv = c(1, kmfit2$surv), \n                                time = c(0, kmfit2$time))\n\n# Create Figure 1.9, part (b)\nfig1.9b <- ggplot(aes(x = time, y = surv), data = simpledata_km_age) +\n  geom_step(size = 1) +\n  xlab(\"Age\") +\n  ylab(\"Estimate of S(age)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 25)) +\n  scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 1), breaks = seq(0, 1, 0.1)) +\n  theme_general_x + \n  theme(legend.position = \"none\")\n\nfig1.9a\n\n\n\nfig1.9b\n\n\n\n#------------------------------------------------------------------#\n#--------------- Figure 1.10 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Kaplan-Meier time as time variable\nkmfit <- survfit(Surv(times, event) ~ 1)\n\nsimpledata_km <- data.frame(surv = c(1, kmfit$surv), \n                            time = c(0, kmfit$time))\nsubdata<-simpledata_km[simpledata_km$time<=12,]\n\n# Create Figure 1.10\nlibrary(dplyr)\nfig1.10 <- ggplot(mapping=aes(x = time, y = surv), data = simpledata_km) +\n  geom_rect(data=subdata,\n            aes(xmin = time, xmax = lead(time),\n                ymin = 0, ymax = surv),\n            linetype=0,fill=\"grey\")+\n  geom_segment(aes(x = 12, y = -Inf, xend = 12, yend = 0.733),\n               size=1,linetype=\"dashed\")+\n  geom_step(size = 1) +\n  xlab(\"Time (t)\") +\n  ylab(\"Estimate of S(t)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 25)) +\n  scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 1), breaks = seq(0, 1, 0.1)) +\n  theme_general + \n  theme(legend.position = \"none\")+\n  annotate(geom=\"text\",x=6, y=0.45,\n           label=expression(epsilon[0](12)),size=8)\nfig1.10\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 1.13 -------------------------------------#\n#------------------------------------------------------------------#\n\n# N(t)\nsfit <- survfit(Surv(times, event) ~ 1)\np1 <- data.frame(time = c(0, sfit$time, 26), \n                 n = c(0, cumsum(sfit$n.event), tail(cumsum(sfit$n.event),1))\n                 )\np2 <- data.frame(time = sfit$time[sfit$n.event==1], \n                 n = cumsum(sfit$n.event)[sfit$n.event==1]-1)\np3 <- data.frame(time = sfit$time[sfit$n.event==1], \n                 n = cumsum(sfit$n.event)[sfit$n.event==1])\n\n# Create Figure 1.13, part (a)\nfig1.13a <- ggplot(aes(x = time, y = n), data = p1) +\n  geom_step(size = 1) + \n  geom_point(aes(x = time, y = n), data = p2, shape = 21, size = 6, color='black', fill='white') +\n  geom_point(aes(x = time, y = n), data = p3, shape = 16, size = 6) +\n  xlab(\"Time (t)\") +\n  ylab(\"N(t)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.005)), \n                     limits = c(0, 26)) +\n  scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 12), breaks = seq(0, 12, 1)) +\n  theme_general_x + \n  theme(legend.position = \"none\")\n\n\n# Y(t)\nsfit <- survfit(Surv(times, event) ~ 1)\np1 <- data.frame(time = c(0, sfit$time, 26), \n                 risk = c(sfit$n.risk, 0, 0)\n)\np2 <- data.frame(time = sfit$time, \n                 risk = sfit$n.risk - 1)\np3 <- data.frame(time = sfit$time, \n                 risk = sfit$n.risk)\n\n# Create Figure 1.13, part (b)\nfig1.13b <- ggplot(aes(x = time, y = risk), data = p1) +\n  geom_step(size = 1) + \n  geom_point(aes(x = time, y = risk), data = p2, shape = 21, size = 6, color='black', fill='white') +\n  geom_point(aes(x = time, y = risk), data = p3, shape = 16, size = 6) +\n  xlab(\"Time (t)\") +\n  ylab(\"Y(t)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.005)), \n                     limits = c(0, 26)) +\n  scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 12), breaks = seq(0, 12, 1)) +\n  theme_general_x + \n  theme(legend.position = \"none\")\n\n\n# N(age)\nasfit <- survfit(Surv(age, exitage, event) ~ 1)\np1 <- data.frame(time = c(0, asfit$time, 26), \n                 n = c(0, cumsum(asfit$n.event), tail(cumsum(asfit$n.event), 1))\n)\np2 <- data.frame(time = asfit$time[asfit$n.event > 0], \n                 n = cumsum(asfit$n.event)[asfit$n.event > 0])\np3 <- data.frame(time = asfit$time[asfit$n.event > 0], \n                 n = c(0, 1, 2, 4, 5, 6))\n\n# Create Figure 1.13, part (c)\nfig1.13c <- ggplot(aes(x = time, y = n), data = p1) +\n  geom_step(size = 1) + \n  geom_point(aes(x = time, y = n), data = p2, shape = 16, size = 6) +\n  geom_point(aes(x = time, y = n), data = p3, shape = 21, size = 6, color='black', fill='white') +\n  xlab(\"Age\") +\n  ylab(\"N(age)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.005)), \n                     limits = c(0, 26)) +\n  scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 12), breaks = seq(0, 12, 1)) +\n  theme_general_x + \n  theme(legend.position = \"none\")\n\n# Y(age)\natriskage <- vector(length=25)\nfor(i in 1:25){\n  atriskage[i] <- sum((age<=i & exitage>i))\n}\n\np1 <- data.frame(time = 0:26, \n                 risk = c(atriskage[1], atriskage, 0)\n)\np2 <- data.frame(time = c(2,3,6,7,8,9,10,12,15,17,18,20,22,24,25), \n                 risk = c(5,6,7,6,7,8, 9,10, 9, 8, 5, 4, 2, 1,0))\np3 <- data.frame(time = c(2,3,6,7,8,9,10,12,15,17,18,20,22,24,25), \n                 risk = c(4,5,6,7,6,7, 8,9, 10, 9, 8, 5, 4, 2,1))\n\n# Create Figure 1.13, part (d)\nfig1.13d <- ggplot(aes(x = time, y = risk), data = p1) +\n  geom_step(size = 1) + \n  geom_point(aes(x = time, y = risk), data = p2, shape = 21, size = 6, color='black', fill='white') +\n  geom_point(aes(x = time, y = risk), data = p3, shape = 16, size = 6) +\n  xlab(\"Age\") +\n  ylab(\"Y(age)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.005, 0.005)), \n                     limits = c(0, 26)) +\n  scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)), \n                     limits = c(0, 12), breaks = seq(0, 12, 1)) +\n  theme_general_x + \n  theme(legend.position = \"none\")\n\nfig1.13a\n\n\n\nfig1.13b\n\n\n\nfig1.13c\n\n\n\nfig1.13d"
  },
  {
    "objectID": "Ch1.html#exercises",
    "href": "Ch1.html#exercises",
    "title": "1  Introduction and data sets",
    "section": "Exercises",
    "text": "Exercises\n\nExercise 1.1\n\nConsider the small data set in Table 1.6 and argue why both the average of all (12) observation times and the average of the (7) uncensored times will likely underestimate the true mean survival time from entry into the study.\nThe average of all 12 observation times: \\[\\frac{5+6+7+8+9+12+13+15+16+20+22+23}{12} = \\frac{156}{12} = 13.00\\] will under-estimate the mean survival time because 5 of the terms in the sum, i.e., those corresponding to right-censored observations, are known to be smaller than the true survival times.\nThe average of the 7 uncensored observations: \\[\\frac{5+7+8+13+15+16+23}{7}=\\frac{87}{7} = 12.43\\] is also likely to under-estimate the mean because right-censoring will typically cause the longer survival times in the population to be incompletely observed. E.g., survival times longer than the time elapsed from the beginning of the study to its end will always be right-censored.\n\n\n\nExercise 1.2\n\n1. Consider the following records mimicking the Copenhagen Holter study (Example 1.1.8) in wide format and transform them into long format, i.e., create one data set for each of the possible six transitions in Figure 1.7.\nData can be converted to long format using the msprep function from the mstate package. However, we must first add indicators of whether the subjects transitioned to AF, stroke and death during the study. Furthermore, we have to fill in timeafib, timestroke and timedeath for all subjects, such that they correspond to the last time where transitions to the states AF, stroke and death are possible. Lastly, we need to specify a transition matrix.\n\nchs_data <- read.csv(\"data/cphholter.csv\")\nlibrary(tidyverse)\nlibrary(survival)\nlibrary(mstate)\n\n\n# The table from the exercise\nid <- factor(1:8)\ntimeafib <- c(NA, 10, NA, 15, NA, 30, NA, 25)\ntimestroke <- c(NA, NA, 20, 30, NA, NA, 35, 50)\ntimedeath <- c(NA, NA, NA, NA, 70, 75, 95, 65)\nlastobs <- c(100, 90, 80, 85, 70, 75, 95, 65)\ncbind(id, timeafib, timestroke, timedeath, lastobs)\n\n     id timeafib timestroke timedeath lastobs\n[1,]  1       NA         NA        NA     100\n[2,]  2       10         NA        NA      90\n[3,]  3       NA         20        NA      80\n[4,]  4       15         30        NA      85\n[5,]  5       NA         NA        70      70\n[6,]  6       30         NA        75      75\n[7,]  7       NA         35        95      95\n[8,]  8       25         50        65      65\n\n# Creating status indicators\nafib <- ifelse(is.na(timeafib), 0, 1)\nstroke <- ifelse(is.na(timestroke), 0, 1)\ndeath <- ifelse(is.na(timedeath), 0, 1)\n\n# Last time point at risk for a transition to each state\ntimedeath <- lastobs\ntimestroke <- ifelse(is.na(timestroke), timedeath, timestroke)\ntimeafib <- ifelse(is.na(timeafib), timestroke, timeafib)\nwide_data <- as.data.frame(cbind(id, timeafib, timestroke, \n                                 timedeath, afib, stroke, death))\n\n# Creating the transition matrix\ntmat <- matrix(NA,4,4)\ntmat[1, 2:4] <- 1:3\ntmat[2, 3:4] <- 4:5\ntmat[3, 4] <- 6\ndimnames(tmat) <- list(from = c(\"No event\", \"AF\", \"Stroke\", \"Death\"), \n                       to = c(\"No event\", \"AF\", \"Stroke\", \"Death\"))\ntmat\n\n          to\nfrom       No event AF Stroke Death\n  No event       NA  1      2     3\n  AF             NA NA      4     5\n  Stroke         NA NA     NA     6\n  Death          NA NA     NA    NA\n\n# Using msprep to create data in long format\nlong_data <- msprep(time = c(NA, \"timeafib\", \"timestroke\", \"timedeath\"),\n                    status = c(NA, \"afib\", \"stroke\", \"death\"),\n                    trans = tmat, data = wide_data) \nlong_data\n\nAn object of class 'msdata'\n\nData:\n   id from to trans Tstart Tstop time status\n1   1    1  2     1      0   100  100      0\n2   1    1  3     2      0   100  100      0\n3   1    1  4     3      0   100  100      0\n4   2    1  2     1      0    10   10      1\n5   2    1  3     2      0    10   10      0\n6   2    1  4     3      0    10   10      0\n7   2    2  3     4     10    90   80      0\n8   2    2  4     5     10    90   80      0\n9   3    1  2     1      0    20   20      0\n10  3    1  3     2      0    20   20      1\n11  3    1  4     3      0    20   20      0\n12  3    3  4     6     20    80   60      0\n13  4    1  2     1      0    15   15      1\n14  4    1  3     2      0    15   15      0\n15  4    1  4     3      0    15   15      0\n16  4    2  3     4     15    30   15      1\n17  4    2  4     5     15    30   15      0\n18  4    3  4     6     30    85   55      0\n19  5    1  2     1      0    70   70      0\n20  5    1  3     2      0    70   70      0\n21  5    1  4     3      0    70   70      1\n22  6    1  2     1      0    30   30      1\n23  6    1  3     2      0    30   30      0\n24  6    1  4     3      0    30   30      0\n25  6    2  3     4     30    75   45      0\n26  6    2  4     5     30    75   45      1\n27  7    1  2     1      0    35   35      0\n28  7    1  3     2      0    35   35      1\n29  7    1  4     3      0    35   35      0\n30  7    3  4     6     35    95   60      1\n31  8    1  2     1      0    25   25      1\n32  8    1  3     2      0    25   25      0\n33  8    1  4     3      0    25   25      0\n34  8    2  3     4     25    50   25      1\n35  8    2  4     5     25    50   25      0\n36  8    3  4     6     50    65   15      1\n\n\n\n\n2. Do the same for the entire data set.\nWe can then repeat the procedure for the Copenhagen Holter Study data set.\n\nchs_data$timestroke <- ifelse(is.na(chs_data$timestroke),\n                              chs_data$timedeath, chs_data$timestroke)\nchs_data$timeafib <- ifelse(is.na(chs_data$timeafib),\n                            chs_data$timestroke, chs_data$timeafib)\n\nchs_long <- msprep(time = c(NA, \"timeafib\", \"timestroke\", \"timedeath\"),\n                   status = c(NA, \"afib\", \"stroke\", \"death\"),\n                   trans = tmat, data = chs_data)\n\nWarning in msprepEngine(time = time, status = status, id = id, starttime =\nstarttime, : Starting from state 1, simultaneous transitions possible for\nsubjects 12 242 267 533 550 at times 4359 1269 1984 2264 3262; smallest\nreceiving state chosen\n\n\nNB: We get a warning because 5 subjects have two events on the same day. This will be handled if necessary for further analyses.\n\n\n\nExercise 1.3\n\n1. Derive Equations (1.2) and (1.3) for, respectively, the survival function in the two-state model (Figure 1.1) and the cumulative incidence function in the competing risks model (Figure 1.2).\nThe hazard function \\[\\alpha(t)=\\lim_{dt\\rightarrow 0}P(T\\leq t+dt\\mid T>t)/dt\\] equals \\[\\alpha(t)=\\frac{f(t)}{S(t)}=\\frac{-(d/dt) S(t)}{S(t)}=-(d/dt)\\log S(t)\\] where \\(f(t)\\) is the density function for \\(T\\) and, thereby, \\(S(t)=\\int_0^t\\alpha(u)du\\).\nThe cause \\(h\\) cumulative incidence is the probability of failing from cause \\(h\\) during \\([0,t]\\). This is the integral of the infinitesimal probabilities of failing in \\((u,u+du)\\) for \\(0\\leq u\\leq t\\). The probability of failing in \\((u,u+du)\\) is, by definition of the cause-\\(h\\)-specific hazard, equal to \\(S(u)\\alpha_h(u)du\\) and the desired result \\[Q_h(t)=\\int_0^tS(u)\\alpha_h(u)du\\] follows.\n\n\n2. Show, for the Markov illness-death model (Figure 1.3), that the state occupation probability for state 1 at time \\(t\\), \\(Q_1(t)\\), is \\[\\int_0^t\\exp\\left(-\\int_0^u(\\alpha_{01}(x)+\\alpha_{02}(x))dx\\right)\\alpha_{01}(u)\\exp\\left(-\\int_u^t\\alpha_{12}(x)dx\\right)du.\\]\nThe probability \\(P_{11}(u,t)\\) of staying in state 1 from time \\(u\\) to time \\(t\\) is given by \\(\\exp(-\\int_u^t\\alpha_{12}(x)dx)\\) and combining this with the argument from the previous question, i.e., that the (infinitesimal) probability \\(\\exp(-\\int_0^u(\\alpha_{01}(x)+\\alpha_{02}(x))dx)\\alpha_{01}(u)du\\), of moving from state 0 to state 1 during \\((u, u+du)\\), the desired result is obtained by integration over \\(u\\) from 0 to \\(t\\).\n\n\n\nExercise 1.4 (*)\n\nArgue (intuitively) how the martingale property \\(E(M(t)\\mid {\\cal H}_{s})=M(s)\\) follows from \\(E(dM(t)\\mid {\\cal H}_{t-})=0\\) (Section 1.4.3).\nBecause \\(M(s)\\) is adapted to the history \\({\\cal H}_s\\) we get \\[E(M(t)\\mid {\\cal F}_s)-M(s)=E(M(t)-M(s)\\mid {\\cal H}_s).\\] We write the difference \\(M(t)-M(s)\\) as the sum of increments \\[=E(\\int_{(s,t]}dM(u)\\mid {\\cal H}_s)\\] and change the order of integration and expectation \\[=\\int_{(s,t]}E(dM(u)\\mid {\\cal H}_s).\\] We finally use the `principle of repeated conditioning’ to obtain the desired result of 0 \\[=\\int_{(s,t]}E(E(dM(u)\\mid {\\cal H}_{u-})\\mid {\\cal H}_s)=0.\\]"
  },
  {
    "objectID": "Ch2.html#pbc3-trial",
    "href": "Ch2.html#pbc3-trial",
    "title": "2  Intuition for intensity models",
    "section": "PBC3 trial",
    "text": "PBC3 trial\n\n#------------------------------------------------------------------#\n#------- Chapter 2, R code, PBC3 data  ----------------------------#\n#------------------------------------------------------------------#\n\nlibrary(haven)\nlibrary(survival)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(stats)\nlibrary(timereg)\n\n# Read data and create a data frame\nlibrary(haven)\npbc3 <- data.frame(read.csv(\"data/pbc3.csv\"))\npbc3$tment_char <- ifelse(pbc3$tment == 0, \"Placebo\", \"CyA\")\n\n# The main event of interest is \"failure of medical treatment\" \n# i.e., either death or liver transplant\n\n#------------------------------------------------------------------#\n# -------- General plotting style ---------------------------------# \n#------------------------------------------------------------------#\n\ntheme_general <- theme_bw() +\n                 theme(legend.position = \"bottom\", \n                       text = element_text(size = 20), \n                       axis.text.x = element_text(size = 20), \n                       axis.text.y = element_text(size = 20)) \n\n#------------------------------------------------------------------#\n#---------------- Figure 2.1 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Nelson Aalen estimate by treatment\nlibrary(survival)\nnafit <- survfit(Surv(days, status != 0) ~ tment, data = pbc3)\n# Collect data for plot\nnadata <- data.frame(cumhaz = nafit$cumhaz, \n                     cumhaz_se = nafit$std.err, \n                     time = nafit$time, \n                     tment = c(rep(names(nafit$strata)[1], nafit$strata[1]), \n                               rep(names(nafit$strata)[2], nafit$strata[2])))\n\n# Create Figure 2.1\nlibrary(ggplot2)\nfig2.1 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = tment), data = nadata) + \n  geom_step(size = 1) + \n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\")) + \n  xlab(\"Time since randomization (years)\") + \n  ylab(\"Cumulative hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1))  + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general + \n  theme(legend.position=\"bottom\",legend.box=\"vertical\",\n        legend.title=element_blank(),\n        legend.text = element_text(size = 20),\n        legend.key.size = unit(2,\"line\"))\n\nfig2.1\n\n\n\n# Estimates after two years\ntail(subset(nadata, nadata$time <= 2*365.25 & nadata$tment == \"tment=0\"),1)\n\n     cumhaz  cumhaz_se time   tment\n60 0.183065 0.03560398  724 tment=0\n\ntail(subset(nadata, nadata$time <= 2*365.25 & nadata$tment == \"tment=1\"),1)\n\n       cumhaz  cumhaz_se time   tment\n209 0.1668539 0.03449431  725 tment=1\n\n# Log rank test for treatment \nprint(survdiff(Surv(days, status != 0) ~ tment, data = pbc3), 4)\n\nCall:\nsurvdiff(formula = Surv(days, status != 0) ~ tment, data = pbc3)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ntment=0 173       46    44.68   0.03878   0.07708\ntment=1 176       44    45.32   0.03824   0.07708\n\n Chisq= 0.1  on 1 degrees of freedom, p= 0.78 \n\n#------------------------------------------------------------------#\n#---------------- Table 2.1 ---------------------------------------#\n#------------------------------------------------------------------#\n\ncuts <- c(0, 2, 4) * 365.25\n# event/failure indicator\npbc3$fail <- ifelse(pbc3$status != 0, 1, 0)\n# Make the data ready using survSplit\npbc3mult <- survSplit(Surv(days, fail) ~ ., pbc3,\n                      cut = cuts[-1], \n                      episode = \"timegroup\")\npbc3mult$risktime <- pbc3mult$days - cuts[pbc3mult$timegroup] \npbc3mult$timegroup <- as.factor(pbc3mult$timegroup)\n\n# Data for Table 2.1\nlibrary(dplyr)\npcwdata <- pbc3mult %>% \n  group_by(tment, timegroup) %>% \n  summarise(fail = sum(fail), risktime = sum(days - cuts[timegroup]))\npcwdata$risktimeyrs <- pcwdata$risktime/365.25\npcwdata$hazard <- 36525*pcwdata$fail/pcwdata$risktime\npcwdata$SD <- 36525*sqrt(pcwdata$fail)/pcwdata$risktime\ndata.frame(pcwdata)\n\n  tment timegroup fail risktime risktimeyrs    hazard       SD\n1     0         1   27 104856.0   287.08008  9.405041 1.810001\n2     0         2   17  49673.0   135.99726 12.500252 3.031756\n3     0         3    2   8642.0    23.66051  8.452904 5.977106\n4     1         1   24 107931.5   295.50034  8.121818 1.657859\n5     1         2   18  50284.5   137.67146 13.074605 3.081714\n6     1         3    2   7599.0    20.80493  9.613107 6.797493\n\n# LRT test using piece-wise exponential model\nlibrary(stats)\npoisfull <- glm(fail ~ offset(log(risktime/36525)) +\n                 - 1 + tment + timegroup + tment:timegroup, \n               data = pbc3mult, family = poisson)\npoisreduced <- glm(fail ~ offset(log(risktime/36525)) +\n                 - 1 + timegroup, \n               data = pbc3mult, family = poisson)\nanova(poisreduced,poisfull,test=\"LRT\")\n\nAnalysis of Deviance Table\n\nModel 1: fail ~ offset(log(risktime/36525)) + -1 + timegroup\nModel 2: fail ~ offset(log(risktime/36525)) + -1 + tment + timegroup + \n    tment:timegroup\n  Resid. Df Resid. Dev Df Deviance Pr(>Chi)\n1       620     459.66                     \n2       617     459.35  3  0.30813   0.9585\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.2 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Rates + cuts from Table 2.1\nrateCyA <- c(8.1,13.1,9.6)\nratePbo <- c(9.4,12.5,8.5)\npcwtime <- c(0,2,4,5)\n\n# Collect data\nplotdata <- data.frame(rates = c(rateCyA, ratePbo),\n                       tment = c(rep(\"CyA\", length(rateCyA)), \n                                 rep(\"Placebo\", length(ratePbo))),\n                       times_s = rep(pcwtime[-4], 2),\n                       times = rep(pcwtime[-1], 2))\n\n# Create Figure 2.2\nfig2.2 <- ggplot(aes(x = time, y = rates, linetype = tment), data = plotdata) +\n  geom_segment(aes(x = times_s, y = rates, xend = times, yend = rates), size = 1) +\n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\", \"CyA\"))  +\n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Estimated hazard function (per 100 years)\") +\n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 5),\n                     breaks = seq(0, 5, 1))  +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)), \n                     limits = c(0,14), breaks = seq(0, 14, 2)) +\n  theme_general+\n  theme(legend.title=element_blank(),\n        legend.text = element_text(size = 20),\n        legend.key.size = unit(2,\"line\"))\n\nfig2.2\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.3 --------------------------------------#\n#------------------------------------------------------------------#\n\n# NA data from figure 2.1 model fit\ntment1 <- subset(nadata, tment == \"tment=1\")\n\n# Estimated hazard per time group\npcwdata$hazard_timegroup <- pcwdata$fail / pcwdata$risktime\n\n# Add a numeric version of the treatment to the NA estimates\nnadata$tmentnum <- ifelse(nadata$tment == \"tment=1\", 1, 0)\n\n# Add piecewise constant hazard to data\nnadata$pwch <- NULL\n# Between time 0 and 2\nnadata$pwch[nadata$time <= 2 * 365.25] <- nadata$time[nadata$time <= 2 * 365.25] * \n                                 (pcwdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time <= 2 * 365.25]) + \n                                  pcwdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time <= 2 * 365.25]))\n# Between time 2 and 4\nnadata$pwch[nadata$time > 2 * 365.25 & nadata$time <= 4* 365.25 ] <- 2 * 365.25 * \n  (pcwdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]) + \n     pcwdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25])) + \n  (nadata$time[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25] - 2 * 365.25) * \n  (pcwdata$hazard_timegroup[2] * (1-nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]) + \n     pcwdata$hazard_timegroup[5] * (nadata$tmentnum[nadata$time > 2 * 365.25 & nadata$time <= 4 * 365.25]))\n# After time 4\nnadata$pwch[nadata$time > 4 * 365.25] <- 2 * 365.25 * \n  (pcwdata$hazard_timegroup[1] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     pcwdata$hazard_timegroup[4] * (nadata$tmentnum[nadata$time > 4 * 365.25])) + \n   2 * 365.25 * \n  (pcwdata$hazard_timegroup[2] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     pcwdata$hazard_timegroup[5] * (nadata$tmentnum[nadata$time > 4 * 365.25])) + \n  (nadata$time[nadata$time > 4 * 365.25] - 4 * 365.25) * \n  (pcwdata$hazard_timegroup[3] * (1-nadata$tmentnum[nadata$time > 4 * 365.25]) + \n     pcwdata$hazard_timegroup[6] * (nadata$tmentnum[nadata$time > 4 * 365.25]))\n\n# Reformat for plot\npiecepdata <- data.frame(cumhaz = c(nadata$cumhaz, nadata$pwch), \n                         time = rep(nadata$time, 2),\n                         tmentnum = rep(nadata$tmentnum, 2),\n                         type = c(rep(\"Nelson-Aalen\", length(nadata$time)), \n                                  rep(\"Piece-wise exponential\", length(nadata$time))))\n# Only for treatment 1\npiecepdata1 <- subset(piecepdata, tmentnum == 1)\n\n# Create Figure 2.3\nfig2.3 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = type), \n                data = subset(piecepdata1, type == \"Nelson-Aalen\")) + \n  geom_step(size = 1) + \n  geom_line(aes(x = time / 365.25, y = cumhaz, linetype = type), size = 1,\n            data = subset(piecepdata1, type == \"Piece-wise exponential\")) + \n  labs(linetype = \"Type\") + \n  xlab(\"Time since randomization (years)\") + \n  ylab(\"Cumulative hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1))  + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general+\n  theme(legend.title=element_blank(),\n        legend.text = element_text(size = 20),\n        legend.key.size = unit(2,\"line\"))\n\nfig2.3\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.5 --------------------------------------#\n#------------------------------------------------------------------#\n\n# Fit a Cox model using the pbc3 data with treatment as a covariate\ncoxfit <- coxph(Surv(days, status != 0) ~ tment, data = pbc3, method = \"breslow\")\n\n# Summary of fit\nsummary(coxfit)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment, data = pbc3, \n    method = \"breslow\")\n\n  n= 349, number of events= 90 \n\n          coef exp(coef) se(coef)      z Pr(>|z|)\ntment -0.05854   0.94314  0.21092 -0.278    0.781\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntment    0.9431       1.06    0.6238     1.426\n\nConcordance= 0.517  (se = 0.029 )\nLikelihood ratio test= 0.08  on 1 df,   p=0.8\nWald test            = 0.08  on 1 df,   p=0.8\nScore (logrank) test = 0.08  on 1 df,   p=0.8\n\n# Extract cumulative baseline hazard\ncoxcumhaz <- basehaz(coxfit, centered = FALSE)\n\n# Collect data for plot\ncoxdata <- data.frame(cumhaz = coxcumhaz$hazard, \n                      time = coxcumhaz$time, \n                      tment = rep(\"0\", nrow(coxcumhaz)), \n                      type = rep(\"Breslow estimate\", nrow(coxcumhaz)))\n\n# Create Figure 2.5\nfig2.5 <- ggplot(aes(x = time / 365.25, y = cumhaz, linetype = tment), data = coxdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") + \n  ylab(\"Cumulative baseline hazard\") + \n  scale_linetype_discrete(\"Treatment\", labels = c(\"Placebo\")) + \n  scale_x_continuous(expand = expansion(mult = c(0.001, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +\n  theme_general+theme(legend.position = \"none\")\n\nfig2.5\n\n\n\n#------------------------------------------------------------------#\n#---------------- Table 2.3 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Calculate average covariate values of albumin and bilirubin per treatment group\n\n# Summarize\nrequire(dplyr)\npcwdata <- pbc3 %>% \n  group_by(tment, tment_char) %>% \n  summarise(n = sum(id != 0),  \n            average_albumin = mean(alb, na.rm = TRUE), # NOTE: Removes missing observations from mean computation\n            average_bilirubin = mean(bili, na.rm = TRUE), \n            )\npcwdata <- as.data.frame(pcwdata)\npcwdata\n\n  tment tment_char   n average_albumin average_bilirubin\n1     0    Placebo 173        39.26101          42.33674\n2     1        CyA 176        37.50731          48.55540\n\n#------------------------------------------------------------------#\n#---------------- Table 2.4 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Cox model with treatment, albumin and bilirubin as covariates \n\ncoxfit <- coxph(Surv(days, status != 0) ~ tment + alb + bili,\n                data = pbc3)\n\nsummary(coxfit)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + bili, \n    data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n            coef  exp(coef)   se(coef)      z Pr(>|z|)    \ntment -0.4965639  0.6086184  0.2256162 -2.201   0.0277 *  \nalb   -0.1156596  0.8907784  0.0212810 -5.435 5.48e-08 ***\nbili   0.0089494  1.0089895  0.0009801  9.131  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntment    0.6086     1.6431    0.3911    0.9471\nalb      0.8908     1.1226    0.8544    0.9287\nbili     1.0090     0.9911    1.0071    1.0109\n\nConcordance= 0.806  (se = 0.021 )\nLikelihood ratio test= 99.06  on 3 df,   p=<2e-16\nWald test            = 121  on 3 df,   p=<2e-16\nScore (logrank) test = 172.3  on 3 df,   p=<2e-16\n\n#------------------------------------------------------------------#\n#---------------- Table 2.5 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Poisson model with treatment, albumin and bilirubin as covariates\n\npbc3mult$tment_char <- as.factor(pbc3mult$tment_char)\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\n\npoismod_t25 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili,\n                   data = pbc3mult,\n                   family = poisson)\n\nsummary(poismod_t25)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili, family = poisson, data = pbc3mult)\n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -4.7682896  0.9749615  -4.891  1.0e-06 ***\nas.factor(timegroup)1 -0.3196440  0.6042836  -0.529   0.5968    \nas.factor(timegroup)2  0.5381074  0.6022200   0.894   0.3716    \ntment_charPlacebo      0.4753406  0.2240970   2.121   0.0339 *  \nalb                   -0.1123359  0.0212829  -5.278  1.3e-07 ***\nbili                   0.0084593  0.0009392   9.007  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.73  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 538.73\n\nNumber of Fisher Scoring iterations: 6\n\n#------------------------------------------------------------------#\n#---------------- Table 2.6 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Add transformations of covariates \npbc3$albnorm <- with(pbc3, (alb-35)*(alb>35))\npbc3$alb10 <- with(pbc3, alb/10)\npbc3$alb2 <- with(pbc3, alb10*alb10)\n\npbc3$bilihigh <- with(pbc3, (bili-17.1)*(bili>17.1))\npbc3$bilitoohigh <- with(pbc3, (bili-34.2)*(bili>34.2))\npbc3$bilimuchtoohigh <- with(pbc3, (bili-51.3)*(bili>51.3))\npbc3$bili100 <- with(pbc3, bili/100)\npbc3$bili2 <- with(pbc3, bili100*bili100)\n\npbc3$log2bili <- with(pbc3, log2(bili))\npbc3$logbilihigh <- with(pbc3, (log2bili-log2(17.1))*(bili>17.1))\npbc3$logbilitoohigh <- with(pbc3, (log2bili-log2(34.2))*(bili>34.2))\npbc3$logbilimuchtoohigh <- with(pbc3, (log2bili-log2(51.3))*(bili>51.3))\npbc3$log2bili2 <- with(pbc3, log2bili*log2bili)\n\n\n\n# Make the data ready using survSplit\npbc3mult <- survSplit(Surv(days, fail) ~ ., \n                      pbc3,\n                      cut = cuts[-1], \n                      episode = \"timegroup\")\n\n# Risk time\npbc3mult$risktime <- pbc3mult$days - cuts[pbc3mult$timegroup] \n\n\n## Poisson models ##\n\n# For comparison, LR test\nbase_poismod <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili,\n                data = pbc3mult,\n                family = poisson)\n\nbase_poismod_log <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                    data = pbc3mult,\n                    family = poisson)\n\n## Linear effects \n# Poisson model 1\npoismod_t26_l1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili + albnorm,\n                   data = pbc3mult,\n                   family = poisson)\n\nsummary(poismod_t26_l1)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili + albnorm, family = poisson, data = pbc3mult)\n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -5.1177409  1.6273358  -3.145  0.00166 ** \nas.factor(timegroup)1 -0.3106216  0.6042733  -0.514  0.60722    \nas.factor(timegroup)2  0.5433694  0.6022062   0.902  0.36690    \ntment_charCyA         -0.4576984  0.2247281  -2.037  0.04168 *  \nalb                   -0.0864388  0.0451742  -1.913  0.05569 .  \nbili                   0.0084777  0.0009419   9.001  < 2e-16 ***\nalbnorm               -0.0473832  0.0720301  -0.658  0.51065    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.28  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 540.28\n\nNumber of Fisher Scoring iterations: 6\n\n# LR test\nrequire(lmtest)\nlrtest(poismod_t26_l1, \n       base_poismod)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + bili + albnorm\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -263.14                     \n2   6 -263.36 -1 0.4404     0.5069\n\n# Small error in table, test statistic = 0.44 (not 0.43)\n\n\n# Poisson model 2\npoismod_t26_l2 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                       bili + bilihigh + bilitoohigh + bilimuchtoohigh,\n                     data = pbc3mult,\n                     family = poisson)\n\nsummary(poismod_t26_l2)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh, \n    family = poisson, data = pbc3mult)\n\nCoefficients:\n                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.453990   1.368380  -4.717  2.4e-06 ***\nas.factor(timegroup)1 -0.427435   0.604700  -0.707   0.4797    \nas.factor(timegroup)2  0.425435   0.603554   0.705   0.4809    \ntment_charCyA         -0.569111   0.226892  -2.508   0.0121 *  \nalb                   -0.086487   0.021876  -3.954  7.7e-05 ***\nbili                   0.061654   0.062308   0.989   0.3224    \nbilihigh              -0.016757   0.085194  -0.197   0.8441    \nbilitoohigh            0.002652   0.052566   0.050   0.9598    \nbilimuchtoohigh       -0.042801   0.026193  -1.634   0.1022    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 326.18  on 602  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.18\n\nNumber of Fisher Scoring iterations: 6\n\n# LR test\nlrtest(poismod_t26_l2, \n       base_poismod)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   9 -251.09                         \n2   6 -263.36 -3 24.545  1.922e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n# Poisson model 3\npoismod_t26_l3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                       log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh,\n                     data = pbc3mult,\n                     family = poisson)\n\nsummary(poismod_t26_l3)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + logbilihigh + logbilitoohigh + \n    logbilimuchtoohigh, family = poisson, data = pbc3mult)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.52003    1.99572  -3.267 0.001087 ** \nas.factor(timegroup)1 -0.40679    0.60392  -0.674 0.500579    \nas.factor(timegroup)2  0.41834    0.60355   0.693 0.488223    \ntment_charCyA         -0.55563    0.22703  -2.447 0.014390 *  \nalb                   -0.08440    0.02181  -3.870 0.000109 ***\nlog2bili               0.19800    0.46549   0.425 0.670583    \nlogbilihigh            0.88154    0.91202   0.967 0.333756    \nlogbilitoohigh        -0.23363    1.27745  -0.183 0.854884    \nlogbilimuchtoohigh    -0.31390    0.97076  -0.323 0.746425    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.54  on 602  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 521.54\n\nNumber of Fisher Scoring iterations: 6\n\n# LR test\nlrtest(poismod_t26_l3, \n       base_poismod_log)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   9 -251.77                     \n2   6 -252.62 -3 1.7135     0.6339\n\n## Quadratic effects\n\n# For comparison, LR test\nbase_poismod2 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + bili100,\n                    data = pbc3mult,\n                    family = poisson)\n\nbase_poismod2_log <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + log2bili,\n                        data = pbc3mult,\n                        family = poisson)\n\n\n\n# Poisson model 1\npoismod_t26_q1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + alb2 + bili100,\n                     data = pbc3mult,\n                     family = poisson)\n\nsummary(poismod_t26_q1)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb10 + alb2 + bili100, family = poisson, data = pbc3mult)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -3.82798    3.81418  -1.004   0.3156    \nas.factor(timegroup)1 -0.32278    0.60484  -0.534   0.5936    \nas.factor(timegroup)2  0.53621    0.60243   0.890   0.3734    \ntment_charCyA         -0.47868    0.22585  -2.119   0.0341 *  \nalb10                 -1.38772    2.10146  -0.660   0.5090    \nalb2                   0.03705    0.29295   0.126   0.8993    \nbili100                0.84614    0.09391   9.010   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.71  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 540.71\n\nNumber of Fisher Scoring iterations: 6\n\n# LR test\nlrtest(poismod_t26_q1, \n       base_poismod2)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + alb2 + bili100\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + bili100\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -263.36                     \n2   6 -263.36 -1 0.0158     0.8999\n\n# Poisson model 2\npoismod_t26_q2 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + bili2 + bili100,\n                      data = pbc3mult,\n                      family = poisson)\n\nsummary(poismod_t26_q2)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb10 + bili2 + bili100, family = poisson, data = pbc3mult)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -5.16310    1.05317  -4.902 9.47e-07 ***\nas.factor(timegroup)1 -0.38186    0.60472  -0.631  0.52774    \nas.factor(timegroup)2  0.45545    0.60332   0.755  0.45030    \ntment_charCyA         -0.49873    0.22169  -2.250  0.02447 *  \nalb10                 -0.97736    0.21632  -4.518 6.24e-06 ***\nbili2                 -0.31517    0.09069  -3.475  0.00051 ***\nbili100                1.99829    0.32664   6.118 9.49e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 337.38  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 527.38\n\nNumber of Fisher Scoring iterations: 6\n\n# LR test\nlrtest(poismod_t26_q2, \n       base_poismod2)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + bili2 + bili100\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + bili100\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   7 -256.69                         \n2   6 -263.36 -1 13.345  0.0002591 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n# Poisson model 3\npoismod_t26_q3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + log2bili + log2bili2,\n                      data = pbc3mult,\n                      family = poisson)\n\nsummary(poismod_t26_q3)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb10 + log2bili + log2bili2, family = poisson, \n    data = pbc3mult)\n\nCoefficients:\n                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -7.860086   1.851557  -4.245 2.18e-05 ***\nas.factor(timegroup)1 -0.406020   0.604625  -0.672   0.5019    \nas.factor(timegroup)2  0.439074   0.603467   0.728   0.4669    \ntment_charCyA         -0.545495   0.222667  -2.450   0.0143 *  \nalb10                 -0.871058   0.218920  -3.979 6.92e-05 ***\nlog2bili               0.627828   0.497489   1.262   0.2070    \nlog2bili2              0.001641   0.042356   0.039   0.9691    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.25  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.25\n\nNumber of Fisher Scoring iterations: 6\n\n# LR test\nlrtest(poismod_t26_q3, \n       base_poismod2_log)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + log2bili + log2bili2\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb10 + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -252.62                     \n2   6 -252.62 -1 0.0015     0.9691\n\n## Cox models ##\n\n# Models for LR tests\n\nbase_coxmod <- coxph(Surv(days, status != 0) ~ tment + alb + bili, eps = 1e-8, method = \"breslow\",\n                       data = pbc3)\n\nbase_coxmod_log <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili, eps = 1e-8, method = \"breslow\",\n                     data = pbc3)\n\n\n## Linear effects \n# Cox model 1\ncoxmod_t26_l1 <- coxph(Surv(days, status != 0) ~ tment + alb + bili + albnorm, eps = 1e-8, method = \"breslow\",\n                 data = pbc3)\n\nsummary(coxmod_t26_l1)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + bili + \n    albnorm, data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n              coef  exp(coef)   se(coef)      z Pr(>|z|)    \ntment   -0.4750722  0.6218402  0.2261462 -2.101   0.0357 *  \nalb     -0.0854244  0.9181225  0.0453150 -1.885   0.0594 .  \nbili     0.0089810  1.0090214  0.0009843  9.124   <2e-16 ***\nalbnorm -0.0557001  0.9458228  0.0726447 -0.767   0.4432    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n        exp(coef) exp(-coef) lower .95 upper .95\ntment      0.6218     1.6081    0.3992    0.9687\nalb        0.9181     1.0892    0.8401    1.0034\nbili       1.0090     0.9911    1.0071    1.0110\nalbnorm    0.9458     1.0573    0.8203    1.0905\n\nConcordance= 0.806  (se = 0.021 )\nLikelihood ratio test= 99.66  on 4 df,   p=<2e-16\nWald test            = 118.5  on 4 df,   p=<2e-16\nScore (logrank) test = 175.5  on 4 df,   p=<2e-16\n\n# LR test\nlrtest(coxmod_t26_l1, base_coxmod)\n\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + bili + albnorm\nModel 2: Surv(days, status != 0) ~ tment + alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   4 -413.12                     \n2   3 -413.42 -1 0.6001     0.4386\n\n# or alternatively anova(coxmod_t26_l1)\n\n# Cox model 2\ncoxmod_t26_l2 <- coxph(Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh,\n                       eps = 1e-8, method = \"breslow\",\n                       data = pbc3)\n\nsummary(coxmod_t26_l2)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + bili + \n    bilihigh + bilitoohigh + bilimuchtoohigh, data = pbc3, method = \"breslow\", \n    eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n                     coef exp(coef)  se(coef)      z Pr(>|z|)    \ntment           -0.598494  0.549639  0.229637 -2.606  0.00915 ** \nalb             -0.090970  0.913045  0.021894 -4.155 3.25e-05 ***\nbili             0.062425  1.064414  0.062296  1.002  0.31631    \nbilihigh        -0.014631  0.985476  0.085327 -0.171  0.86386    \nbilitoohigh     -0.002584  0.997419  0.052961 -0.049  0.96109    \nbilimuchtoohigh -0.040017  0.960773  0.026486 -1.511  0.13082    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                exp(coef) exp(-coef) lower .95 upper .95\ntment              0.5496     1.8194    0.3504    0.8621\nalb                0.9130     1.0952    0.8747    0.9531\nbili               1.0644     0.9395    0.9421    1.2026\nbilihigh           0.9855     1.0147    0.8337    1.1649\nbilitoohigh        0.9974     1.0026    0.8991    1.1065\nbilimuchtoohigh    0.9608     1.0408    0.9122    1.0120\n\nConcordance= 0.825  (se = 0.021 )\nLikelihood ratio test= 123.5  on 6 df,   p=<2e-16\nWald test            = 110.8  on 6 df,   p=<2e-16\nScore (logrank) test = 173.9  on 6 df,   p=<2e-16\n\n# LR test\nlrtest(coxmod_t26_l2, base_coxmod)\n\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + \n    bilimuchtoohigh\nModel 2: Surv(days, status != 0) ~ tment + alb + bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   6 -401.22                         \n2   3 -413.42 -3 24.396  2.064e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n# Cox model 3\ncoxmod_t26_l3 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh,\n                       eps = 1e-8, method = \"breslow\",\n                       data = pbc3)\n\nsummary(coxmod_t26_l3)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + \n    logbilihigh + logbilitoohigh + logbilimuchtoohigh, data = pbc3, \n    method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n                       coef exp(coef) se(coef)      z Pr(>|z|)    \ntment              -0.58019   0.55979  0.22957 -2.527   0.0115 *  \nalb                -0.08852   0.91528  0.02182 -4.056 4.99e-05 ***\nlog2bili            0.20135   1.22306  0.46511  0.433   0.6651    \nlogbilihigh         0.93567   2.54893  0.91503  1.023   0.3065    \nlogbilitoohigh     -0.38647   0.67945  1.29333 -0.299   0.7651    \nlogbilimuchtoohigh -0.18140   0.83410  0.98801 -0.184   0.8543    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                   exp(coef) exp(-coef) lower .95 upper .95\ntment                 0.5598     1.7864   0.35696    0.8779\nalb                   0.9153     1.0926   0.87696    0.9553\nlog2bili              1.2231     0.8176   0.49152    3.0433\nlogbilihigh           2.5489     0.3923   0.42412   15.3191\nlogbilitoohigh        0.6794     1.4718   0.05386    8.5712\nlogbilimuchtoohigh    0.8341     1.1989   0.12029    5.7838\n\nConcordance= 0.823  (se = 0.021 )\nLikelihood ratio test= 121.6  on 6 df,   p=<2e-16\nWald test            = 108.5  on 6 df,   p=<2e-16\nScore (logrank) test = 164.3  on 6 df,   p=<2e-16\n\n# LR test\nlrtest(coxmod_t26_l3, base_coxmod_log)\n\nLikelihood ratio test\n\nModel 1: Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + \n    logbilitoohigh + logbilimuchtoohigh\nModel 2: Surv(days, status != 0) ~ tment + alb + log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -402.13                     \n2   3 -402.94 -3 1.6144     0.6561\n\n## Quadratic effects \n# Cox model 1\ncoxmod_t26_q1 <- coxph(Surv(days, status != 0) ~ tment + alb10 + bili100 + alb2,\n                       data = pbc3)\n\nsummary(coxmod_t26_q1)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb10 + bili100 + \n    alb2, data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n            coef exp(coef) se(coef)      z Pr(>|z|)    \ntment   -0.49840   0.60750  0.22743 -2.191   0.0284 *  \nalb10   -1.29704   0.27334  2.13031 -0.609   0.5426    \nbili100  0.89502   2.44739  0.09800  9.133   <2e-16 ***\nalb2     0.01971   1.01991  0.29751  0.066   0.9472    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n        exp(coef) exp(-coef) lower .95 upper .95\ntment      0.6075     1.6461  0.389011    0.9487\nalb10      0.2733     3.6584  0.004201   17.7838\nbili100    2.4474     0.4086  2.019676    2.9657\nalb2       1.0199     0.9805  0.569276    1.8273\n\nConcordance= 0.806  (se = 0.021 )\nLikelihood ratio test= 99.06  on 4 df,   p=<2e-16\nWald test            = 121.2  on 4 df,   p=<2e-16\nScore (logrank) test = 178.8  on 4 df,   p=<2e-16\n\n# Cox model 2\ncoxmod_t26_q2 <- coxph(Surv(days, status != 0) ~ tment + alb10 + bili100 + bili2,\n                       data = pbc3)\n\nsummary(coxmod_t26_q2)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb10 + bili100 + \n    bili2, data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n            coef exp(coef) se(coef)      z Pr(>|z|)    \ntment   -0.52111   0.59386  0.22330 -2.334 0.019613 *  \nalb10   -1.01919   0.36089  0.21675 -4.702 2.57e-06 ***\nbili100  1.99811   7.37511  0.32629  6.124 9.14e-10 ***\nbili2   -0.30520   0.73698  0.09098 -3.355 0.000795 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n        exp(coef) exp(-coef) lower .95 upper .95\ntment      0.5939     1.6839    0.3834    0.9199\nalb10      0.3609     2.7709    0.2360    0.5519\nbili100    7.3751     0.1356    3.8907   13.9800\nbili2      0.7370     1.3569    0.6166    0.8808\n\nConcordance= 0.815  (se = 0.021 )\nLikelihood ratio test= 111.4  on 4 df,   p=<2e-16\nWald test            = 121.6  on 4 df,   p=<2e-16\nScore (logrank) test = 172.5  on 4 df,   p=<2e-16\n\n# Cox model 3\ncoxmod_t26_q3 <- coxph(Surv(days, status != 0) ~ tment + alb10 + log2bili + log2bili2,\n                       data = pbc3)\n\nsummary(coxmod_t26_q3)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb10 + log2bili + \n    log2bili2, data = pbc3)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n               coef exp(coef)  se(coef)      z Pr(>|z|)    \ntment     -0.574344  0.563074  0.224533 -2.558   0.0105 *  \nalb10     -0.914495  0.400719  0.219173 -4.172 3.01e-05 ***\nlog2bili   0.583636  1.792545  0.500009  1.167   0.2431    \nlog2bili2  0.007044  1.007069  0.042774  0.165   0.8692    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n          exp(coef) exp(-coef) lower .95 upper .95\ntment        0.5631     1.7760    0.3626    0.8744\nalb10        0.4007     2.4955    0.2608    0.6157\nlog2bili     1.7925     0.5579    0.6728    4.7762\nlog2bili2    1.0071     0.9930    0.9261    1.0951\n\nConcordance= 0.819  (se = 0.022 )\nLikelihood ratio test= 120.1  on 4 df,   p=<2e-16\nWald test            = 111.9  on 4 df,   p=<2e-16\nScore (logrank) test = 169.6  on 4 df,   p=<2e-16\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.6 --------------------------------------#\n#------------------------------------------------------------------#\n\n# The below linear predictors include estimates from the following models, \n\n\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npbc3mult$tment_char <- as.factor(pbc3mult$tment_char)\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\n\nbase_poismod <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili,\n                    data = pbc3mult,\n                    family = poisson)\nsummary(base_poismod)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili, family = poisson, data = pbc3mult)\n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -4.2301822  0.7855195  -5.385 7.24e-08 ***\nas.factor(timegroup)3 -0.5381074  0.6022200  -0.894 0.371568    \nas.factor(timegroup)1 -0.8577514  0.2361480  -3.632 0.000281 ***\ntment_charPlacebo      0.4753406  0.2240970   2.121 0.033910 *  \nalb                   -0.1123359  0.0212829  -5.278 1.30e-07 ***\nbili                   0.0084593  0.0009392   9.007  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.73  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 538.73\n\nNumber of Fisher Scoring iterations: 6\n\npoismod_t26_l1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + bili + albnorm,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t26_l1) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili + albnorm, family = poisson, data = pbc3mult)\n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -5.0320699  1.4715432  -3.420 0.000627 ***\nas.factor(timegroup)3 -0.5433694  0.6022062  -0.902 0.366899    \nas.factor(timegroup)1 -0.8539910  0.2362103  -3.615 0.000300 ***\ntment_charPlacebo      0.4576984  0.2247281   2.037 0.041683 *  \nalb                   -0.0864388  0.0451742  -1.913 0.055690 .  \nbili                   0.0084777  0.0009419   9.001  < 2e-16 ***\nalbnorm               -0.0473832  0.0720301  -0.658 0.510651    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 350.28  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 540.28\n\nNumber of Fisher Scoring iterations: 6\n\npoismod_t26_l3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                        bili + bilihigh + bilitoohigh + bilimuchtoohigh,\n                      data = pbc3mult,\n                      family = poisson)\n\nsummary(poismod_t26_l3) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh, \n    family = poisson, data = pbc3mult)\n\nCoefficients:\n                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.597666   1.204436  -5.478 4.31e-08 ***\nas.factor(timegroup)3 -0.425435   0.603554  -0.705  0.48088    \nas.factor(timegroup)1 -0.852870   0.231526  -3.684  0.00023 ***\ntment_charPlacebo      0.569111   0.226892   2.508  0.01213 *  \nalb                   -0.086487   0.021876  -3.954 7.70e-05 ***\nbili                   0.061654   0.062308   0.989  0.32242    \nbilihigh              -0.016757   0.085194  -0.197  0.84406    \nbilitoohigh            0.002652   0.052566   0.050  0.95977    \nbilimuchtoohigh       -0.042801   0.026193  -1.634  0.10224    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 326.18  on 602  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.18\n\nNumber of Fisher Scoring iterations: 6\n\n# Make a dataset with linear predictor information\nlin2 <- pbc3\n\nlin2$lp1 <- with(pbc3, 1.6076-0.1123*alb)\nlin2$lp2 <- with(pbc3, 0.7828-0.0864*alb-0.0474*albnorm)\nlin2$lp3 <- with(pbc3, 1.6076+0.0085*bili-38.7*0.1123)\nlin2$lp4 <- with(pbc3, -0.5534+0.0617*bili-0.0168*bilihigh+0.0027*bilitoohigh\n                 -0.0428*bilimuchtoohigh-0.0865*38.7)\n\n\nlin2row <- data.frame(effect = c(rep(\"Linear effect\", nrow(lin2)),\n                                 rep(\"Effect as linear spline\", nrow(lin2))), \n                      lp = c(lin2$lp1, lin2$lp2),\n                      alb = c(lin2$alb, lin2$alb))\n\nrequire(ggplot2)\n\nfig2.6 <- ggplot(aes(x = alb, y = lp, linetype = effect), data = lin2row) +\n  geom_line(size = 1) + \n  xlab(\"Albumin\") + \n  ylab(\"Linear predictor\") + \n  scale_linetype_discrete(\"Effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general +\n  theme(legend.title=element_blank(),\n        legend.text = element_text(size = 20),\n        legend.key.size = unit(2,\"line\"))\n\nfig2.6\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.7 --------------------------------------#\n#------------------------------------------------------------------#\n\n# bilirubin and the two last linear predictors\nlin2row2 <- data.frame(effect = c(rep(\"Linear effect\", nrow(lin2)),\n                                  rep(\"Effect as linear spline\", nrow(lin2))), \n                      lp = c(lin2$lp3, lin2$lp4),\n                      bili = c(lin2$bili, lin2$bili))\n\nrequire(ggplot2)\n\nfig2.7 <- ggplot(aes(x = bili, y = lp, linetype = effect), data = lin2row2) + \n  geom_line(size = 1) + \n  xlab(\"Bilirubin\") + \n  ylab(\"Linear predictor\") + \n  scale_linetype_discrete(\"Effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general +\n  theme(legend.title=element_blank(), \n        legend.text = element_text(size = 20), \n        legend.key.size = unit(2,\"line\"))\n\nfig2.7\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.8 --------------------------------------#\n#------------------------------------------------------------------#\n\n# The below linear predictors include estimates from the following models, \n\nbase_poismod2_log <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb10 + log2bili,\n                         data = pbc3mult,\n                         family = poisson)\nsummary(base_poismod2_log)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb10 + log2bili, family = poisson, data = pbc3mult)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -8.02328    0.95100  -8.437  < 2e-16 ***\nas.factor(timegroup)3 -0.43894    0.60346  -0.727 0.466999    \nas.factor(timegroup)1 -0.84401    0.22867  -3.691 0.000223 ***\ntment_charPlacebo      0.54549    0.22265   2.450 0.014288 *  \nalb10                 -0.86972    0.21615  -4.024 5.73e-05 ***\nlog2bili               0.64689    0.07326   8.830  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.25  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 517.25\n\nNumber of Fisher Scoring iterations: 6\n\npoismod_t26_l3 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + \n                        log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh,\n                        data = pbc3mult,\n                        family = poisson)\n\nsummary(poismod_t26_l3)\n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + logbilihigh + logbilitoohigh + \n    logbilimuchtoohigh, family = poisson, data = pbc3mult)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.65731    1.88624  -3.529 0.000416 ***\nas.factor(timegroup)3 -0.41834    0.60355  -0.693 0.488223    \nas.factor(timegroup)1 -0.82513    0.22932  -3.598 0.000320 ***\ntment_charPlacebo      0.55563    0.22703   2.447 0.014390 *  \nalb                   -0.08440    0.02181  -3.870 0.000109 ***\nlog2bili               0.19800    0.46549   0.425 0.670583    \nlogbilihigh            0.88154    0.91202   0.967 0.333756    \nlogbilitoohigh        -0.23363    1.27745  -0.183 0.854884    \nlogbilimuchtoohigh    -0.31390    0.97076  -0.323 0.746425    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.54  on 602  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 521.54\n\nNumber of Fisher Scoring iterations: 6\n\n# Make a dataset with linear predictor information\nlog2 <- pbc3\n\nlog2$lp3 <- with(pbc3, -2.0162+0.6469*log2bili-38.7*0.087)\nlog2$lp4 <- with(pbc3, -0.6194+0.198*log2bili+0.8815*logbilihigh-0.2336*logbilitoohigh\n                 -0.3139*logbilimuchtoohigh-0.0844*38.7)\n\n\nlog2row <- data.frame(effect = c(rep(\"Linear effect\", nrow(log2)),\n                                 rep(\"Effect as linear spline\", nrow(log2))), \n                      lp = c(log2$lp3, log2$lp4),\n                      log2bili = c(log2$log2bili, log2$log2bili))\n\n# Make plot\nfig2.8 <- ggplot(aes(x = log2bili, y = lp, linetype = effect), data = log2row) + \n  geom_line(size = 1) + \n  xlab(expression(log[2] * \"(bilirubin)\")) +\n  ylab(\"Linear predictor\") + \n  scale_linetype_discrete(\"Effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general +\n  theme(legend.title=element_blank(), \n        legend.text = element_text(size = 20), \n        legend.key.size = unit(2,\"line\"))\n\nfig2.8\n\n\n\n#------------------------------------------------------------------#\n#---------------- Table 2.7 ---------------------------------------#\n#------------------------------------------------------------------#\n\n# Cox model\ncoxmod_t27 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                    eps = 1e-8, method = \"breslow\",\n                    data = pbc3)\n\nsummary(coxmod_t27)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, \n    data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n             coef exp(coef) se(coef)      z Pr(>|z|)    \ntment    -0.57406   0.56323  0.22447 -2.557   0.0105 *  \nalb      -0.09093   0.91308  0.02164 -4.201 2.65e-05 ***\nlog2bili  0.66500   1.94449  0.07443  8.935  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\ntment       0.5632     1.7755    0.3628    0.8745\nalb         0.9131     1.0952    0.8752    0.9526\nlog2bili    1.9445     0.5143    1.6805    2.2499\n\nConcordance= 0.819  (se = 0.022 )\nLikelihood ratio test= 120  on 3 df,   p=<2e-16\nWald test            = 110.4  on 3 df,   p=<2e-16\nScore (logrank) test = 133.7  on 3 df,   p=<2e-16\n\n# Poisson model\npoismod_t27 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                   data = pbc3mult,\n                   family = poisson)\nsummary(poismod_t27) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili, family = poisson, data = pbc3mult)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -8.02328    0.95100  -8.437  < 2e-16 ***\nas.factor(timegroup)3 -0.43894    0.60346  -0.727 0.466999    \nas.factor(timegroup)1 -0.84401    0.22867  -3.691 0.000223 ***\ntment_charPlacebo      0.54549    0.22265   2.450 0.014288 *  \nalb                   -0.08697    0.02162  -4.024 5.73e-05 ***\nlog2bili               0.64689    0.07326   8.830  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.25  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 517.25\n\nNumber of Fisher Scoring iterations: 6\n\n#------------------------------------------------------------------#\n#---------------- Table 2.8 ---------------------------------------#\n#------------------------------------------------------------------#\n\n\n## Cox models\n\n# Model for LR comparison\ncoxmod_t28_base <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\n\n# Cox model 1\ncoxmod_t28_1 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili + tment*alb,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\nsummary(coxmod_t28_1)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + \n    tment * alb, data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n               coef exp(coef)  se(coef)      z Pr(>|z|)    \ntment     -0.009736  0.990312  1.559670 -0.006   0.9950    \nalb       -0.081319  0.921900  0.034031 -2.390   0.0169 *  \nlog2bili   0.664413  1.943350  0.074494  8.919   <2e-16 ***\ntment:alb -0.015725  0.984398  0.042980 -0.366   0.7145    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n          exp(coef) exp(-coef) lower .95 upper .95\ntment        0.9903     1.0098   0.04658   21.0555\nalb          0.9219     1.0847   0.86242    0.9855\nlog2bili     1.9434     0.5146   1.67935    2.2489\ntment:alb    0.9844     1.0158   0.90487    1.0709\n\nConcordance= 0.819  (se = 0.022 )\nLikelihood ratio test= 120.2  on 4 df,   p=<2e-16\nWald test            = 111.2  on 4 df,   p=<2e-16\nScore (logrank) test = 134.3  on 4 df,   p=<2e-16\n\n# LR test\nanova(coxmod_t28_1, \n      coxmod_t28_base)\n\nAnalysis of Deviance Table\n Cox model: response is  Surv(days, status != 0)\n Model 1: ~ tment + alb + log2bili + tment * alb\n Model 2: ~ tment + alb + log2bili\n   loglik  Chisq Df Pr(>|Chi|)\n1 -402.87                     \n2 -402.94 0.1338  1     0.7145\n\n# Cox model 2\ncoxmod_t28_2 <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili + tment*log2bili,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\nsummary(coxmod_t28_2)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + \n    tment * log2bili, data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n                   coef exp(coef) se(coef)      z Pr(>|z|)    \ntment           0.19880   1.21994  0.85653  0.232    0.816    \nalb            -0.09331   0.91091  0.02191 -4.260 2.05e-05 ***\nlog2bili        0.72558   2.06593  0.09865  7.355 1.91e-13 ***\ntment:log2bili -0.13213   0.87623  0.14180 -0.932    0.351    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\ntment             1.2199     0.8197    0.2276    6.5375\nalb               0.9109     1.0978    0.8726    0.9509\nlog2bili          2.0659     0.4840    1.7027    2.5066\ntment:log2bili    0.8762     1.1413    0.6636    1.1570\n\nConcordance= 0.821  (se = 0.022 )\nLikelihood ratio test= 120.9  on 4 df,   p=<2e-16\nWald test            = 112.9  on 4 df,   p=<2e-16\nScore (logrank) test = 136.9  on 4 df,   p=<2e-16\n\n# LR test\nanova(coxmod_t28_2, \n      coxmod_t28_base)\n\nAnalysis of Deviance Table\n Cox model: response is  Surv(days, status != 0)\n Model 1: ~ tment + alb + log2bili + tment * log2bili\n Model 2: ~ tment + alb + log2bili\n   loglik  Chisq Df Pr(>|Chi|)\n1 -402.51                     \n2 -402.94 0.8644  1     0.3525\n\n## Poisson models\n\n# Model for LR comparison - no interaction\npoismod_t28_base <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                     data = pbc3mult,\n                     family = poisson)\n\n# Poisson model 1\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\npoismod_t28_1 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*alb,\n                    data = pbc3mult,\n                    family = poisson)\nsummary(poismod_t28_1) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * alb, family = poisson, \n    data = pbc3mult)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -7.77706    1.11741  -6.960 3.41e-12 ***\nas.factor(timegroup)3 -0.43125    0.60379  -0.714 0.475080    \nas.factor(timegroup)1 -0.84426    0.22851  -3.695 0.000220 ***\ntment_charPlacebo     -0.09200    1.55226  -0.059 0.952738    \nalb                   -0.09406    0.02755  -3.414 0.000639 ***\nlog2bili               0.64624    0.07334   8.812  < 2e-16 ***\ntment_charPlacebo:alb  0.01778    0.04281   0.415 0.677959    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.08  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.08\n\nNumber of Fisher Scoring iterations: 6\n\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"CyA\")\npoismod_t28_11 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*alb,\n                     data = pbc3mult,\n                     family = poisson)\nsummary(poismod_t28_11) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * alb, family = poisson, \n    data = pbc3mult)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -7.86906    1.36181  -5.778 7.54e-09 ***\nas.factor(timegroup)3 -0.43125    0.60379  -0.714  0.47508    \nas.factor(timegroup)1 -0.84426    0.22851  -3.695  0.00022 ***\ntment_charCyA          0.09200    1.55226   0.059  0.95274    \nalb                   -0.07628    0.03359  -2.271  0.02316 *  \nlog2bili               0.64624    0.07334   8.812  < 2e-16 ***\ntment_charCyA:alb     -0.01778    0.04281  -0.415  0.67796    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 329.08  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.08\n\nNumber of Fisher Scoring iterations: 6\n\n# LR test\nlrtest(poismod_t28_base, \n       poismod_t28_1)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili + tment_char * alb\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   7 -252.54  1 0.1723      0.678\n\n# Poisson model 2\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\npoismod_t28_2 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*log2bili,\n                     data = pbc3mult,\n                     family = poisson)\nsummary(poismod_t28_2) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * log2bili, family = poisson, \n    data = pbc3mult)\n\nCoefficients:\n                           Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                -7.53457    1.09655  -6.871 6.37e-12 ***\nas.factor(timegroup)3      -0.41713    0.60400  -0.691 0.489808    \nas.factor(timegroup)1      -0.85694    0.22932  -3.737 0.000186 ***\ntment_charPlacebo          -0.18058    0.84828  -0.213 0.831422    \nalb                        -0.08909    0.02185  -4.078 4.54e-05 ***\nlog2bili                    0.57982    0.10472   5.537 3.08e-08 ***\ntment_charPlacebo:log2bili  0.12386    0.14006   0.884 0.376511    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.47  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 518.47\n\nNumber of Fisher Scoring iterations: 6\n\npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"CyA\")\npoismod_t28_21 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*log2bili,\n                     data = pbc3mult,\n                     family = poisson)\nsummary(poismod_t28_21) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * log2bili, family = poisson, \n    data = pbc3mult)\n\nCoefficients:\n                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)            -7.71515    1.01592  -7.594 3.10e-14 ***\nas.factor(timegroup)3  -0.41713    0.60400  -0.691 0.489808    \nas.factor(timegroup)1  -0.85694    0.22932  -3.737 0.000186 ***\ntment_charCyA           0.18058    0.84828   0.213 0.831422    \nalb                    -0.08909    0.02185  -4.078 4.54e-05 ***\nlog2bili                0.70368    0.09717   7.242 4.42e-13 ***\ntment_charCyA:log2bili -0.12386    0.14006  -0.884 0.376511    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.47  on 604  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 518.47\n\nNumber of Fisher Scoring iterations: 6\n\n# LR test\nlrtest(poismod_t28_base, \n       poismod_t28_2)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili + tment_char * log2bili\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   7 -252.24  1 0.7787     0.3775\n\n#------------------------------------------------------------------#\n#---------------- Table 2.9 ---------------------------------------#\n#------------------------------------------------------------------#\n\n\n# Column 1; \npbc3mult$tment_char <- relevel(pbc3mult$tment_char, ref = \"Placebo\")\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"1\")\n\npoismod_t29_11 <- glm(fail ~ offset(log(risktime)) + timegroup + tment_char + alb + log2bili + tment_char*timegroup,\n                     data = pbc3mult,\n                     family = poisson)\nsummary(poismod_t29_11) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + \n    alb + log2bili + tment_char * timegroup, family = poisson, \n    data = pbc3mult)\n\nCoefficients:\n                             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                  -8.01250    0.97312  -8.234  < 2e-16 ***\ntimegroup1                   -0.89421    0.31710  -2.820   0.0048 ** \ntimegroup3                   -0.89971    1.02908  -0.874   0.3820    \ntment_charPlacebo             0.46193    0.34460   1.340   0.1801    \nalb                          -0.08640    0.02166  -3.988 6.65e-05 ***\nlog2bili                      0.64871    0.07367   8.806  < 2e-16 ***\ntimegroup1:tment_charPlacebo  0.09973    0.44250   0.225   0.8217    \ntimegroup3:tment_charPlacebo  0.80434    1.27283   0.632   0.5274    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.82  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.82\n\nNumber of Fisher Scoring iterations: 6\n\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"2\")\npoismod_t29_12 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_12) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * timegroup, family = poisson, \n    data = pbc3mult)\n\nCoefficients: (2 not defined because of singularities)\n                              Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                  -8.912206   1.410958  -6.316 2.68e-10 ***\nas.factor(timegroup)2         0.899710   1.029079   0.874    0.382    \nas.factor(timegroup)1         0.005499   1.026826   0.005    0.996    \ntment_charPlacebo             1.266273   1.229390   1.030    0.303    \nalb                          -0.086405   0.021665  -3.988 6.65e-05 ***\nlog2bili                      0.648711   0.073669   8.806  < 2e-16 ***\ntimegroup2                          NA         NA      NA       NA    \ntimegroup1                          NA         NA      NA       NA    \ntment_charPlacebo:timegroup2 -0.804338   1.272830  -0.632    0.527    \ntment_charPlacebo:timegroup1 -0.704610   1.262063  -0.558    0.577    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.82  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.82\n\nNumber of Fisher Scoring iterations: 6\n\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npoismod_t29_13 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + tment_char*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_13) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + tment_char * timegroup, family = poisson, \n    data = pbc3mult)\n\nCoefficients: (2 not defined because of singularities)\n                              Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                  -8.906706   0.949577  -9.380  < 2e-16 ***\nas.factor(timegroup)3        -0.005499   1.026826  -0.005   0.9957    \nas.factor(timegroup)2         0.894211   0.317101   2.820   0.0048 ** \ntment_charPlacebo             0.561662   0.290915   1.931   0.0535 .  \nalb                          -0.086405   0.021665  -3.988 6.65e-05 ***\nlog2bili                      0.648711   0.073669   8.806  < 2e-16 ***\ntimegroup3                          NA         NA      NA       NA    \ntimegroup2                          NA         NA      NA       NA    \ntment_charPlacebo:timegroup3  0.704610   1.262063   0.558   0.5766    \ntment_charPlacebo:timegroup2 -0.099728   0.442503  -0.225   0.8217    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 328.82  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 520.82\n\nNumber of Fisher Scoring iterations: 6\n\n# Column 2; \npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"1\")\npoismod_t29_21 <- glm(fail ~ offset(log(risktime)) + timegroup + tment_char + alb + log2bili + alb*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_21) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + \n    alb + log2bili + alb * timegroup, family = poisson, data = pbc3mult)\n\nCoefficients:\n                  Estimate Std. Error z value Pr(>|z|)    \n(Intercept)       -9.30795    1.40949  -6.604 4.01e-11 ***\ntimegroup1         1.24042    1.59864   0.776   0.4378    \ntimegroup3         0.01433    6.09060   0.002   0.9981    \ntment_charPlacebo  0.56130    0.22300   2.517   0.0118 *  \nalb               -0.05231    0.03472  -1.507   0.1319    \nlog2bili           0.64608    0.07361   8.777  < 2e-16 ***\ntimegroup1:alb    -0.05795    0.04376  -1.324   0.1854    \ntimegroup3:alb    -0.01311    0.15739  -0.083   0.9336    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.45  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.45\n\nNumber of Fisher Scoring iterations: 6\n\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"2\")\npoismod_t29_22 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + alb*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_22) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + alb * timegroup, family = poisson, \n    data = pbc3mult)\n\nCoefficients: (2 not defined because of singularities)\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -9.29362    5.94435  -1.563   0.1179    \nas.factor(timegroup)2 -0.01433    6.09060  -0.002   0.9981    \nas.factor(timegroup)1  1.22609    6.02995   0.203   0.8389    \ntment_charPlacebo      0.56130    0.22300   2.517   0.0118 *  \nalb                   -0.06542    0.15336  -0.427   0.6697    \nlog2bili               0.64608    0.07361   8.777   <2e-16 ***\ntimegroup2                  NA         NA      NA       NA    \ntimegroup1                  NA         NA      NA       NA    \nalb:timegroup2         0.01311    0.15739   0.083   0.9336    \nalb:timegroup1        -0.04484    0.15605  -0.287   0.7739    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.45  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.45\n\nNumber of Fisher Scoring iterations: 6\n\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npoismod_t29_23 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + alb*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_23) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + alb * timegroup, family = poisson, \n    data = pbc3mult)\n\nCoefficients: (2 not defined because of singularities)\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -8.06752    1.11184  -7.256 3.99e-13 ***\nas.factor(timegroup)3 -1.22609    6.02995  -0.203   0.8389    \nas.factor(timegroup)2 -1.24042    1.59864  -0.776   0.4378    \ntment_charPlacebo      0.56130    0.22300   2.517   0.0118 *  \nalb                   -0.11026    0.02791  -3.951 7.79e-05 ***\nlog2bili               0.64608    0.07361   8.777  < 2e-16 ***\ntimegroup3                  NA         NA      NA       NA    \ntimegroup2                  NA         NA      NA       NA    \nalb:timegroup3         0.04484    0.15605   0.287   0.7739    \nalb:timegroup2         0.05795    0.04376   1.324   0.1854    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.45  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.45\n\nNumber of Fisher Scoring iterations: 6\n\n# Column 3; \npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"1\")\npoismod_t29_31 <- glm(fail ~ offset(log(risktime)) + timegroup + tment_char + alb + log2bili + log2bili*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_31) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + \n    alb + log2bili + log2bili * timegroup, family = poisson, \n    data = pbc3mult)\n\nCoefficients:\n                    Estimate Std. Error z value Pr(>|z|)    \n(Intercept)         -7.57166    1.08557  -6.975 3.06e-12 ***\ntimegroup1          -1.72397    0.88760  -1.942   0.0521 .  \ntimegroup3           0.69600    2.32124   0.300   0.7643    \ntment_charPlacebo    0.51454    0.22373   2.300   0.0215 *  \nalb                 -0.08570    0.02174  -3.942 8.10e-05 ***\nlog2bili             0.55747    0.12113   4.602 4.18e-06 ***\ntimegroup1:log2bili  0.15296    0.15024   1.018   0.3086    \ntimegroup3:log2bili -0.25235    0.49539  -0.509   0.6105    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.67  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.67\n\nNumber of Fisher Scoring iterations: 6\n\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"2\")\npoismod_t29_32 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + log2bili*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_32) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + log2bili * timegroup, family = poisson, \n    data = pbc3mult)\n\nCoefficients: (2 not defined because of singularities)\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -6.87566    2.36338  -2.909  0.00362 ** \nas.factor(timegroup)2 -0.69600    2.32124  -0.300  0.76430    \nas.factor(timegroup)1 -2.41998    2.30859  -1.048  0.29452    \ntment_charPlacebo      0.51454    0.22373   2.300  0.02146 *  \nalb                   -0.08570    0.02174  -3.942  8.1e-05 ***\nlog2bili               0.30512    0.48171   0.633  0.52646    \ntimegroup2                  NA         NA      NA       NA    \ntimegroup1                  NA         NA      NA       NA    \nlog2bili:timegroup2    0.25235    0.49539   0.509  0.61047    \nlog2bili:timegroup1    0.40532    0.49015   0.827  0.40828    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.67  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.67\n\nNumber of Fisher Scoring iterations: 6\n\npbc3mult$timegroup <- relevel(as.factor(pbc3mult$timegroup), ref = \"3\")\npoismod_t29_33 <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili + log2bili*timegroup,\n                      data = pbc3mult,\n                      family = poisson)\nsummary(poismod_t29_33) \n\n\nCall:\nglm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + \n    tment_char + alb + log2bili + log2bili * timegroup, family = poisson, \n    data = pbc3mult)\n\nCoefficients: (2 not defined because of singularities)\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -9.29563    1.02069  -9.107  < 2e-16 ***\nas.factor(timegroup)3  2.41998    2.30859   1.048   0.2945    \nas.factor(timegroup)2  1.72397    0.88760   1.942   0.0521 .  \ntment_charPlacebo      0.51454    0.22373   2.300   0.0215 *  \nalb                   -0.08570    0.02174  -3.942 8.10e-05 ***\nlog2bili               0.71044    0.09260   7.672 1.69e-14 ***\ntimegroup3                  NA         NA      NA       NA    \ntimegroup2                  NA         NA      NA       NA    \nlog2bili:timegroup3   -0.40532    0.49015  -0.827   0.4083    \nlog2bili:timegroup2   -0.15296    0.15024  -1.018   0.3086    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 449.14  on 610  degrees of freedom\nResidual deviance: 327.67  on 603  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 519.67\n\nNumber of Fisher Scoring iterations: 6\n\n## LR tests \n\n# Base model; no interaction\n\npoismod_t29_base <- glm(fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + alb + log2bili,\n                      data = pbc3mult,\n                      family = poisson)\n# Column 1\nlrtest(poismod_t29_base, \n       poismod_t29_11)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + \n    log2bili + tment_char * timegroup\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   8 -252.41  2 0.4312     0.8061\n\n# Column 2\nlrtest(poismod_t29_base, \n       poismod_t29_21)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + \n    log2bili + alb * timegroup\n  #Df  LogLik Df Chisq Pr(>Chisq)\n1   6 -252.62                    \n2   8 -251.72  2 1.803      0.406\n\n# Column 3\nlrtest(poismod_t29_base, \n       poismod_t29_31)\n\nLikelihood ratio test\n\nModel 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + \n    alb + log2bili\nModel 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + \n    log2bili + log2bili * timegroup\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   6 -252.62                     \n2   8 -251.84  2 1.5777     0.4544\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.10 --------------------------------------#\n#------------------------------------------------------------------#\n\ncoxmod_f29 <- coxph(Surv(days, status != 0) ~ strata(tment) + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\nsummary(coxmod_f29)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ strata(tment) + alb + \n    log2bili, data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n             coef exp(coef) se(coef)      z Pr(>|z|)    \nalb      -0.09002   0.91391  0.02168 -4.153 3.28e-05 ***\nlog2bili  0.66328   1.94114  0.07531  8.807  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\nalb         0.9139     1.0942    0.8759    0.9536\nlog2bili    1.9411     0.5152    1.6748    2.2499\n\nConcordance= 0.818  (se = 0.022 )\nLikelihood ratio test= 119.3  on 2 df,   p=<2e-16\nWald test            = 109.1  on 2 df,   p=<2e-16\nScore (logrank) test = 133.5  on 2 df,   p=<2e-16\n\n# Extracting cumulative baseline hazards per treatment\ncumhaz_treat <- basehaz(coxmod_f29, centered = FALSE)\ncumhaz_treat <- as.data.frame(cumhaz_treat)\n\n# Per treatment\nhazard_t0 <- cumhaz_treat[cumhaz_treat$strata == \"tment=0\",]\nhazard_t0[1,] <- c(0, 0, \"tment=0\")\nhazard_t0$time<- as.numeric(hazard_t0$time)\nhazard_t0$hazard <- as.numeric(hazard_t0$hazard)\nhazard_t1 <- cumhaz_treat[cumhaz_treat$strata == \"tment=1\",]\n\n# Match times\nalltimes <- sort(unique(cumhaz_treat$time))\n\nhazard_t0_allt <- as.numeric(sapply(1:length(alltimes), function(k) tail(hazard_t0$hazard[hazard_t0$time <= alltimes[k]], 1)))\nhazard_t1_allt <- as.numeric(sapply(1:length(alltimes), function(k) tail(hazard_t1$hazard[hazard_t1$time <= alltimes[k]], 1))) \n\nhazards <- data.frame(hazard_t0_allt, \n                      hazard_t1_allt)\n\n# Extract coefficient\ncoxmod_f29_t <- coxph(Surv(days, status != 0) ~ tment + alb + log2bili,\n                      eps = 1e-8, method = \"breslow\",\n                      data = pbc3)\n\nsummary(coxmod_f29_t)\n\nCall:\ncoxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, \n    data = pbc3, method = \"breslow\", eps = 1e-08)\n\n  n= 343, number of events= 88 \n   (6 observations deleted due to missingness)\n\n             coef exp(coef) se(coef)      z Pr(>|z|)    \ntment    -0.57406   0.56323  0.22447 -2.557   0.0105 *  \nalb      -0.09093   0.91308  0.02164 -4.201 2.65e-05 ***\nlog2bili  0.66500   1.94449  0.07443  8.935  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\ntment       0.5632     1.7755    0.3628    0.8745\nalb         0.9131     1.0952    0.8752    0.9526\nlog2bili    1.9445     0.5143    1.6805    2.2499\n\nConcordance= 0.819  (se = 0.022 )\nLikelihood ratio test= 120  on 3 df,   p=<2e-16\nWald test            = 110.4  on 3 df,   p=<2e-16\nScore (logrank) test = 133.7  on 3 df,   p=<2e-16\n\n# Make plot\nfig2.10 <- ggplot(aes(x = hazard_t0_allt, y = hazard_t1_allt), data = hazards) + \n  geom_step(size = 1) + \n  geom_abline(intercept = 0, slope = exp(coef(coxmod_f29_t)[[\"tment\"]]), linetype = \"dashed\", size = 1) + \n  xlab(\"Cumulative baseline hazard: placebo\") +\n  ylab(\"Cumulative baseline hazard: CyA\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05))) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\nfig2.10\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.11 -------------------------------------#\n#------------------------------------------------------------------#\n\n# Additive Aalen models - available with timereg\nlibrary(timereg)\n\n# Fit model\nnonparmod <- aalen(Surv(days, status != 0) ~ tment, data = pbc3)\n\n\ncumhazdata <- data.frame(eventtimes = nonparmod$cum[,1],\n                         basecumhaz = nonparmod$cum[,2], \n                         cumhaztreat = nonparmod$cum[,3], \n                         cumhaztreat_ll = nonparmod$cum[,3]-1.96*sqrt(nonparmod$var.cum[,3]),\n                         cumhaztreat_ul = nonparmod$cum[,3]+1.96*sqrt(nonparmod$var.cum[,3])\n                         )\ncumhazdata\n\n   eventtimes  basecumhaz   cumhaztreat cumhaztreat_ll cumhaztreat_ul\n1      0.0000 0.000000000  0.000000e+00     0.00000000    0.000000000\n2     24.0000 0.005780347 -5.780347e-03    -0.01710983    0.005549133\n3     35.0000 0.005780347  3.360667e-05    -0.01603534    0.016102555\n4     98.0000 0.011628300 -5.814347e-03    -0.02555234    0.013923644\n5    107.0000 0.011628300  6.800639e-05    -0.02279059    0.022926606\n6    114.0000 0.017510653 -5.814347e-03    -0.03141597    0.019787273\n7    117.0000 0.023427813 -1.173151e-02    -0.03983752    0.016374508\n8    133.0000 0.029415837 -1.771953e-02    -0.04817760    0.012738541\n9    146.0000 0.029415837 -1.176715e-02    -0.04438318    0.020848877\n10   156.0000 0.029415837 -5.779125e-03    -0.04044252    0.028884274\n11   169.0000 0.035476443 -1.183973e-02    -0.04848201    0.024802551\n12   193.0000 0.041574004 -1.793729e-02    -0.05647933    0.020604743\n13   195.0000 0.041574004 -1.187669e-02    -0.05220774    0.028454370\n14   199.0000 0.047746843 -1.804953e-02    -0.06015623    0.024057175\n15   213.0000 0.053996843 -2.429953e-02    -0.06815197    0.019552917\n16   221.0000 0.053996843 -1.820196e-02    -0.06365379    0.027249860\n17   235.0000 0.053996843 -1.206700e-02    -0.05908250    0.034948512\n18   249.0000 0.060286151 -1.835630e-02    -0.06696097    0.030248366\n19   254.0000 0.066615265 -2.468542e-02    -0.07484815    0.025477313\n20   261.0000 0.072984692 -3.105484e-02    -0.08274770    0.020638015\n21   264.0000 0.072984692 -2.476554e-02    -0.07790787    0.028376799\n22   280.0000 0.072984692 -1.843642e-02    -0.07300742    0.036134571\n23   286.0000 0.072984692 -1.206700e-02    -0.06804776    0.043913765\n24   339.0000 0.079520640 -1.860294e-02    -0.07603075    0.038824866\n25   347.0000 0.079520640 -1.210944e-02    -0.07093066    0.046711791\n26   351.0000 0.086099587 -1.868838e-02    -0.07890641    0.041529645\n27   362.0000 0.086099587 -1.206587e-02    -0.07366696    0.049535227\n28   366.0000 0.092948902 -1.891518e-02    -0.08196212    0.044131755\n29   367.0000 0.092948902 -1.215843e-02    -0.07658125    0.052264395\n30   368.0000 0.099845454 -1.905498e-02    -0.08488062    0.046770668\n31   371.0000 0.106789898 -2.599942e-02    -0.09321756    0.041218715\n32   378.0000 0.106789898 -1.919670e-02    -0.08772447    0.049331072\n33   379.0000 0.113782905 -2.618971e-02    -0.09607474    0.043695328\n34   396.0000 0.120977150 -3.338395e-02    -0.10467735    0.037909445\n35   413.0000 0.128223527 -4.063033e-02    -0.11332470    0.032064037\n36   425.0000 0.135522797 -4.792960e-02    -0.12201839    0.026159190\n37   429.0000 0.142875738 -5.528254e-02    -0.13076001    0.020194924\n38   430.0000 0.150283145 -6.268995e-02    -0.13955109    0.014171194\n39   461.0000 0.150283145 -5.554709e-02    -0.13367286    0.022578674\n40   472.0000 0.150283145 -4.830071e-02    -0.12770699    0.031105567\n41   487.0000 0.157916733 -5.593430e-02    -0.13673785    0.024869249\n42   489.0000 0.165609041 -6.362661e-02    -0.14582471    0.018571489\n43   562.0000 0.165609041 -5.616392e-02    -0.13965328    0.027325434\n44   592.0000 0.173805762 -6.436064e-02    -0.14938167    0.020660384\n45   612.0000 0.173805762 -5.654814e-02    -0.14293708    0.029840790\n46   625.0000 0.173805762 -4.867413e-02    -0.13643077    0.039082510\n47   639.0000 0.173805762 -4.067413e-02    -0.12982058    0.048472324\n48   639.4515 0.173805762 -3.260961e-02    -0.12314653    0.057927308\n49   669.0000 0.173805762 -2.420625e-02    -0.11622915    0.067816650\n50   679.0000 0.173805762 -1.565924e-02    -0.10919452    0.077876036\n51   691.0000 0.173805762 -6.887313e-03    -0.10198961    0.088214985\n52   714.0000 0.183065022 -1.614657e-02    -0.11296497    0.080671826\n53   743.0000 0.183065022 -7.137563e-03    -0.10555298    0.091277858\n54   766.0000 0.183065022  2.477822e-03    -0.09772583    0.102681477\n55   786.0000 0.192868943 -7.326100e-03    -0.10935558    0.094703382\n56   791.0000 0.202868943 -1.732610e-02    -0.12122112    0.086568920\n57   821.0000 0.213621631 -2.807879e-02    -0.13408984    0.077932259\n58   865.0000 0.224491196 -3.894835e-02    -0.14707891    0.069182204\n59   916.0000 0.224491196 -2.795934e-02    -0.13821415    0.082295466\n60   928.0000 0.235985449 -3.945360e-02    -0.15198655    0.073079363\n61   931.0000 0.235985449 -2.808996e-02    -0.14280587    0.086625956\n62   945.0000 0.247750155 -3.985466e-02    -0.15686514    0.077155807\n63   962.0000 0.247750155 -2.780647e-02    -0.14717604    0.091563093\n64   978.0000 0.247750155 -1.530647e-02    -0.13716435    0.106551409\n65   985.0000 0.260250155 -2.780647e-02    -0.15210286    0.096489920\n66   995.0000 0.272908383 -4.046470e-02    -0.16721301    0.086283615\n67  1043.0000 0.272908383 -2.747769e-02    -0.15675672    0.101801350\n68  1046.0000 0.286066278 -4.063558e-02    -0.17246185    0.091190691\n69  1066.0000 0.286066278 -2.712207e-02    -0.16158284    0.107338708\n70  1105.0000 0.299764908 -4.082070e-02    -0.17793593    0.096294531\n71  1127.0000 0.314257662 -5.531345e-02    -0.19534015    0.084713243\n72  1134.0000 0.314257662 -4.082070e-02    -0.18369954    0.102058148\n73  1166.0000 0.314257662 -2.519570e-02    -0.17131981    0.120928411\n74  1168.0000 0.314257662 -9.322682e-03    -0.15872200    0.140076636\n75  1169.0000 0.314257662  6.806350e-03    -0.14590099    0.159513691\n76  1171.0000 0.314257662  2.319979e-02    -0.13285130    0.179250883\n77  1198.0000 0.330651104  6.806350e-03    -0.15251833    0.166131029\n78  1238.0000 0.330651104  2.435021e-02    -0.13864288    0.187343301\n79  1249.0000 0.330651104  4.253203e-02    -0.12431131    0.209375363\n80  1265.0000 0.350651104  2.253203e-02    -0.14885449    0.193918545\n81  1290.0000 0.350651104  4.427116e-02    -0.13233246    0.220874780\n82  1324.0000 0.375651104  1.927116e-02    -0.16400415    0.202546468\n83  1325.0000 0.401292130 -6.369867e-03    -0.19641077    0.183671039\n84  1325.0038 0.427607919 -3.268566e-02    -0.22960171    0.164230401\n85  1391.0000 0.427607919 -5.658630e-03    -0.20957545    0.198258191\n86  1423.0000 0.457910950 -3.596166e-02    -0.24835213    0.176428805\n87  1433.0000 0.457910950 -6.549895e-03    -0.22662464    0.213524849\n88  1547.0000 0.457910950  3.511677e-02    -0.19962210    0.269855642\n89  1647.0000 0.507910950 -1.488323e-02    -0.26925763    0.239491176\n90  1703.0000 0.507910950  5.654534e-02    -0.23381019    0.346900879\n91  1859.0000 0.650768092 -8.631180e-02    -0.48968054    0.317056936\n\n# Extend lines to last observed time\ncumhazdata[nrow(cumhazdata)+1,] <- c(max(pbc3$days), tail(cumhazdata, 1)[-1])\n\n\n\n# Figure LHS\ncumhazplot1 <- ggplot(aes(x = eventtimes / 365.25, y = basecumhaz), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative baseline hazard\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot1\n\n\n\n# Figure RHS\ncumhazplot2 <- ggplot(aes(x = eventtimes / 365.25, y = cumhaztreat), data = cumhazdata) + \n  geom_step(size = 1) + \n  geom_step(size = 1, aes(x = eventtimes / 365.25, y = cumhaztreat_ll), linetype = \"dashed\") +  \n  geom_step(size = 1, aes(x = eventtimes / 365.25, y = cumhaztreat_ul), linetype = \"dashed\") +\n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative treatment effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot2\n\n\n\n#------------------------------------------------------------------#\n#---------------- Figure 2.12 -------------------------------------#\n#------------------------------------------------------------------#\n\n# Make Aalen model fit\nnonparmod2 <- aalen(Surv(days, status != 0) ~ tment + alb + bili, data = pbc3) \ncumhazdata <- data.frame(eventtimes = nonparmod2$cum[,1],\n                         basecumhaz = nonparmod2$cum[,2], \n                         cumhaztreat = nonparmod2$cum[,3], \n                         cumhazalb = nonparmod2$cum[,4], \n                         cumhazbili= nonparmod2$cum[,5]\n)\n# Extend lines to last observed time\ncumhazdata[nrow(cumhazdata)+1,] <- c(max(pbc3$days), tail(cumhazdata, 1)[-1])\n\n# Figure treatment\ncumhazplot1 <- ggplot(aes(x = eventtimes / 365.25, y = cumhaztreat), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative treatment effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot1\n\n\n\n# Figure albumin\ncumhazplot2 <- ggplot(aes(x = eventtimes / 365.25, y = cumhazalb), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative albumin effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)), \n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot2\n\n\n\n# Figure bilirubin\ncumhazplot3 <- ggplot(aes(x = eventtimes / 365.25, y = cumhazbili), data = cumhazdata) + \n  geom_step(size = 1) + \n  xlab(\"Time since randomization (years)\") +\n  ylab(\"Cumulative bilirubin effect\") + \n  scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)),\n                     limits = c(0, 6),\n                     breaks = seq(0, 6, 1)) + \n  scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +\n  theme_general\n\ncumhazplot3\n\n\n\n#------------------------------------------------------------------#\n#---------------- Table 2.10 --------------------------------------#\n#------------------------------------------------------------------#\n\n# -- Only treatment -- #\n# In text p-values prior to Table 2.10\nnonparmod0 <- aalen(Surv(days, status != 0) ~ tment, data = pbc3) \nsummary(nonparmod0)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          5.96               0.000\ntment                                1.60               0.738\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.107                       0.573\ntment                               0.136                       0.639\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          7.62                       0.417\ntment                                4.54                       0.733\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)\n\n# Hypothesis of a time-constant hazard difference for treatment\n\n# Constant effect of treatment\nnonparmod01 <- aalen(Surv(days, status != 0) ~ const(tment), data = pbc3) \nsummary(nonparmod01)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          6.62                   0\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                        0.0914                       0.407\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          4.97                       0.299\n\nParametric terms :     \n                 Coef.       SE Robust SE     z P-val lower2.5% upper97.5%\nconst(tment) -1.61e-05 5.75e-05  5.74e-05 -0.28 0.779 -0.000129   9.66e-05\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment), data = pbc3)\n\n# -- Treatment, albumin, bilirubin -- #\n# Table 2.10, first two columns\nnonparmod1 <- aalen(Surv(days, status != 0) ~ tment + alb + bili, data = pbc3) \nsummary(nonparmod1)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.62               0.015\ntment                                2.66               0.135\nalb                                  3.82               0.012\nbili                                 4.83               0.000\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                       0.30300                       0.914\ntment                             0.12100                       0.684\nalb                               0.00666                       0.959\nbili                              0.00301                       0.219\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                      14.20000                       0.993\ntment                             3.29000                       0.806\nalb                               0.00826                       0.994\nbili                              0.00203                       0.361\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment + alb + bili, \n    data = pbc3)\n\n# Table 2.10, last columns\nnonparmod2 <- aalen(Surv(days, status != 0) ~ const(tment) + const(alb) + const(bili), data = pbc3) \nsummary(nonparmod2)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          4.03               0.001\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.119                       0.156\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                           9.6                       0.099\n\nParametric terms :     \n                 Coef.       SE Robust SE     z    P-val lower2.5% upper97.5%\nconst(tment) -1.13e-04 5.90e-05  5.51e-05 -2.05 4.01e-02 -2.29e-04   2.64e-06\nconst(alb)   -2.30e-05 6.28e-06  6.11e-06 -3.77 1.63e-04 -3.53e-05  -1.07e-05\nconst(bili)   6.30e-06 1.32e-06  1.05e-06  5.98 2.17e-09  3.71e-06   8.89e-06\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + \n    const(bili), data = pbc3)\n\n# In-text\nnonparmod3 <- aalen(Surv(days, status != 0) ~ const(tment) + alb + bili, data = pbc3) \nsummary(nonparmod3)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.60               0.011\nalb                                  3.80               0.006\nbili                                 4.83               0.000\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                       0.28500                       0.946\nalb                               0.00954                       0.801\nbili                              0.00315                       0.160\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                      11.50000                       0.993\nalb                               0.01920                       0.883\nbili                              0.00238                       0.300\n\nParametric terms :     \n                Coef.       SE Robust SE     z P-val lower2.5% upper97.5%\nconst(tment) -0.00011 5.92e-05  5.58e-05 -1.97 0.049 -0.000226   6.03e-06\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + alb + \n    bili, data = pbc3)\n\n# -- Quadratic effects -- #\nnonparmod41 <- aalen(Surv(days, status != 0) ~ tment + I(alb/10) + I(bili/100) + I((bili/100)^2), data = pbc3) \nsummary(nonparmod41)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n                Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                              3.94               0.001\ntment                                    2.59               0.144\nI(alb/10)                                4.04               0.000\nI(bili/100)                              3.82               0.004\nI((bili/100)^2)                          3.02               0.056\n\nTest for time invariant effects \n                      Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                            0.3080                       0.926\ntment                                  0.1230                       0.662\nI(alb/10)                              0.0912                       0.833\nI(bili/100)                            0.6370                       0.469\nI((bili/100)^2)                        0.5160                       0.193\n                        Cramer von Mises test p-value H_0:constant effect\n(Intercept)                             24.00                       0.948\ntment                                    3.94                       0.758\nI(alb/10)                                2.38                       0.842\nI(bili/100)                            188.00                       0.356\nI((bili/100)^2)                        101.00                       0.208\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment + I(alb/10) + \n    I(bili/100) + I((bili/100)^2), data = pbc3)\n\nnonparmod42 <- aalen(Surv(days, status != 0) ~ tment + I(alb/10) + I(bili/100) + I((alb/10)^2), data = pbc3) \nsummary(nonparmod42)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n              Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                            3.25               0.015\ntment                                  2.74               0.091\nI(alb/10)                              3.02               0.041\nI(bili/100)                            4.86               0.000\nI((alb/10)^2)                          2.79               0.069\n\nTest for time invariant effects \n                    Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                           9.260                       0.217\ntment                                 0.096                       0.813\nI(alb/10)                             4.880                       0.222\nI(bili/100)                           0.371                       0.051\nI((alb/10)^2)                         0.626                       0.224\n                      Cramer von Mises test p-value H_0:constant effect\n(Intercept)                        28500.00                       0.315\ntment                                  1.78                       0.920\nI(alb/10)                           8370.00                       0.309\nI(bili/100)                           32.00                       0.161\nI((alb/10)^2)                        144.00                       0.305\n\n   \n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ tment + I(alb/10) + \n    I(bili/100) + I((alb/10)^2), data = pbc3)\n\nnonparmod43 <- aalen(Surv(days, status != 0) ~ const(tment) + I(alb/10) + I(bili/100) + I((bili/100)^2), data = pbc3) \nsummary(nonparmod43)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n                Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                              3.82               0.005\nI(alb/10)                                4.02               0.002\nI(bili/100)                              3.85               0.005\nI((bili/100)^2)                          3.01               0.055\n\nTest for time invariant effects \n                      Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                             0.440                       0.685\nI(alb/10)                               0.117                       0.626\nI(bili/100)                             0.612                       0.455\nI((bili/100)^2)                         0.515                       0.170\n                        Cramer von Mises test p-value H_0:constant effect\n(Intercept)                             48.20                       0.768\nI(alb/10)                                4.51                       0.628\nI(bili/100)                            169.00                       0.343\nI((bili/100)^2)                        105.00                       0.182\n\nParametric terms :     \n                 Coef.       SE Robust SE     z  P-val lower2.5% upper97.5%\nconst(tment) -0.000108 5.83e-05   5.7e-05 -1.89 0.0582 -0.000222   6.27e-06\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + I(alb/10) + \n    I(bili/100) + I((bili/100)^2), data = pbc3)\n\nnonparmod44 <- aalen(Surv(days, status != 0) ~ const(tment) + I(alb/10) + I(bili/100) + I((alb/10)^2), data = pbc3) \nsummary(nonparmod44)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n              Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                            3.23               0.025\nI(alb/10)                              3.00               0.048\nI(bili/100)                            4.88               0.000\nI((alb/10)^2)                          2.77               0.090\n\nTest for time invariant effects \n                    Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                           9.420                       0.232\nI(alb/10)                             4.950                       0.232\nI(bili/100)                           0.366                       0.079\nI((alb/10)^2)                         0.635                       0.239\n                      Cramer von Mises test p-value H_0:constant effect\n(Intercept)                         30500.0                       0.350\nI(alb/10)                            8910.0                       0.341\nI(bili/100)                            34.6                       0.191\nI((alb/10)^2)                         152.0                       0.338\n\nParametric terms :     \n                 Coef.       SE Robust SE     z  P-val lower2.5% upper97.5%\nconst(tment) -0.000115 5.89e-05  5.51e-05 -2.09 0.0366  -0.00023   4.42e-07\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + I(alb/10) + \n    I(bili/100) + I((alb/10)^2), data = pbc3)\n\n# -- Interactions -- #\nnonparmod51 <- aalen(Surv(days, status != 0) ~ const(tment) + const(alb) + const(bili) + const(tment * bili), data = pbc3) \nsummary(nonparmod51)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          4.03                   0\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                         0.123                       0.172\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          10.5                         0.1\n\nParametric terms :     \n                        Coef.       SE Robust SE       z    P-val lower2.5%\nconst(tment)        -5.30e-06 8.06e-05  6.23e-05 -0.0851 9.32e-01 -1.63e-04\nconst(alb)          -2.35e-05 6.20e-06  6.04e-06 -3.9000 9.69e-05 -3.57e-05\nconst(bili)          8.18e-06 2.38e-06  1.20e-06  6.8400 7.77e-12  3.52e-06\nconst(tment * bili) -3.16e-06 2.79e-06  1.80e-06 -1.7600 7.92e-02 -8.63e-06\n                    upper97.5%\nconst(tment)          1.53e-04\nconst(alb)           -1.13e-05\nconst(bili)           1.28e-05\nconst(tment * bili)   2.31e-06\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + \n    const(bili) + const(tment * bili), data = pbc3)\n\nnonparmod52 <- aalen(Surv(days, status != 0) ~ const(tment) + const(alb) + const(bili) + const(tment * alb), data = pbc3) \nsummary(nonparmod52)\n\nAdditive Aalen Model \n\nTest for nonparametric terms \n\nTest for non-significant effects \n            Supremum-test of significance p-value H_0: B(t)=0\n(Intercept)                          3.06               0.008\n\nTest for time invariant effects \n                  Kolmogorov-Smirnov test p-value H_0:constant effect\n(Intercept)                          0.12                       0.184\n                    Cramer von Mises test p-value H_0:constant effect\n(Intercept)                          9.68                       0.105\n\nParametric terms :     \n                       Coef.       SE Robust SE       z    P-val lower2.5%\nconst(tment)        2.77e-05 5.45e-04  4.81e-04  0.0576 9.54e-01 -1.04e-03\nconst(alb)         -2.11e-05 8.63e-06  7.61e-06 -2.7700 5.54e-03 -3.80e-05\nconst(bili)         6.29e-06 1.32e-06  1.05e-06  5.9600 2.45e-09  3.70e-06\nconst(tment * alb) -3.60e-06 1.31e-05  1.18e-05 -0.3060 7.59e-01 -2.93e-05\n                   upper97.5%\nconst(tment)         1.10e-03\nconst(alb)          -4.19e-06\nconst(bili)          8.88e-06\nconst(tment * alb)   2.21e-05\n   \n  Call: \naalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + \n    const(bili) + const(tment * alb), data = pbc3)\n\n#------------------------------------------------------------------#\n#---------------- Table 2.11 --------------------------------------#\n#------------------------------------------------------------------#\n\n\n# -- In-text -- #\n\n# Additive hazards model with piecewise constant baseline hazards\n# Model with only treatment as covariate\n\nhead(pbc3mult)\n\n  id unit status tment sex age  bili   alb stage tment_char albnorm alb10\n1  1    5      1     1   0  58 52.04 36.00     4        CyA    1.00 3.600\n2  1    5      1     1   0  58 52.04 36.00     4        CyA    1.00 3.600\n3  2    4      0     1   1  54 14.82 38.00     2        CyA    3.00 3.800\n4  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271\n5  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271\n6  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271\n      alb2 bilihigh bilitoohigh bilimuchtoohigh bili100      bili2 log2bili\n1 12.96000    34.94       17.84            0.74  0.5204 0.27081616 5.701549\n2 12.96000    34.94       17.84            0.74  0.5204 0.27081616 5.701549\n3 14.44000     0.00        0.00            0.00  0.1482 0.02196324 3.889474\n4 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355\n5 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355\n6 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355\n  logbilihigh logbilitoohigh logbilimuchtoohigh log2bili2 tstart   days fail\n1    1.605625      0.6056246         0.02066214 32.507662    0.0  730.5    0\n2    1.605625      0.6056246         0.02066214 32.507662  730.5 1168.0    1\n3    0.000000      0.0000000         0.00000000 15.128004    0.0  405.0    0\n4    0.000000      0.0000000         0.00000000  7.881242    0.0  730.5    0\n5    0.000000      0.0000000         0.00000000  7.881242  730.5 1461.0    0\n6    0.000000      0.0000000         0.00000000  7.881242 1461.0 1735.0    0\n  timegroup risktime\n1         1    730.5\n2         2    437.5\n3         1    405.0\n4         1    730.5\n5         2    730.5\n6         3    274.0\n\n# update data set\npbc3add <- pbc3mult\npbc3add$time1 <- with(pbc3add, (timegroup == 1)*risktime)\npbc3add$time2 <- with(pbc3add, (timegroup == 2)*risktime)\npbc3add$time3 <- with(pbc3add, (timegroup == 3)*risktime)\npbc3add$tment0 <- with(pbc3add, (tment == 0)*risktime)\npbc3add$tment1 <- with(pbc3add, (tment == 1)*risktime)\npbc3add$albny <- with(pbc3add, (alb-35)/100*risktime)\npbc3add$biliny <- with(pbc3add, (bili-50)/1000*risktime)\n\n\n# In-text\npiece_aalen1 <- glm(fail ~ time1 + time2 + time3 + tment1 - 1,\n                    data = pbc3add, start = c(0.1, 0.1, 0.1, 0),\n                    family = poisson(link = \"identity\"))\nsummary(piece_aalen1)\n\n\nCall:\nglm(formula = fail ~ time1 + time2 + time3 + tment1 - 1, family = poisson(link = \"identity\"), \n    data = pbc3add, start = c(0.1, 0.1, 0.1, 0))\n\nCoefficients:\n         Estimate Std. Error z value Pr(>|z|)    \ntime1   2.494e-04  4.498e-05   5.546 2.93e-08 ***\ntime2   3.607e-04  6.610e-05   5.456 4.87e-08 ***\ntime3   2.566e-04  1.264e-04   2.031   0.0423 *  \ntment1 -1.988e-05  5.683e-05  -0.350   0.7265    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance:    Inf  on 623  degrees of freedom\nResidual deviance: 459.54  on 619  degrees of freedom\nAIC: 647.54\n\nNumber of Fisher Scoring iterations: 4\n\n# Table 2.11 - questionable fit\npiece_aalen2 <- glm(fail ~ time1 + time2 + time3 + tment1 + albny + biliny -1,\n                    data = pbc3add, start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2),\n                    family = poisson(link = \"identity\"))\nsummary(piece_aalen2)\n\n\nCall:\nglm(formula = fail ~ time1 + time2 + time3 + tment1 + albny + \n    biliny - 1, family = poisson(link = \"identity\"), data = pbc3add, \n    start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2))\n\nCoefficients:\n         Estimate Std. Error z value Pr(>|z|)    \ntime1   7.925e-04  7.346e-05  10.788  < 2e-16 ***\ntime2   1.029e-03  8.866e-05  11.608  < 2e-16 ***\ntime3   9.910e-04  1.890e-04   5.244 1.57e-07 ***\ntment1 -1.023e-04  6.006e-05  -1.704   0.0883 .  \nalbny  -1.902e-03  4.274e-04  -4.451 8.56e-06 ***\nbiliny  9.328e-03  1.360e-03   6.860 6.89e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance:    Inf  on 611  degrees of freedom\nResidual deviance: 432.31  on 605  degrees of freedom\n  (12 observations deleted due to missingness)\nAIC: 620.31\n\nNumber of Fisher Scoring iterations: 25"
  },
  {
    "objectID": "Ch2.html#exercises",
    "href": "Ch2.html#exercises",
    "title": "2  Intuition for intensity models",
    "section": "Exercises",
    "text": "Exercises\n\nExercise 2.1"
  }
]