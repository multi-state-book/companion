<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models for Multi-State Survival Data - 6&nbsp; Pseudo-values</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch7.html" rel="next">
<link href="./Ch5.html" rel="prev">
<link href="./corvos.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./MSBfrontbirds.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/multi-state-book/companion" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./errata.html" class="sidebar-item-text sidebar-link">Errata</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pbc3-trial-in-liver-cirrhosis" id="toc-pbc3-trial-in-liver-cirrhosis" class="nav-link active" data-scroll-target="#pbc3-trial-in-liver-cirrhosis">PBC3 trial in liver cirrhosis</a>
  <ul>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">Read data</a></li>
  <li><a href="#figure-6.1" id="toc-figure-6.1" class="nav-link" data-scroll-target="#figure-6.1">Figure 6.1</a></li>
  <li><a href="#figure-6.2" id="toc-figure-6.2" class="nav-link" data-scroll-target="#figure-6.2">Figure 6.2</a>
  <ul>
  <li><a href="#a" id="toc-a" class="nav-link" data-scroll-target="#a">(a)</a></li>
  <li><a href="#b" id="toc-b" class="nav-link" data-scroll-target="#b">(b)</a></li>
  <li><a href="#c" id="toc-c" class="nav-link" data-scroll-target="#c">(c)</a></li>
  </ul></li>
  <li><a href="#figure-6.3" id="toc-figure-6.3" class="nav-link" data-scroll-target="#figure-6.3">Figure 6.3</a>
  <ul>
  <li><a href="#left" id="toc-left" class="nav-link" data-scroll-target="#left">Left</a></li>
  <li><a href="#right" id="toc-right" class="nav-link" data-scroll-target="#right">Right</a></li>
  </ul></li>
  <li><a href="#figure-6.4" id="toc-figure-6.4" class="nav-link" data-scroll-target="#figure-6.4">Figure 6.4</a>
  <ul>
  <li><a href="#left-1" id="toc-left-1" class="nav-link" data-scroll-target="#left-1">Left</a></li>
  <li><a href="#right-1" id="toc-right-1" class="nav-link" data-scroll-target="#right-1">Right</a></li>
  </ul></li>
  <li><a href="#table-6.1" id="toc-table-6.1" class="nav-link" data-scroll-target="#table-6.1">Table 6.1</a></li>
  <li><a href="#figure-6.5" id="toc-figure-6.5" class="nav-link" data-scroll-target="#figure-6.5">Figure 6.5</a></li>
  <li><a href="#table-6.2" id="toc-table-6.2" class="nav-link" data-scroll-target="#table-6.2">Table 6.2</a></li>
  <li><a href="#figure-6.6" id="toc-figure-6.6" class="nav-link" data-scroll-target="#figure-6.6">Figure 6.6</a>
  <ul>
  <li><a href="#left-2" id="toc-left-2" class="nav-link" data-scroll-target="#left-2">Left</a></li>
  <li><a href="#right-2" id="toc-right-2" class="nav-link" data-scroll-target="#right-2">Right</a></li>
  </ul></li>
  <li><a href="#figure-6.7" id="toc-figure-6.7" class="nav-link" data-scroll-target="#figure-6.7">Figure 6.7</a></li>
  <li><a href="#table-6.3" id="toc-table-6.3" class="nav-link" data-scroll-target="#table-6.3">Table 6.3</a></li>
  <li><a href="#figure-6.8" id="toc-figure-6.8" class="nav-link" data-scroll-target="#figure-6.8">Figure 6.8</a></li>
  <li><a href="#figure-6.9" id="toc-figure-6.9" class="nav-link" data-scroll-target="#figure-6.9">Figure 6.9</a></li>
  <li><a href="#table-6.6" id="toc-table-6.6" class="nav-link" data-scroll-target="#table-6.6">Table 6.6</a></li>
  <li><a href="#figure-6.11" id="toc-figure-6.11" class="nav-link" data-scroll-target="#figure-6.11">Figure 6.11</a>
  <ul>
  <li><a href="#left-3" id="toc-left-3" class="nav-link" data-scroll-target="#left-3">left</a></li>
  <li><a href="#right-3" id="toc-right-3" class="nav-link" data-scroll-target="#right-3">right</a></li>
  <li><a href="#left-4" id="toc-left-4" class="nav-link" data-scroll-target="#left-4">left</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#prova-trial-in-liver-cirrhosis" id="toc-prova-trial-in-liver-cirrhosis" class="nav-link" data-scroll-target="#prova-trial-in-liver-cirrhosis">PROVA trial in liver cirrhosis</a>
  <ul>
  <li><a href="#read-data-1" id="toc-read-data-1" class="nav-link" data-scroll-target="#read-data-1">Read data</a></li>
  <li><a href="#figure-6.10" id="toc-figure-6.10" class="nav-link" data-scroll-target="#figure-6.10">Figure 6.10</a></li>
  <li><a href="#table-6.7" id="toc-table-6.7" class="nav-link" data-scroll-target="#table-6.7">Table 6.7</a></li>
  </ul></li>
  <li><a href="#leader-cardiovascular-trial-in-type-2-diabetes" id="toc-leader-cardiovascular-trial-in-type-2-diabetes" class="nav-link" data-scroll-target="#leader-cardiovascular-trial-in-type-2-diabetes">LEADER cardiovascular trial in type 2 diabetes</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#exercise-6.1" id="toc-exercise-6.1" class="nav-link" data-scroll-target="#exercise-6.1">Exercise 6.1 (*)</a>
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">1.</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">2.</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">3.</a></li>
  </ul></li>
  <li><a href="#exercise-6.2" id="toc-exercise-6.2" class="nav-link" data-scroll-target="#exercise-6.2">Exercise 6.2 (*)</a>
  <ul>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3">1.</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4">2.</a></li>
  </ul></li>
  <li><a href="#exercise-6.3" id="toc-exercise-6.3" class="nav-link" data-scroll-target="#exercise-6.3">Exercise 6.3</a>
  <ul>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5">1.</a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6">2.</a></li>
  </ul></li>
  <li><a href="#exercise-6.4" id="toc-exercise-6.4" class="nav-link" data-scroll-target="#exercise-6.4">Exercise 6.4</a>
  <ul>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7">1.</a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8">2.</a></li>
  </ul></li>
  <li><a href="#exercise-6.5" id="toc-exercise-6.5" class="nav-link" data-scroll-target="#exercise-6.5">Exercise 6.5</a>
  <ul>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9">1.</a></li>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10">2.</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/multi-state-book/companion/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Show/hide all code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="pbc3-trial-in-liver-cirrhosis" class="level2">
<h2 class="anchored" data-anchor-id="pbc3-trial-in-liver-cirrhosis">PBC3 trial in liver cirrhosis</h2>
<section id="read-data" class="level3">
<h3 class="anchored" data-anchor-id="read-data">Read data</h3>
<div class="cell" data-hash="Ch6_cache/html/read-pbc3_32aa2d9e284e9b59e1e2d97ed8f8d2b3">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pbc3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/pbc3.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>fail <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">with</span>(pbc3, status <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fu">log2</span>(bili))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- # Load required packages (should be installed if not already) -->
<!-- library(haven) -->
<!-- library(survival) -->
<!-- library(timereg) -->
<!-- library(gridExtra) -->
<!-- library(mets) -->
<!-- library(cmprsk) -->
</section>
<section id="figure-6.1" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.1">Figure 6.1</h3>
<div class="cell" data-hash="Ch6_cache/html/figure-6.1_ffccea223464fc2c008e8ccea2fa55e5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General plotting style</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pseudo-observations of the survival function for subjects</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The subjects with ptno=415 and ptno=458 are selected</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pseudo)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>pseudo_allt <span class="ot">&lt;-</span> <span class="fu">pseudosurv</span>(pbc3<span class="sc">$</span>days, pbc3<span class="sc">$</span>fail)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-arrange the data into a long data set</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pseudo_allt<span class="sc">$</span>time)){</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">rbind</span>(b,<span class="fu">cbind</span>(pbc3,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pseudo =</span> pseudo_allt<span class="sc">$</span>pseudo[,it],</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tpseudo =</span> pseudo_allt<span class="sc">$</span>time[it],</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3)))</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> b[<span class="fu">order</span>(b<span class="sc">$</span>id),]</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>pseudo_alltid <span class="ot">&lt;-</span> b</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the two subjects </span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>subdat <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"305"</span>, <span class="st">"325"</span>))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> subdat<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> subdat<span class="sc">$</span>pseudo, </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id =</span> <span class="fu">as.factor</span>(subdat<span class="sc">$</span>id))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tpseudo, <span class="at">y =</span> pseudo, <span class="at">linetype =</span> id), </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Patient number"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"dotted"</span>)) <span class="sc">+</span> </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.1-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="figure-6.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.2">Figure 6.2</h3>
<section id="a" class="level4">
<h4 class="anchored" data-anchor-id="a">(a)</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.2a_80396e9c62dd635936abd6abe6cdfd5e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>theme_general_1 <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>), </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>)) </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the pseudo-observations at times </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">366</span>, <span class="dv">743</span>, <span class="dv">1105</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># At 1 year</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>pseudo_t1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">1</span>])</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t1<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t1<span class="sc">$</span>days,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t1<span class="sc">$</span>pseudo, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t1<span class="sc">$</span>fail))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days  <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> pseudo, <span class="at">shape =</span> failtype), </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Fail"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"X"</span>[i]<span class="sc">*</span><span class="st">" (years)"</span>)) <span class="sc">+</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.9</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  theme_general_1</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.2a-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="b" class="level4">
<h4 class="anchored" data-anchor-id="b">(b)</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.2b_0302da1354ae0ecd0dbbc2cf4054a782">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At 2 years</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pseudo_t2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">2</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t2<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t2<span class="sc">$</span>days,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t2<span class="sc">$</span>pseudo, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t2<span class="sc">$</span>fail))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> pseudo, <span class="at">shape =</span> failtype), </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Fail"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"X"</span>[i]<span class="sc">*</span><span class="st">" (years)"</span>)) <span class="sc">+</span>  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.9</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  theme_general_1</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.2b-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="c" class="level4">
<h4 class="anchored" data-anchor-id="c">(c)</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.2c_d1dd5d5c44a83642c701f5e90278d59b">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At 3 years</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pseudo_t3 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">3</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t3<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t3<span class="sc">$</span>days,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t3<span class="sc">$</span>pseudo, </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t3<span class="sc">$</span>fail))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span>c <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days<span class="sc">/</span><span class="fl">365.25</span>, <span class="at">y =</span> pseudo, <span class="at">shape =</span> failtype), </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Fail"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"X"</span>[i]<span class="sc">*</span><span class="st">" (years)"</span>)) <span class="sc">+</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.9</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  theme_general_1 <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span>c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.2c-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
</section>
<section id="figure-6.3" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.3">Figure 6.3</h3>
<section id="left" class="level4">
<h4 class="anchored" data-anchor-id="left">Left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.3left_6136ea6cdb26e3d901ce004019cda355">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t2<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t2<span class="sc">$</span>days,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t2<span class="sc">$</span>pseudo, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">log2bili =</span>  pseudo_t2<span class="sc">$</span>log2bili, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bili =</span> pseudo_t2<span class="sc">$</span>bili,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">alb =</span> pseudo_t2<span class="sc">$</span>alb,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tment =</span> pseudo_t2<span class="sc">$</span>tment,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id =</span> pseudo_t2<span class="sc">$</span>id,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t2<span class="sc">$</span>fail))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>bili_loess <span class="ot">&lt;-</span> <span class="fu">loess</span>(pseudo <span class="sc">~</span> bili, <span class="at">data =</span> pseudodata, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>loesspred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_loess)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>t_loesspred <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  pseudodata, <span class="fu">ifelse</span>(loesspred <span class="sc">&gt;</span> <span class="dv">0</span> , <span class="fu">log</span>(<span class="sc">-</span><span class="fu">log</span>(loesspred)), <span class="cn">NA</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.3</span>left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> pseudo), <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> loesspred), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span>  </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="at">by =</span> <span class="fl">0.2</span>), </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">1.2</span>)) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.3</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.3left-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="right" class="level4">
<h4 class="anchored" data-anchor-id="right">Right</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.3right_8b7454b0063c24296ff0c048ac4eca07">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.3</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> t_loesspred), <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"log(-log(predicted pseudo-values))"</span>) <span class="sc">+</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="dv">1</span>), </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.3</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.3right-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</section>
<section id="figure-6.4" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.4">Figure 6.4</h3>
<section id="left-1" class="level4">
<h4 class="anchored" data-anchor-id="left-1">Left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.4left_ae236bff22f56c23825a3992c96cf86c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loess for log2 bili</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>log2bili_loess <span class="ot">&lt;-</span> <span class="fu">loess</span>(pseudo <span class="sc">~</span> log2bili, <span class="at">data =</span> pseudodata, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>log2bili_loesspred <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_loess)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>t_log2bili_loesspred <span class="ot">&lt;-</span> <span class="fu">with</span>(pseudodata,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(log2bili_loesspred <span class="sc">&gt;</span> <span class="dv">0</span> , <span class="fu">log</span>(<span class="sc">-</span><span class="fu">log</span>(log2bili_loesspred)), <span class="cn">NA</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.4</span>left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> pseudo), <span class="at">data =</span> pseudodata) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> log2bili_loesspred), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"log"</span> [<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">1.2</span>)) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.4</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.4left-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="right-1" class="level4">
<h4 class="anchored" data-anchor-id="right-1">Right</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.4right_9903e359f5cffec493b7f442372771be">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.4</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> t_log2bili_loesspred), <span class="at">data =</span> pseudodata) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"log"</span> [<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"log(-log(predicted pseudo-values))"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.4</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.4right-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</section>
<section id="table-6.1" class="level3">
<h3 class="anchored" data-anchor-id="table-6.1">Table 6.1</h3>
<p>TODO: SDs for the three time points model are not as in table in Book</p>
<div class="cell" data-hash="Ch6_cache/html/table-6.1_f61e157415056e79f55ca36076cd0437">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>posumm<span class="ot">&lt;-</span><span class="cf">function</span>(pofit,<span class="at">d=</span><span class="dv">6</span>){ </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">cbind</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Est =</span> pofit<span class="sc">$</span>beta, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta)), </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lo.ci =</span> pofit<span class="sc">$</span>beta<span class="fl">-1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta)), </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">up.ci =</span> pofit<span class="sc">$</span>beta<span class="fl">+1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta)), </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Wald =</span> (pofit<span class="sc">$</span>beta<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta)))<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">PVal =</span> <span class="dv">2-2</span><span class="sc">*</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(pofit<span class="sc">$</span>beta<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta))))),d) </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>posummExp<span class="ot">&lt;-</span><span class="cf">function</span>(pofit,<span class="at">d=</span><span class="dv">6</span>){</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">cbind</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">est =</span> pofit<span class="sc">$</span>beta, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta)), </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.est =</span> <span class="fu">exp</span>(pofit<span class="sc">$</span>beta), </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.lo.ci =</span> <span class="fu">exp</span>(pofit<span class="sc">$</span>beta<span class="fl">-1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta))), </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.up.ci =</span> <span class="fu">exp</span>(pofit<span class="sc">$</span>beta<span class="fl">+1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta))), </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">PVal =</span> <span class="dv">2-2</span><span class="sc">*</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(pofit<span class="sc">$</span>beta<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta))))),d) </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># At time year 2</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo) <span class="sc">~</span> tment <span class="sc">+</span>alb <span class="sc">+</span> log2bili,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">id =</span> id,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="fu">posummExp</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  est       SD  exp.est exp.lo.ci exp.up.ci     PVal
(Intercept) -2.116642 1.326984 0.120435  0.008937  1.622951 0.110695
tment       -0.705053 0.369341 0.494082  0.239557  1.019035 0.056269
alb         -0.105069 0.034169 0.900263  0.841946  0.962618 0.002105
log2bili     0.835723 0.140429 2.306480  1.751517  3.037282 0.000000</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At time year c(1, 2, 3)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the pseudo-observations at times</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">366</span>, <span class="dv">743</span>, <span class="dv">1105</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>pseudo_t1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">1</span>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>pseudo_t2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">2</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>pseudo_t3 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">3</span>])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>pseudo_t <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pseudo_t1, pseudo_t2, pseudo_t3)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>pseudodata_t <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t<span class="sc">$</span>days,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t<span class="sc">$</span>pseudo,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">log2bili =</span>  pseudo_t<span class="sc">$</span>log2bili,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bili =</span> pseudo_t<span class="sc">$</span>bili,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">alb =</span> pseudo_t<span class="sc">$</span>alb,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tment =</span> pseudo_t<span class="sc">$</span>tment,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id =</span> pseudo_t<span class="sc">$</span>id,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t<span class="sc">$</span>fail))</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># At time year c(1, 2, 3)</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">as.factor</span>(tpseudo) <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">id =</span> id,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean.link =</span> <span class="st">"cloglog"</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">corstr=</span><span class="st">"independence"</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="fu">posummExp</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                         est       SD  exp.est exp.lo.ci
tment                              -0.598536 0.213046 0.549616  0.362002
alb                                -0.093907 0.019069 0.910367  0.876970
log2bili                            0.684093 0.071818 1.981972  1.721729
as.factor(tpseudo)1.00205338809035 -2.474620 0.829782 0.084195  0.016556
as.factor(tpseudo)2.03422313483915 -1.554010 0.810703 0.211399  0.043154
as.factor(tpseudo)3.02532511978097 -1.123233 0.813730 0.325227  0.065997
                                   exp.up.ci     PVal
tment                               0.834464 0.004963
alb                                 0.945036 0.000001
log2bili                            2.281552 0.000000
as.factor(tpseudo)1.00205338809035  0.428165 0.002861
as.factor(tpseudo)2.03422313483915  1.035587 0.055255
as.factor(tpseudo)3.02532511978097  1.602682 0.167479</code></pre>
</div>
</div>
</section>
<section id="figure-6.5" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.5">Figure 6.5</h3>
<div class="cell" data-hash="Ch6_cache/html/figure-6.5_9d96d28a4bdf09da5a5fa76587a7e094">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At time year c(1, 2, 3) </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo) <span class="sc">~</span> <span class="fu">as.factor</span>(tpseudo) <span class="sc">+</span> log2bili <span class="sc">+</span> alb <span class="sc">+</span> tment <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, <span class="sc">!</span><span class="fu">is.na</span>(alb)), </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">id =</span> id, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean.link =</span> <span class="st">"cloglog"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">variance =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale.value =</span> <span class="dv">0</span>, </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale.fix =</span> <span class="dv">1</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(pseudodata_t))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 1</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">1</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span> </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">1</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        fit2<span class="sc">$</span>beta[<span class="dv">1</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>log2bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 2</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">2</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span> </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">2</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">2</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>log2bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 3</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">3</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">3</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">3</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>log2bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform back</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">with</span>(pseudodata_t, pseudo <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">exp</span>(pred)))</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">*</span> <span class="fl">365.25</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Make loess smooth per time</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>log2bili_res_loess_1 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> log2bili, </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">366</span>), <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>log2bili_res_loess_2 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> log2bili, </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">743</span>), <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>log2bili_res_loess_3 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> log2bili, </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">1105</span>), <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>log2bili_res_pred_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_res_loess_1, <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">366</span>))</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>log2bili_res_pred_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_res_loess_2, <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">743</span>))</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>log2bili_res_pred_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_res_loess_3, <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">1105</span>))</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>log2bili_res_pred <span class="ot">&lt;-</span> <span class="fu">c</span>(log2bili_res_pred_1, log2bili_res_pred_2, log2bili_res_pred_3)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> res, <span class="at">shape =</span> time), <span class="at">data =</span> pseudodata_t) <span class="sc">+</span> </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> log2bili_res_pred , <span class="at">linetype =</span> time), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Year"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">0</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Year"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"solid"</span>, <span class="st">"dotted"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"log"</span> [<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span>  </span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-residuals"</span>) <span class="sc">+</span> </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>), </span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>), </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span> </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.box =</span> <span class="st">"vertical"</span>,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>), </span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">'cm'</span>),</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.5-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="table-6.2" class="level3">
<h3 class="anchored" data-anchor-id="table-6.2">Table 6.2</h3>
<div class="cell" data-hash="Ch6_cache/html/table-6.2_d25c1914c28f3c88790e9f3037cb204e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At time year c(1, 2, 3) using log-link instead</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> pseudo <span class="sc">~</span> <span class="fu">as.factor</span>(tpseudo) <span class="sc">+</span> bili <span class="sc">+</span> alb <span class="sc">+</span> tment <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">id =</span> id,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean.link =</span> <span class="st">"log"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">variance =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale.value =</span> <span class="dv">0</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale.fix =</span> <span class="dv">1</span>, <span class="at">maxit =</span> <span class="dv">50</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo ~ as.factor(tpseudo) + bili + alb + tment - 
    1, id = id, data = subset(pseudodata_t, !is.na(alb)), mean.link = "log", 
    variance = "gaussian", scale.fix = 1, scale.value = 0, maxit = 50)

Mean Model:
 Mean Link:                 log 
 Variance to Mean Relation: gaussian 

 Coefficients:
                                       estimate       san.se      wald
as.factor(tpseudo)1.00205338809035 -0.340268943 0.1038790249 10.729733
as.factor(tpseudo)2.03422313483915 -0.412025685 0.1063019966 15.023314
as.factor(tpseudo)3.02532511978097 -0.507547919 0.1089067608 21.719230
bili                               -0.004191576 0.0005629232 55.444219
alb                                 0.009689574 0.0023542035 16.940310
tment                               0.048389674 0.0227323690  4.531229
                                              p
as.factor(tpseudo)1.00205338809035 1.054277e-03
as.factor(tpseudo)2.03422313483915 1.061912e-04
as.factor(tpseudo)3.02532511978097 3.156116e-06
bili                               9.614531e-14
alb                                3.857371e-05
tment                              3.328171e-02

Scale is fixed.

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   1029   Maximum cluster size: 1 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## - log scale used as link in Table 6.2 (add "-" in front of all estimates)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># No default "-log(x)" link function in R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure-6.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.6">Figure 6.6</h3>
<section id="left-2" class="level4">
<h4 class="anchored" data-anchor-id="left-2">Left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.6left_9b16ea7e750bd981cf22878ab8c98b8b">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 6.6 (a) - done earlier</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.6</span>left <span class="ot">&lt;-</span> fig6<span class="fl">.3</span>left</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.6</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.6left-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="right-2" class="level4">
<h4 class="anchored" data-anchor-id="right-2">Right</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.6right_ce7f3b0592b0a3ce7291e47c9d7aa942">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same as earlier:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>bili_loess <span class="ot">&lt;-</span> <span class="fu">loess</span>(pseudo <span class="sc">~</span> bili, <span class="at">data =</span> pseudodata, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>loesspred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_loess)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use log-trans instead of cloglog</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>log_loesspred <span class="ot">&lt;-</span> <span class="fu">with</span>(pseudodata,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(loesspred <span class="sc">&gt;</span> <span class="dv">0</span> , <span class="sc">-</span><span class="fu">log</span>(loesspred), <span class="cn">NA</span>))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.6</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> log_loesspred), <span class="at">data =</span> pseudodata) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"-log(predicted pseudo-values)"</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.6</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.6right-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</section>
<section id="figure-6.7" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.7">Figure 6.7</h3>
<div class="cell" data-hash="Ch6_cache/html/figure-6.7_76261a9e735839ce3f3999094107f848">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use regression estimates from fit2</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(pseudodata_t))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 1</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">1</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">1</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">1</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 2</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">2</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">2</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">2</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 3</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">3</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">3</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">3</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform back</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">with</span>(pseudodata_t, pseudo <span class="sc">-</span> <span class="fu">exp</span>(pred))</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">*</span> <span class="fl">365.25</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Make loess smooth per time</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>bili_res_loess_1 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> bili,</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">366</span>), </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>                          <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>bili_res_loess_2 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> bili,</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">743</span>), </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>bili_res_loess_3 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> bili,</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">1105</span>), </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>                          <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>bili_res_pred_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_res_loess_1, </span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">366</span>))</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>bili_res_pred_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_res_loess_2, </span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">743</span>))</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>bili_res_pred_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_res_loess_3, </span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">1105</span>))</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>bili_res_pred <span class="ot">&lt;-</span> <span class="fu">c</span>(bili_res_pred_1, </span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>                                bili_res_pred_2, </span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>                                bili_res_pred_3)</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> res, <span class="at">shape =</span> time), <span class="at">data =</span> pseudodata_t) <span class="sc">+</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> bili_res_pred , <span class="at">linetype =</span> time), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Year"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">0</span>), </span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Year"</span>, </span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"solid"</span>, <span class="st">"dotted"</span>), </span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"Bilirubin"</span>)) <span class="sc">+</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-residuals"</span>) <span class="sc">+</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>),</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.box =</span> <span class="st">"vertical"</span>,</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">'cm'</span>),</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.7-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="table-6.3" class="level3">
<h3 class="anchored" data-anchor-id="table-6.3">Table 6.3</h3>
<div class="cell" data-hash="Ch6_cache/html/table-6.3_3adc1ee34d56cf8c7bdde811668c1cd0">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pseudo-observations of the restricted mean for subjects</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>pseudo_allt <span class="ot">&lt;-</span> <span class="fu">pseudomean</span>(pbc3<span class="sc">$</span>days <span class="sc">/</span> <span class="fl">365.25</span>, pbc3<span class="sc">$</span>fail, <span class="at">tmax =</span> <span class="dv">3</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-arrange the data into a long data set</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pbc3, <span class="at">pseudo =</span> pseudo_allt)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>outmean3 <span class="ot">&lt;-</span> a</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>fit_resm <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo <span class="sc">~</span> tment  <span class="sc">+</span> alb<span class="sc">+</span> log2bili, <span class="at">id =</span> id,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">subset</span>(outmean3, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mean.link =</span> <span class="st">"identity"</span>, <span class="at">corstr =</span> <span class="st">"independence"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">scale.fix =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">posumm</span>(fit_resm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  Est       SD     lo.ci     up.ci      Wald     PVal
(Intercept)  2.825598 0.346121  2.147201  3.503995 66.644608 0.000000
tment        0.147813 0.072936  0.004858  0.290769  4.107123 0.042703
alb          0.022512 0.006811  0.009162  0.035862 10.924256 0.000949
log2bili    -0.243093 0.031982 -0.305778 -0.180408 57.773091 0.000000</code></pre>
</div>
</div>
</section>
<section id="figure-6.8" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.8">Figure 6.8</h3>
<div class="cell" data-hash="Ch6_cache/html/figure-6.8_a5aa5fdc3388ede6c799e86350026cdb">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">days =</span> outmean3<span class="sc">$</span>days,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> outmean3<span class="sc">$</span>pseudo,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(outmean3<span class="sc">$</span>fail))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> pseudo, <span class="at">shape =</span> failtype), <span class="at">data =</span> pseudodata) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Fail"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"X"</span>[i]<span class="sc">*</span><span class="st">" (years)"</span>)) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.8-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="figure-6.9" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.9">Figure 6.9</h3>
<div class="cell" data-hash="Ch6_cache/html/figure-6.9_929e756797230f280f72c6192f68b455">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loess for log2 bili</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>log2bili_loess <span class="ot">&lt;-</span> <span class="fu">loess</span>(pseudo <span class="sc">~</span> log2bili, <span class="at">data =</span> outmean3, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>outmean3<span class="sc">$</span>log2bili_loesspred <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_loess)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#outmean3$t_log2bili_loesspred &lt;- with(outmean3,</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        ifelse(log2bili_loesspred &gt; 0 ,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                                               log(log2bili_loesspred/(1-log2bili_loesspred)), NA))</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> pseudo), <span class="at">data =</span> outmean3) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> log2bili_loesspred), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"log"</span> [<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.9-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>

<!-- ### Table 6.4 -->
<!-- ```{r} -->

<!-- #| label: table-6.4 -->
<!-- # Pseudo-obs -->
<!-- pseudo2 <- pseudoci(time = pbc3$days / 365.25, -->
<!--                     event = pbc3$status, -->
<!--                     tmax = 2) -->
<!-- b2 <- NULL -->
<!-- for(it in 1:length(pseudo2$time)){ -->
<!--   b2 <- rbind(b2,cbind(pbc3,pseudo = pseudo2$pseudo[[2]][,it], -->
<!--                        tpseudo = pseudo2$time[it])) -->
<!-- } -->
<!-- b2 <- b2[order(b2$id),] -->
<!-- # GEE fits -->
<!-- fit2 <- geese(pseudo ~ tment + I(alb-40) + I(log2(bili) - 4.6), data = b2, -->
<!--               id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--               mean.link = "logit", corstr = "independence") -->
<!-- summary(fit2) -->
<!-- fit2cloglog <- geese(pseudo ~ tment + I(alb-40) + I(log2(bili) - 4.6), data = b2, -->
<!--                      id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                      mean.link = "cloglog", corstr = "independence") -->
<!-- summary(fit2cloglog) -->
<!-- # NU ALLE ptt (kun TMENT): -->
<!-- pseudo2tot <- pseudoci(time = pbc3$days / 365.25, -->
<!--                        event = pbc3$status, -->
<!--                        tmax = 2) -->
<!-- b2tot <- NULL -->
<!-- for(it in 1:length(pseudo2tot$time)){ -->
<!--   b2tot <- rbind(b2tot,cbind(pbc3,pseudo = pseudo2tot$pseudo[[2]][,it], -->
<!--                              tpseudo = pseudo2tot$time[it],id=1:nrow(pbc3))) -->
<!-- } -->
<!-- b2tot <- b2tot[order(b2tot$id),] -->
<!-- fit2tment <- geese(pseudo ~ tment, data = b2tot, -->
<!--                    id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                    mean.link = "logit", corstr = "independence") -->
<!-- summary(fit2tment) -->
<!-- fit2tmentcloglog <- geese(pseudo ~ tment, data = b2tot, -->
<!--                           id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                           mean.link = "cloglog", corstr = "independence") -->
<!-- summary(fit2tmentcloglog) -->
<!-- ``` -->

<!-- ### Table 6.5 -->
<!-- ```{r} -->

<!-- #| label: table-6.4 -->
<!-- pseudo123 <- pseudoci(time = pbc3$days / 365.25, -->
<!--                       event = pbc3$status, -->
<!--                       tmax = c(1,2,3)) -->
<!-- b123 <- NULL -->
<!-- for(it in 1:length(pseudo123$time)){ -->
<!--   b123 <- rbind(b123,cbind(pbc3,pseudo = pseudo123$pseudo[[2]][,it], -->
<!--                            tpseudo = pseudo123$time[it])) -->
<!-- } -->
<!-- b123 <- b123[order(b123$id),] -->
<!-- # fit123 <- geese(pseudo ~ as.factor(tpseudo) + tment + I(alb-40) + I(log2(bili) - 4.6), -->
<!-- #                 data = b123, -->
<!-- #                 id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!-- #                 mean.link = "cloglog", corstr = "independence") -->
<!-- # summary(fit123) -->
<!-- b123$sex <- relevel(as.factor(b123$sex), ref = "1") -->
<!-- fit123ny <- geese(pseudo ~ as.factor(tpseudo) + tment + I(alb-40) + I(log2(bili) - 4.6) -->
<!--                   + as.factor(sex) + age, data = b123, -->
<!--                   id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                   mean.link =  "cloglog", corstr = "independence") -->
<!-- summary(fit123ny) -->
<!-- pseudo10 <- pseudoci(time = pbc3$days / 365.25, -->
<!--                      event = pbc3$status, -->
<!--                      tmax = c(0.5,1,1.5,2,2.5,3,3.5,4,4.5,5)) -->
<!-- b10 <- NULL -->
<!-- for(it in 1:length(pseudo10$time)){ -->
<!--   b10 <- rbind(b10,cbind(pbc3,pseudo = pseudo10$pseudo[[2]][,it], -->
<!--                          tpseudo = pseudo10$time[it],id=1:nrow(pbc3))) -->
<!-- } -->
<!-- b10 <- b10[order(b10$id),] -->
<!-- b10$sex <- relevel(as.factor(b10$sex), ref = "1") -->
<!-- fit10 <- geese(pseudo ~ as.factor(tpseudo) + tment + I(alb-40) + I(log2(bili) - 4.6) -->
<!--                + as.factor(sex) + age, data = b10, -->
<!--                id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                mean.link = "cloglog", corstr = "independence") -->
<!-- summary(fit10) -->
<!-- ``` -->
</section>
<section id="table-6.6" class="level3">
<h3 class="anchored" data-anchor-id="table-6.6">Table 6.6</h3>
<div class="cell" data-hash="Ch6_cache/html/table-6.6_96dedf7cd4d7d61c9b8dc0b89a7b2a0d">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lost years</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>pseudolost <span class="ot">&lt;-</span> <span class="fu">pseudoyl</span>(<span class="at">time =</span> pbc3<span class="sc">$</span>days <span class="sc">/</span> <span class="fl">365.25</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">event =</span> <span class="fu">as.integer</span>(pbc3<span class="sc">$</span>status),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">3</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pbc3,<span class="at">pseudo =</span> pseudolost<span class="sc">$</span>pseudo[[<span class="dv">1</span>]],<span class="at">id=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pbc3,<span class="at">pseudo =</span> pseudolost<span class="sc">$</span>pseudo[[<span class="dv">2</span>]],<span class="at">id=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fityl1 <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo <span class="sc">~</span> tment,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> a1, <span class="at">id =</span> id, <span class="at">jack =</span> <span class="cn">TRUE</span>, <span class="at">family =</span> gaussian,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">corstr =</span> <span class="st">"independence"</span>, <span class="at">scale.fix =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo ~ tment, id = id, data = a1, family = gaussian, 
    scale.fix = FALSE, corstr = "independence", jack = TRUE)

Mean Model:
 Mean Link:                 identity 
 Variance to Mean Relation: gaussian 

 Coefficients:
               estimate     san.se     ajs.se      wald            p
(Intercept)  0.14304562 0.04121590 0.04127696 12.045356 0.0005192156
tment       -0.05638594 0.05102947 0.05110332  1.220955 0.2691733775

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
             estimate     san.se    ajs.se     wald            p
(Intercept) 0.2260261 0.05100506 0.0515204 19.63771 9.360351e-06

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   349   Maximum cluster size: 1 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fityl2 <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo <span class="sc">~</span> tment,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> a2, <span class="at">id =</span> id, <span class="at">jack =</span> <span class="cn">TRUE</span>, <span class="at">family =</span> gaussian,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">corstr =</span> <span class="st">"independence"</span>, <span class="at">scale.fix =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo ~ tment, id = id, data = a2, family = gaussian, 
    scale.fix = FALSE, corstr = "independence", jack = TRUE)

Mean Model:
 Mean Link:                 identity 
 Variance to Mean Relation: gaussian 

 Coefficients:
               estimate     san.se     ajs.se        wald            p
(Intercept)  0.25153053 0.05315608 0.05323484 22.39110068 2.224022e-06
tment       -0.01520994 0.07291925 0.07302390  0.04350814 8.347714e-01

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
             estimate    san.se     ajs.se    wald            p
(Intercept) 0.4634606 0.0697068 0.07040943 44.2054 2.956646e-11

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   349   Maximum cluster size: 1 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fityl1 <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> <span class="fu">log2</span>(bili),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(a1,<span class="sc">!</span><span class="fu">is.na</span>(alb)), <span class="at">id =</span> id, <span class="at">jack =</span> <span class="cn">TRUE</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> gaussian,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">corstr =</span> <span class="st">"independence"</span>, <span class="at">scale.fix =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo ~ tment + alb + log2(bili), id = id, data = subset(a1, 
    !is.na(alb)), family = gaussian, scale.fix = FALSE, corstr = "independence", 
    jack = TRUE)

Mean Model:
 Mean Link:                 identity 
 Variance to Mean Relation: gaussian 

 Coefficients:
                 estimate      san.se      ajs.se        wald            p
(Intercept) -0.2925955874 0.214509773 0.219305817  1.86055015 0.1725613190
tment       -0.0629704571 0.045824402 0.046173406  1.88833949 0.1693893294
alb         -0.0007479074 0.004088095 0.004166756  0.03346984 0.8548390903
log2(bili)   0.1001512112 0.026281542 0.026811333 14.52147461 0.0001385709

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
             estimate     san.se     ajs.se     wald            p
(Intercept) 0.1877829 0.03991555 0.04086088 22.13236 2.544835e-06

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   343   Maximum cluster size: 1 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fityl2 <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> <span class="fu">log2</span>(bili),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(a2,<span class="sc">!</span><span class="fu">is.na</span>(alb)), <span class="at">id =</span> id, <span class="at">jack =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> gaussian,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">corstr =</span> <span class="st">"independence"</span>, <span class="at">scale.fix =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo ~ tment + alb + log2(bili), id = id, data = subset(a2, 
    !is.na(alb)), family = gaussian, scale.fix = FALSE, corstr = "independence", 
    jack = TRUE)

Mean Model:
 Mean Link:                 identity 
 Variance to Mean Relation: gaussian 

 Coefficients:
               estimate      san.se      ajs.se     wald            p
(Intercept)  0.46699730 0.323932111 0.328438874  2.07836 1.494006e-01
tment       -0.08484277 0.068542273 0.069039590  1.53219 2.157840e-01
alb         -0.02176434 0.006549422 0.006642189 11.04295 8.902503e-04
log2(bili)   0.14294187 0.032316673 0.032763783 19.56436 9.726692e-06

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
             estimate     san.se     ajs.se     wald            p
(Intercept) 0.3914462 0.05096053 0.05211022 59.00331 1.576517e-14

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   343   Maximum cluster size: 1 </code></pre>
</div>
</div>
</section>
<section id="figure-6.11" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.11">Figure 6.11</h3>
<section id="left-3" class="level4">
<h4 class="anchored" data-anchor-id="left-3">left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.11left_94e3c3841ea9deaf4a94f8a1340900f0">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comp. end point t=2 smlg med IJ</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pseudo)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>nystatus<span class="ot">&lt;-</span><span class="fu">ifelse</span>(pbc3<span class="sc">$</span>status <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>pseudo <span class="ot">&lt;-</span> <span class="fu">pseudosurv</span>(<span class="at">time =</span> pbc3<span class="sc">$</span>days,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">event =</span> pbc3<span class="sc">$</span>nystatus,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tmax=</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(days, status <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>IJpseudo <span class="ot">&lt;-</span> <span class="fu">pseudo</span>(fit, <span class="at">times =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>, <span class="at">addNA =</span> <span class="cn">TRUE</span>, <span class="at">data.frame =</span> <span class="cn">TRUE</span>, <span class="at">minus1 =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>pdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">IJpseudo =</span> IJpseudo<span class="sc">$</span>pseudo,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pseudo =</span> pseudo<span class="sc">$</span>pseudo,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">diff =</span> IJpseudo<span class="sc">$</span>pseudo <span class="sc">-</span> pseudo<span class="sc">$</span>pseudo)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span>left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pseudo, <span class="at">y =</span> IJpseudo), <span class="at">data =</span> pdata) <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"IJ pseudo-value"</span>) <span class="sc">+</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pseudo-value"</span>) <span class="sc">+</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>),</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>),</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.11left-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="right-3" class="level4">
<h4 class="anchored" data-anchor-id="right-3">right</h4>
</section>
<section id="left-4" class="level4">
<h4 class="anchored" data-anchor-id="left-4">left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.11right_45691729c2ea51578adbe5b787f4bb97">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pseudo, <span class="at">y =</span> IJpseudo <span class="sc">-</span> pseudo), <span class="at">data =</span> pdata) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Difference"</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pseudo-value"</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="at">by =</span> <span class="fl">0.005</span>)) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.11right-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</section>
</section>
<section id="prova-trial-in-liver-cirrhosis" class="level2">
<h2 class="anchored" data-anchor-id="prova-trial-in-liver-cirrhosis">PROVA trial in liver cirrhosis</h2>
<section id="read-data-1" class="level3">
<h3 class="anchored" data-anchor-id="read-data-1">Read data</h3>
<div class="cell" data-hash="Ch6_cache/html/read-prova_071b6feddc1e23ac624af34b962f6982">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>prova <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/prova.csv"</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"."</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment 2x2 factorial</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>prova<span class="sc">$</span>beh <span class="ot">&lt;-</span> <span class="fu">with</span>(prova, <span class="fu">as.factor</span>(scle <span class="sc">+</span> beta<span class="sc">*</span><span class="dv">2</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>prova <span class="ot">&lt;-</span> prova <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">timebleed =</span> <span class="fu">ifelse</span>(bleed <span class="sc">==</span> <span class="dv">1</span>, timebleed, timedeath),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">outof0 =</span> <span class="fu">ifelse</span>(bleed <span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>, death),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">wait =</span> <span class="fu">ifelse</span>(bleed <span class="sc">==</span><span class="dv">1</span>, timedeath <span class="sc">-</span> timebleed, <span class="cn">NA</span>))</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Faster processing</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(data.table)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>prova <span class="ot">&lt;-</span> <span class="fu">setDT</span>(prova)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting start times, s = 1 year and s = 2 years</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">=</span> <span class="fl">365.25</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span><span class="fl">365.25</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Censoring times</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>cens_outof0 <span class="ot">&lt;-</span> <span class="dv">1509</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>cens_wait <span class="ot">&lt;-</span> <span class="dv">1363</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure-6.10" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.10">Figure 6.10</h3>
<p>TODO: get program to make data file <code>datafig610.csv</code></p>
<div class="cell" data-hash="Ch6_cache/html/figure-6.10_34c7f2f5742147922cfa9e08d06ca8c2">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mstate)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table) <span class="co">#Faster aggregation of data</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating data frame</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting data to long format</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition matrix for irreversible illness-death model</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>tmat <span class="ot">&lt;-</span> <span class="fu">trans.illdeath</span>(<span class="at">names =</span> <span class="fu">c</span>(<span class="st">"Non-bleeding"</span>, <span class="st">"Bleeding"</span>, <span class="st">"Dead"</span>))</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>long_format_scle0 <span class="ot">&lt;-</span> <span class="fu">msprep</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"timebleed"</span>, <span class="st">"timedeath"</span>), <span class="at">status =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"bleed"</span>, <span class="st">"death"</span>), <span class="at">data =</span> <span class="fu">subset</span>(<span class="fu">as.data.frame</span>(prova), scle <span class="sc">==</span><span class="dv">0</span>), <span class="at">trans =</span> tmat, <span class="at">keep =</span> <span class="st">"scle"</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>long_format_scle1 <span class="ot">&lt;-</span> <span class="fu">msprep</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"timebleed"</span>, <span class="st">"timedeath"</span>), <span class="at">status =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"bleed"</span>, <span class="st">"death"</span>), <span class="at">data =</span> <span class="fu">subset</span>(<span class="fu">as.data.frame</span>(prova), scle <span class="sc">==</span><span class="dv">1</span>), <span class="at">trans =</span> tmat, <span class="at">keep =</span> <span class="st">"scle"</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimation of transition probabilities with the Landmark Aalen-Johansen estimator</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Warning is not related to the estimate of pstate2</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>LMAaJ_scle0 <span class="ot">&lt;-</span> <span class="fu">LMAJ</span>(long_format_scle0, <span class="at">s =</span> s1, <span class="at">from =</span> <span class="dv">1</span>) <span class="co">#P(V(t) = 1 | V(1) = 0)</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>LMAaJ_scle1 <span class="ot">&lt;-</span> <span class="fu">LMAJ</span>(long_format_scle1, <span class="at">s =</span> s1, <span class="at">from =</span> <span class="dv">1</span>) <span class="co">#P(V(t) = 1 | V(1) = 0)</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>LMAJ_scle0_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(LMAaJ_scle0<span class="sc">$</span>time, LMAaJ_scle0<span class="sc">$</span>pstate2, <span class="st">"No"</span>))</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(LMAJ_scle0_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"p01"</span>, <span class="st">"Sclerotherapy"</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>LMAJ_scle1_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(LMAaJ_scle1<span class="sc">$</span>time, LMAaJ_scle1<span class="sc">$</span>pstate2, <span class="st">"Yes"</span>))</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(LMAJ_scle1_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"p01"</span>, <span class="st">"Sclerotherapy"</span>)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>LMAJ_scle <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(LMAJ_scle0_data, LMAJ_scle1_data))</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>LMAJ_scle <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"R/data/datafig610.csv"</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(LMAJ_scle,<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(time)<span class="sc">/</span><span class="fl">365.25</span>, <span class="at">y =</span> <span class="fu">as.numeric</span>(p01), <span class="at">group =</span> Sclerotherapy)) <span class="sc">+</span> </span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span> </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(),<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.94</span>,<span class="fl">4.2</span>)) <span class="sc">+</span>  </span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">linetype=</span>Sclerotherapy) <span class="sc">+</span> theme_general <span class="sc">+</span> </span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">"cm"</span>),<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.10-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="table-6.7" class="level3">
<h3 class="anchored" data-anchor-id="table-6.7">Table 6.7</h3>
<p>No code available - results are from: Andersen, P. K., Wandall, E. N. S., Pohar Perme, M. (2022). Inference for transition probabilities in non-Markov multi-state models. <em>Lifetime Data Analysis</em>, 28:585604.</p>
</section>
</section>
<section id="leader-cardiovascular-trial-in-type-2-diabetes" class="level2">
<h2 class="anchored" data-anchor-id="leader-cardiovascular-trial-in-type-2-diabetes">LEADER cardiovascular trial in type 2 diabetes</h2>
<!-- {{< include R/chapter6_leader.qmd >}} -->
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<p>The SAS solutions are available as a single file for download:</p>
<ul>
<li><a href="./SAS/chapter6_solutions_cphholter.sas">Exercises 6.3 - 6.5 (The Copenhagen Holter study)</a></li>
</ul>
<section id="exercise-6.1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.1">Exercise 6.1 (*)</h3>
<p><em>The influence function for the survival function <span class="math inline">\(S(t)\)</span> is</em> <span class="math display">\[\dot{\phi}(X_i^*)=-S(t)\int_0^t\frac{dM_i(u)}{S(u)G(u)}\]</span> <em>with <span class="math inline">\(M_i(u)=N_i(u)-\int_0^uY_i(s)dA(s)\)</span> being the martingale for the failure counting process for subject <span class="math inline">\(i\)</span> (Overgaard et al.&nbsp;2017). The corresponding `plug-in approximation is then</em> <span class="math display">\[\widehat{\dot{\phi}}(X_i^*)=-\widehat{S}(t)\left(\frac{N_i(t)}{Y(t\wedge X_i)/n}-\int_0^{t\wedge X_i}\frac{dN(u)}{Y(u)^2/n}\right).\]</span></p>
<section id="section" class="level4">
<h4 class="anchored" data-anchor-id="section">1.</h4>
<p><em>Show that, writing the estimator in the</em> `<span class="math inline">\(\exp(-\mbox{Nelson-Aalen})\)</span> <em>form</em> <span class="math inline">\(\widehat{S}^w(t)=\exp(-\int_0^t(\sum_iw_idN_i(u)/\sum_iw_iY_i(u)))\)</span><em>, this expression is obtained as</em> <span class="math display">\[\dot{\widehat{\phi}}(X_i^*)=\frac{\partial \widehat{S}^w(t)}{\partial w_i}\vert_{\mathbf{w}=1/n}.\]</span> The derivative <span class="math inline">\(\frac{\partial \widehat{S}^w(t)}{\partial w_i}\vert_{\mathbf{w}=1/n}\)</span> is <span class="math display">\[-\widehat{S}(t)\int_0^t\frac{(Y(u)/n)dN_i(u)-Y_i(u)dN(u)/n}{(Y(u)/n)^2}\]</span> <span class="math display">\[=-\widehat{S}(t)(\int_0^t\frac{dN_i(u)}{Y(u)/n}-\int_0^tY_i(u)\frac{dN(u)}{Y(u)^2/n}),\]</span> which equals the desired expression.</p>
</section>
<section id="section-1" class="level4">
<h4 class="anchored" data-anchor-id="section-1">2.</h4>
<p><em>Show that for the standard Kaplan-Meier estimator</em> <span class="math display">\[\widehat{S}^w(t)=\prod_{[0,t]}(1-\sum_iw_idN_i(u)/\sum_iw_iY(u))\]</span> <em>it holds that</em> <span class="math display">\[\frac{\partial \widehat{S}^w(t)}{\partial w_i}\vert_{\mathbf{w}=1/n}=
-n\widehat{S}(t)\left(\frac{N_i(t)}{Y(t\wedge X_i)-dN(t\wedge X_i)}-\int_0^{t\wedge X_i}\frac{dN(u)}{Y(u)(Y(u)-dN(u))}\right).\]</span></p>
<p>Note that the factor <span class="math inline">\(n\)</span> is missing in the exercise text in the book.</p>
<p>The Kaplan-Meier estimator is a product, say <span class="math inline">\(f(\mathbf{w})=\prod_jf_j(\mathbf{w})\)</span>, with a factor for each observation time <span class="math inline">\(u=X_j\)</span> and with derivative <span class="math display">\[f^{\prime}(\mathbf{w})=\sum_jf_j^{\prime}(\mathbf{w})\prod_{k\neq j}f_k(\mathbf{w})=f(\mathbf{w})\sum_j\frac{f_j^{\prime}(\mathbf{w})}{f_j(\mathbf{w})}.\]</span> The <span class="math inline">\(j\)</span>th factor is <span class="math inline">\(f_j(\mathbf{w})=1-\frac{\sum_iw_idN_i(u)}{\sum_iw_iY(u)}\)</span> with <span class="math inline">\(i\)</span>th derivative, when <span class="math inline">\(\mathbf{w}=1/n\)</span>, <span class="math display">\[-\frac{(Y(u)/n)dN_i(u)-(dN(u)/n)Y_i(u)}{(Y(u)/n)^2}\]</span> and, hence, <span class="math display">\[\frac{f_j^{\prime}(\mathbf{w})}{f_j(\mathbf{w})}=-\frac{Y(u)dN_i(u)-dN(u)Y_i(u)}{(Y(u)-dN(u))Y(u)/n}.\]</span> Summing (integrating) over all observation times, the desired expression is obtained.</p>
</section>
<section id="section-2" class="level4">
<h4 class="anchored" data-anchor-id="section-2">3.</h4>
<p><em>Show that, in the case of no censoring, the influence function reduces to</em> <span class="math display">\[\dot{\phi}(X_i^*)=I(T_i&gt;t)-S(t).\]</span></p>
<p>Using the infinitesimal jackknife approach on the complete data estimator <span class="math inline">\(\widehat{S}^w(t)={\sum_iw_iI(T_i&gt;t)}/{\sum_iw_i}\)</span>, the <span class="math inline">\(i\)</span>th derivative is, when <span class="math inline">\(\mathbf{w}=1/n\)</span>, <span class="math display">\[I(T_i&gt;t)-\sum_jI(T_j&gt;t)/n=I(T_i&gt;t)-\widehat{S}(t).\]</span> Alternatively, evaluating the expression for <span class="math inline">\(\dot{\phi}(X_i^*)\)</span> for uncensored data (<span class="math inline">\(G(u)=1\)</span>), we get <span class="math display">\[-S(t)\int_0^t(dN_i(u)-\alpha(u)Y_i(u))/S(u)du=-S(t)(\frac{N_i(t)}{S(t\wedge T_i)}-\int_0^tY_i(u)\alpha(u)/S(u)du,\]</span> where the latter integral (using that the density <span class="math inline">\(\alpha(u)S(u)\)</span> is minus the derivative of <span class="math inline">\(S(u)\)</span>) can be evaluated as <span class="math inline">\(1-1/S(t\wedge T_i)\)</span>. All in all, we get <span class="math inline">\(-S(t)\)</span> for <span class="math inline">\(T_i\leq t\)</span> and <span class="math inline">\(1-S(t)\)</span> for <span class="math inline">\(T_i&gt;t\)</span>, i.e., <span class="math inline">\(I(T_i&gt;t)-S(t)\)</span>.</p>
</section>
</section>
<section id="exercise-6.2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.2">Exercise 6.2 (*)</h3>
<section id="section-3" class="level4">
<h4 class="anchored" data-anchor-id="section-3">1.</h4>
<p><em>Show that, for the Aalen-Johansen estimator, the calculation</em> <span class="math display">\[\dot{\widehat{\phi}}(X_i^*)=\frac{\partial \widehat{F}^w_h(t)}{\partial w_i}\vert_{\mathbf{w}=1/n},\]</span> with <span class="math inline">\(\widehat{F}^w_h(t)\)</span> <em>given by (6.11), leads to the pseudo-value approximation obtained by plugging-in estimators into (6.10).</em></p>
<p>The <span class="math inline">\(i\)</span>th derivative of <span class="math inline">\(\widehat{F}^w_h(t)\)</span> when <span class="math inline">\(\mathbf{w}=1/n\)</span> is <span class="math display">\[\int_0^t(-\widehat{S}(u-)(\sum_j\int_0^u\frac{(Y(s)/n)dN_{ji}(s)-(dN_j(s)/n)Y_i(s)}{(Y(s)/n)^2}d\widehat{A}_h(u))\]</span> <span class="math display">\[+\widehat{S}(u-)(\frac{(Y(u)/n)dN_{hi}(u)-(dN_h(u)/n)Y_i(u)}{(Y(s)/n)^2})).\]</span> Using the relation <span class="math inline">\(\widehat{S}(u-)\widehat{G}(u-)=Y(u)/n\)</span>, the second line reduces to <span class="math display">\[\int_0^t\frac{dN_{hi}(u)}{\widehat{G}(u-)}-\int_0^tY_i(u)\frac{d\widehat{A}_h(u)}{\widehat{G}(u-)}\]</span> which is the estimate for the first term in (6.10) because <span class="math inline">\(M_{hi}(t)=N_{hi}(t)-\int_0^tY_i(u)dA_h(u)\)</span>. Using the same relation for the first line, this reduces to <span class="math display">\[-\int_0^t\widehat{S}(u-)\left(\int_0^u\sum_h(\frac{dN_{ji}(s)}{\widehat{S}(s-)\widehat{G}(s-)}-
Y_i(s)\frac{dN_h(s)}{\widehat{S}(s-)\widehat{G}(s-)Y(s)})\right)\]</span> which is the estimate of the second term in (6.10) because <span class="math display">\[M_{i}(t)=\sum_j (N_{ji}(t)-\int_0^tY_i(u)dA_j(u)).\]</span></p>
</section>
<section id="section-4" class="level4">
<h4 class="anchored" data-anchor-id="section-4">2.</h4>
<p><em>Show that, in the case of no censoring, the influence function reduces to</em> <span class="math display">\[\dot{\phi}(X_i^*)=I(T_i\leq t, D=h)-F_h(t).\]</span></p>
<p>Looking at Equation (6.6), the result follows directly because <span class="math inline">\(G(u)=1\)</span> and <span class="math inline">\(M_{0i}(t)=0\)</span>. Using, as an alternative, the infinitesimal jackknife approach on the complete data estimator <span class="math inline">\(\widehat{F}_h^w(t)={\sum_iw_iI(T_i\leq t, D_i=h)}/{\sum_iw_i}\)</span>, the <span class="math inline">\(i\)</span>th derivative is, when <span class="math inline">\(\mathbf{w}=1/n\)</span>, <span class="math display">\[I(T_i\leq t, D_i=h)-\sum_jI(T_j\leq t, D_j=h)/n=I(T_i\leq t, D_i=h)-\widehat{F}_h(t).\]</span></p>
</section>
</section>
<section id="exercise-6.3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.3">Exercise 6.3</h3>
<p>This and the next two exercises are using the Copenhagen Holter study, and we start by loading and preparing data.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>The data should be loaded as <strong>chs_data</strong></p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-24_90035f65774ddb6483cee184850e0ef4">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/cphholter.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then load the relevant packages</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-25_afde1c9168add3ad411b33c6c91b5727">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co">#Data manipulations and plots</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co">#Core survival analysis routines</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer) <span class="co">#Plots of survival curves</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survRM2) <span class="co">#RMST </span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mstate) <span class="co">#probtrans, ELOS</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mets) <span class="co">#binreg</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pseudo)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geepack)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, we will convert the time variables to years and add a time variable and status indicator for the composite end-point stroke-free survival.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-26_76d24ff8b473a6e08d91e0c84264d0df">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">timeafib =</span> timeafib<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timestroke =</span> timestroke<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timedeath =</span> timedeath<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timestrokeordeath =</span> <span class="fu">ifelse</span>(stroke <span class="sc">==</span> <span class="dv">1</span>, timestroke, timedeath),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">strokeordeath =</span> <span class="fu">ifelse</span>(stroke <span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>, death))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-27_dc925b589d03a3c6f9c5b95664b43ffe">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out = chs_<span class="kw">data</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    datafile = <span class="st">'data/cphholter.csv'</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    dbms= csv <span class="kw">replace</span>;</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    getnames=yes;</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">* We will convert the time variables, timeafib, timestroke, and timedeath, from days to years;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    timeafib = timeafib/<span class="dv">365.25</span>;</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    timestroke = timestroke/<span class="dv">365.25</span>;</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    timedeath = timedeath/<span class="dv">365.25</span>;</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">* Furthermore, we add variables for the composite end-point of stroke or death without stroke;</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    timestrokeordeath = timedeath;</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stroke = <span class="dv">1</span> <span class="kw">then</span> timestrokeordeath = timestroke;</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    strokeordeath = death;</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stroke = <span class="dv">1</span> <span class="kw">then</span> strokeordeath = <span class="dv">1</span>;</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p><em>Consider the Copenhagen Holter study and the composite end-point strokefree survival.</em></p>
<section id="section-5" class="level4">
<h4 class="anchored" data-anchor-id="section-5">1.</h4>
<p><em>Fit, using pseudo-values, a cloglog model for experiencing that end-point before time 3 years including the covariates ESVEA, sex, age, and systolic blood pressure.</em></p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>We will compute the pseudo observations for the incompletely observed survival indicators <span class="math inline">\(I(T_i &gt; 3 \text{ years})\)</span>, <span class="math inline">\(i = 1,...,678\)</span> using the <strong>pseudosurv</strong> function from the <em>pseudo</em> package. The function takes a time variable, <strong>time</strong>, status indicator, <strong>event</strong>, and time point(s) where the pseudo observations should be computed, <strong>tmax</strong>, as arguments. The pseudo observations are returned as a list called <strong>pseudo</strong>.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-28_3c6028b4e1a4a5d003e7bc94cc7659a4">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the pseudo observations </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>pseudo631 <span class="ot">&lt;-</span> <span class="fu">pseudosurv</span>(<span class="at">time =</span> chs_data<span class="sc">$</span>timestrokeordeath, <span class="at">event =</span> chs_data<span class="sc">$</span>strokeordeath, <span class="at">tmax =</span> <span class="dv">3</span>)<span class="sc">$</span>pseudo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The cloglog model for experiencing stroke-free survival is fitted using the <strong>geese</strong> function from the <em>geepack</em> library where we must provide the arguments <strong>formula</strong>, <strong>data</strong> and <strong>mean.link</strong>. Since the cloglog link function is implemented as <span class="math inline">\(\log(-\log(1-x))\)</span> we must use 1 minus the pseudo observations as responses in the GEE. Furthermore, we must exclude the three observations with missing values of systolic blood pressure in the data argument.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-29_6b1dfc2443c2eec6b911a7e7d3bcbd05">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting the GEE</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fit631 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo631) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> <span class="fu">subset</span>(chs_data, <span class="sc">!</span><span class="fu">is.na</span>(sbp)), <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit631)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = I(1 - pseudo631) ~ esvea + sex + age + sbp, data = subset(chs_data, 
    !is.na(sbp)), mean.link = "cloglog")

Mean Model:
 Mean Link:                 cloglog 
 Variance to Mean Relation: gaussian 

 Coefficients:
                estimate      san.se        wald            p
(Intercept) -8.417674445 2.250118633 13.99501663 0.0001832958
esvea        0.235836070 0.473373013  0.24820668 0.6183406485
sex          0.552503402 0.424275723  1.69579578 0.1928387168
age          0.081000941 0.030941929  6.85307312 0.0088488936
sbp         -0.001947476 0.008978799  0.04704438 0.8282884941

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
              estimate      san.se     wald            p
(Intercept) 0.04417044 0.007098887 38.71532 4.903444e-10

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   675   Maximum cluster size: 1 </code></pre>
</div>
</div>
<p>Thus, we obtain the following model for stroke-free survival at three years including the covariates ESVEA, sex, age, and systolic blood pressure</p>
<p><span class="math display">\[ S(3|Z) = \exp(-\exp(-8.417674 + 0.235836\cdot Z_1\]</span> <span class="math display">\[+ 0.552503\cdot Z_2 +  0.081001\cdot Z_3 -0.001947\cdot Z_4 ) ),\]</span></p>
<p>where <span class="math inline">\(Z_1, Z_2, Z_3\)</span>, and <span class="math inline">\(Z_4\)</span> are ESVEA, sex, age, and systolic blood pressure, respectively.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-30_baf21271ac8ed7890fd273e8d6c93731">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We will compute the pseudo observations for the incompletely observed survival indicators I(T_i &gt; 3 years), i = 1,...,678 using </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">  the pseudosurv MACRO.;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">* 'noprint plots = none' are included twice in the proc lifetest statement of the MACRO to avoid none important outputs being </span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">  printed;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudosurv(indata,time,dead,howmany,datatau,outdata);</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">/* The subsequent SAS code is adapted from that described by J.P.Klein,</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">    M.Gerster, P.K.Andersen, S.Tarima, M.Pohar Perme (2008): "SAS and R</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co">    functions to compute pseudo-values for censored data regression"</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Comp. Meth. Progr. Biomed., vol. 89,pp. 289-300. */</span> </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">/*    MACRO COMPUTES PSEUDOVALUES BASED ON THE KAPLAN-MEIER ESTIMATOR AT EACH</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co">      INPUTS:</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">      INDATA---INPUT DATA SET</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME--TIME VARIABLE</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co">      DEAD---EVENT INDICATOR (1-EVENT, 0-CENSORED)</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY---SAMPLE SIZE</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co">      DATATAU---SUBSET OF INPUT DATA SET AT WHICH PSEUDO VALUES ARE COMPUTED DATA</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co">                SET HAS SINGLE VARIABLE TIME</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co">     </span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co">      OUTDATA---OUTPUT DATA SET WHICH CONTAINS PSUK,K=1,...,HOWMANY THE PSEUDO</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co">      VALUES AT EACH TIME POINT (Note output data set includes orginal data sorted</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co">                           by time</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="co">      </span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;indata;</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">keep</span>;  <span class="kw">set</span> <span class="kw">&amp;datatau;</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>find=<span class="dv">1</span>;</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;time;</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span>=<span class="dv">1</span>;</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">merge</span> <span class="fu">point</span> <span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> find <span class="kw">keep</span>;</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> useme;  <span class="kw">set</span> <span class="fu">point</span>;</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> temp -<span class="dv">1</span>;</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">keep</span> = <span class="dv">1</span> <span class="kw">then</span> temp=<span class="fu">time</span>;</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>tuse=temp; </span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;time=</span>tuse;</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="kw"> run</span>;</span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a><span class="co">/* WORKING DATA SET THAT INCLUDE A SET OF N INDICATORS WHERE FOR THE KTH INDICATOR</span></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a><span class="co"> THE EVENT IS MISSING */</span></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> newdat;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobs(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>iobs(j)=<span class="kw">&amp;dead;</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> j=id <span class="kw">then</span> iobs(j)=.;</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> newdat;</span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE KME FOR FULL SAMPLE */</span></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> lifetest<span class="kw"> data</span>=newdat noprint plots = none;</span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span> <span class="kw">&amp;TIME*&amp;dead(</span><span class="dv">0</span>);</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a>survival out=sall;</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> sall;  <span class="kw">set</span> sall;</span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>sall=survival;</span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a> <span class="kw">keep</span> <span class="kw">&amp;time </span>sall;</span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a><span class="kw">%do</span> ip=<span class="dv">1</span> <span class="kw">%to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE KME FOR REDUCED SAMPLE */</span></span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> lifetest<span class="kw"> data</span>=newdat noprint plots = none;</span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span> <span class="kw">&amp;time*</span>dead<span class="kw">&amp;ip(</span><span class="dv">0</span>);</span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>survival out=stmp;</span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> stmp;  <span class="kw">set</span> stmp;</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>s<span class="kw">&amp;ip=</span>survival;</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;time </span>s<span class="kw">&amp;ip;</span></span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a><span class="co">/*merge KMEs AND COMPUTE PSEUDOVALUES FOR OBSERVATION IP*/</span></span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pstmp; <span class="kw">merge</span> sall stmp;  <span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> stemp <span class="dv">1</span>;</span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> s<span class="kw">&amp;ip=</span>. <span class="kw">then</span> s<span class="kw">&amp;ip=</span>stemp;</span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a>stemp=s<span class="kw">&amp;ip;</span></span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a>psu<span class="kw">&amp;ip=&amp;howmany*</span>sall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*s<span class="kw">&amp;ip;</span></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out; <span class="kw">merge</span> out pstmp useme ;  <span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;time </span>psu1-psu<span class="kw">&amp;ip;</span></span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a><span class="kw">%end</span>;</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> out;</span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> dup -<span class="dv">1</span>;</span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">&amp;time=</span>dup <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a> <span class="kw">else</span> dup=<span class="kw">&amp;time;</span></span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a> jd+<span class="dv">1</span>;</span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> io;  <span class="kw">set</span> out;</span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> ps psu1-psu<span class="kw">&amp;howmany;</span></span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> id=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a>pseudo=ps(id);</span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;time;</span></span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span>;</span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> id pseudo jd;</span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=io ;</span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> id;</span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> a;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> io;  <span class="kw">merge</span> a io;  <span class="kw">by</span> id;</span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a><span class="kw"> proc</span> sort<span class="kw"> data</span>=io;  <span class="kw">by</span> jd;</span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datatau;</span></span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> taus;  <span class="kw">set</span> <span class="kw">&amp;datatau </span>;</span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a> jd+<span class="dv">1</span>;</span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true" tabindex="-1"></a> tpseudo=<span class="fu">time</span>;</span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true" tabindex="-1"></a> <span class="kw">keep</span> jd tpseudo;</span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-125"><a href="#cb44-125" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb44-126"><a href="#cb44-126" aria-hidden="true" tabindex="-1"></a><span class="kw">  data</span> <span class="kw">&amp;outdata;</span>  <span class="kw">merge</span> io taus;  <span class="kw">by</span> jd;</span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> jd id <span class="kw">&amp;time &amp;dead;</span></span>
<span id="cb44-128"><a href="#cb44-128" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span>;</span>
<span id="cb44-129"><a href="#cb44-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-130"><a href="#cb44-130" aria-hidden="true" tabindex="-1"></a><span class="co">* Inside the MACRO a variable called 'id' is created which interferes with the 'id' variable in our data set, chs_data. Therefore,</span></span>
<span id="cb44-131"><a href="#cb44-131" aria-hidden="true" tabindex="-1"></a><span class="co">  we will first rename the 'id' variable in the chs_data;</span></span>
<span id="cb44-132"><a href="#cb44-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-133"><a href="#cb44-133" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>; </span>
<span id="cb44-134"><a href="#cb44-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>; </span>
<span id="cb44-135"><a href="#cb44-135" aria-hidden="true" tabindex="-1"></a>    ptno = id;</span>
<span id="cb44-136"><a href="#cb44-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> id;</span>
<span id="cb44-137"><a href="#cb44-137" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb44-138"><a href="#cb44-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-139"><a href="#cb44-139" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, we make a data set named 'timepoint' which contains one column 'time' with the timepoint where we wish the pseudo observations to</span></span>
<span id="cb44-140"><a href="#cb44-140" aria-hidden="true" tabindex="-1"></a><span class="co">  be computed.;</span></span>
<span id="cb44-141"><a href="#cb44-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-142"><a href="#cb44-142" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> timepoint;</span>
<span id="cb44-143"><a href="#cb44-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> <span class="fu">time</span>;</span>
<span id="cb44-144"><a href="#cb44-144" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines;</span></span>
<span id="cb44-145"><a href="#cb44-145" aria-hidden="true" tabindex="-1"></a><span class="ot">    3</span></span>
<span id="cb44-146"><a href="#cb44-146" aria-hidden="true" tabindex="-1"></a><span class="ot">    ;</span></span>
<span id="cb44-147"><a href="#cb44-147" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb44-148"><a href="#cb44-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-149"><a href="#cb44-149" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudosurv MACRO is then called with 'chs_data', 'timestrokeordeath', 'strokeordeath', '678'. 'timepoint' and 'outdatadata631' </span></span>
<span id="cb44-150"><a href="#cb44-150" aria-hidden="true" tabindex="-1"></a><span class="co">  as arguments;</span></span>
<span id="cb44-151"><a href="#cb44-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-152"><a href="#cb44-152" aria-hidden="true" tabindex="-1"></a><span class="co">* The MACRO returns a data set 'outdata631' where the pseudo observations are stored in the column 'pseudo'.;</span></span>
<span id="cb44-153"><a href="#cb44-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-154"><a href="#cb44-154" aria-hidden="true" tabindex="-1"></a>%pseudosurv(chs_data, timestrokeordeath, strokeordeath, 678, timepoint, outdata631);</span>
<span id="cb44-155"><a href="#cb44-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-156"><a href="#cb44-156" aria-hidden="true" tabindex="-1"></a><span class="co">* The output of the MACRO 'outdata631' is then used as data when fitting the cloglog model using the genmod procedure.;</span></span>
<span id="cb44-157"><a href="#cb44-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-158"><a href="#cb44-158" aria-hidden="true" tabindex="-1"></a><span class="co">* We must specify the link function and the inverse link function in the fwdlink and invlink statements;</span></span>
<span id="cb44-159"><a href="#cb44-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-160"><a href="#cb44-160" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.3.1'</span>;</span>
<span id="cb44-161"><a href="#cb44-161" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata631;</span>
<span id="cb44-162"><a href="#cb44-162" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb44-163"><a href="#cb44-163" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=<span class="fu">log</span>(-<span class="fu">log</span>(_mean_));</span>
<span id="cb44-164"><a href="#cb44-164" aria-hidden="true" tabindex="-1"></a>    invlink ilink=<span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb44-165"><a href="#cb44-165" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> pseudo= esvea sex age sbp/dist=<span class="fu">normal</span> noscale;</span>
<span id="cb44-166"><a href="#cb44-166" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb44-167"><a href="#cb44-167" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb44-168"><a href="#cb44-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-169"><a href="#cb44-169" aria-hidden="true" tabindex="-1"></a><span class="co">* Thus, we obtain the following model for stroke-free survival at three years including the covariates ESVEA, sex, age, and systolic </span></span>
<span id="cb44-170"><a href="#cb44-170" aria-hidden="true" tabindex="-1"></a><span class="co">  blood pressure</span></span>
<span id="cb44-171"><a href="#cb44-171" aria-hidden="true" tabindex="-1"></a><span class="co">  S(3|Z) = exp(-exp(-8.4177 + 0.2358*Z1 + 0.5525*Z2 +  0.0810*Z3 - 0.0019*Z4)),</span></span>
<span id="cb44-172"><a href="#cb44-172" aria-hidden="true" tabindex="-1"></a><span class="co">  where Z1, Z2, Z3, and Z4 are ESVEA, sex, age, and systolic blood pressure, respectively.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-6" class="level4">
<h4 class="anchored" data-anchor-id="section-6">2.</h4>
<p><em>Compare the results with those of Exercise 2.4.</em></p>
<p>In Exercise 2.4, we obtained the following estimates of the coefficients for ESVEA, sex, age, and systolic blood pressure assuming the Cox model and almost identical estimates was found assuming a Poisson model</p>
<p><span class="math display">\[ \beta_{ESVEA} = 0.318284 \quad \beta_{sex} = 0.577585 \quad \beta_{age} = 0.076658   \quad \beta_{sbp} = 0.005152   \]</span></p>
<p>Thus, the models agree in the direction and in some degree the magnitude of the effect of ESVEA, sex, and age. The effect of systolic blood pressure is on the other hand estimated to have the opposite effect in the model using pseudo observations compared with the Cox and Poisson models. However, the effect of systolic blood pressure (and also ESVEA and sex) is not significant at a 0.05 level in the model based on pseudo values.</p>
</section>
</section>
<section id="exercise-6.4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.4">Exercise 6.4</h3>
<p><em>Consider the Copenhagen Holter study and the composite end-point strokefree survival.</em></p>
<section id="section-7" class="level4">
<h4 class="anchored" data-anchor-id="section-7">1.</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p><em>Fit, using pseudo-values a linear model for the 3-year restricted mean time to the composite event including the covariates ESVEA, sex, age, and systolic blood pressure.</em></p>
<p>The pseudo observations for the 3 year restricted mean time to the composite end-point are fitted using the <strong>pseudomean</strong> function from the <em>pseudo</em> package.</p>
<p>The values are then used as responses in the <strong>formula</strong> argument of the <strong>geese</strong> function.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-31_378518513da2d1c77ce4d30c754ed57f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the pseudo observations</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>pseudo641 <span class="ot">&lt;-</span> <span class="fu">pseudomean</span>(<span class="at">time =</span> chs_data<span class="sc">$</span>timestrokeordeath,<span class="at">event =</span> chs_data<span class="sc">$</span>strokeordeath, <span class="at">tmax =</span> <span class="dv">3</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting the GEE</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>fit641 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> pseudo641 <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> <span class="fu">subset</span>(chs_data, <span class="sc">!</span><span class="fu">is.na</span>(sbp)), <span class="at">mean.link =</span> <span class="st">"identity"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit641)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo641 ~ esvea + sex + age + sbp, data = subset(chs_data, 
    !is.na(sbp)), mean.link = "identity")

Mean Model:
 Mean Link:                 identity 
 Variance to Mean Relation: gaussian 

 Coefficients:
                 estimate       san.se        wald          p
(Intercept)  3.3551746975 0.2078355430 260.6097352 0.00000000
esvea       -0.0273741987 0.0527081358   0.2697289 0.60351367
sex         -0.0540324232 0.0352191476   2.3537005 0.12498600
age         -0.0073221791 0.0028486997   6.6067420 0.01015934
sbp          0.0005144224 0.0006748332   0.5810945 0.44588365

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
             estimate    san.se     wald            p
(Intercept) 0.1396737 0.0310223 20.27127 6.720211e-06

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   675   Maximum cluster size: 1 </code></pre>
</div>
</div>
<p>We get the following model for the 3-year restricted mean time to the composite end-point stroke-free survival</p>
<p><span class="math display">\[ \varepsilon(3|Z) = 3.355175 - 0.027374 \cdot Z_1 - 0.054032 \cdot Z_2 - 0.007322 \cdot Z_3 + 0.000514 \cdot Z_4,\]</span></p>
<p>where <span class="math inline">\(Z_1, Z_2, Z_3\)</span>, and <span class="math inline">\(Z_4\)</span> are ESVEA, sex, age, and systolic blood pressure, respectively.</p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-32_01e1ed3891b08f8fa32de0eeb2fff209">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudo observations for the 3 year restricted mean time to the composite end-point are computed using the pseudomean MACRO;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudomean(indata,time,dead,howmany,tmax,outdata);</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a> <span class="co">/* MACRO ARGUMENTS</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">      INDATA--NAME OF INPUT DATA SET</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME--NAME OF TIME VARIABLE</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">      DEAD--NAME OF EVENT INDICATOR VARIABLE--(1-DEAD,0-CENSORED)</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY--SAMPLE SIZE</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">      TMAX--UPPER LIMIT OF INTEGRATION FOR RESTRICTED MEAN</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">      OUTDATA--NAME OF OUTPUT DATA SET WITH PSEUDOVALUES FPR RESTRICTED</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">               MEAN IN VARIABLE "PSUMEAN"  */</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a> <span class="co">/* CREATE A DATA SET WHERE EVERYTHING ABOVE TMAX IS CENSORED */</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> work; <span class="kw">SET</span> <span class="kw">&amp;indata;</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  restime = <span class="fu">MIN</span>(<span class="kw">&amp;tmax,</span> <span class="kw">&amp;time)</span>;</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  resdead = <span class="kw">&amp;dead;</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">IF</span> restime EQ <span class="kw">&amp;tmax THEN</span> resdead = <span class="dv">0</span>;</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">/* CREATE DATA SET WITH SET OF INDICATORS DEADK THAT HAS MISSING VALUE</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co">     FOR KTH OBSERVATION, K=1,...,HOWMANY*/</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> work;  <span class="kw">SET</span> work;</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>   id+<span class="dv">1</span>;</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>   <span class="kw">ARRAY</span> iobs(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="kw">   DO</span> j = <span class="dv">1</span> <span class="kw">TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    iobs(j) = resdead;</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> j = id <span class="kw">THEN</span> iobs(j) = .;</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="kw">   END</span>;</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE RESTRICTED MEAN FOR COMPLETE SAMPLE USING PROC LIFETEST */</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="kw"> PROC</span> LIFETEST<span class="kw"> DATA</span> = work OUTSURV = km;</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">TIME</span> restime*resdead(<span class="dv">0</span>);</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>   ODS <span class="kw">SELECT</span> MEANS;</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>   ODS <span class="kw">OUTPUT</span> MEANS = mall;</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="kw"> RUN</span>;</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> km; <span class="kw">SET</span> km;</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> _CENSOR_ EQ <span class="dv">0</span>;</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="kw">  PROC</span> SORT<span class="kw"> DATA</span>=km;</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">BY</span> restime;</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a><span class="kw">  RUN</span>; </span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> km; <span class="kw">SET</span> km<span class="kw"> END</span>=LAST;</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> <span class="kw">NOT</span>(LAST) <span class="kw">THEN</span> <span class="kw">DELETE</span>;</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>    area = (<span class="kw">&amp;tmax </span>- restime)*survival;</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">KEEP</span> area;</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> psu; <span class="kw">MERGE</span> km mall;</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>    meanall = <span class="fu">mean</span> + area;</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">KEEP</span> meanall;</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a> <span class="kw">%DO</span> ip = <span class="dv">1</span> <span class="kw">%TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* COMPUTE RESTRICTED MEAN FOR SAMPLE WITH IPTH OBSERVATION DELETED</span></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a><span class="co">      USING PROC LIFETEST */</span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a><span class="kw">   PROC</span> LIFETEST<span class="kw"> DATA</span> = work OUTSURV = km1;</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>     <span class="fu">TIME</span> restime*dead<span class="kw">&amp;ip(</span><span class="dv">0</span>);</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>     ODS <span class="kw">SELECT</span> means;</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>     ODS <span class="kw">OUTPUT</span> MEANS = m1;</span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="kw">   RUN</span>;</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">SET</span> km1;</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>     <span class="kw">IF</span> _CENSOR_ EQ <span class="dv">0</span>;</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a><span class="kw">   PROC</span> SORT<span class="kw"> DATA</span> = km1;</span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>     <span class="kw">BY</span> restime;</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a><span class="kw">   RUN</span>;</span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">SET</span> km1<span class="kw"> END</span>=LAST;</span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>     <span class="kw">IF</span> <span class="kw">NOT</span>(LAST) <span class="kw">THEN</span> <span class="kw">DELETE</span>;</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>     area = (<span class="kw">&amp;tmax </span>- restime)*survival;</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>     <span class="kw">KEEP</span> area;</span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">MERGE</span> km1 m1;</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span> = <span class="fu">mean</span> + area;</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>     <span class="kw">KEEP</span> <span class="fu">mean</span>;</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* COMPUTE PSEUDOVALUE FOR IPTH OBSERVATION*/</span></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> psu; <span class="kw">MERGE</span> psu km1;</span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>     psu<span class="kw">&amp;ip=&amp;howmany*</span>meanall-(<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*<span class="fu">mean</span>;</span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a> <span class="kw">%END</span>;</span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a> <span class="co">/* TRANSPOSE DATASET AND MERGE WITH RAW DATA*/</span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> out;  <span class="kw">SET</span> psu;</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>   <span class="kw">ARRAY</span> y(<span class="kw">&amp;howmany)</span> psu1-psu<span class="kw">&amp;howmany;</span></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a><span class="kw">   DO</span> j = <span class="dv">1</span> <span class="kw">TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>     psumean=y(j);</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>     <span class="kw">OUTPUT</span>;</span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a><span class="kw">   END</span>;</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a> <span class="kw">KEEP</span> psumean;</span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> <span class="kw">&amp;outdata;</span> <span class="kw">MERGE</span> <span class="kw">&amp;indata </span>out;</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a><span class="kw"> run</span>; </span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a><span class="kw">%MEND</span>;</span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudomean MACRO is now called with 'chs_data', 'timestrokeordeath', 'strokeordeath', '678'. '3' and 'outdatadata641' </span></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a><span class="co">  as arguments;</span></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a><span class="co">* The MACRO returns a data set 'outdata641' where the pseudo observations are stored in the column 'psumean'.;</span></span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.4.1'</span>;</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>%pseudomean(chs_data, timestrokeordeath, strokeordeath, 678, 3, outdata641);</span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a><span class="co">* The model is then fitted with the genmod procedure;</span> </span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata641;</span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> psumean=esvea sex age sbp /dist=<span class="fu">normal</span>;</span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a><span class="co">* We get the following model for the 3-year restricted mean time to the composite end-point stroke-free survival</span></span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a><span class="co">  epsilon(3|Z) = 3.3552 - 0.0274*Z1 - 0.0540*Z2 - 0.0073*Z3 + 0.0005*Z4,</span></span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a><span class="co">  where Z1, Z2, Z3, and Z4 are ESVEA, sex, age, and systolic blood pressure, respectively.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-8" class="level4">
<h4 class="anchored" data-anchor-id="section-8">2.</h4>
<p><em>Compare with the results of Exercise 4.3.</em></p>
<p>The model obtained in Exercise 4.3 is identical to the model fitted using pseudo observations. This is because none of the subjects are censored before 3 years and the pseudo observation for subject <span class="math inline">\(i\)</span> is thus <span class="math inline">\(\min(3,T_i)\)</span> where <span class="math inline">\(T_i\)</span> is the time of stroke or death without stroke for subject <span class="math inline">\(i\)</span>.</p>
</section>
</section>
<section id="exercise-6.5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.5">Exercise 6.5</h3>
<p><em>Consider the competing outcomes stroke and death without stroke in the Copenhagen Holter study.</em></p>
<section id="section-9" class="level4">
<h4 class="anchored" data-anchor-id="section-9">1.</h4>
<p><em>Fit, using pseudo-values, a cloglog-model for the cumulative incidences at 3 years including ESVEA, sex, age, and systolic blood pressure.</em></p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>To estimate the cumulative incidences at 3 years we will first create a variable called <strong>event</strong> where 1 indicates stroke, 2 indicates death without stroke and 0 indicates censoring.</p>
<p>The pseudo observations for the cumulative incidences are then computed using the <strong>pseudoci</strong> function from the <em>pseudo</em> package. The output <strong>pseudo</strong> is a list of two cmponents; the first containing the pseudo observation for cause 1 (stroke) and the second containing the pseudo observations for cause 2 (death without stroke). The pseudo observations are stored as <strong>pseudo651_stroke</strong> and <strong>pseudo651_death</strong>, respectively.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-33_da529c754e7fb31c841c5c99032b7b2e">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Status indicator for death without stroke</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>death_wo_stroke <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(chs_data<span class="sc">$</span>stroke <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, chs_data<span class="sc">$</span>death)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Event variable</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(chs_data<span class="sc">$</span>death_wo_stroke <span class="sc">==</span> <span class="dv">0</span>, chs_data<span class="sc">$</span>stroke, chs_data<span class="sc">$</span>death_wo_stroke<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the pseudo observations</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>pseudo651 <span class="ot">&lt;-</span> <span class="fu">pseudoci</span>(<span class="at">time =</span> chs_data<span class="sc">$</span>timestrokeordeath, <span class="at">event =</span> chs_data<span class="sc">$</span>event, <span class="at">tmax =</span> <span class="dv">3</span>)<span class="sc">$</span>pseudo</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pseudo651_stroke =</span> pseudo651[[<span class="dv">1</span>]],</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">pseudo651_death =</span> pseudo651[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then fit a cloglog model for the cumulative incidence of stroke at 3 years using the <strong>geese</strong> function.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-34_1d52aa6fcec4a5833d0dac12628cae85">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting GEE for the end-point stroke</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>fit651_stroke <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> pseudo651_stroke <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> <span class="fu">subset</span>(chs_data, <span class="sc">!</span><span class="fu">is.na</span>(sbp)), <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit651_stroke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo651_stroke ~ esvea + sex + age + sbp, data = subset(chs_data, 
    !is.na(sbp)), mean.link = "cloglog")

Mean Model:
 Mean Link:                 cloglog 
 Variance to Mean Relation: gaussian 

 Coefficients:
                estimate      san.se         wald           p
(Intercept) -13.22924598 4.176619986 10.032756198 0.001537808
esvea         0.03121341 0.735520028  0.001800916 0.966150174
sex           0.97102501 0.750193280  1.675384486 0.195538876
age           0.11987793 0.060010682  3.990445009 0.045758977
sbp           0.00402910 0.007673721  0.275679233 0.599547288

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
              estimate      san.se     wald            p
(Intercept) 0.01706673 0.004691019 13.23629 0.0002745808

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    1 
Number of clusters:   675   Maximum cluster size: 1 </code></pre>
</div>
</div>
<p>Thus, we obtain the following model for the cumulative incidence of stroke at 3 years <span class="math display">\[ F_{stroke}(3|Z) = 1 - \exp(-\exp(-13.229246 + 0.031213\cdot Z_1\]</span> <span class="math display">\[+ 0.971025 \cdot Z_2 + 0.119878 \cdot Z_3  + 0.004029\cdot Z_4)),\]</span> where <span class="math inline">\(Z_1, Z_2, Z_3\)</span>, and <span class="math inline">\(Z_4\)</span> are ESVEA, sex, age, and systolic blood pressure, respectively.</p>
<p>Likewise, we will fit a model for the cumulative incidence of death without stroke at 3 years</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-35_2526b12b45bdceb8362522d4d748ccb5">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fit651_death <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> pseudo651_death <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> <span class="fu">subset</span>(chs_data, <span class="sc">!</span><span class="fu">is.na</span>(sbp)), <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit651_death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo651_death ~ esvea + sex + age + sbp, data = subset(chs_data, 
    !is.na(sbp)), mean.link = "cloglog")

Mean Model:
 Mean Link:                 cloglog 
 Variance to Mean Relation: gaussian 

 Coefficients:
               estimate     san.se      wald          p
(Intercept) -3.18491794 4.09532929 0.6048098 0.43674872
esvea        0.33067549 0.93749873 0.1244121 0.72429761
sex          1.20812564 0.75670860 2.5489826 0.11036531
age          0.07407931 0.05731313 1.6706507 0.19617140
sbp         -0.04396479 0.01864246 5.5616450 0.01835816

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
              estimate      san.se     wald            p
(Intercept) 0.02840673 0.006072949 21.87979 2.902748e-06

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    1 
Number of clusters:   675   Maximum cluster size: 1 </code></pre>
</div>
</div>
<p>We obtain the following model for the cumulative incidence of death without stroke at 3 years</p>
<p><span class="math display">\[ F_{death}(3|Z) = 1 - \exp(-\exp(-3.184918 + 0.330675\cdot Z_1 + 1.208126 \cdot Z_2\]</span> <span class="math display">\[+ 0.074079 \cdot Z_3  - 0.043965\cdot Z_4)),\]</span></p>
<p>where <span class="math inline">\(Z_1, Z_2, Z_3\)</span>, and <span class="math inline">\(Z_4\)</span> are ESVEA, sex, age, and systolic blood pressure, respectively.</p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-36_c375a318b261e7e92e151741a3094ca6">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudo observations for the cumulative incidences of stroke and death without stroke at three years are computed using the  pseudoci MACRO. To use this MACRO we must remember to include the cuminc MACRO.;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> cuminc(datain,x,re,de,dataout,cir,cid);</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">/*  THIS MACRO COMPUTES THE CUMULATIVE INCIDENCE FUNCTIONS FOR</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">    BOTH COMPETING RISKS USING PROC PHREG OUTPUT</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">    INPUTS TO MACRO</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">    DATAIN--NAME OF INPUT DATA SET CONTAINING </span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">        X--TIME TO EVENT</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">        RE--INDICATOR OF FIRST COMPETING RISK (1-YES, 0-NO)</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">        DE--INDICATOR OF SECOND COMPETING RISK</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">    DATAOUT--NAME OF OUTPUT DATA SET CONTAINING</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">        CIR--CUMULATIVE INCIDENCE FUNCTION FOR 1ST COMPETING RISK</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">        CID--CUMULATIVE INCIDENCE FUNCTION FOR 2ST COMPETING RISK</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> work;  <span class="kw">set</span> <span class="kw">&amp;datain;</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>t=<span class="kw">&amp;x;</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>r=<span class="kw">&amp;re;</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>d=<span class="kw">&amp;de;</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>zero=<span class="dv">0</span>;</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CRUDE CUMUALTIVE HAZARD FOR FIRST COMPETING RISK */</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=work noprint; </span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> t*r(<span class="dv">0</span>)=zero;</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span> out=rel  logsurv=chr  /method=emp;</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE CRUDE CUMUALTIVE HAZARD FOR SECOND COMPETING RISK */</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=work noprint; </span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> t*d(<span class="dv">0</span>)=zero;</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span> out=dead  logsurv=chd  /method=emp;</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE cumualtive incidence */</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> both;  <span class="kw">merge</span> rel dead;  <span class="kw">by</span> t;</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> s <span class="dv">1</span></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cr <span class="dv">0</span>;</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cd <span class="dv">0</span>;</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cumincr <span class="dv">0</span>;</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cumincd <span class="dv">0</span>;</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>hr=-(cr+chr);</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>hd=-(cd+chd);</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a><span class="co">/* NOTE HR AND HD ARE THE JUMPS IN THE CUMUALTIVE CRUDE HAZARDS AT THIS TIME */</span></span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>cr=-chr;</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>cd=-chd;</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>cir=cumincr+hr*s;</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>cumincr=cir;</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>cid=cumincd+hd*s;</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>cumincd=cid;</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>s=s*(<span class="dv">1</span>-hr-hd);</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a><span class="co">/* NOTE S IS KAPLAN-MEIER ESTIMATE IGNORING CAUSE OF FAILURE */</span></span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">&amp;dataout;</span>  <span class="kw">set</span> both;</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;x=</span>t;</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;cir=</span>cir;  <span class="kw">&amp;cid=</span>cid;</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;x &amp;cir &amp;cid;</span></span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span>;</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudoci(datain,x,r,d,howmany,datatau,dataout);</span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a><span class="co">/*    MACRO COMPUTES PSEUDOVALUES BASED ON THE CUMUALTIVE INCIDENCE FUNCTION</span></span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a><span class="co">      FOR BOTH OF TWO COMPETING RISKS  </span></span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME</span></span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true" tabindex="-1"></a><span class="co">      INPUTS:</span></span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true" tabindex="-1"></a><span class="co">      DATAIN---INPUT DATA SET</span></span>
<span id="cb53-68"><a href="#cb53-68" aria-hidden="true" tabindex="-1"></a><span class="co">      X--TIME VARIABLE</span></span>
<span id="cb53-69"><a href="#cb53-69" aria-hidden="true" tabindex="-1"></a><span class="co">      R--INDICATOR OF FIRST COMPETING RISK (1-YES, 0-NO)</span></span>
<span id="cb53-70"><a href="#cb53-70" aria-hidden="true" tabindex="-1"></a><span class="co">      D--INDICATOR OF SECOND COMPETING RISK</span></span>
<span id="cb53-71"><a href="#cb53-71" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY---SAMPLE SIZE</span></span>
<span id="cb53-72"><a href="#cb53-72" aria-hidden="true" tabindex="-1"></a><span class="co">     </span></span>
<span id="cb53-73"><a href="#cb53-73" aria-hidden="true" tabindex="-1"></a><span class="co">      DATATAU---SUBSET OF INPUT DATA SET AT WHICH PSEUDO VALUES ARE COMPUTED </span></span>
<span id="cb53-74"><a href="#cb53-74" aria-hidden="true" tabindex="-1"></a><span class="co">                DATA SET HAS SINGLE VARIABLE "TIME"</span></span>
<span id="cb53-75"><a href="#cb53-75" aria-hidden="true" tabindex="-1"></a><span class="co">                </span></span>
<span id="cb53-76"><a href="#cb53-76" aria-hidden="true" tabindex="-1"></a><span class="co">      DATAOUT---OUTPUT DATA SET WHICH CONATINS PSUK,K=1,...,HOWMANY THE PSEUDO</span></span>
<span id="cb53-77"><a href="#cb53-77" aria-hidden="true" tabindex="-1"></a><span class="co">                VALUES AT EACH TIME POINT (Note output data set</span></span>
<span id="cb53-78"><a href="#cb53-78" aria-hidden="true" tabindex="-1"></a><span class="co">                 includes orginal data sorted by time)</span></span>
<span id="cb53-79"><a href="#cb53-79" aria-hidden="true" tabindex="-1"></a><span class="co">      </span></span>
<span id="cb53-80"><a href="#cb53-80" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb53-81"><a href="#cb53-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-82"><a href="#cb53-82" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datain;</span>  <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb53-83"><a href="#cb53-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-84"><a href="#cb53-84" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">keep</span>;  <span class="kw">set</span> <span class="kw">&amp;datatau;</span></span>
<span id="cb53-85"><a href="#cb53-85" aria-hidden="true" tabindex="-1"></a>find=<span class="dv">1</span>;</span>
<span id="cb53-86"><a href="#cb53-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-87"><a href="#cb53-87" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb53-88"><a href="#cb53-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-89"><a href="#cb53-89" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">set</span> <span class="kw">&amp;datain;</span></span>
<span id="cb53-90"><a href="#cb53-90" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;x;</span></span>
<span id="cb53-91"><a href="#cb53-91" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span>=<span class="dv">1</span>;</span>
<span id="cb53-92"><a href="#cb53-92" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">merge</span> <span class="fu">point</span> <span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb53-93"><a href="#cb53-93" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> find <span class="kw">keep</span>;</span>
<span id="cb53-94"><a href="#cb53-94" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb53-95"><a href="#cb53-95" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> useme;  <span class="kw">set</span> <span class="fu">point</span>;</span>
<span id="cb53-96"><a href="#cb53-96" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> temp -<span class="dv">1</span>;</span>
<span id="cb53-97"><a href="#cb53-97" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">keep</span> = <span class="dv">1</span> <span class="kw">then</span> temp=<span class="fu">time</span>;</span>
<span id="cb53-98"><a href="#cb53-98" aria-hidden="true" tabindex="-1"></a>tuse=temp; </span>
<span id="cb53-99"><a href="#cb53-99" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb53-100"><a href="#cb53-100" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;x=</span>tuse;</span>
<span id="cb53-101"><a href="#cb53-101" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb53-102"><a href="#cb53-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-103"><a href="#cb53-103" aria-hidden="true" tabindex="-1"></a><span class="co">/* PREPARE DATA SET WITH MISSING VALUES FOR DEADK AND RELAPSEK TO BE USED IN COMPUTING</span></span>
<span id="cb53-104"><a href="#cb53-104" aria-hidden="true" tabindex="-1"></a><span class="co">   ESTIMATED CUMULATIVE INCIDENCE WITH KTH OBSERVATION DELETED*/</span></span>
<span id="cb53-105"><a href="#cb53-105" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datain;</span></span>
<span id="cb53-106"><a href="#cb53-106" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb53-107"><a href="#cb53-107" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> newdat;  <span class="kw">set</span> <span class="kw">&amp;datain </span>;</span>
<span id="cb53-108"><a href="#cb53-108" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb53-109"><a href="#cb53-109" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobsd(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb53-110"><a href="#cb53-110" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobsr(<span class="kw">&amp;howmany)</span> relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb53-111"><a href="#cb53-111" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb53-112"><a href="#cb53-112" aria-hidden="true" tabindex="-1"></a>iobsd(j)=<span class="kw">&amp;d;</span></span>
<span id="cb53-113"><a href="#cb53-113" aria-hidden="true" tabindex="-1"></a>iobsr(j)=<span class="kw">&amp;r;</span></span>
<span id="cb53-114"><a href="#cb53-114" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> j=id <span class="kw">then do</span>; iobsr(j)=.; iobsd(j)=.<span class="kw">; end</span>;</span>
<span id="cb53-115"><a href="#cb53-115" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb53-116"><a href="#cb53-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-117"><a href="#cb53-117" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> newdat;</span>
<span id="cb53-118"><a href="#cb53-118" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> dead1-dead<span class="kw">&amp;howmany </span>relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb53-119"><a href="#cb53-119" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CI FOR 1ST (CIRALL) AND 2ND (CIDALL) FOR FULL SAMPLE, STORE IN SALL*/</span></span>
<span id="cb53-120"><a href="#cb53-120" aria-hidden="true" tabindex="-1"></a>%cuminc(newdat,&amp;x,&amp;r,&amp;d,sall,cirall,cidall);</span>
<span id="cb53-121"><a href="#cb53-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-122"><a href="#cb53-122" aria-hidden="true" tabindex="-1"></a><span class="kw">%do</span> ip=<span class="dv">1</span> <span class="kw">%to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb53-123"><a href="#cb53-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-124"><a href="#cb53-124" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CI FOR 1ST (CIRALL) AND 2ND (CIDALL) FOR REDUCED SAMPLE, STORE IN SIP*/</span></span>
<span id="cb53-125"><a href="#cb53-125" aria-hidden="true" tabindex="-1"></a>%cuminc(newdat,&amp;x,relapse&amp;ip,dead&amp;ip,stemp,cir1,cid1);</span>
<span id="cb53-126"><a href="#cb53-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-127"><a href="#cb53-127" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE PSEUDOVALUES FOR BOTH RISK AT EVERY DATA POINT AND ADD TO FILE */</span> </span>
<span id="cb53-128"><a href="#cb53-128" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> ps; <span class="kw">merge</span> sall stemp;  <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb53-129"><a href="#cb53-129" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cirtemp <span class="dv">0</span>;</span>
<span id="cb53-130"><a href="#cb53-130" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cidtemp <span class="dv">0</span>;</span>
<span id="cb53-131"><a href="#cb53-131" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> cir1=. <span class="kw">then</span> cir1=cirtemp;</span>
<span id="cb53-132"><a href="#cb53-132" aria-hidden="true" tabindex="-1"></a>cirtemp=cir1;</span>
<span id="cb53-133"><a href="#cb53-133" aria-hidden="true" tabindex="-1"></a>rpsu<span class="kw">&amp;ip=&amp;howmany*</span>cirall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*cir1;</span>
<span id="cb53-134"><a href="#cb53-134" aria-hidden="true" tabindex="-1"></a> <span class="kw">if</span> cid1=. <span class="kw">then</span> cid1=cidtemp;</span>
<span id="cb53-135"><a href="#cb53-135" aria-hidden="true" tabindex="-1"></a>cidtemp=cid1;</span>
<span id="cb53-136"><a href="#cb53-136" aria-hidden="true" tabindex="-1"></a>dpsu<span class="kw">&amp;ip=&amp;howmany*</span>cidall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*cid1;</span>
<span id="cb53-137"><a href="#cb53-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-138"><a href="#cb53-138" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out; <span class="kw">merge</span> out ps useme; <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb53-139"><a href="#cb53-139" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb53-140"><a href="#cb53-140" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> rpsu1-rpsu<span class="kw">&amp;ip </span>dpsu1-dpsu<span class="kw">&amp;ip &amp;x;</span></span>
<span id="cb53-141"><a href="#cb53-141" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb53-142"><a href="#cb53-142" aria-hidden="true" tabindex="-1"></a><span class="kw">%end</span>;</span>
<span id="cb53-143"><a href="#cb53-143" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb53-144"><a href="#cb53-144" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> <span class="kw">&amp;dataout;</span>  <span class="kw">set</span> newdat; </span>
<span id="cb53-145"><a href="#cb53-145" aria-hidden="true" tabindex="-1"></a> <span class="kw">drop</span> dead1-dead<span class="kw">&amp;howmany </span>relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb53-146"><a href="#cb53-146" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb53-147"><a href="#cb53-147" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> all;  <span class="kw">set</span> out;</span>
<span id="cb53-148"><a href="#cb53-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-149"><a href="#cb53-149" aria-hidden="true" tabindex="-1"></a> <span class="kw">array</span> yr(<span class="kw">&amp;howmany)</span> rpsu1-rpsu<span class="kw">&amp;howmany;</span></span>
<span id="cb53-150"><a href="#cb53-150" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> yd(<span class="kw">&amp;howmany)</span> dpsu1-dpsu<span class="kw">&amp;howmany;</span></span>
<span id="cb53-151"><a href="#cb53-151" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb53-152"><a href="#cb53-152" aria-hidden="true" tabindex="-1"></a>rpseudo=yr(j);</span>
<span id="cb53-153"><a href="#cb53-153" aria-hidden="true" tabindex="-1"></a>dpseudo=yd(j);</span>
<span id="cb53-154"><a href="#cb53-154" aria-hidden="true" tabindex="-1"></a>id=j;</span>
<span id="cb53-155"><a href="#cb53-155" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span>;</span>
<span id="cb53-156"><a href="#cb53-156" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb53-157"><a href="#cb53-157" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">time</span> rpseudo dpseudo;</span>
<span id="cb53-158"><a href="#cb53-158" aria-hidden="true" tabindex="-1"></a><span class="kw"> proc</span> sort<span class="kw"> data</span>=all;  <span class="kw">by</span> id;</span>
<span id="cb53-159"><a href="#cb53-159" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> <span class="kw">&amp;dataout;</span> <span class="kw">merge</span> <span class="kw">&amp;dataout </span>all;</span>
<span id="cb53-160"><a href="#cb53-160" aria-hidden="true" tabindex="-1"></a> <span class="kw">by</span> id;</span>
<span id="cb53-161"><a href="#cb53-161" aria-hidden="true" tabindex="-1"></a> <span class="kw">retain</span> otime -<span class="dv">1</span>;</span>
<span id="cb53-162"><a href="#cb53-162" aria-hidden="true" tabindex="-1"></a> <span class="kw">retain</span> oid -<span class="dv">1</span>;</span>
<span id="cb53-163"><a href="#cb53-163" aria-hidden="true" tabindex="-1"></a> <span class="kw">if</span> id eq oid <span class="kw">and</span> otime=<span class="fu">time</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb53-164"><a href="#cb53-164" aria-hidden="true" tabindex="-1"></a> <span class="kw">else do</span>; oid=id; otime=<span class="fu">time</span><span class="kw">; end</span>;</span>
<span id="cb53-165"><a href="#cb53-165" aria-hidden="true" tabindex="-1"></a> <span class="kw">%mend</span>;</span>
<span id="cb53-166"><a href="#cb53-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-167"><a href="#cb53-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-168"><a href="#cb53-168" aria-hidden="true" tabindex="-1"></a><span class="co">* We must create a variable for the end-point death without stroke;</span></span>
<span id="cb53-169"><a href="#cb53-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-170"><a href="#cb53-170" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb53-171"><a href="#cb53-171" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb53-172"><a href="#cb53-172" aria-hidden="true" tabindex="-1"></a>    death_wo_stroke = death;</span>
<span id="cb53-173"><a href="#cb53-173" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stroke = <span class="dv">1</span> <span class="kw">then</span> death_wo_stroke = <span class="dv">0</span>;</span>
<span id="cb53-174"><a href="#cb53-174" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb53-175"><a href="#cb53-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-176"><a href="#cb53-176" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudoci MACRO is called with 'chs_data', 'timestrokeordeath', 'stroke', 'death_wo_stroke', '678'. 'timepoint' and 'outdatadata661'</span></span>
<span id="cb53-177"><a href="#cb53-177" aria-hidden="true" tabindex="-1"></a><span class="co">  as arguments;</span></span>
<span id="cb53-178"><a href="#cb53-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-179"><a href="#cb53-179" aria-hidden="true" tabindex="-1"></a><span class="co">* The MACRO returns a data set 'outdata661' where the pseudo observations for the end-point stroke are stored in the column 'rpseudo'</span></span>
<span id="cb53-180"><a href="#cb53-180" aria-hidden="true" tabindex="-1"></a><span class="co">  and the pseudo observations for death without stroke are stored in the column 'dpseudo'.;</span></span>
<span id="cb53-181"><a href="#cb53-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-182"><a href="#cb53-182" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.6.1'</span>;</span>
<span id="cb53-183"><a href="#cb53-183" aria-hidden="true" tabindex="-1"></a> %pseudoci(chs_data, timestrokeordeath, stroke, death_wo_stroke, 678, timepoint, outdata661);</span>
<span id="cb53-184"><a href="#cb53-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-185"><a href="#cb53-185" aria-hidden="true" tabindex="-1"></a><span class="co">* We fit a cloglog model for the cumulative incidence of stroke with the genmod procedure where we specify the 'fwdlink' and 'invlink' </span></span>
<span id="cb53-186"><a href="#cb53-186" aria-hidden="true" tabindex="-1"></a><span class="co">  statements;</span></span>
<span id="cb53-187"><a href="#cb53-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-188"><a href="#cb53-188" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.5.1 - stroke'</span>;</span>
<span id="cb53-189"><a href="#cb53-189" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata661;</span>
<span id="cb53-190"><a href="#cb53-190" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb53-191"><a href="#cb53-191" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=<span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb53-192"><a href="#cb53-192" aria-hidden="true" tabindex="-1"></a>    invlink ilink= <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb53-193"><a href="#cb53-193" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> rpseudo= esvea sex age sbp /dist=<span class="fu">normal</span>  noscale ; </span>
<span id="cb53-194"><a href="#cb53-194" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb53-195"><a href="#cb53-195" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb53-196"><a href="#cb53-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-197"><a href="#cb53-197" aria-hidden="true" tabindex="-1"></a><span class="co">* Thus, we obtain the following model for the cumulative incidence of stroke at 3 years</span></span>
<span id="cb53-198"><a href="#cb53-198" aria-hidden="true" tabindex="-1"></a><span class="co">  F_stroke(3|Z) = 1 - exp(-exp(-13.2294 + 0.0312*Z1 + 0.9711*Z2 + 0.1199*Z3  + 0.0040*Z4)),  </span></span>
<span id="cb53-199"><a href="#cb53-199" aria-hidden="true" tabindex="-1"></a><span class="co">  where Z1, Z2, Z3, and Z4 are ESVEA, sex, age, and systolic blood pressure, respectively.;</span></span>
<span id="cb53-200"><a href="#cb53-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-201"><a href="#cb53-201" aria-hidden="true" tabindex="-1"></a><span class="co">* Likewise, we will fit a model for the cumulative incidence of death without stroke at 3 years;</span></span>
<span id="cb53-202"><a href="#cb53-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-203"><a href="#cb53-203" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.5.1 - death without stroke'</span>;</span>
<span id="cb53-204"><a href="#cb53-204" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata661;</span>
<span id="cb53-205"><a href="#cb53-205" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb53-206"><a href="#cb53-206" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=<span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb53-207"><a href="#cb53-207" aria-hidden="true" tabindex="-1"></a>    invlink ilink= <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb53-208"><a href="#cb53-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo= esvea sex age sbp /dist=<span class="fu">normal</span> noscale ; </span>
<span id="cb53-209"><a href="#cb53-209" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb53-210"><a href="#cb53-210" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb53-211"><a href="#cb53-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-212"><a href="#cb53-212" aria-hidden="true" tabindex="-1"></a><span class="co">* We obtain the following model for the cumulative incidence of death without stroke at 3 years</span></span>
<span id="cb53-213"><a href="#cb53-213" aria-hidden="true" tabindex="-1"></a><span class="co">  F_death(3|Z) = 1 - exp(-exp(-3.3924 + 0.2862*Z1 + 1.2618*Z2 + 0.0771*Z3 - 0.0442*Z4)), </span></span>
<span id="cb53-214"><a href="#cb53-214" aria-hidden="true" tabindex="-1"></a><span class="co">  where Z1, Z2, Z3, and Z4 are ESVEA, sex, age, and systolic blood pressure, respectively.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-10" class="level4">
<h4 class="anchored" data-anchor-id="section-10">2.</h4>
<p><em>Compare with the results of Exercises 4.4 and 5.8.</em></p>
<p>In Exercise 4.5, we used Fine-Gray models to estimate the cumulative incidence functions for stroke and death without stroke. For the end-point stroke we obtained the following coefficients</p>
<p><span class="math display">\[ \beta_{ESVEA} = 0.593921   \quad \beta_{sex} = 0.379189   \quad \beta_{age} = 0.063347   \quad \beta_{sbp} = 0.010629,     \]</span></p>
<p>and for death without stroke we obtained the following coefficients</p>
<p><span class="math display">\[ \beta_{ESVEA} = -0.006269     \quad \beta_{sex} = 0.530219     \quad \beta_{age} = 0.066495       \quad \beta_{sbp} = 0.001601.\]</span></p>
<p>The estimates of the coefficients are quite different for the Fine-Gray model and the model based on pseudo observations for both end-points. This is likely due to the fact that the Fine-Gray model assumes that the linear predictor has the same association with the cumulative incidence at all time points. We also notice that only one of the covariates in each model using pseudo values (age in the case of stroke and systolic blood pressure in the case of death without stroke) are associated with <span class="math inline">\(p\)</span>-values smaller than 0.05.</p>
<p>Comparison with Exercise 5.8 is not meaningful - sorry!</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch5.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch7.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</div>   
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a> and <a href="https://posit.co/products/open-source/rstudio/">RStudio</a></div>
  </div>
</footer>



</body></html>