<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models for Multi-State Survival Data - 6&nbsp; Pseudo-values</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch7.html" rel="next">
<link href="./Ch5.html" rel="prev">
<link href="./corvos.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./MSBfrontbirds.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/multi-state-book/companion" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./errata.html" class="sidebar-item-text sidebar-link">Errata</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pbc3-trial-in-liver-cirrhosis" id="toc-pbc3-trial-in-liver-cirrhosis" class="nav-link active" data-scroll-target="#pbc3-trial-in-liver-cirrhosis">PBC3 trial in liver cirrhosis</a>
  <ul>
  <li><a href="#read-data-and-sas-macro" id="toc-read-data-and-sas-macro" class="nav-link" data-scroll-target="#read-data-and-sas-macro">Read data and SAS macro</a></li>
  <li><a href="#figure-6.1" id="toc-figure-6.1" class="nav-link" data-scroll-target="#figure-6.1">Figure 6.1</a></li>
  <li><a href="#figure-6.2" id="toc-figure-6.2" class="nav-link" data-scroll-target="#figure-6.2">Figure 6.2</a></li>
  <li><a href="#figure-6.3" id="toc-figure-6.3" class="nav-link" data-scroll-target="#figure-6.3">Figure 6.3</a></li>
  <li><a href="#figure-6.4" id="toc-figure-6.4" class="nav-link" data-scroll-target="#figure-6.4">Figure 6.4</a></li>
  <li><a href="#table-6.1" id="toc-table-6.1" class="nav-link" data-scroll-target="#table-6.1">Table 6.1</a></li>
  <li><a href="#figure-6.5" id="toc-figure-6.5" class="nav-link" data-scroll-target="#figure-6.5">Figure 6.5</a></li>
  <li><a href="#table-6.2" id="toc-table-6.2" class="nav-link" data-scroll-target="#table-6.2">Table 6.2</a></li>
  <li><a href="#figure-6.6" id="toc-figure-6.6" class="nav-link" data-scroll-target="#figure-6.6">Figure 6.6</a></li>
  <li><a href="#figure-6.7" id="toc-figure-6.7" class="nav-link" data-scroll-target="#figure-6.7">Figure 6.7</a></li>
  <li><a href="#table-6.3" id="toc-table-6.3" class="nav-link" data-scroll-target="#table-6.3">Table 6.3</a></li>
  <li><a href="#figure-6.8" id="toc-figure-6.8" class="nav-link" data-scroll-target="#figure-6.8">Figure 6.8</a></li>
  <li><a href="#figure-6.9" id="toc-figure-6.9" class="nav-link" data-scroll-target="#figure-6.9">Figure 6.9</a></li>
  <li><a href="#table-6.4" id="toc-table-6.4" class="nav-link" data-scroll-target="#table-6.4">Table 6.4</a></li>
  <li><a href="#in-text-p.-233-cloglog-link-function---year-123" id="toc-in-text-p.-233-cloglog-link-function---year-123" class="nav-link" data-scroll-target="#in-text-p.-233-cloglog-link-function---year-123">In-text, p.&nbsp;233: cloglog link function - year 1,2,3</a></li>
  <li><a href="#table-6.5" id="toc-table-6.5" class="nav-link" data-scroll-target="#table-6.5">Table 6.5</a></li>
  <li><a href="#table-6.6" id="toc-table-6.6" class="nav-link" data-scroll-target="#table-6.6">Table 6.6</a></li>
  <li><a href="#figure-6.12" id="toc-figure-6.12" class="nav-link" data-scroll-target="#figure-6.12">Figure 6.12</a></li>
  </ul></li>
  <li><a href="#prova-trial-in-liver-cirrhosis" id="toc-prova-trial-in-liver-cirrhosis" class="nav-link" data-scroll-target="#prova-trial-in-liver-cirrhosis">PROVA trial in liver cirrhosis</a>
  <ul>
  <li><a href="#figure-6.10" id="toc-figure-6.10" class="nav-link" data-scroll-target="#figure-6.10">Figure 6.10</a></li>
  <li><a href="#table-6.7" id="toc-table-6.7" class="nav-link" data-scroll-target="#table-6.7">Table 6.7</a></li>
  </ul></li>
  <li><a href="#leader-cardiovascular-trial-in-type-2-diabetes" id="toc-leader-cardiovascular-trial-in-type-2-diabetes" class="nav-link" data-scroll-target="#leader-cardiovascular-trial-in-type-2-diabetes">LEADER cardiovascular trial in type 2 diabetes</a>
  <ul>
  <li><a href="#figure-6.11" id="toc-figure-6.11" class="nav-link" data-scroll-target="#figure-6.11">Figure 6.11</a></li>
  <li><a href="#table-6.8" id="toc-table-6.8" class="nav-link" data-scroll-target="#table-6.8">Table 6.8</a></li>
  <li><a href="#in-text-p.-236-test-for-beta_r-beta_s-00" id="toc-in-text-p.-236-test-for-beta_r-beta_s-00" class="nav-link" data-scroll-target="#in-text-p.-236-test-for-beta_r-beta_s-00">In-text, p.&nbsp;236: Test for <span class="math inline">\((\beta_R, \beta_S) = (0,0)\)</span></a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#exercise-6.1" id="toc-exercise-6.1" class="nav-link" data-scroll-target="#exercise-6.1">Exercise 6.1 (*)</a>
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">1.</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">2.</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">3.</a></li>
  </ul></li>
  <li><a href="#exercise-6.2" id="toc-exercise-6.2" class="nav-link" data-scroll-target="#exercise-6.2">Exercise 6.2 (*)</a>
  <ul>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3">1.</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4">2.</a></li>
  </ul></li>
  <li><a href="#exercise-6.3" id="toc-exercise-6.3" class="nav-link" data-scroll-target="#exercise-6.3">Exercise 6.3</a>
  <ul>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5">1.</a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6">2.</a></li>
  </ul></li>
  <li><a href="#exercise-6.4" id="toc-exercise-6.4" class="nav-link" data-scroll-target="#exercise-6.4">Exercise 6.4</a>
  <ul>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7">1.</a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8">2.</a></li>
  </ul></li>
  <li><a href="#exercise-6.5" id="toc-exercise-6.5" class="nav-link" data-scroll-target="#exercise-6.5">Exercise 6.5</a>
  <ul>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9">1.</a></li>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10">2.</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/multi-state-book/companion/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Show/hide all code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="pbc3-trial-in-liver-cirrhosis" class="level2">
<h2 class="anchored" data-anchor-id="pbc3-trial-in-liver-cirrhosis">PBC3 trial in liver cirrhosis</h2>
<section id="read-data-and-sas-macro" class="level3">
<h3 class="anchored" data-anchor-id="read-data-and-sas-macro">Read data and SAS macro</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="Ch6_cache/html/read-pbc3-r_a30f07e4ab14ac151f08c110b16e4d5e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pbc3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/pbc3.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>fail <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">with</span>(pbc3, status <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fu">log2</span>(bili))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="Ch6_cache/html/read-pbc3-sas_d830f828676f20343d1280d5f2ed7ff0">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=pbc3</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/pbc3.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">* NB: Inside the macros below a variable called `id` is created which will interfere </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">  with your identification variable if it is also called `id` in your data set,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">  in which case you will need to rename your `id` variable. We have to do it for pbc3;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3; </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3;</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    fail=(status&gt;<span class="dv">0</span>); </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    log2bili=<span class="fu">log2</span>(bili);</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    years=days/<span class="dv">365.25</span>;</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rename</span> id=ptno;</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="macro-pseudosurv" class="level4">
<h4 class="anchored" data-anchor-id="macro-pseudosurv">Macro <code>pseudosurv</code></h4>
<p>This SAS macro computes pseudo-values based on Kaplan-Meier estimates and is adapted from that described by:</p>
<ul>
<li>J.P.Klein, M.Gerster, P.K.Andersen, S.Tarima, M.Pohar Perme (2008): “SAS and R functions to compute pseudo-values for censored data regression” Comp. Meth. Progr. Biomed., vol.&nbsp;89,pp.&nbsp;289-300. */</li>
</ul>
<p>NB: Inside the macros below a variable called <code>id</code> is created which will interfere with your identification variable if it is also called <code>id</code> in your data set, in which case you will need to rename your <code>id</code> variable. We have to do it for pbc3.</p>
<div class="cell" data-hash="Ch6_cache/html/macro-pseudosurv-sas_f6abc4c44e1f1b2ce08ea03350a0e089">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Can also be found on: </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">  https://biostat.ku.dk/pka/epidata/pseudosurv.sas;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">* 'noprint plots = none' are included twice in the proc lifetest statement of the MACRO to avoid none important outputs being printed;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudosurv(indata,time,dead,howmany,datatau,outdata);</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* The subsequent SAS code is adapted from that described by J.P.Klein,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    M.Gerster, P.K.Andersen, S.Tarima, M.Pohar Perme (2008): "SAS and R</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">    functions to compute pseudo-values for censored data regression"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Comp. Meth. Progr. Biomed., vol. 89,pp. 289-300. */</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">/*    MACRO COMPUTES PSEUDOVALUES BASED ON THE KAPLAN-MEIER ESTIMATOR AT EACH</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">      INPUTS:</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">      INDATA---INPUT DATA SET</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME--TIME VARIABLE</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">      DEAD---EVENT INDICATOR (1-EVENT, 0-CENSORED)</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY---SAMPLE SIZE</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">      DATATAU---SUBSET OF INPUT DATA SET AT WHICH PSEUDO VALUES ARE COMPUTED DATA</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">                SET HAS SINGLE VARIABLE TIME</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">     </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">      OUTDATA---OUTPUT DATA SET WHICH CONTAINS PSUK,K=1,...,HOWMANY THE PSEUDO</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">      VALUES AT EACH TIME POINT (Note output data set includes orginal data sorted</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">                           by time</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">      </span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;indata;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">keep</span>;  <span class="kw">set</span> <span class="kw">&amp;datatau;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>find=<span class="dv">1</span>;</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;time;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span>=<span class="dv">1</span>;</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">merge</span> <span class="fu">point</span> <span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> find <span class="kw">keep</span>;</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> useme;  <span class="kw">set</span> <span class="fu">point</span>;</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> temp -<span class="dv">1</span>;</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">keep</span> = <span class="dv">1</span> <span class="kw">then</span> temp=<span class="fu">time</span>;</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>tuse=temp; </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;time=</span>tuse;</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="kw"> run</span>;</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">/* WORKING DATA SET THAT INCLUDE A SET OF N INDICATORS WHERE FOR THE KTH INDICATOR</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co"> THE EVENT IS MISSING */</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> newdat;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobs(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>iobs(j)=<span class="kw">&amp;dead;</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> j=id <span class="kw">then</span> iobs(j)=.;</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> newdat;</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE KME FOR FULL SAMPLE */</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> lifetest<span class="kw"> data</span>=newdat noprint plots = none;</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span> <span class="kw">&amp;TIME*&amp;dead(</span><span class="dv">0</span>);</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>survival out=sall;</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> sall;  <span class="kw">set</span> sall;</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>sall=survival;</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a> <span class="kw">keep</span> <span class="kw">&amp;time </span>sall;</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="kw">%do</span> ip=<span class="dv">1</span> <span class="kw">%to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE KME FOR REDUCED SAMPLE */</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> lifetest<span class="kw"> data</span>=newdat noprint plots = none;</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span> <span class="kw">&amp;time*</span>dead<span class="kw">&amp;ip(</span><span class="dv">0</span>);</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>survival out=stmp;</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> stmp;  <span class="kw">set</span> stmp;</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>s<span class="kw">&amp;ip=</span>survival;</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;time </span>s<span class="kw">&amp;ip;</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="co">/*merge KMEs AND COMPUTE PSEUDOVALUES FOR OBSERVATION IP*/</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pstmp; <span class="kw">merge</span> sall stmp;  <span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> stemp <span class="dv">1</span>;</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> s<span class="kw">&amp;ip=</span>. <span class="kw">then</span> s<span class="kw">&amp;ip=</span>stemp;</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>stemp=s<span class="kw">&amp;ip;</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>psu<span class="kw">&amp;ip=&amp;howmany*</span>sall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*s<span class="kw">&amp;ip;</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out; <span class="kw">merge</span> out pstmp useme ;  <span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;time </span>psu1-psu<span class="kw">&amp;ip;</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="kw">%end</span>;</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> out;</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> dup -<span class="dv">1</span>;</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">&amp;time=</span>dup <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a> <span class="kw">else</span> dup=<span class="kw">&amp;time;</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a> jd+<span class="dv">1</span>;</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> io;  <span class="kw">set</span> out;</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> ps psu1-psu<span class="kw">&amp;howmany;</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> id=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>pseudo=ps(id);</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;time;</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span>;</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> id pseudo jd;</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=io ;</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> id;</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> a;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> io;  <span class="kw">merge</span> a io;  <span class="kw">by</span> id;</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a><span class="kw"> proc</span> sort<span class="kw"> data</span>=io;  <span class="kw">by</span> jd;</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datatau;</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> taus;  <span class="kw">set</span> <span class="kw">&amp;datatau </span>;</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a> jd+<span class="dv">1</span>;</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a> tpseudo=<span class="fu">time</span>;</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a> <span class="kw">keep</span> jd tpseudo;</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a><span class="kw">  data</span> <span class="kw">&amp;outdata;</span>  <span class="kw">merge</span> io taus;  <span class="kw">by</span> jd;</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> jd id <span class="kw">&amp;time &amp;dead;</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a><span class="kw">    run</span>;</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="figure-6.1" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.1">Figure 6.1</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.1-r_4227d66e4c7bdccad0f583f70389c659">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General plotting style</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pseudo-observations of the survival function for subjects</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The subjects with id=415 and 458 are selected</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The subjects with id=305 and 325 are selected</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pseudo)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>pseudo_allt <span class="ot">&lt;-</span> <span class="fu">pseudosurv</span>(pbc3<span class="sc">$</span>days, pbc3<span class="sc">$</span>fail)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-arrange the data into a long data set</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pseudo_allt<span class="sc">$</span>time)){</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">rbind</span>(b,<span class="fu">cbind</span>(pbc3,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pseudo =</span> pseudo_allt<span class="sc">$</span>pseudo[,it],</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tpseudo =</span> pseudo_allt<span class="sc">$</span>time[it],</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3)))</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> b[<span class="fu">order</span>(b<span class="sc">$</span>id),]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>pseudo_alltid <span class="ot">&lt;-</span> b</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the two subjects </span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>subdat <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"305"</span>, <span class="st">"325"</span>))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> subdat<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> subdat<span class="sc">$</span>pseudo, </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id =</span> <span class="fu">as.factor</span>(subdat<span class="sc">$</span>id))</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tpseudo, <span class="at">y =</span> pseudo, <span class="at">linetype =</span> id), </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Patient number"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"dotted"</span>)) <span class="sc">+</span> </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.1-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.1-sas_92851f21d2e16ce5724bbd56bce43974">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-6.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.2">Figure 6.2</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<section id="a" class="level4">
<h4 class="anchored" data-anchor-id="a">(a)</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.2a-r_f693ba86ef1f3df6c50f103cabe77aba">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>theme_general_1 <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>), </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>), </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>)) </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the pseudo-observations at times </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">366</span>, <span class="dv">743</span>, <span class="dv">1105</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># At 1 year</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>pseudo_t1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">1</span>])</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t1<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t1<span class="sc">$</span>days,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t1<span class="sc">$</span>pseudo, </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t1<span class="sc">$</span>fail))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days  <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> pseudo, <span class="at">shape =</span> failtype), </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Fail"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"X"</span>[i]<span class="sc">*</span><span class="st">" (years)"</span>)) <span class="sc">+</span> </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.9</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  theme_general_1</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.2a-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="b" class="level4">
<h4 class="anchored" data-anchor-id="b">(b)</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.2b-r_d664afabca48c6d69a1319d24beed70c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At 2 years</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>pseudo_t2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">2</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t2<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t2<span class="sc">$</span>days,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t2<span class="sc">$</span>pseudo, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t2<span class="sc">$</span>fail))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> pseudo, <span class="at">shape =</span> failtype), </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Fail"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"X"</span>[i]<span class="sc">*</span><span class="st">" (years)"</span>)) <span class="sc">+</span>  </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.9</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  theme_general_1</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.2b-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="c" class="level4">
<h4 class="anchored" data-anchor-id="c">(c)</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.2c-r_7ec84c1c812cbb3b1fc10335d059539e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At 3 years</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pseudo_t3 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">3</span>])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t3<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t3<span class="sc">$</span>days,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t3<span class="sc">$</span>pseudo, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t3<span class="sc">$</span>fail))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span>c <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days<span class="sc">/</span><span class="fl">365.25</span>, <span class="at">y =</span> pseudo, <span class="at">shape =</span> failtype), </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Fail"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"X"</span>[i]<span class="sc">*</span><span class="st">" (years)"</span>)) <span class="sc">+</span> </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.9</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  theme_general_1 <span class="sc">+</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.2</span>c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.2c-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.2-sas_e5f2960c62fff9d6d56305841ee68235">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> timepoints;</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> <span class="fu">time</span>;</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    366</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    743</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    1105</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    ;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>%pseudosurv(pbc3, days, fail, 349, timepoints, outdata);</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> outdata; </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> outdata;</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    fail=(status&gt;<span class="dv">0</span>); </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=outdata;</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">366</span>;</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    plot pseudo*years = fail / haxis=axis1 vaxis=axis2;</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">6</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'Years'</span>);</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">0.9</span> <span class="kw">to</span> <span class="dv">1.1</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    symbol1  v=<span class="kw">x</span> i=none c=black;</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    symbol2  v=o i=none c=black;</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=outdata;</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">743</span>;</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    plot pseudo*years = fail / haxis=axis1 vaxis=axis2;</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">6</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'Years'</span>);</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">0.9</span> <span class="kw">to</span> <span class="dv">1.1</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    symbol1  v=<span class="kw">x</span> i=none c=black;</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    symbol2  v=o i=none c=black;</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=outdata;</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">1105</span>;</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    plot pseudo*years = fail / haxis=axis1 vaxis=axis2;</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">6</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'Years'</span>);</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">0.9</span> <span class="kw">to</span> <span class="dv">1.1</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    symbol1  v=<span class="kw">x</span> i=none c=black;</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    symbol2  v=o i=none c=black;</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-6.3" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.3">Figure 6.3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<section id="left" class="level4">
<h4 class="anchored" data-anchor-id="left">Left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.3left-r_db5114fd311ef26a9386b8a9f5a026ea">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot year=2</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t2<span class="sc">$</span>tpseudo <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t2<span class="sc">$</span>days,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t2<span class="sc">$</span>pseudo, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">log2bili =</span>  pseudo_t2<span class="sc">$</span>log2bili, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bili =</span> pseudo_t2<span class="sc">$</span>bili,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">alb =</span> pseudo_t2<span class="sc">$</span>alb,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tment =</span> pseudo_t2<span class="sc">$</span>tment,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id =</span> pseudo_t2<span class="sc">$</span>id,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t2<span class="sc">$</span>fail))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>bili_loess <span class="ot">&lt;-</span> <span class="fu">loess</span>(pseudo <span class="sc">~</span> bili, <span class="at">data =</span> pseudodata, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>loesspred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_loess)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>t_loesspred <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  pseudodata, <span class="fu">ifelse</span>(loesspred <span class="sc">&gt;</span> <span class="dv">0</span> , <span class="fu">log</span>(<span class="sc">-</span><span class="fu">log</span>(loesspred)), <span class="cn">NA</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.3</span>left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> pseudo), <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> loesspred), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span>  </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span> </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="at">by =</span> <span class="fl">0.2</span>), </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">1.2</span>)) <span class="sc">+</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.3</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.3left-r-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="right" class="level4">
<h4 class="anchored" data-anchor-id="right">Right</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.3right-r_00167ec7183a80b65ca8de7d0b44164c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.3</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> t_loesspred), <span class="at">data =</span> pseudodata) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"log(-log(predicted pseudo-values))"</span>) <span class="sc">+</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="dv">1</span>), </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.3</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.3right-r-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.3-sas_07f8459bb53679fe525f9d7396703921">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=outdata; </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> bili;</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">* Left plot;</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=outdata;</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">743</span>;</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    plot pseudo*bili/haxis=axis1 vaxis=axis2;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">500</span> <span class="kw">by</span> <span class="dv">50</span> minor=none <span class="kw">label</span>=(<span class="st">'Bilirubin'</span>);</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">0.4</span> <span class="kw">to</span> <span class="dv">1.2</span> <span class="kw">by</span> <span class="dv">0.2</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    symbol1 v=<span class="kw">x</span> i=sm70; * i=sm70 specifies that a smooth line is fit <span class="kw">to data</span>;</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">* Right plot;</span> </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> loess<span class="kw"> data</span>=outdata;</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">743</span>;</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> pseudo=bili/smooth=<span class="dv">0.7</span>;</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span> out=smbili p=smooth;</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> smbili; </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> smbili;</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    line=<span class="fu">log</span>(-<span class="fu">log</span>(smooth));</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=smbili; </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> bili; </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=smbili;</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    plot line*bili/haxis=axis1 vaxis=axis2;</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">500</span> <span class="kw">by</span> <span class="dv">50</span> minor=none <span class="kw">label</span>=(<span class="st">'Bilirubin'</span>);</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">5</span> <span class="kw">to</span> <span class="dv">2</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    symbol1 v=none i=join;</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-6.4" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.4">Figure 6.4</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<section id="left-1" class="level4">
<h4 class="anchored" data-anchor-id="left-1">Left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.4left-r_0fc36d219c53b7ddfdf4abfdc58d7a8c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loess for log2 bili</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>log2bili_loess <span class="ot">&lt;-</span> <span class="fu">loess</span>(pseudo <span class="sc">~</span> log2bili, <span class="at">data =</span> pseudodata, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>log2bili_loesspred <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_loess)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>t_log2bili_loesspred <span class="ot">&lt;-</span> <span class="fu">with</span>(pseudodata,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(log2bili_loesspred <span class="sc">&gt;</span> <span class="dv">0</span> , <span class="fu">log</span>(<span class="sc">-</span><span class="fu">log</span>(log2bili_loesspred)), <span class="cn">NA</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.4</span>left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> pseudo), <span class="at">data =</span> pseudodata) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> log2bili_loesspred), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"log"</span> [<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">1.2</span>)) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.4</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.4left-r-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="right-1" class="level4">
<h4 class="anchored" data-anchor-id="right-1">Right</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.4right-r_5e20875abbf991c05be4973738ff87e5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.4</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> t_log2bili_loesspred), <span class="at">data =</span> pseudodata) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"log"</span> [<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"log(-log(predicted pseudo-values))"</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.4</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.4right-r-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.4-sas_5483815378ba7eb0ed4ed9f1d7a8d466">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Left plot;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=outdata;</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">743</span>;</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    plot pseudo*log2bili/haxis=axis1 vaxis=axis2;</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">1</span> <span class="kw">to</span> <span class="dv">9</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'log2(bilirubin)'</span>);</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">0.4</span> <span class="kw">to</span> <span class="dv">1.1</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    symbol1 v=<span class="kw">x</span> i=sm70;* i=sm70 specifies that a smooth line is fit <span class="kw">to data</span>;</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">* Right plot;</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> loess<span class="kw"> data</span>=outdata;</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">743</span>;</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> pseudo=log2bili/smooth=<span class="dv">0.7</span>;</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span> out=smlogbili p=smooth;</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> smlogbili; </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> smlogbili;</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    line=<span class="fu">log</span>(-<span class="fu">log</span>(smooth));</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=smlogbili; </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> bili; </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=smlogbili;</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    plot line*log2bili/haxis=axis1 vaxis=axis2;</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">1</span> <span class="kw">to</span> <span class="dv">9</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'log2(Bilirubin)'</span>);</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">5</span> <span class="kw">to</span> <span class="dv">2</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    symbol1 v=none i=join;</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-6.1" class="level3">
<h3 class="anchored" data-anchor-id="table-6.1">Table 6.1</h3>
<p>Estimates and SD in the book are from SAS <code>proc genmod</code>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>In R we have at least three ways to estimate:</p>
<ul>
<li>When using <code>geese</code> from <code>geepack</code> package for the three time points model the SDs are smaller compared to SAS</li>
<li>Using <code>svyglm</code> from <code>survey</code> package gives comparable SDs to SAS</li>
<li>Package <code>eventglm</code> is another option with other issues – see comments in the R code</li>
</ul>
<section id="function-geese-from-geepackpackage" class="level4">
<h4 class="anchored" data-anchor-id="function-geese-from-geepackpackage">Function <code>geese</code> from <code>geepack</code>package</h4>
<div class="cell" data-hash="Ch6_cache/html/table-6.1-geese-r_ed71c8f9e1b3677037f6275655ad1bcd">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geepack)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># summary function for pseudo-value regression from a geese fit</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>summgeese<span class="ot">&lt;-</span><span class="cf">function</span>(pofit,<span class="at">d=</span><span class="dv">6</span>){</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  beta<span class="ot">&lt;-</span>pofit<span class="sc">$</span>beta</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  SD <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>vbeta))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">cbind</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta =</span> beta, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD.robust =</span> SD, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.beta =</span> <span class="fu">exp</span>(beta), </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.lci  =</span> <span class="fu">exp</span>(beta<span class="fl">-1.96</span><span class="sc">*</span>SD), </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.uci  =</span> <span class="fu">exp</span>(beta<span class="fl">+1.96</span><span class="sc">*</span>SD), </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">PVal.N =</span> <span class="dv">2-2</span><span class="sc">*</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(beta<span class="sc">/</span>SD))),d) </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># At day 743</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># data frame pseudodata countains pseudo-observations day 743</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>geefit1 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo) <span class="sc">~</span> tment <span class="sc">+</span>alb <span class="sc">+</span> log2bili,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">id =</span> id,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(geefit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept) -2.116642  1.326984 0.120435 0.008937 1.622951 0.110695
tment       -0.705053  0.369341 0.494082 0.239557 1.019035 0.056269
alb         -0.105069  0.034169 0.900263 0.841946 0.962618 0.002105
log2bili     0.835723  0.140429 2.306480 1.751517 3.037282 0.000000</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At days 366, 743, 1105 </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the pseudo-observations at times</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">366</span>, <span class="dv">743</span>, <span class="dv">1105</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>pseudo_t1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">1</span>])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>pseudo_t2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">2</span>])</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>pseudo_t3 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pseudo_alltid, tpseudo <span class="sc">==</span> times[<span class="dv">3</span>])</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>pseudo_t <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pseudo_t1, pseudo_t2, pseudo_t3)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>pseudodata_t <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tpseudo =</span> pseudo_t<span class="sc">$</span>tpseudo,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">days =</span> pseudo_t<span class="sc">$</span>days,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> pseudo_t<span class="sc">$</span>pseudo,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">log2bili =</span>  pseudo_t<span class="sc">$</span>log2bili,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bili =</span> pseudo_t<span class="sc">$</span>bili,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">alb =</span> pseudo_t<span class="sc">$</span>alb,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tment =</span> pseudo_t<span class="sc">$</span>tment,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id =</span> pseudo_t<span class="sc">$</span>id,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(pseudo_t<span class="sc">$</span>fail))</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>geefit3 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo) <span class="sc">~</span> tment <span class="sc">+</span>alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">factor</span>(tpseudo)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">id =</span> id,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(geefit3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                         beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
tment               -0.598536  0.213046 0.549616 0.362002 0.834464 0.004963
alb                 -0.093907  0.019069 0.910367 0.876970 0.945036 0.000001
log2bili             0.684093  0.071818 1.981972 1.721729 2.281552 0.000000
factor(tpseudo)366  -2.474620  0.829782 0.084195 0.016556 0.428165 0.002861
factor(tpseudo)743  -1.554010  0.810703 0.211399 0.043154 1.035587 0.055255
factor(tpseudo)1105 -1.123233  0.813730 0.325227 0.065997 1.602682 0.167479</code></pre>
</div>
</div>
</section>
<section id="function-svyglm-from-survey-package" class="level4">
<h4 class="anchored" data-anchor-id="function-svyglm-from-survey-package">Function <code>svyglm</code> from <code>survey</code> package</h4>
<div class="cell" data-hash="Ch6_cache/html/table-6.1-survey-r_7ac323fe1fa5688310077194c6ee121f">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co"># get bcloglog()</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Thanks to Terry Therneau for this comment:</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># It needs one more line to set up compaed to geese, but has 3 advantages: </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1: naturally deals with missing values in the data</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2: results follow standard R nomenclature, e.g., the coef and vcov functions work as expected</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3: geese gives incorrect answers, without warning, if the data set is not sorted in exactly the order it expects</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Also: The bounded cloglog link, bcloglog(), avoid an error message in glm's initial values step. It's found in the survival package.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># summary function for pseudo-value regression from a svyglm fit</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>summsvy<span class="ot">&lt;-</span><span class="cf">function</span>(pofit,<span class="at">d=</span><span class="dv">5</span>){</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  beta<span class="ot">&lt;-</span>pofit<span class="sc">$</span>coefficient</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  SD<span class="ot">&lt;-</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(pofit<span class="sc">$</span>cov.unscaled))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">cbind</span>(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta =</span> beta, </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD.robust =</span> SD,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.beta =</span> <span class="fu">exp</span>(beta), </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.lci =</span> <span class="fu">exp</span>(beta<span class="fl">-1.96</span><span class="sc">*</span>SD), </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp.uci =</span> <span class="fu">exp</span>(beta<span class="fl">+1.96</span><span class="sc">*</span>SD), </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">PVal.N =</span> <span class="dv">2-2</span><span class="sc">*</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(beta<span class="sc">/</span>SD))),d)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># At days 743</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>svydata <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>id, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>pseudodata, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>svyfit1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">design=</span>svydata, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span> <span class="fu">bcloglog</span>()))</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(svyfit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci exp.uci  PVal.N
(Intercept) -2.11619   1.32893  0.12049 0.00891 1.62989 0.11129
tment       -0.70510   0.36987  0.49406 0.23930 1.02004 0.05660
alb         -0.10508   0.03422  0.90026 0.84186 0.96270 0.00213
log2bili     0.83569   0.14064  2.30641 1.75074 3.03845 0.00000</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At days 366, 743, 1105 </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>svydata3 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>id, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>pseudodata_t, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>svyfit3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili<span class="sc">+</span><span class="fu">factor</span>(tpseudo)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">design=</span>svydata3, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span> <span class="fu">bcloglog</span>()))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(svyfit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        beta SD.robust exp.beta exp.lci exp.uci  PVal.N
tment               -0.59853   0.28738  0.54962 0.31292 0.96536 0.03728
alb                 -0.09391   0.02630  0.91037 0.86462 0.95853 0.00036
log2bili             0.68410   0.09203  1.98198 1.65487 2.37374 0.00000
factor(tpseudo)366  -2.47472   1.14395  0.08419 0.00894 0.79250 0.03052
factor(tpseudo)743  -1.55410   1.12274  0.21138 0.02341 1.90877 0.16629
factor(tpseudo)1105 -1.12332   1.12718  0.32520 0.03570 2.96225 0.31897</code></pre>
</div>
</div>
</section>
<section id="function-cumincglm-from-eventglmpackage" class="level4">
<h4 class="anchored" data-anchor-id="function-cumincglm-from-eventglmpackage">Function <code>cumincglm</code> from <code>eventglm</code>package</h4>
<p>Now, using <code>eventglm</code> package. Handling of missing values (here for variable <code>alb</code>) causes some issue, see comment in R code below.</p>
<div class="cell" data-hash="Ch6_cache/html/table-6.1-eventglm-r_e3fac90dc52fb627b94e2df06aebdfdf">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(eventglm)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># At day 743</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SD differ a bit from from than SAS, geese, and svyglm</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>egfit1 <span class="ot">&lt;-</span> <span class="fu">cumincglm</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">time =</span> <span class="dv">743</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3, <span class="at">link=</span><span class="st">"cloglog"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(egfit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
cumincglm(formula = Surv(days, fail) ~ tment + alb + log2bili, 
    time = 743, link = "cloglog", data = pbc3)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.11633    1.42637  -1.484  0.13788    
tment       -0.70509    0.38569  -1.828  0.06753 .  
alb         -0.10507    0.03628  -2.896  0.00378 ** 
log2bili     0.83570    0.14657   5.702 1.19e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasi family taken to be 1)

    Null deviance: 53.331  on 342  degrees of freedom
Residual deviance: 34.736  on 339  degrees of freedom
  (6 observations deleted due to missingness)
AIC: NA

Number of Fisher Scoring iterations: 8</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use of argument subset gives the same</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>egfit1x <span class="ot">&lt;-</span> <span class="fu">cumincglm</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">time =</span> <span class="dv">743</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3, <span class="at">subset=</span><span class="sc">!</span><span class="fu">is.na</span>(alb), <span class="at">link=</span><span class="st">"cloglog"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(egfit1x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
cumincglm(formula = Surv(days, fail) ~ tment + alb + log2bili, 
    time = 743, link = "cloglog", data = pbc3, subset = !is.na(alb))

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.11633    1.42637  -1.484  0.13788    
tment       -0.70509    0.38569  -1.828  0.06753 .  
alb         -0.10507    0.03628  -2.896  0.00378 ** 
log2bili     0.83570    0.14657   5.702 1.19e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasi family taken to be 1)

    Null deviance: 53.331  on 342  degrees of freedom
Residual deviance: 34.736  on 339  degrees of freedom
AIC: NA

Number of Fisher Scoring iterations: 8</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sub-setting the data is not the way:</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># When sub-setting, the pseudo-values are calculated base on the sub-sample,</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># which is different from all the above where the full sample is used to</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the pseudo-values</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>egfit1xx <span class="ot">&lt;-</span> <span class="fu">cumincglm</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">time =</span> <span class="dv">743</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">subset</span>(pbc3,<span class="sc">!</span><span class="fu">is.na</span>(alb)), <span class="at">link=</span><span class="st">"cloglog"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(egfit1xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
cumincglm(formula = Surv(days, fail) ~ tment + alb + log2bili, 
    time = 743, link = "cloglog", data = subset(pbc3, !is.na(alb)))

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.11445    1.42986  -1.479  0.13920    
tment       -0.70619    0.38684  -1.826  0.06792 .  
alb         -0.10532    0.03642  -2.892  0.00383 ** 
log2bili     0.83700    0.14731   5.682 1.33e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasi family taken to be 1)

    Null deviance: 53.570  on 342  degrees of freedom
Residual deviance: 34.909  on 339  degrees of freedom
AIC: NA

Number of Fisher Scoring iterations: 8</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At days 366, 743, 1105 </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For multiple time points we get an error for this code:</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># egfit3 &lt;- cumincglm(Surv(days, fail) ~ tment + alb + log2bili, time = c(366, 743, 1105),</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                    data = pbc3, link="cloglog")</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Error in model.frame.default(formula = formula2i, data = newdatasrt, weights = weights,  : </span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># variable lengths differ (found for '(weights)')</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to use argument subset, but get same error</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># egfit3x &lt;- cumincglm(Surv(days, fail) ~ tment + alb + log2bili, time = c(366, 743, 1105),</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                    data = pbc3, subset=!is.na(alb), link="cloglog")</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Have to do sub-setting on data, but this is not the way to do it</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># but is in this case VERY close to svyglm results</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>egfit3xx <span class="ot">&lt;-</span> <span class="fu">cumincglm</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">time =</span> <span class="fu">c</span>(<span class="dv">366</span>, <span class="dv">743</span>, <span class="dv">1105</span>),</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">subset</span>(pbc3,<span class="sc">!</span><span class="fu">is.na</span>(alb)), <span class="at">link=</span><span class="st">"cloglog"</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(egfit3xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
cumincglm(formula = Surv(days, fail) ~ tment + alb + log2bili, 
    time = c(366, 743, 1105), link = "cloglog", data = subset(pbc3, 
        !is.na(alb)))

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)            -1.11947    1.12726  -0.993 0.320664    
factor(pseudo.time)366 -1.35313    0.23361  -5.792 6.94e-09 ***
factor(pseudo.time)743 -0.43081    0.11892  -3.623 0.000292 ***
tment                  -0.59990    0.28746  -2.087 0.036898 *  
alb                    -0.09416    0.02633  -3.576 0.000349 ***
log2bili                0.68516    0.09219   7.432 1.07e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasi family taken to be 1)

    Null deviance: 169.71  on 1028  degrees of freedom
Residual deviance: 121.65  on 1023  degrees of freedom
AIC: NA

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-hash="Ch6_cache/html/table-6.1-sas_bc4de8036e78c082ea9bdc2b75474a07">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a># <span class="kw">Rename</span> the id variable ;</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3; </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3; </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rename</span> id=ptno;</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=pbc3; </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> days; </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> timepoints;</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> <span class="fu">time</span>;</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="ot">    366</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="ot">    743</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="ot">    1105</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="ot">    ;</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>%pseudosurv(pbc3, days, fail, 349, timepoints, outdata);</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co">* At day 743 ----------------------------------------------------------------;</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata;</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">743</span>;</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=<span class="fu">log</span>(-<span class="fu">log</span>(_mean_));</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    invlink ilink=<span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> pseudo=tment alb log2bili / dist=<span class="fu">normal</span> noscale;</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>              Analysis Of GEE Parameter Estimates</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>               Empirical Standard <span class="kw">Error</span> Estimates</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>                    Standard   <span class="dv">95</span>% Confidence</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a> Parameter Estimate    <span class="kw">Error</span>       Limits            Z Pr &gt; |Z|</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a> Intercept  -<span class="dv">2.1167</span>   <span class="dv">1.3270</span>  -<span class="dv">4.7175</span>   <span class="dv">0.4842</span>   -<span class="dv">1.60</span>   <span class="dv">0.1107</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a> tment      -<span class="dv">0.7051</span>   <span class="dv">0.3693</span>  -<span class="dv">1.4289</span>   <span class="dv">0.0188</span>   -<span class="dv">1.91</span>   <span class="dv">0.0563</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a> alb        -<span class="dv">0.1051</span>   <span class="dv">0.0342</span>  -<span class="dv">0.1720</span>  -<span class="dv">0.0381</span>   -<span class="dv">3.08</span>   <span class="dv">0.0021</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a> log2bili    <span class="dv">0.8357</span>   <span class="dv">0.1404</span>   <span class="dv">0.5605</span>   <span class="dv">1.1110</span>    <span class="dv">5.95</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="co">* At days 366 , 743, 1105 ----------------------------------------------------;</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata;</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>    class ptno <span class="fu">time</span>;</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=<span class="fu">log</span>(-<span class="fu">log</span>(_mean_));</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    invlink ilink=<span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> pseudo=tment alb log2bili <span class="fu">time</span> / dist=<span class="fu">normal</span> noscale noint;</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>                 Analysis Of GEE Parameter Estimates</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>                 Empirical Standard <span class="kw">Error</span> Estimates</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>                         Standard   <span class="dv">95</span>% Confidence</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a> Parameter      Estimate    <span class="kw">Error</span>       Limits            Z Pr &gt; |Z|</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a> Intercept        <span class="dv">0.0000</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>     .      .</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a> tment           -<span class="dv">0.5985</span>   <span class="dv">0.2870</span>  -<span class="dv">1.1610</span>  -<span class="dv">0.0361</span>   -<span class="dv">2.09</span>   <span class="dv">0.0370</span></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a> alb             -<span class="dv">0.0939</span>   <span class="dv">0.0263</span>  -<span class="dv">0.1454</span>  -<span class="dv">0.0424</span>   -<span class="dv">3.58</span>   <span class="dv">0.0003</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a> log2bili         <span class="dv">0.6841</span>   <span class="dv">0.0919</span>   <span class="dv">0.5040</span>   <span class="dv">0.8642</span>    <span class="dv">7.44</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">366</span>   -<span class="dv">2.4746</span>   <span class="dv">1.1423</span>  -<span class="dv">4.7135</span>  -<span class="dv">0.2357</span>   -<span class="dv">2.17</span>   <span class="dv">0.0303</span></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">743</span>   -<span class="dv">1.5540</span>   <span class="dv">1.1211</span>  -<span class="dv">3.7514</span>   <span class="dv">0.6434</span>   -<span class="dv">1.39</span>   <span class="dv">0.1657</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">1105</span>  -<span class="dv">1.1232</span>   <span class="dv">1.1256</span>  -<span class="dv">3.3293</span>   <span class="dv">1.0829</span>   -<span class="dv">1.00</span>   <span class="dv">0.3183</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-6.5" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.5">Figure 6.5</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.5-r_8de2d8cecd555241e2f75bfd70936063">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At time year c(1, 2, 3) </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo) <span class="sc">~</span> <span class="fu">as.factor</span>(tpseudo) <span class="sc">+</span> log2bili <span class="sc">+</span> alb <span class="sc">+</span> tment <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, <span class="sc">!</span><span class="fu">is.na</span>(alb)), </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">id =</span> id, </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean.link =</span> <span class="st">"cloglog"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">variance =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale.value =</span> <span class="dv">0</span>, </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale.fix =</span> <span class="dv">1</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(pseudodata_t))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 1</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">1</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">1</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        fit2<span class="sc">$</span>beta[<span class="dv">1</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>log2bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 2</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">2</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span> </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">2</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">2</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>log2bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 3</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">3</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span> </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">3</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">3</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>log2bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform back</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">with</span>(pseudodata_t, pseudo <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">exp</span>(pred)))</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">*</span> <span class="fl">365.25</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Make loess smooth per time</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>log2bili_res_loess_1 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> log2bili, </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">366</span>), <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>log2bili_res_loess_2 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> log2bili, </span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">743</span>), <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>log2bili_res_loess_3 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> log2bili, </span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">1105</span>), <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>log2bili_res_pred_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_res_loess_1, <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">366</span>))</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>log2bili_res_pred_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_res_loess_2, <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">743</span>))</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>log2bili_res_pred_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_res_loess_3, <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">1105</span>))</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>log2bili_res_pred <span class="ot">&lt;-</span> <span class="fu">c</span>(log2bili_res_pred_1, log2bili_res_pred_2, log2bili_res_pred_3)</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> res, <span class="at">shape =</span> time), <span class="at">data =</span> pseudodata_t) <span class="sc">+</span> </span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> log2bili_res_pred , <span class="at">linetype =</span> time), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Year"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">0</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Year"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"solid"</span>, <span class="st">"dotted"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"log"</span> [<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span>  </span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-residuals"</span>) <span class="sc">+</span> </span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>), </span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>), </span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span> </span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.box =</span> <span class="st">"vertical"</span>,</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>), </span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">'cm'</span>),</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.5-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.5-sas_c60636ad224774ff57a65124b710ec8e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> fig6_5; <span class="kw">set</span> outdata;</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="fu">time</span>=<span class="dv">366</span> <span class="kw">then do</span>;</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    linpred=-<span class="dv">2.4746+0.6841</span>*log2bili<span class="dv">-0.0939</span>*alb<span class="dv">-0.5985</span>*tment;</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    pred=<span class="fu">exp</span>(-<span class="fu">exp</span>(linpred)); res=pseudo-pred<span class="kw">; end</span>;</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="fu">time</span>=<span class="dv">743</span> <span class="kw">then do</span>;</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    linpred=-<span class="dv">1.5540+0.6841</span>*log2bili<span class="dv">-0.0939</span>*alb<span class="dv">-0.5985</span>*tment;</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    pred=<span class="fu">exp</span>(-<span class="fu">exp</span>(linpred)); res=pseudo-pred<span class="kw">; end</span>;</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="fu">time</span>=<span class="dv">1105</span> <span class="kw">then do</span>;</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    linpred=-<span class="dv">1.1232+0.6841</span>*log2bili<span class="dv">-0.0939</span>*alb<span class="dv">-0.5985</span>*tment;</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    pred=<span class="fu">exp</span>(-<span class="fu">exp</span>(linpred)); res=pseudo-pred<span class="kw">; end</span>;</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=fig6_5;</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    plot res*log2bili=<span class="fu">time</span>/haxis=axis1 vaxis=axis2;</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">1</span> <span class="kw">to</span> <span class="dv">9</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'log2(Bilirubin)'</span>);</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">2</span> <span class="kw">to</span> <span class="dv">1</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-residuals'</span>);;</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    symbol1 v=<span class="kw">x</span> i=sm50;</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    symbol2 v=o i=sm50;</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    symbol3 v=+ i=sm50;</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-6.2" class="level3">
<h3 class="anchored" data-anchor-id="table-6.2">Table 6.2</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-hash="Ch6_cache/html/table-6.2-r_cd2e5af78064ac28647211ec5d6a0770">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At days 366 , 743, 1105 using link function "-log"</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># No default link function "-log" R, thus add "-" in front of all beta estimates</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> <span class="fu">factor</span>(tpseudo)<span class="sc">-</span><span class="dv">1</span> , </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">design=</span>svydata3, <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="fu">blog</span>())))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        beta SD.robust exp.beta exp.lci exp.uci  PVal.N
tment                0.04839   0.03111  1.04958 0.98748 1.11558 0.11989
alb                  0.00969   0.00319  1.00974 1.00344 1.01607 0.00241
bili                -0.00419   0.00079  0.99582 0.99427 0.99737 0.00000
factor(tpseudo)366  -0.34027   0.14239  0.71158 0.53830 0.94065 0.01686
factor(tpseudo)743  -0.41202   0.14523  0.66231 0.49824 0.88040 0.00455
factor(tpseudo)1105 -0.50754   0.14699  0.60197 0.45129 0.80296 0.00055</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-hash="Ch6_cache/html/table-6.2-sas_81814abea4cb3ba5151f07ca95a06ca2">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">*  At days 366 , 743, 1105 using link function "-log";</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata;</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    class ptno <span class="fu">time</span>;</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=-<span class="fu">log</span>(_mean_);</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    invlink ilink=<span class="fu">exp</span>(-_xbeta_);</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> pseudo=tment alb bili <span class="fu">time</span>  /dist=<span class="fu">normal</span> noscale noint;</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                Analysis Of GEE Parameter Estimates</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                Empirical Standard <span class="kw">Error</span> Estimates</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>                          Standard   <span class="dv">95</span>% Confidence</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  Parameter      Estimate    <span class="kw">Error</span>       Limits            Z Pr &gt; |Z|</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  Intercept        <span class="dv">0.0000</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>     .      .</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  tment           -<span class="dv">0.0484</span>   <span class="dv">0.0311</span>  -<span class="dv">0.1093</span>   <span class="dv">0.0125</span>   -<span class="dv">1.56</span>   <span class="dv">0.1194</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  alb             -<span class="dv">0.0097</span>   <span class="dv">0.0032</span>  -<span class="dv">0.0159</span>  -<span class="dv">0.0034</span>   -<span class="dv">3.04</span>   <span class="dv">0.0024</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  bili             <span class="dv">0.0042</span>   <span class="dv">0.0008</span>   <span class="dv">0.0026</span>   <span class="dv">0.0057</span>    <span class="dv">5.29</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">time</span>      <span class="dv">366</span>    <span class="dv">0.3403</span>   <span class="dv">0.1422</span>   <span class="dv">0.0616</span>   <span class="dv">0.6189</span>    <span class="dv">2.39</span>   <span class="dv">0.0167</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">time</span>      <span class="dv">743</span>    <span class="dv">0.4120</span>   <span class="dv">0.1450</span>   <span class="dv">0.1278</span>   <span class="dv">0.6963</span>    <span class="dv">2.84</span>   <span class="dv">0.0045</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">time</span>      <span class="dv">1105</span>   <span class="dv">0.5075</span>   <span class="dv">0.1468</span>   <span class="dv">0.2199</span>   <span class="dv">0.7952</span>    <span class="dv">3.46</span>   <span class="dv">0.0005</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-6.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.6">Figure 6.6</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<section id="left-2" class="level4">
<h4 class="anchored" data-anchor-id="left-2">Left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.6left-r_aaad4d5f96255f2fe3e5f920b57d8f8a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 6.6 (a) - done earlier</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.6</span>left <span class="ot">&lt;-</span> fig6<span class="fl">.3</span>left</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.6</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.6left-r-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="right-2" class="level4">
<h4 class="anchored" data-anchor-id="right-2">Right</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.6right-r_0f003f9855b572cc6691997ecbfc0ea5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same as earlier:</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>bili_loess <span class="ot">&lt;-</span> <span class="fu">loess</span>(pseudo <span class="sc">~</span> bili, <span class="at">data =</span> pseudodata, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>loesspred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_loess)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use log-trans instead of cloglog</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>pseudodata<span class="sc">$</span>log_loesspred <span class="ot">&lt;-</span> <span class="fu">with</span>(pseudodata,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(loesspred <span class="sc">&gt;</span> <span class="dv">0</span> , <span class="sc">-</span><span class="fu">log</span>(loesspred), <span class="cn">NA</span>))</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.6</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> log_loesspred), <span class="at">data =</span> pseudodata) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"-log(predicted pseudo-values)"</span>) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.6</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.6right-r-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.6-sas_a4383b13902eb2f2785f2fe9e902716c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Right plot;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=outdata; </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> bili; </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=outdata;</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">743</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    plot pseudo*bili/haxis=axis1 vaxis=axis2;</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">500</span> <span class="kw">by</span> <span class="dv">50</span> minor=none <span class="kw">label</span>=(<span class="st">'Bilirubin'</span>);</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">0.4</span> <span class="kw">to</span> <span class="dv">1.2</span> <span class="kw">by</span> <span class="dv">0.2</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    symbol1 v=<span class="kw">x</span> i=sm70;</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">* Left plot;</span> </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> loess<span class="kw"> data</span>=outdata;</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="fu">time</span>=<span class="dv">743</span>;</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> pseudo=bili/smooth=<span class="dv">0.7</span>;</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span> out=smbili p=smooth;</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> smbili; </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> smbili;</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    line=-<span class="fu">log</span>(smooth);</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=smbili; </span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> bili; </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=smbili;</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    plot line*bili/haxis=axis1 vaxis=axis2;</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">500</span> <span class="kw">by</span> <span class="dv">50</span> minor=none <span class="kw">label</span>=(<span class="st">'Bilirubin'</span>);</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">1</span> <span class="kw">to</span> <span class="dv">3</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    symbol1 v=none i=join;</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-6.7" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.7">Figure 6.7</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.7-r_eefe9ae66fc4576f5fd99c1c50074f0b">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use regression estimates from fit2</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(pseudodata_t))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 1</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">1</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">1</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">1</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 2</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">2</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">2</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">2</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># At time 3</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">3</span>] <span class="sc">/</span> <span class="fl">365.25</span>,]<span class="sc">$</span>pred <span class="ot">&lt;-</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pseudodata_t[pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">==</span> times[<span class="dv">3</span>] <span class="sc">/</span> <span class="fl">365.25</span>,],</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>       fit2<span class="sc">$</span>beta[<span class="dv">3</span>] <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">4</span>]<span class="sc">*</span>bili <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">5</span>]<span class="sc">*</span>alb <span class="sc">+</span> fit2<span class="sc">$</span>beta[<span class="dv">6</span>]<span class="sc">*</span>tment)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform back</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">with</span>(pseudodata_t, pseudo <span class="sc">-</span> <span class="fu">exp</span>(pred))</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pseudodata_t<span class="sc">$</span>tpseudo <span class="sc">*</span> <span class="fl">365.25</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Make loess smooth per time</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>bili_res_loess_1 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> bili,</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">366</span>), </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>                          <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>bili_res_loess_2 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> bili,</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">743</span>), </span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>bili_res_loess_3 <span class="ot">&lt;-</span> <span class="fu">loess</span>(res <span class="sc">~</span> bili,</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">1105</span>), </span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>                          <span class="at">span =</span> <span class="fl">0.7</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>bili_res_pred_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_res_loess_1, </span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">366</span>))</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>bili_res_pred_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_res_loess_2, </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">743</span>))</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>bili_res_pred_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bili_res_loess_3, </span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(pseudodata_t, time <span class="sc">==</span> <span class="dv">1105</span>))</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>pseudodata_t<span class="sc">$</span>bili_res_pred <span class="ot">&lt;-</span> <span class="fu">c</span>(bili_res_pred_1, </span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>                                bili_res_pred_2, </span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>                                bili_res_pred_3)</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> res, <span class="at">shape =</span> time), <span class="at">data =</span> pseudodata_t) <span class="sc">+</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> bili_res_pred , <span class="at">linetype =</span> time), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Year"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">0</span>), </span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Year"</span>, </span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"solid"</span>, <span class="st">"dotted"</span>), </span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"Bilirubin"</span>)) <span class="sc">+</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-residuals"</span>) <span class="sc">+</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>),</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.box =</span> <span class="st">"vertical"</span>,</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">'cm'</span>),</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.7-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.7-sas_a35b643d9785c1f280ceb6dd0fd1b45d">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> fig6_7; </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> outdata;</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="fu">time</span>=<span class="dv">366</span> <span class="kw">then do</span>;</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    linpred2=<span class="dv">0.3403+0.0042</span>*bili<span class="dv">-0.0097</span>*alb<span class="dv">-0.0484</span>*tment;</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    pred2=<span class="fu">exp</span>(-linpred2); res2=pseudo-pred2<span class="kw">; end</span>;</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="fu">time</span>=<span class="dv">743</span> <span class="kw">then do</span>;</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    linpred2=<span class="dv">0.4120+0.0042</span>*bili<span class="dv">-0.0097</span>*alb<span class="dv">-0.0484</span>*tment;</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    pred2=<span class="fu">exp</span>(-linpred2); res2=pseudo-pred2<span class="kw">; end</span>;</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="fu">time</span>=<span class="dv">1105</span> <span class="kw">then do</span>;</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    linpred2=<span class="dv">0.5075+0.0042</span>*bili<span class="dv">-0.0097</span>*alb<span class="dv">-0.0484</span>*tment;</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    pred2=<span class="fu">exp</span>(-linpred2); res2=pseudo-pred2<span class="kw">; end</span>;</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=fig6_7;</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    plot res2*bili=<span class="fu">time</span>/haxis=axis1 vaxis=axis2;</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">500</span> <span class="kw">by</span> <span class="dv">100</span> minor=none <span class="kw">label</span>=(<span class="st">'Bilirubin'</span>);</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">2</span> <span class="kw">to</span> <span class="dv">1</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-residuals'</span>);;</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    symbol1 v=<span class="kw">x</span> i=sm50;</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    symbol2 v=o i=sm50;</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    symbol3 v=+ i=sm50;</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-6.3" class="level3">
<h3 class="anchored" data-anchor-id="table-6.3">Table 6.3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<p>Here, <code>geese</code>, <code>svyglm</code>, and <code>rmeanglm</code> (from package <code>eventglm</code>) give very similar results.</p>
<div class="cell" data-hash="Ch6_cache/html/table-6.3-r_d5c300a6919669232299c2cd415e2ee9">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pseudo-observations of the restricted mean and merge with pbc3</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>datarmean3<span class="ot">&lt;-</span><span class="fu">cbind</span>(pbc3,<span class="at">pseudormean=</span><span class="fu">pseudomean</span>(pbc3<span class="sc">$</span>days<span class="sc">/</span><span class="fl">365.25</span>,pbc3<span class="sc">$</span>fail,<span class="at">tmax =</span> <span class="dv">3</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># geese</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(pseudormean <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">id =</span> id,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(datarmean3, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">mean.link =</span> <span class="st">"identity"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">corstr =</span> <span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust  exp.beta  exp.lci   exp.uci   PVal.N
(Intercept)  2.825598  0.346121 16.871036 8.560865 33.248026 0.000000
tment        0.147813  0.072936  1.159296 1.004870  1.337455 0.042703
alb          0.022512  0.006811  1.022768 1.009204  1.036513 0.000949
log2bili    -0.243093  0.031982  0.784199 0.736550  0.834930 0.000000</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># svyglm</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>svydata <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>id, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>datarmean3, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(pseudormean <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">design=</span>svydata,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">"identity"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci  exp.uci  PVal.N
(Intercept)  2.82560   0.34662 16.87104 8.55253 33.28043 0.00000
tment        0.14781   0.07304  1.15930 1.00466  1.33773 0.04300
alb          0.02251   0.00682  1.02277 1.00919  1.03653 0.00097
log2bili    -0.24309   0.03203  0.78420 0.73648  0.83500 0.00000</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rmeanglm from package eventglm</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rmeanglm</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, fail) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,<span class="at">time =</span> <span class="dv">3</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> pbc3, <span class="at">link=</span><span class="st">"identity"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
rmeanglm(formula = Surv(days/365.25, fail) ~ tment + alb + log2bili, 
    time = 3, link = "identity", data = pbc3)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.825598   0.353204   8.000 1.25e-15 ***
tment        0.147813   0.073915   2.000   0.0455 *  
alb          0.022512   0.006951   3.238   0.0012 ** 
log2bili    -0.243093   0.032626  -7.451 9.27e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasi family taken to be 1)

    Null deviance: 213.75  on 342  degrees of freedom
Residual deviance: 152.10  on 339  degrees of freedom
  (6 observations deleted due to missingness)
AIC: NA

Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<section id="proc-rmstreg" class="level4">
<h4 class="anchored" data-anchor-id="proc-rmstreg"><code>proc rmstreg</code></h4>
<div class="cell" data-hash="Ch6_cache/html/rmstreg-sas_5e777d28a09d2fe9bb4c66775860a6e5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> rmstreg<span class="kw"> data</span>=pbc3 tau=<span class="dv">3</span>;</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">model</span> years*status(<span class="dv">0</span>)=tment alb log2bili / <span class="kw">link</span>=linear;</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                            Analysis of Parameter Estimates</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                               Standard       <span class="dv">95</span>% Confidence          Chi-</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>Parameter    DF    Estimate       <span class="kw">Error</span>           Limits            Square    Pr &gt; ChiSq</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>Intercept     <span class="dv">1</span>      <span class="dv">2.8263</span>      <span class="dv">0.3467</span>      <span class="dv">2.1469</span>      <span class="dv">3.5058</span>      <span class="dv">66.47</span>        &lt;.<span class="dv">0001</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>tment         <span class="dv">1</span>      <span class="dv">0.1480</span>      <span class="dv">0.0730</span>      <span class="dv">0.0048</span>      <span class="dv">0.2911</span>       <span class="dv">4.11</span>        <span class="dv">0.0427</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>alb           <span class="dv">1</span>      <span class="dv">0.0225</span>      <span class="dv">0.0068</span>      <span class="dv">0.0092</span>      <span class="dv">0.0359</span>      <span class="dv">10.92</span>        <span class="dv">0.0010</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>log2bili      <span class="dv">1</span>     -<span class="dv">0.2435</span>      <span class="dv">0.0320</span>     -<span class="dv">0.3063</span>     -<span class="dv">0.1808</span>      <span class="dv">57.83</span>        &lt;.<span class="dv">0001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="macro-pseudomean" class="level4">
<h4 class="anchored" data-anchor-id="macro-pseudomean">Macro <code>pseudomean</code></h4>
<p>SAS macro for computing pseudo-values of the restricted mean based on Kaplan-Meier estimates.</p>
<p>NB: Inside the macro a variable called <code>id</code> is created which will interfere with your identification variable is called <code>id</code> in your data set, in which case you will need to rename your <code>id</code> variable.</p>
<div class="cell" data-hash="Ch6_cache/html/macro-pseudomean-sas_5eb15798bc949d74a302924ac4a504d0">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Can also be found on: </span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">  https://biostat.ku.dk/pka/epidata/pseudomean.sas;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudomean(indata,time,dead,howmany,tmax,outdata);</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a> <span class="co">/* MACRO ARGUMENTS</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">      INDATA--NAME OF INPUT DATA SET</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME--NAME OF TIME VARIABLE</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">      DEAD--NAME OF EVENT INDICATOR VARIABLE--(1-DEAD,0-CENSORED)</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY--SAMPLE SIZE</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">      TMAX--UPPER LIMIT OF INTEGRATION FOR RESTRICTED MEAN</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">      OUTDATA--NAME OF OUTPUT DATA SET WITH PSEUDOVALUES FPR RESTRICTED</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">               MEAN IN VARIABLE "PSUMEAN"  */</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a> <span class="co">/* CREATE A DATA SET WHERE EVERYTHING ABOVE TMAX IS CENSORED */</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> work; <span class="kw">SET</span> <span class="kw">&amp;indata;</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  restime = <span class="fu">MIN</span>(<span class="kw">&amp;tmax,</span> <span class="kw">&amp;time)</span>;</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  resdead = <span class="kw">&amp;dead;</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">IF</span> restime EQ <span class="kw">&amp;tmax THEN</span> resdead = <span class="dv">0</span>;</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co">/* CREATE DATA SET WITH SET OF INDICATORS DEADK THAT HAS MISSING VALUE</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co">     FOR KTH OBSERVATION, K=1,...,HOWMANY*/</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> work;  <span class="kw">SET</span> work;</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>   id+<span class="dv">1</span>;</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>   <span class="kw">ARRAY</span> iobs(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="kw">   DO</span> j = <span class="dv">1</span> <span class="kw">TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    iobs(j) = resdead;</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> j = id <span class="kw">THEN</span> iobs(j) = .;</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="kw">   END</span>;</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE RESTRICTED MEAN FOR COMPLETE SAMPLE USING PROC LIFETEST */</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="kw"> PROC</span> LIFETEST<span class="kw"> DATA</span> = work OUTSURV = km ;</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">TIME</span> restime*resdead(<span class="dv">0</span>);</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>   ODS <span class="kw">SELECT</span> MEANS;</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>   ODS <span class="kw">OUTPUT</span> MEANS = mall;</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="kw"> RUN</span>;</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> km; <span class="kw">SET</span> km;</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> _CENSOR_ EQ <span class="dv">0</span>;</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="kw">  PROC</span> SORT<span class="kw"> DATA</span>=km;</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">BY</span> restime;</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="kw">  RUN</span>; </span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> km; <span class="kw">SET</span> km<span class="kw"> END</span>=LAST;</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> <span class="kw">NOT</span>(LAST) <span class="kw">THEN</span> <span class="kw">DELETE</span>;</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>    area = (<span class="kw">&amp;tmax </span>- restime)*survival;</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">KEEP</span> area;</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> psu; <span class="kw">MERGE</span> km mall;</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>    meanall = <span class="fu">mean</span> + area;</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">KEEP</span> meanall;</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a> <span class="kw">%DO</span> ip = <span class="dv">1</span> <span class="kw">%TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* COMPUTE RESTRICTED MEAN FOR SAMPLE WITH IPTH OBSERVATION DELETED</span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a><span class="co">      USING PROC LIFETEST */</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a><span class="kw">   PROC</span> LIFETEST<span class="kw"> DATA</span> = work OUTSURV = km1 ;</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>     <span class="fu">TIME</span> restime*dead<span class="kw">&amp;ip(</span><span class="dv">0</span>);</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>     ODS <span class="kw">SELECT</span> means;</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a>     ODS <span class="kw">OUTPUT</span> MEANS = m1;</span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a><span class="kw">   RUN</span>;</span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">SET</span> km1;</span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a>     <span class="kw">IF</span> _CENSOR_ EQ <span class="dv">0</span>;</span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a><span class="kw">   PROC</span> SORT<span class="kw"> DATA</span> = km1;</span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a>     <span class="kw">BY</span> restime;</span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a><span class="kw">   RUN</span>;</span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">SET</span> km1<span class="kw"> END</span>=LAST;</span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a>     <span class="kw">IF</span> <span class="kw">NOT</span>(LAST) <span class="kw">THEN</span> <span class="kw">DELETE</span>;</span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>     area = (<span class="kw">&amp;tmax </span>- restime)*survival;</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a>     <span class="kw">KEEP</span> area;</span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">MERGE</span> km1 m1;</span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span> = <span class="fu">mean</span> + area;</span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a>     <span class="kw">KEEP</span> <span class="fu">mean</span>;</span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* COMPUTE PSEUDOVALUE FOR IPTH OBSERVATION*/</span></span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> psu; <span class="kw">MERGE</span> psu km1;</span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a>     psu<span class="kw">&amp;ip=&amp;howmany*</span>meanall-(<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*<span class="fu">mean</span>;</span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a> <span class="kw">%END</span>;</span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a> <span class="co">/* TRANSPOSE DATASET AND MERGE WITH RAW DATA*/</span></span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> out;  <span class="kw">SET</span> psu;</span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a>   <span class="kw">ARRAY</span> y(<span class="kw">&amp;howmany)</span> psu1-psu<span class="kw">&amp;howmany;</span></span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a><span class="kw">   DO</span> j = <span class="dv">1</span> <span class="kw">TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a>     psumean=y(j);</span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a>     <span class="kw">OUTPUT</span>;</span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a><span class="kw">   END</span>;</span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a> <span class="kw">KEEP</span> psumean;</span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-90"><a href="#cb50-90" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> <span class="kw">&amp;outdata;</span> <span class="kw">MERGE</span> <span class="kw">&amp;indata </span>out;</span>
<span id="cb50-91"><a href="#cb50-91" aria-hidden="true" tabindex="-1"></a><span class="kw"> run</span>; </span>
<span id="cb50-92"><a href="#cb50-92" aria-hidden="true" tabindex="-1"></a><span class="kw">%MEND</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="table" class="level4">
<h4 class="anchored" data-anchor-id="table">Table</h4>
<div class="cell" data-hash="Ch6_cache/html/table-6.3-sas_6c59d076f80f4b80754e7bbc28db94be">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>%pseudomean(pbc3,years,fail,349,3,outmean3);</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outmean3;</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> psumean = tment alb log2bili /dist=<span class="fu">normal</span>;</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>              Analysis Of GEE Parameter Estimates</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>               Empirical Standard <span class="kw">Error</span> Estimates</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>                    Standard   <span class="dv">95</span>% Confidence</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a> Parameter Estimate    <span class="kw">Error</span>       Limits            Z Pr &gt; |Z|</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a> Intercept   <span class="dv">2.8256</span>   <span class="dv">0.3461</span>   <span class="dv">2.1472</span>   <span class="dv">3.5040</span>    <span class="dv">8.16</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a> tment       <span class="dv">0.1478</span>   <span class="dv">0.0729</span>   <span class="dv">0.0049</span>   <span class="dv">0.2908</span>    <span class="dv">2.03</span>   <span class="dv">0.0427</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a> alb         <span class="dv">0.0225</span>   <span class="dv">0.0068</span>   <span class="dv">0.0092</span>   <span class="dv">0.0359</span>    <span class="dv">3.31</span>   <span class="dv">0.0009</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a> log2bili   -<span class="dv">0.2431</span>   <span class="dv">0.0320</span>  -<span class="dv">0.3058</span>  -<span class="dv">0.1804</span>   -<span class="dv">7.60</span>   &lt;.<span class="dv">0001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="figure-6.8" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.8">Figure 6.8</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.8-r_0a3cd5d13e779f2f32d1eb8e2cdd7398">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>pseudodata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">days =</span> outmean3<span class="sc">$</span>days,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pseudo =</span> outmean3<span class="sc">$</span>pseudo,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">failtype =</span> <span class="fu">as.factor</span>(outmean3<span class="sc">$</span>fail))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> pseudo, <span class="at">shape =</span> failtype), <span class="at">data =</span> pseudodata) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">"Fail"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"X"</span>[i]<span class="sc">*</span><span class="st">" (years)"</span>)) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.8-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.8-sas_e19b50b070055459d87f8637e4b1cf81">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">* see %pseudomean(pbc3,years,fail,349,3,outmean3) above for table 6.3;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=outmean3; </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> years; </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=outmean3;</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    plot psumean*years=fail/haxis=axis1 vaxis=axis2;</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">6</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'Years'</span>);</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">4</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    symbol1  v=<span class="kw">x</span> i=none c=black;</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    symbol2  v=o i=none c=black;</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-6.9" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.9">Figure 6.9</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.9-r_63d5090ae4906efbaff2618c591e7bf3">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loess for log2 bili</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>log2bili_loess <span class="ot">&lt;-</span> <span class="fu">loess</span>(pseudo <span class="sc">~</span> log2bili, <span class="at">data =</span> outmean3, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">degree =</span> <span class="dv">1</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>outmean3<span class="sc">$</span>log2bili_loesspred <span class="ot">&lt;-</span> <span class="fu">predict</span>(log2bili_loess)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#outmean3$t_log2bili_loesspred &lt;- with(outmean3,</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        ifelse(log2bili_loesspred &gt; 0 ,</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                                               log(log2bili_loesspred/(1-log2bili_loesspred)), NA))</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> pseudo), <span class="at">data =</span> outmean3) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> log2bili_loesspred), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">"log"</span> [<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pseudo-values"</span>) <span class="sc">+</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.9-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>

<!-- ### Table 6.4 -->
<!-- ```{r} -->

<!-- #| label: table-6.4 -->
<!-- # Pseudo-obs -->
<!-- pseudo2 <- pseudoci(time = pbc3$days / 365.25, -->
<!--                     event = pbc3$status, -->
<!--                     tmax = 2) -->
<!-- b2 <- NULL -->
<!-- for(it in 1:length(pseudo2$time)){ -->
<!--   b2 <- rbind(b2,cbind(pbc3,pseudo = pseudo2$pseudo[[2]][,it], -->
<!--                        tpseudo = pseudo2$time[it])) -->
<!-- } -->
<!-- b2 <- b2[order(b2$id),] -->
<!-- # GEE fits -->
<!-- fit2 <- geese(pseudo ~ tment + I(alb-40) + I(log2(bili) - 4.6), data = b2, -->
<!--               id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--               mean.link = "logit", corstr = "independence") -->
<!-- summary(fit2) -->
<!-- fit2cloglog <- geese(pseudo ~ tment + I(alb-40) + I(log2(bili) - 4.6), data = b2, -->
<!--                      id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                      mean.link = "cloglog", corstr = "independence") -->
<!-- summary(fit2cloglog) -->
<!-- # NU ALLE ptt (kun TMENT): -->
<!-- pseudo2tot <- pseudoci(time = pbc3$days / 365.25, -->
<!--                        event = pbc3$status, -->
<!--                        tmax = 2) -->
<!-- b2tot <- NULL -->
<!-- for(it in 1:length(pseudo2tot$time)){ -->
<!--   b2tot <- rbind(b2tot,cbind(pbc3,pseudo = pseudo2tot$pseudo[[2]][,it], -->
<!--                              tpseudo = pseudo2tot$time[it],id=1:nrow(pbc3))) -->
<!-- } -->
<!-- b2tot <- b2tot[order(b2tot$id),] -->
<!-- fit2tment <- geese(pseudo ~ tment, data = b2tot, -->
<!--                    id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                    mean.link = "logit", corstr = "independence") -->
<!-- summary(fit2tment) -->
<!-- fit2tmentcloglog <- geese(pseudo ~ tment, data = b2tot, -->
<!--                           id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                           mean.link = "cloglog", corstr = "independence") -->
<!-- summary(fit2tmentcloglog) -->
<!-- ``` -->

<!-- ### Table 6.5 -->
<!-- ```{r} -->

<!-- #| label: table-6.4 -->
<!-- pseudo123 <- pseudoci(time = pbc3$days / 365.25, -->
<!--                       event = pbc3$status, -->
<!--                       tmax = c(1,2,3)) -->
<!-- b123 <- NULL -->
<!-- for(it in 1:length(pseudo123$time)){ -->
<!--   b123 <- rbind(b123,cbind(pbc3,pseudo = pseudo123$pseudo[[2]][,it], -->
<!--                            tpseudo = pseudo123$time[it])) -->
<!-- } -->
<!-- b123 <- b123[order(b123$id),] -->
<!-- # fit123 <- geese(pseudo ~ as.factor(tpseudo) + tment + I(alb-40) + I(log2(bili) - 4.6), -->
<!-- #                 data = b123, -->
<!-- #                 id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!-- #                 mean.link = "cloglog", corstr = "independence") -->
<!-- # summary(fit123) -->
<!-- b123$sex <- relevel(as.factor(b123$sex), ref = "1") -->
<!-- fit123ny <- geese(pseudo ~ as.factor(tpseudo) + tment + I(alb-40) + I(log2(bili) - 4.6) -->
<!--                   + as.factor(sex) + age, data = b123, -->
<!--                   id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                   mean.link =  "cloglog", corstr = "independence") -->
<!-- summary(fit123ny) -->
<!-- pseudo10 <- pseudoci(time = pbc3$days / 365.25, -->
<!--                      event = pbc3$status, -->
<!--                      tmax = c(0.5,1,1.5,2,2.5,3,3.5,4,4.5,5)) -->
<!-- b10 <- NULL -->
<!-- for(it in 1:length(pseudo10$time)){ -->
<!--   b10 <- rbind(b10,cbind(pbc3,pseudo = pseudo10$pseudo[[2]][,it], -->
<!--                          tpseudo = pseudo10$time[it],id=1:nrow(pbc3))) -->
<!-- } -->
<!-- b10 <- b10[order(b10$id),] -->
<!-- b10$sex <- relevel(as.factor(b10$sex), ref = "1") -->
<!-- fit10 <- geese(pseudo ~ as.factor(tpseudo) + tment + I(alb-40) + I(log2(bili) - 4.6) -->
<!--                + as.factor(sex) + age, data = b10, -->
<!--                id = id, jack = TRUE, scale.fix = TRUE, family = gaussian, -->
<!--                mean.link = "cloglog", corstr = "independence") -->
<!-- summary(fit10) -->
<!-- ``` -->
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.9-sas_8604a65234d04f776147472f92b4d2a2">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=outmean3; </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> bili; </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=outmean3;</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    plot psumean*log2bili/haxis=axis1 vaxis=axis2;</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">1</span> <span class="kw">to</span> <span class="dv">9</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'log2(bilirubin)'</span>);</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">4</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Pseudo-values'</span>);</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    symbol1 v=<span class="kw">x</span> i=sm70;</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-6.4" class="level3">
<h3 class="anchored" data-anchor-id="table-6.4">Table 6.4</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell" data-hash="Ch6_cache/html/table-6.4-r_278b31f8a84f8d17569c7311b425609a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pseudo-values based on Aalen-Johansen estimates using pseudoci()</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and merge with pbc3 data</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>ci2 <span class="ot">&lt;-</span> <span class="fu">pseudoci</span>(pbc3<span class="sc">$</span>days<span class="sc">/</span><span class="fl">365.25</span>, pbc3<span class="sc">$</span>status,<span class="at">tmax =</span> <span class="dv">2</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>dataci2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pbc3,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">pseudo.trans =</span> <span class="fu">as.vector</span>(ci2<span class="sc">$</span>pseudo[[<span class="dv">1</span>]]),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">pseudo.death =</span> <span class="fu">as.vector</span>(ci2<span class="sc">$</span>pseudo[[<span class="dv">2</span>]]))</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>geese_logit <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo.death <span class="sc">~</span> tment , <span class="at">id =</span> id,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> dataci2,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">mean.link =</span> <span class="st">"logit"</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">corstr =</span> <span class="st">"independence"</span>, <span class="at">scale.fix =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(geese_logit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept) -2.219619  0.266253 0.108651 0.064475 0.183093 0.000000
tment        0.111654  0.369947 1.118126 0.541484 2.308852 0.762796</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>geese_cloglog <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo.death <span class="sc">~</span> tment, <span class="at">id =</span> id,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> dataci2,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">mean.link =</span> <span class="st">"cloglog"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">corstr =</span> <span class="st">"independence"</span>, <span class="at">scale.fix =</span> <span class="cn">FALSE</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(geese_cloglog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept) -2.271634  0.252982 0.103144 0.062820 0.169350 0.000000
tment        0.105795  0.350554 1.111593 0.559175 2.209754 0.762811</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>geese_logit <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo.death <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">id =</span> id,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">subset</span>(dataci2, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">mean.link =</span> <span class="st">"logit"</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">corstr =</span> <span class="st">"independence"</span>, <span class="at">scale.fix =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(geese_logit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci   exp.uci   PVal.N
(Intercept) -0.486188  1.786601 0.614966 0.018538 20.400294 0.785522
tment       -0.573544  0.505353 0.563525 0.209290  1.517322 0.256401
alb         -0.143586  0.048657 0.866247 0.787452  0.952926 0.003168
log2bili     0.712280  0.187606 2.038634 1.411385  2.944646 0.000147</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>geese_cloglog <span class="ot">&lt;-</span> <span class="fu">geese</span>(pseudo.death <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">id =</span> id,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">subset</span>(dataci2, <span class="sc">!</span><span class="fu">is.na</span>(alb)),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">mean.link =</span> <span class="st">"cloglog"</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">corstr =</span> <span class="st">"independence"</span>, <span class="at">scale.fix =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(geese_cloglog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept) -0.791914  1.499176 0.452977 0.023986 8.554614 0.597338
tment       -0.518744  0.424131 0.595268 0.259230 1.366910 0.221301
alb         -0.114153  0.037407 0.892122 0.829054 0.959988 0.002276
log2bili     0.569410  0.145153 1.767224 1.329642 2.348815 0.000088</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>svydata <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>id, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>dataci2, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>svyfit_logit <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(pseudo.death <span class="sc">~</span> tment,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">design=</span>svydata, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span><span class="fu">blogit</span>()))</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(svyfit_logit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci exp.uci  PVal.N
(Intercept) -2.21962   0.26663  0.10865 0.06443 0.18323 0.00000
tment        0.11165   0.37048  1.11813 0.54092 2.31126 0.76313</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>svyfit_cloglog <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(pseudo.death <span class="sc">~</span> tment,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">design=</span>svydata, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span><span class="fu">bcloglog</span>()))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(svyfit_cloglog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci exp.uci  PVal.N
(Intercept) -2.27163   0.25334  0.10314 0.06278 0.16947 0.00000
tment        0.10579   0.35106  1.11159 0.55862 2.21194 0.76314</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>svyfit_logit <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(pseudo.death <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">design=</span>svydata, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span><span class="fu">blogit</span>()))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(svyfit_logit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci  exp.uci  PVal.N
(Intercept) -0.48606   1.78915  0.61505 0.01845 20.50513 0.78588
tment       -0.57356   0.50607  0.56352 0.20899  1.51943 0.25706
alb         -0.14359   0.04873  0.86624 0.78734  0.95305 0.00321
log2bili     0.71227   0.18787  2.03862 1.41064  2.94616 0.00015</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>svyfit_cloglog <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(pseudo.death <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">design=</span>svydata, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span><span class="fu">bcloglog</span>()))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(svyfit_cloglog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci exp.uci  PVal.N
(Intercept) -0.79221   1.50134  0.45284 0.02388 8.58844 0.59773
tment       -0.51873   0.42475  0.59528 0.25892 1.36860 0.22199
alb         -0.11415   0.03746  0.89213 0.82897 0.96010 0.00231
log2bili     0.56942   0.14536  1.76724 1.32910 2.34980 0.00009</code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<section id="macros-pseudoci" class="level4">
<h4 class="anchored" data-anchor-id="macros-pseudoci">Macros <code>pseudoci</code></h4>
<p>To use the macro <code>pseudoci</code> we need the following John Klein’s <code>cuminc</code> macro:</p>
<div class="cell" data-hash="Ch6_cache/html/macro-pseudoci-cuminc-sas_d8e2f757f6b99ad80571d3328e5dc016">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> cuminc(datain,x,re,de,dataout,cir,cid);</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*  THIS MACRO COMPUTES THE CUMULATIVE INCIDENCE FUNCTIONS FOR</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">    BOTH COMPETING RISKS USING PROC PHREG OUTPUT</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">    INPUTS TO MACRO</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">    DATAIN--NAME OF INPUT DATA SET CONTAINING </span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">        X--TIME TO EVENT</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">        RE--INDICATOR OF FIRST COMPETING RISK (1-YES, 0-NO)</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">        DE--INDICATOR OF SECOND COMPETING RISK</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">    DATAOUT--NAME OF OUTPUT DATA SET CONTAINING</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">        CIR--CUMULATIVE INCIDENCE FUNCTION FOR 1ST COMPETING RISK</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">        CID--CUMULATIVE INCIDENCE FUNCTION FOR 2ST COMPETING RISK</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> work;  <span class="kw">set</span> <span class="kw">&amp;datain;</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>t=<span class="kw">&amp;x;</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>r=<span class="kw">&amp;re;</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>d=<span class="kw">&amp;de;</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>zero=<span class="dv">0</span>;</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CRUDE CUMUALTIVE HAZARD FOR FIRST COMPETING RISK */</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=work noprint; </span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> t*r(<span class="dv">0</span>)=zero;</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span> out=rel  logsurv=chr  /method=emp;</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE CRUDE CUMUALTIVE HAZARD FOR SECOND COMPETING RISK */</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=work noprint; </span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> t*d(<span class="dv">0</span>)=zero;</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span> out=dead  logsurv=chd  /method=emp;</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE cumualtive incidence */</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> both;  <span class="kw">merge</span> rel dead;  <span class="kw">by</span> t;</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> s <span class="dv">1</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cr <span class="dv">0</span>;</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cd <span class="dv">0</span>;</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cumincr <span class="dv">0</span>;</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cumincd <span class="dv">0</span>;</span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>hr=-(cr+chr);</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>hd=-(cd+chd);</span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="co">/* NOTE HR AND HD ARE THE JUMPS IN THE CUMUALTIVE CRUDE HAZARDS AT THIS TIME */</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>cr=-chr;</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>cd=-chd;</span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>cir=cumincr+hr*s;</span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>cumincr=cir;</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>cid=cumincd+hd*s;</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>cumincd=cid;</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>s=s*(<span class="dv">1</span>-hr-hd);</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a><span class="co">/* NOTE S IS KAPLAN-MEIER ESTIMATE IGNORING CAUSE OF FAILURE */</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">&amp;dataout;</span>  <span class="kw">set</span> both;</span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;x=</span>t;</span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;cir=</span>cir;  <span class="kw">&amp;cid=</span>cid;</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;x &amp;cir &amp;cid;</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And now the <code>pseudoci</code>macro:</p>
<div class="cell" data-hash="Ch6_cache/html/macro-pseudoci-sas_eb219fd78dc318327a669ba3078c11f5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudoci(datain,x,r,d,howmany,datatau,dataout);</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*    MACRO COMPUTES PSEUDOVALUES BASED ON THE CUMUALTIVE INCIDENCE FUNCTION</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co">      FOR BOTH OF TWO COMPETING RISKS  </span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">      INPUTS:</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">      DATAIN---INPUT DATA SET</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">      X--TIME VARIABLE</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co">      R--INDICATOR OF FIRST COMPETING RISK (1-YES, 0-NO)</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co">      D--INDICATOR OF SECOND COMPETING RISK</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY---SAMPLE SIZE</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co">     </span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co">      DATATAU---SUBSET OF INPUT DATA SET AT WHICH PSEUDO VALUES ARE COMPUTED </span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co">                DATA SET HAS SINGLE VARIABLE "TIME"</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co">                </span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co">      DATAOUT---OUTPUT DATA SET WHICH CONATINS PSUK,K=1,...,HOWMANY THE PSEUDO</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="co">                VALUES AT EACH TIME POINT (Note output data set</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="co">                 includes orginal data sorted by time)</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="co">      </span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datain;</span>  <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">keep</span>;  <span class="kw">set</span> <span class="kw">&amp;datatau;</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>find=<span class="dv">1</span>;</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">set</span> <span class="kw">&amp;datain;</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;x;</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span>=<span class="dv">1</span>;</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">merge</span> <span class="fu">point</span> <span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> find <span class="kw">keep</span>;</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> useme;  <span class="kw">set</span> <span class="fu">point</span>;</span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> temp -<span class="dv">1</span>;</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">keep</span> = <span class="dv">1</span> <span class="kw">then</span> temp=<span class="fu">time</span>;</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>tuse=temp; </span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;x=</span>tuse;</span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="co">/* PREPARE DATA SET WITH MISSING VALUES FOR DEADK AND RELAPSEK TO BE USED IN COMPUTING</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a><span class="co">   ESTIMATED CUMULATIVE INCIDENCE WITH KTH OBSERVATION DELETED*/</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datain;</span></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> newdat;  <span class="kw">set</span> <span class="kw">&amp;datain </span>;</span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobsd(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobsr(<span class="kw">&amp;howmany)</span> relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a>iobsd(j)=<span class="kw">&amp;d;</span></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>iobsr(j)=<span class="kw">&amp;r;</span></span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> j=id <span class="kw">then do</span>; iobsr(j)=.; iobsd(j)=.<span class="kw">; end</span>;</span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> newdat;</span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> dead1-dead<span class="kw">&amp;howmany </span>relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CI FOR 1ST (CIRALL) AND 2ND (CIDALL) FOR FULL SAMPLE, STORE IN SALL*/</span></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a>%cuminc(newdat,&amp;x,&amp;r,&amp;d,sall,cirall,cidall);</span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a><span class="kw">%do</span> ip=<span class="dv">1</span> <span class="kw">%to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CI FOR 1ST (CIRALL) AND 2ND (CIDALL) FOR REDUCED SAMPLE, STORE IN SIP*/</span></span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>%cuminc(newdat,&amp;x,relapse&amp;ip,dead&amp;ip,stemp,cir1,cid1);</span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE PSEUDOVALUES FOR BOTH RISK AT EVERY DATA POINT AND ADD TO FILE */</span> </span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> ps; <span class="kw">merge</span> sall stemp;  <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cirtemp <span class="dv">0</span>;</span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cidtemp <span class="dv">0</span>;</span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> cir1=. <span class="kw">then</span> cir1=cirtemp;</span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a>cirtemp=cir1;</span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a>rpsu<span class="kw">&amp;ip=&amp;howmany*</span>cirall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*cir1;</span>
<span id="cb73-74"><a href="#cb73-74" aria-hidden="true" tabindex="-1"></a> <span class="kw">if</span> cid1=. <span class="kw">then</span> cid1=cidtemp;</span>
<span id="cb73-75"><a href="#cb73-75" aria-hidden="true" tabindex="-1"></a>cidtemp=cid1;</span>
<span id="cb73-76"><a href="#cb73-76" aria-hidden="true" tabindex="-1"></a>dpsu<span class="kw">&amp;ip=&amp;howmany*</span>cidall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*cid1;</span>
<span id="cb73-77"><a href="#cb73-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-78"><a href="#cb73-78" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out; <span class="kw">merge</span> out ps useme; <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb73-79"><a href="#cb73-79" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb73-80"><a href="#cb73-80" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> rpsu1-rpsu<span class="kw">&amp;ip </span>dpsu1-dpsu<span class="kw">&amp;ip &amp;x;</span></span>
<span id="cb73-81"><a href="#cb73-81" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb73-82"><a href="#cb73-82" aria-hidden="true" tabindex="-1"></a><span class="kw">%end</span>;</span>
<span id="cb73-83"><a href="#cb73-83" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb73-84"><a href="#cb73-84" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> <span class="kw">&amp;dataout;</span>  <span class="kw">set</span> newdat; </span>
<span id="cb73-85"><a href="#cb73-85" aria-hidden="true" tabindex="-1"></a> <span class="kw">drop</span> dead1-dead<span class="kw">&amp;howmany </span>relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb73-86"><a href="#cb73-86" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb73-87"><a href="#cb73-87" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> all;  <span class="kw">set</span> out;</span>
<span id="cb73-88"><a href="#cb73-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-89"><a href="#cb73-89" aria-hidden="true" tabindex="-1"></a> <span class="kw">array</span> yr(<span class="kw">&amp;howmany)</span> rpsu1-rpsu<span class="kw">&amp;howmany;</span></span>
<span id="cb73-90"><a href="#cb73-90" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> yd(<span class="kw">&amp;howmany)</span> dpsu1-dpsu<span class="kw">&amp;howmany;</span></span>
<span id="cb73-91"><a href="#cb73-91" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb73-92"><a href="#cb73-92" aria-hidden="true" tabindex="-1"></a>rpseudo=yr(j);</span>
<span id="cb73-93"><a href="#cb73-93" aria-hidden="true" tabindex="-1"></a>dpseudo=yd(j);</span>
<span id="cb73-94"><a href="#cb73-94" aria-hidden="true" tabindex="-1"></a>id=j;</span>
<span id="cb73-95"><a href="#cb73-95" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span>;</span>
<span id="cb73-96"><a href="#cb73-96" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb73-97"><a href="#cb73-97" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">time</span> rpseudo dpseudo;</span>
<span id="cb73-98"><a href="#cb73-98" aria-hidden="true" tabindex="-1"></a><span class="kw"> proc</span> sort<span class="kw"> data</span>=all;  <span class="kw">by</span> id;</span>
<span id="cb73-99"><a href="#cb73-99" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> <span class="kw">&amp;dataout;</span> <span class="kw">merge</span> <span class="kw">&amp;dataout </span>all;</span>
<span id="cb73-100"><a href="#cb73-100" aria-hidden="true" tabindex="-1"></a> <span class="kw">by</span> id;</span>
<span id="cb73-101"><a href="#cb73-101" aria-hidden="true" tabindex="-1"></a> <span class="kw">retain</span> otime -<span class="dv">1</span>;</span>
<span id="cb73-102"><a href="#cb73-102" aria-hidden="true" tabindex="-1"></a> <span class="kw">retain</span> oid -<span class="dv">1</span>;</span>
<span id="cb73-103"><a href="#cb73-103" aria-hidden="true" tabindex="-1"></a> <span class="kw">if</span> id eq oid <span class="kw">and</span> otime=<span class="fu">time</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb73-104"><a href="#cb73-104" aria-hidden="true" tabindex="-1"></a> <span class="kw">else do</span>; oid=id; otime=<span class="fu">time</span><span class="kw">; end</span>;</span>
<span id="cb73-105"><a href="#cb73-105" aria-hidden="true" tabindex="-1"></a><span class="kw"> run</span>;</span>
<span id="cb73-106"><a href="#cb73-106" aria-hidden="true" tabindex="-1"></a> <span class="kw">%mend</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="table-1" class="level4">
<h4 class="anchored" data-anchor-id="table-1">Table</h4>
<div class="cell" data-hash="Ch6_cache/html/table-6.4-sas_5e13d64984c72fa6d1eaa95c7f40389e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">* NB: Inside the macros below a variable called `id` is created which will interfere </span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">  with your identification variable is called `id` in your data set,</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">  in which case you will need to rename your `id` variable;</span> </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">* create indicator variables for each competing risk as required by the macro;</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=pbc3</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/pbc3.csv"</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3; </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3;</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    log2bili=<span class="fu">log2</span>(bili);</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    years=days/<span class="dv">365.25</span>;</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    trans=status=<span class="dv">1</span>;</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    death=status=<span class="dv">2</span>;</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rename</span> id=ptno;</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> timepoint;</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> <span class="fu">time</span>;</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines;</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="ot">    2</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="ot">    ;</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>%pseudoci(pbc3,years,trans,death,349,timepoint,cumincpv1);</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="co">* rpseudo: transplant;</span> </span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a><span class="co">* dpseudo: death;</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a><span class="co">* logit link function;</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=cumincpv1;</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo = tment / dist=<span class="fu">normal</span> noscale <span class="kw">link</span>=logit; </span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=cumincpv1;</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo = tment alb log2bili / dist=<span class="fu">normal</span> noscale <span class="kw">link</span>=logit; </span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a><span class="co">* cloglog link function;</span></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=cumincpv1;</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span> = <span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a>    invlink ilink = <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo = tment / dist=<span class="fu">normal</span> noscale ; </span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=cumincpv1;</span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span> = <span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a>    invlink ilink = <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo = tment alb log2bili / dist=<span class="fu">normal</span> noscale ; </span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="in-text-p.-233-cloglog-link-function---year-123" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-233-cloglog-link-function---year-123">In-text, p.&nbsp;233: cloglog link function - year 1,2,3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell" data-hash="Ch6_cache/html/in-text-r_5331c6da22d71e9c04ed6ba83938e4d7">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the pseudo-observations</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>pseudo <span class="ot">&lt;-</span> <span class="fu">pseudoci</span>(<span class="at">time=</span>pbc3<span class="sc">$</span>days<span class="sc">/</span><span class="fl">365.25</span>,<span class="at">event=</span>pbc3<span class="sc">$</span>status,<span class="at">tmax=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">#rearrange the data into a long data set, use only pseudo-observations for death,</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e.,  status=2:  pseudo$pseudo[[2]],</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pseudo<span class="sc">$</span>time)){</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rbind</span>(b,<span class="fu">cbind</span>(pbc3,<span class="at">death.pseudo =</span> pseudo<span class="sc">$</span>pseudo[[<span class="dv">2</span>]][,it],</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="at">tpseudo =</span> pseudo<span class="sc">$</span>time[it],<span class="at">idno=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3)))</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>dataci3 <span class="ot">&lt;-</span> b[<span class="fu">order</span>(b<span class="sc">$</span>idno),]</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co"># geese</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(death.pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">factor</span>(tpseudo),</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(dataci3,<span class="sc">!</span><span class="fu">is.na</span>(alb)), <span class="at">id=</span>idno,</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">family=</span>gaussian, <span class="at">mean.link =</span> <span class="st">"cloglog"</span>, <span class="at">corstr=</span><span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      beta SD.robust exp.beta  exp.lci   exp.uci   PVal.N
(Intercept)      -0.261582  1.344886 0.769832 0.055158 10.744500 0.845783
tment            -0.509819  0.348199 0.600604 0.303525  1.188452 0.143150
alb              -0.106465  0.031640 0.899006 0.844949  0.956522 0.000766
log2bili          0.517712  0.116717 1.678183 1.335020  2.109555 0.000009
factor(tpseudo)1 -1.090629  0.225800 0.336005 0.215845  0.523059 0.000001
factor(tpseudo)2 -0.451689  0.132065 0.636552 0.491380  0.824613 0.000626</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># svyglm</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>svydata3 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>idno, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>dataci3, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(death.pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili<span class="sc">+</span><span class="fu">factor</span>(tpseudo)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">design=</span>svydata3, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span> <span class="fu">bcloglog</span>())))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     beta SD.robust exp.beta exp.lci  exp.uci  PVal.N
tment            -0.50982   0.34870  0.60061 0.30323  1.18962 0.14373
alb              -0.10646   0.03168  0.89901 0.84488  0.95661 0.00078
log2bili          0.51771   0.11688  1.67818 1.33458  2.11024 0.00001
factor(tpseudo)1 -1.35232   1.31432  0.25864 0.01968  3.39993 0.30352
factor(tpseudo)2 -0.71337   1.33521  0.48999 0.03578  6.71032 0.59315
factor(tpseudo)3 -0.26168   1.34680  0.76976 0.05495 10.78386 0.84595</code></pre>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell" data-hash="Ch6_cache/html/in-text-sas_e5f8064f16c0798175808cfe2b1f1be1">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> timepoints;</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> <span class="fu">time</span>;</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines;</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    1</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    2</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    3</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    ;</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>%pseudoci(pbc3,years,trans,death,349,timepoints,cumincpv3);</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co">* cloglog link function - year 1,2,3;</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=cumincpv3;</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    class ptno <span class="fu">time</span>;</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span> = <span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    invlink ilink = <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo = tment alb log2bili <span class="fu">time</span> / dist=<span class="fu">normal</span> noscale ; </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-6.5" class="level3">
<h3 class="anchored" data-anchor-id="table-6.5">Table 6.5</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<section id="time-points" class="level4">
<h4 class="anchored" data-anchor-id="time-points">3 time points</h4>
<div class="cell" data-hash="Ch6_cache/html/table-6.5-3times-r_2f34c11505cb10f7d9e8e7b5e0d81594">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pseudo-values based on Aalen-Johansen estimates using pseudoci()</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and merge with pbc3 data</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>pseudo <span class="ot">&lt;-</span> <span class="fu">pseudoci</span>(<span class="at">time=</span>pbc3<span class="sc">$</span>days<span class="sc">/</span><span class="fl">365.25</span>,<span class="at">event=</span>pbc3<span class="sc">$</span>status,<span class="at">tmax=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange the data into a long data set, use only pseudo-observations for death,</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e.,  status=2:  pseudo$pseudo[[2]],</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pseudo<span class="sc">$</span>time)){</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rbind</span>(b,<span class="fu">cbind</span>(pbc3,<span class="at">death.pseudo =</span> pseudo<span class="sc">$</span>pseudo[[<span class="dv">2</span>]][,it],</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tpseudo =</span> pseudo<span class="sc">$</span>time[it],<span class="at">idno=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3)))</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>dataci3 <span class="ot">&lt;-</span> b[<span class="fu">order</span>(b<span class="sc">$</span>idno),]</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co"># geese</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(death.pseudo<span class="sc">~</span>tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili<span class="sc">+</span>sex<span class="sc">+</span>age<span class="sc">+</span><span class="fu">factor</span>(tpseudo),</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(dataci3,<span class="sc">!</span><span class="fu">is.na</span>(alb)),<span class="at">id=</span>idno,</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">family=</span>gaussian, <span class="at">mean.link =</span> <span class="st">"cloglog"</span>, <span class="at">corstr=</span><span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept)      -6.406249  2.217556 0.001651 0.000021 0.127475 0.003866
tment            -0.271673  0.336437 0.762103 0.394124 1.473650 0.419378
alb              -0.075997  0.033083 0.926819 0.868627 0.988908 0.021611
log2bili          0.665681  0.120499 1.945816 1.536495 2.464179 0.000000
sex               0.501740  0.399031 1.651593 0.755512 3.610478 0.208609
age               0.073409  0.022257 1.076170 1.030232 1.124156 0.000973
factor(tpseudo)1 -1.250392  0.277938 0.286393 0.166103 0.493796 0.000007
factor(tpseudo)2 -0.559604  0.172916 0.571435 0.407172 0.801966 0.001211</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># svyglm</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>svydata3 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>idno, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>dataci3, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(death.pseudo <span class="sc">~</span> tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili<span class="sc">+</span>sex<span class="sc">+</span>age<span class="sc">+</span><span class="fu">factor</span>(tpseudo)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">design=</span>svydata3, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span> <span class="fu">bcloglog</span>())))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     beta SD.robust exp.beta exp.lci exp.uci  PVal.N
tment            -0.27168   0.33691  0.76210 0.39375 1.47501 0.42002
alb              -0.07600   0.03313  0.92682 0.86855 0.98900 0.02180
log2bili          0.66567   0.12067  1.94580 1.53598 2.46496 0.00000
sex               0.50177   0.39960  1.65164 0.75469 3.61464 0.20924
age               0.07341   0.02229  1.07617 1.03017 1.12422 0.00099
factor(tpseudo)1 -7.65653   2.21309  0.00047 0.00001 0.03619 0.00054
factor(tpseudo)2 -6.96572   2.23153  0.00094 0.00001 0.07488 0.00180
factor(tpseudo)3 -6.40610   2.22068  0.00165 0.00002 0.12828 0.00392</code></pre>
</div>
</div>
</section>
<section id="time-points-1" class="level4">
<h4 class="anchored" data-anchor-id="time-points-1">10 time points</h4>
<div class="cell" data-hash="Ch6_cache/html/table-6.5-10times-r_b3d799699953e9c6264c7ed7b98619ce">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate pseudo-values based on Aalen-Johansen estimates using pseudoci()</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and merge with pbc3 data</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>pseudo <span class="ot">&lt;-</span> <span class="fu">pseudoci</span>(<span class="at">time=</span>pbc3<span class="sc">$</span>days<span class="sc">/</span><span class="fl">365.25</span>,<span class="at">event=</span>pbc3<span class="sc">$</span>status,<span class="at">tmax=</span><span class="fu">seq</span>(<span class="fl">0.5</span>,<span class="dv">5</span>,<span class="fl">0.5</span>))</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange the data into a long data set, use only pseudo-observations for death,</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e.,  status=2:  pseudo$pseudo[[2]],</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pseudo<span class="sc">$</span>time)){</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rbind</span>(b,<span class="fu">cbind</span>(pbc3,<span class="at">death.pseudo =</span> pseudo<span class="sc">$</span>pseudo[[<span class="dv">2</span>]][,it],</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="at">tpseudo =</span> pseudo<span class="sc">$</span>time[it],<span class="at">idno=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3)))</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>dataci10 <span class="ot">&lt;-</span> b[<span class="fu">order</span>(b<span class="sc">$</span>idno),]</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="co"># geese</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(death.pseudo<span class="sc">~</span>tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili<span class="sc">+</span>sex<span class="sc">+</span>age<span class="sc">+</span><span class="fu">factor</span>(tpseudo),</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(dataci10,<span class="sc">!</span><span class="fu">is.na</span>(alb)),<span class="at">id=</span>idno,</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">family=</span>gaussian, <span class="at">mean.link =</span> <span class="st">"cloglog"</span>, <span class="at">corstr=</span><span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept)        -8.317791  2.280980 0.000244 0.000003 0.021342 0.000266
tment              -0.407879  0.317456 0.665059 0.356973 1.239038 0.198850
alb                -0.037795  0.032187 0.962910 0.904040 1.025614 0.240298
log2bili            0.668563  0.118147 1.951432 1.548047 2.459928 0.000000
sex                 0.851497  0.388020 2.343153 1.095245 5.012911 0.028202
age                 0.096334  0.022090 1.101127 1.054470 1.149849 0.000013
factor(tpseudo)0.5 -3.837984  0.855628 0.021537 0.004026 0.115215 0.000007
factor(tpseudo)1   -2.060869  0.379676 0.127343 0.060505 0.268017 0.000000
factor(tpseudo)1.5 -1.598225  0.315035 0.202255 0.109078 0.375027 0.000000
factor(tpseudo)2   -1.371611  0.289547 0.253698 0.143830 0.447491 0.000002
factor(tpseudo)2.5 -1.158939  0.268789 0.313819 0.185303 0.531467 0.000016
factor(tpseudo)3   -0.706484  0.221593 0.493376 0.319561 0.761731 0.001432
factor(tpseudo)3.5 -0.497828  0.200511 0.607849 0.410315 0.900480 0.013035
factor(tpseudo)4   -0.201936  0.146273 0.817147 0.613466 1.088454 0.167419
factor(tpseudo)4.5 -0.205112  0.147055 0.814556 0.610584 1.086667 0.163077</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># svyglm</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>svydata10 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>idno, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>dataci10, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(death.pseudo <span class="sc">~</span> tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili<span class="sc">+</span>sex<span class="sc">+</span>age<span class="sc">+</span><span class="fu">factor</span>(tpseudo)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">design=</span>svydata10, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span><span class="fu">bcloglog</span>())))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        beta SD.robust exp.beta exp.lci exp.uci  PVal.N
tment               -0.40782   0.31790  0.66510 0.35668 1.24019 0.19954
alb                 -0.03780   0.03223  0.96290 0.90396 1.02569 0.24084
log2bili             0.66853   0.11831  1.95137 1.54752 2.46062 0.00000
sex                  0.85135   0.38856  2.34281 1.09392 5.01751 0.02845
age                  0.09633   0.02212  1.10112 1.05440 1.14991 0.00001
factor(tpseudo)0.5 -12.15365   2.63773  0.00001 0.00000 0.00093 0.00000
factor(tpseudo)1   -10.37780   2.38032  0.00003 0.00000 0.00330 0.00001
factor(tpseudo)1.5  -9.91517   2.36244  0.00005 0.00000 0.00507 0.00003
factor(tpseudo)2    -9.68856   2.36301  0.00006 0.00000 0.00636 0.00004
factor(tpseudo)2.5  -9.47592   2.34952  0.00008 0.00000 0.00767 0.00006
factor(tpseudo)3    -9.02351   2.31359  0.00012 0.00000 0.01123 0.00010
factor(tpseudo)3.5  -8.81484   2.31331  0.00015 0.00000 0.01383 0.00014
factor(tpseudo)4    -8.51899   2.28551  0.00020 0.00000 0.01761 0.00019
factor(tpseudo)4.5  -8.52217   2.28615  0.00020 0.00000 0.01757 0.00019
factor(tpseudo)5    -8.31701   2.28395  0.00024 0.00000 0.02148 0.00027</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<section id="time-points-2" class="level4">
<h4 class="anchored" data-anchor-id="time-points-2">3 time points</h4>
<div class="cell" data-hash="Ch6_cache/html/table-6.5-3times-sas_217a9e2011aea5971e1d33f200f178f8">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">* cloglog link function - 3 time points;</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=cumincpv3;</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    class ptno <span class="fu">time</span>;</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span> = <span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    invlink ilink = <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo = tment alb log2bili sex age <span class="fu">time</span> / dist=<span class="fu">normal</span> noscale ; </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>               Analysis Of GEE Parameter Estimates</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>                Empirical Standard <span class="kw">Error</span> Estimates</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>                      Standard   <span class="dv">95</span>% Confidence</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a> Parameter   Estimate    <span class="kw">Error</span>       Limits            Z Pr &gt; |Z|</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a> Intercept    -<span class="dv">6.4063</span>   <span class="dv">2.2176</span> -<span class="dv">10.7526</span>  -<span class="dv">2.0599</span>   -<span class="dv">2.89</span>   <span class="dv">0.0039</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a> tment        -<span class="dv">0.2717</span>   <span class="dv">0.3364</span>  -<span class="dv">0.9311</span>   <span class="dv">0.3877</span>   -<span class="dv">0.81</span>   <span class="dv">0.4194</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a> alb          -<span class="dv">0.0760</span>   <span class="dv">0.0331</span>  -<span class="dv">0.1408</span>  -<span class="dv">0.0112</span>   -<span class="dv">2.30</span>   <span class="dv">0.0216</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a> log2bili      <span class="dv">0.6657</span>   <span class="dv">0.1205</span>   <span class="dv">0.4295</span>   <span class="dv">0.9019</span>    <span class="dv">5.52</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a> sex           <span class="dv">0.5017</span>   <span class="dv">0.3990</span>  -<span class="dv">0.2803</span>   <span class="dv">1.2838</span>    <span class="dv">1.26</span>   <span class="dv">0.2086</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a> age           <span class="dv">0.0734</span>   <span class="dv">0.0223</span>   <span class="dv">0.0298</span>   <span class="dv">0.1170</span>    <span class="dv">3.30</span>   <span class="dv">0.0010</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">1</span>  -<span class="dv">1.2504</span>   <span class="dv">0.2779</span>  -<span class="dv">1.7951</span>  -<span class="dv">0.7056</span>   -<span class="dv">4.50</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">2</span>  -<span class="dv">0.5596</span>   <span class="dv">0.1729</span>  -<span class="dv">0.8985</span>  -<span class="dv">0.2207</span>   -<span class="dv">3.24</span>   <span class="dv">0.0012</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">3</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>     .      .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="time-points-3" class="level4">
<h4 class="anchored" data-anchor-id="time-points-3">10 time points</h4>
<p>Initial values from R used to make <code>proc genmod</code> converge.</p>
<div class="cell" data-hash="Ch6_cache/html/table-6.5-10times-sas_d3e12f9027f51dc71e224f25456f22e7">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">* cloglog link function - 10 time points;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> time10points;</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> <span class="fu">time</span>;</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines;</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    .5</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="ot">    1</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="ot">    1.5</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="ot">    2</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="ot">    2.5</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="ot">    3</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="ot">    3.5</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="ot">    4</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="ot">    4.5</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="ot">    5</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="ot">    ;</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>%pseudoci(pbc3,years,trans,death,349,time10points,cumincpv10);</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=cumincpv10;</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    class ptno <span class="fu">time</span>(ref=<span class="st">"5"</span>);</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span> = <span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    invlink ilink = <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo = tment alb log2bili sex age <span class="fu">time</span> / dist=<span class="fu">normal</span> noscale </span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>  intercept=-<span class="dv">8.3</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>  initial=</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>-<span class="dv">0.4</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>-<span class="dv">0.04</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a> <span class="dv">0.6</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a> <span class="dv">0.8</span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a> <span class="dv">0.09</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>-<span class="dv">3.8</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>-<span class="dv">2.0</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>-<span class="dv">1.5</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>-<span class="dv">1.3</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>-<span class="dv">1.1</span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>-<span class="dv">0.7</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>-<span class="dv">0.4</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>-<span class="dv">0.2</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>-<span class="dv">0.2</span></span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno / corr=ind;</span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>                Analysis Of GEE Parameter Estimates</span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a>                 Empirical Standard <span class="kw">Error</span> Estimates</span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>                        Standard   <span class="dv">95</span>% Confidence</span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a> Parameter     Estimate    <span class="kw">Error</span>       Limits            Z Pr &gt; |Z|</span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a> Intercept      -<span class="dv">8.3178</span>   <span class="dv">2.2810</span> -<span class="dv">12.7885</span>  -<span class="dv">3.8472</span>   -<span class="dv">3.65</span>   <span class="dv">0.0003</span></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a> tment          -<span class="dv">0.4079</span>   <span class="dv">0.3175</span>  -<span class="dv">1.0301</span>   <span class="dv">0.2143</span>   -<span class="dv">1.28</span>   <span class="dv">0.1988</span></span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a> alb            -<span class="dv">0.0378</span>   <span class="dv">0.0322</span>  -<span class="dv">0.1009</span>   <span class="dv">0.0253</span>   -<span class="dv">1.17</span>   <span class="dv">0.2403</span></span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a> log2bili        <span class="dv">0.6686</span>   <span class="dv">0.1181</span>   <span class="dv">0.4370</span>   <span class="dv">0.9001</span>    <span class="dv">5.66</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a> sex             <span class="dv">0.8515</span>   <span class="dv">0.3880</span>   <span class="dv">0.0910</span>   <span class="dv">1.6120</span>    <span class="dv">2.19</span>   <span class="dv">0.0282</span></span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a> age             <span class="dv">0.0963</span>   <span class="dv">0.0221</span>   <span class="dv">0.0530</span>   <span class="dv">0.1396</span>    <span class="dv">4.36</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">0.5</span>  -<span class="dv">3.8381</span>   <span class="dv">0.8557</span>  -<span class="dv">5.5151</span>  -<span class="dv">2.1610</span>   -<span class="dv">4.49</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">1</span>    -<span class="dv">2.0609</span>   <span class="dv">0.3797</span>  -<span class="dv">2.8050</span>  -<span class="dv">1.3167</span>   -<span class="dv">5.43</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">1.5</span>  -<span class="dv">1.5982</span>   <span class="dv">0.3150</span>  -<span class="dv">2.2157</span>  -<span class="dv">0.9808</span>   -<span class="dv">5.07</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">2</span>    -<span class="dv">1.3716</span>   <span class="dv">0.2895</span>  -<span class="dv">1.9391</span>  -<span class="dv">0.8041</span>   -<span class="dv">4.74</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">2.5</span>  -<span class="dv">1.1589</span>   <span class="dv">0.2688</span>  -<span class="dv">1.6858</span>  -<span class="dv">0.6321</span>   -<span class="dv">4.31</span>   &lt;.<span class="dv">0001</span></span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">3</span>    -<span class="dv">0.7065</span>   <span class="dv">0.2216</span>  -<span class="dv">1.1408</span>  -<span class="dv">0.2722</span>   -<span class="dv">3.19</span>   <span class="dv">0.0014</span></span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">3.5</span>  -<span class="dv">0.4978</span>   <span class="dv">0.2005</span>  -<span class="dv">0.8908</span>  -<span class="dv">0.1048</span>   -<span class="dv">2.48</span>   <span class="dv">0.0130</span></span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">4</span>    -<span class="dv">0.2019</span>   <span class="dv">0.1463</span>  -<span class="dv">0.4886</span>   <span class="dv">0.0848</span>   -<span class="dv">1.38</span>   <span class="dv">0.1674</span></span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">4.5</span>  -<span class="dv">0.2051</span>   <span class="dv">0.1471</span>  -<span class="dv">0.4933</span>   <span class="dv">0.0831</span>   -<span class="dv">1.39</span>   <span class="dv">0.1631</span></span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a> <span class="fu">time</span>      <span class="dv">5</span>     <span class="dv">0.0000</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>   <span class="dv">0.0000</span>     .      .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="table-6.6" class="level3">
<h3 class="anchored" data-anchor-id="table-6.6">Table 6.6</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell" data-hash="Ch6_cache/html/table-6.6-r_c79acebb6f7b9461512316a8e5ca1a00">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lost years</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>pseudolost <span class="ot">&lt;-</span> <span class="fu">pseudoyl</span>(<span class="at">time =</span> pbc3<span class="sc">$</span>days <span class="sc">/</span> <span class="fl">365.25</span>,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">event =</span> <span class="fu">as.integer</span>(pbc3<span class="sc">$</span>status),</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">3</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pbc3,<span class="at">pseudo =</span> pseudolost<span class="sc">$</span>pseudo[[<span class="dv">1</span>]],<span class="at">idno=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3))</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>death <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pbc3,<span class="at">pseudo =</span> pseudolost<span class="sc">$</span>pseudo[[<span class="dv">2</span>]],<span class="at">idno=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3))</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>svytrans <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>idno, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>trans, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>svydeath <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>idno, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>death, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Transplantation</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(pseudo <span class="sc">~</span> tment,<span class="at">data =</span> trans,<span class="at">id =</span> idno,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> gaussian, <span class="at">corstr =</span> <span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept)  0.143046  0.041216 1.153782 1.064242 1.250857 0.000519
tment       -0.056386  0.051029 0.945174 0.855214 1.044598 0.269173</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(pseudo <span class="sc">~</span> tment, <span class="at">design=</span>svytrans, <span class="at">family=</span>gaussian))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci exp.uci  PVal.N
(Intercept)  0.14305   0.04128  1.15378 1.06412 1.25100 0.00053
tment       -0.05639   0.05110  0.94517 0.85509 1.04475 0.26986</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> <span class="fu">log2</span>(bili),</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(trans,<span class="sc">!</span><span class="fu">is.na</span>(alb)), <span class="at">id =</span> idno,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> gaussian, <span class="at">corstr =</span> <span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept) -0.292596  0.214510 0.746324 0.490154 1.136375 0.172561
tment       -0.062970  0.045824 0.938971 0.858313 1.027209 0.169389
alb         -0.000748  0.004088 0.999252 0.991278 1.007291 0.854839
log2(bili)   0.100151  0.026282 1.105338 1.049842 1.163768 0.000139</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(pseudo <span class="sc">~</span> tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili,<span class="at">design=</span>svytrans,<span class="at">family=</span> gaussian))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci exp.uci  PVal.N
(Intercept) -0.29260   0.21482  0.74632 0.48986 1.13706 0.17318
tment       -0.06297   0.04589  0.93897 0.85820 1.02734 0.17000
alb         -0.00075   0.00409  0.99925 0.99127 1.00730 0.85504
log2bili     0.10015   0.02632  1.10534 1.04976 1.16385 0.00014</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Death without transplantation</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(pseudo <span class="sc">~</span> tment, <span class="at">data =</span> death, <span class="at">id =</span> idno,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> gaussian, <span class="at">corstr =</span> <span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept)  0.251531  0.053156 1.285992 1.158753 1.427203 0.000002
tment       -0.015210  0.072919 0.984905 0.853737 1.136225 0.834771</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(pseudo <span class="sc">~</span> tment, <span class="at">design=</span>svydeath, <span class="at">family=</span>gaussian))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci exp.uci PVal.N
(Intercept)  0.25153   0.05323  1.28599 1.15858 1.42742  0.000
tment       -0.01521   0.07302  0.98491 0.85356 1.13646  0.835</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> <span class="fu">log2</span>(bili),</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(death,<span class="sc">!</span><span class="fu">is.na</span>(alb)), <span class="at">id =</span> idno, </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> gaussian, <span class="at">corstr =</span> <span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 beta SD.robust exp.beta  exp.lci  exp.uci   PVal.N
(Intercept)  0.466997  0.323932 1.595197 0.845430 3.009892 0.149401
tment       -0.084843  0.068542 0.918657 0.803173 1.050746 0.215784
alb         -0.021764  0.006549 0.978471 0.965991 0.991112 0.000890
log2(bili)   0.142942  0.032317 1.153663 1.082855 1.229100 0.000010</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(pseudo <span class="sc">~</span> tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili,<span class="at">design=</span>svydeath,<span class="at">family=</span> gaussian))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                beta SD.robust exp.beta exp.lci exp.uci  PVal.N
(Intercept)  0.46700   0.32440  1.59520 0.84466 3.01264 0.14998
tment       -0.08484   0.06864  0.91866 0.80302 1.05095 0.21644
alb         -0.02176   0.00656  0.97847 0.96597 0.99113 0.00091
log2bili     0.14294   0.03236  1.15366 1.08276 1.22921 0.00001</code></pre>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">

</div>
</div>
</div>
</section>
<section id="figure-6.12" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.12">Figure 6.12</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<section id="left-3" class="level4">
<h4 class="anchored" data-anchor-id="left-3">left</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.12left-r_8e48934f31fa640b97c0c1f0f09a631f">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comp. end point t=2 smlg med IJ</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pseudo)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>nystatus<span class="ot">&lt;-</span><span class="fu">ifelse</span>(pbc3<span class="sc">$</span>status <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>pseudo <span class="ot">&lt;-</span> <span class="fu">pseudosurv</span>(<span class="at">time =</span> pbc3<span class="sc">$</span>days,</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">event =</span> pbc3<span class="sc">$</span>nystatus,</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tmax=</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(days, status <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>IJpseudo <span class="ot">&lt;-</span> <span class="fu">pseudo</span>(fit, <span class="at">times =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>, <span class="at">addNA =</span> <span class="cn">TRUE</span>, <span class="at">data.frame =</span> <span class="cn">TRUE</span>, <span class="at">minus1 =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>pdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">IJpseudo =</span> IJpseudo<span class="sc">$</span>pseudo,</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pseudo =</span> pseudo<span class="sc">$</span>pseudo,</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">diff =</span> IJpseudo<span class="sc">$</span>pseudo <span class="sc">-</span> pseudo<span class="sc">$</span>pseudo)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span>left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pseudo, <span class="at">y =</span> IJpseudo), <span class="at">data =</span> pdata) <span class="sc">+</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"IJ pseudo-value"</span>) <span class="sc">+</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pseudo-value"</span>) <span class="sc">+</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>),</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>),</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.12left-r-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="right-3" class="level4">
<h4 class="anchored" data-anchor-id="right-3">right</h4>
<div class="cell" data-hash="Ch6_cache/html/figure-6.12right-r_fd9afc5f38f04cdec023b0ca0b3c4c6f">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pseudo, <span class="at">y =</span> IJpseudo <span class="sc">-</span> pseudo), <span class="at">data =</span> pdata) <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Difference"</span>) <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pseudo-value"</span>) <span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>),</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span>),</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="at">by =</span> <span class="fl">0.005</span>)) <span class="sc">+</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.12right-r-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.12-sas_26b04ef0ac0061a4182d33246510ac95">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="prova-trial-in-liver-cirrhosis" class="level2">
<h2 class="anchored" data-anchor-id="prova-trial-in-liver-cirrhosis">PROVA trial in liver cirrhosis</h2>
<p>Only R code available.</p>
<section id="figure-6.10" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.10">Figure 6.10</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">R</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.10_df548943a53e79b0971e08eb7abb9a1e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>prova <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/prova.csv"</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"."</span>))</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>prova <span class="ot">&lt;-</span> prova <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">timebleed =</span> <span class="fu">ifelse</span>(bleed <span class="sc">==</span> <span class="dv">1</span>, timebleed, timedeath),</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">outof0 =</span> <span class="fu">ifelse</span>(bleed <span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>, death),</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">wait =</span> <span class="fu">ifelse</span>(bleed <span class="sc">==</span><span class="dv">1</span>, timedeath <span class="sc">-</span> timebleed, <span class="cn">NA</span>))</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mstate) <span class="co"># LMAJ</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="co"># transition matrix for irreversible illness-death model</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>tmat <span class="ot">&lt;-</span> <span class="fu">trans.illdeath</span>(<span class="at">names =</span> <span class="fu">c</span>(<span class="st">"Non-bleeding"</span>, <span class="st">"Bleeding"</span>, <span class="st">"Dead"</span>))</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>long_format_scle0 <span class="ot">&lt;-</span> <span class="fu">msprep</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"timebleed"</span>, <span class="st">"timedeath"</span>),</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">status =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"bleed"</span>, <span class="st">"death"</span>), </span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> <span class="fu">subset</span>(<span class="fu">as.data.frame</span>(prova), scle <span class="sc">==</span><span class="dv">0</span>), </span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">trans =</span> tmat, <span class="at">keep =</span> <span class="st">"scle"</span>)</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>long_format_scle1 <span class="ot">&lt;-</span> <span class="fu">msprep</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"timebleed"</span>, <span class="st">"timedeath"</span>),</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">status =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"bleed"</span>, <span class="st">"death"</span>), </span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> <span class="fu">subset</span>(<span class="fu">as.data.frame</span>(prova), scle <span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>                            <span class="at">trans =</span> tmat, <span class="at">keep =</span> <span class="st">"scle"</span>)</span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimation of transition probabilities with the Landmark Aalen-Johansen estimator</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Warning is not related to the estimate of pstate2</span></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>LMAaJ_scle0 <span class="ot">&lt;-</span> <span class="fu">LMAJ</span>(long_format_scle0, <span class="at">s =</span> <span class="fl">365.25</span>, <span class="at">from =</span> <span class="dv">1</span>) <span class="co">#P(V(t) = 1 | V(1) = 0)</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>LMAaJ_scle1 <span class="ot">&lt;-</span> <span class="fu">LMAJ</span>(long_format_scle1, <span class="at">s =</span> <span class="fl">365.25</span>, <span class="at">from =</span> <span class="dv">1</span>) <span class="co">#P(V(t) = 1 | V(1) = 0)</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>LMAJ_scle0_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(LMAaJ_scle0<span class="sc">$</span>time,LMAaJ_scle0<span class="sc">$</span>pstate2, <span class="st">"No"</span>))</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(LMAJ_scle0_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"p01"</span>, <span class="st">"Sclerotherapy"</span>)</span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>LMAJ_scle1_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(LMAaJ_scle1<span class="sc">$</span>time, LMAaJ_scle1<span class="sc">$</span>pstate2, <span class="st">"Yes"</span>))</span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(LMAJ_scle1_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"p01"</span>, <span class="st">"Sclerotherapy"</span>)</span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>LMAJ_scle <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(LMAJ_scle0_data, LMAJ_scle1_data))</span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>  LMAJ_scle,<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(time)<span class="sc">/</span><span class="fl">365.25</span>, <span class="at">y =</span> <span class="fu">as.numeric</span>(p01), <span class="at">group =</span> Sclerotherapy)) <span class="sc">+</span> </span>
<span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span> </span>
<span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(),<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.94</span>,<span class="fl">4.2</span>)) <span class="sc">+</span>  </span>
<span id="cb109-46"><a href="#cb109-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">linetype=</span>Sclerotherapy) <span class="sc">+</span> theme_general <span class="sc">+</span> </span>
<span id="cb109-47"><a href="#cb109-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">"cm"</span>),<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb109-48"><a href="#cb109-48" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.10-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="table-6.7" class="level3">
<h3 class="anchored" data-anchor-id="table-6.7">Table 6.7</h3>
<p>No code available - results are from: Andersen, P. K., Wandall, E. N. S., Pohar Perme, M. (2022). Inference for transition probabilities in non-Markov multi-state models. <em>Lifetime Data Analysis</em>, 28:585–604.</p>
</section>
</section>
<section id="leader-cardiovascular-trial-in-type-2-diabetes" class="level2">
<h2 class="anchored" data-anchor-id="leader-cardiovascular-trial-in-type-2-diabetes">LEADER cardiovascular trial in type 2 diabetes</h2>
<section id="figure-6.11" class="level3">
<h3 class="anchored" data-anchor-id="figure-6.11">Figure 6.11</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-52_dd601ba98d0f28b7acc02aee20fc7985">

</div>
<p>Assume that the LEADER data set is loaded in data set <code>leader_mi</code>.</p>
<div class="cell" data-hash="Ch6_cache/html/figure-6.11-r_a32152c98a06a1d21372151efab9aae5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mets)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>np_ests <span class="ot">&lt;-</span> <span class="cf">function</span>(endpointdat){</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit NAa</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  NAa_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat, </span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> endpointdat, <span class="at">id =</span> id,</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ctype =</span> <span class="dv">1</span>)</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit KM</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  KM_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> treat,</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> endpointdat, <span class="at">id =</span> id,</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ctype =</span> <span class="dv">1</span>)</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust hat(mu)</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>  mu_adj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">cumsum</span>(KM_fit<span class="sc">$</span>surv[<span class="dv">1</span><span class="sc">:</span>KM_fit<span class="sc">$</span>strata[[<span class="dv">1</span>]]] <span class="sc">*</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">diff</span>(NAa_fit<span class="sc">$</span>cumhaz[<span class="dv">1</span><span class="sc">:</span>NAa_fit<span class="sc">$</span>strata[[<span class="dv">1</span>]]]))),</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">cumsum</span>(KM_fit<span class="sc">$</span>surv[(KM_fit<span class="sc">$</span>strata[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(KM_fit<span class="sc">$</span>strata[[<span class="dv">1</span>]] <span class="sc">+</span> KM_fit<span class="sc">$</span>strata[[<span class="dv">2</span>]])] <span class="sc">*</span> </span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(NAa_fit<span class="sc">$</span>cumhaz[(NAa_fit<span class="sc">$</span>strata[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(NAa_fit<span class="sc">$</span>strata[[<span class="dv">1</span>]] <span class="sc">+</span> NAa_fit<span class="sc">$</span>strata[[<span class="dv">2</span>]])]))))</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>  dat_adj <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mu =</span> mu_adj, </span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">time =</span> NAa_fit<span class="sc">$</span>time, </span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">treat =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Liraglutide"</span>, NAa_fit<span class="sc">$</span>strata[[<span class="dv">1</span>]]), <span class="fu">rep</span>(<span class="st">"Placebo"</span>, NAa_fit<span class="sc">$</span>strata[[<span class="dv">2</span>]])),</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Mortality taken into account (GL)"</span>, <span class="fu">length</span>(NAa_fit<span class="sc">$</span>time)))</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>  pdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dat_adj)</span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time  <span class="sc">*</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="fl">365.25</span> <span class="sc">/</span> <span class="dv">12</span>), <span class="at">y =</span> mu), <span class="at">data =</span> pdat) <span class="sc">+</span> </span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> treat), <span class="at">size =</span> <span class="fl">1.05</span>) <span class="sc">+</span> </span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Time since randomization (months)"</span>) <span class="sc">+</span> </span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">hat</span>(mu)<span class="sc">*</span> <span class="st">"(t)"</span>)) <span class="sc">+</span> </span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>),</span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>, </span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.box =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">65</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">65</span>, <span class="at">by =</span> <span class="dv">12</span>)) <span class="sc">+</span> </span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.12</span>, <span class="at">by =</span> <span class="fl">0.02</span>))</span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>  <span class="do">## S</span></span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a>  dat_S <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">surv =</span> KM_fit<span class="sc">$</span>surv, </span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>                          <span class="at">time =</span> KM_fit<span class="sc">$</span>time, </span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>                          <span class="at">treat =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Liraglutide"</span>, KM_fit<span class="sc">$</span>strata[[<span class="dv">1</span>]]), <span class="fu">rep</span>(<span class="st">"Placebo"</span>, KM_fit<span class="sc">$</span>strata[[<span class="dv">2</span>]])))</span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>  surv <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time  <span class="sc">*</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="fl">365.25</span> <span class="sc">/</span> <span class="dv">12</span>), <span class="at">y =</span> surv), <span class="at">data =</span> dat_S) <span class="sc">+</span> </span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> treat), <span class="at">size =</span> <span class="fl">1.05</span>) <span class="sc">+</span> </span>
<span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Time since randomization (months)"</span>) <span class="sc">+</span> </span>
<span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">hat</span>(S)<span class="sc">*</span> <span class="st">"(t)"</span>)) <span class="sc">+</span> </span>
<span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb110-57"><a href="#cb110-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb110-58"><a href="#cb110-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb110-59"><a href="#cb110-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb110-60"><a href="#cb110-60" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb110-61"><a href="#cb110-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>, </span>
<span id="cb110-62"><a href="#cb110-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.box =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb110-63"><a href="#cb110-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb110-64"><a href="#cb110-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb110-65"><a href="#cb110-65" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">65</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">65</span>, <span class="at">by =</span> <span class="dv">12</span>)) <span class="sc">+</span> </span>
<span id="cb110-66"><a href="#cb110-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb110-67"><a href="#cb110-67" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb110-68"><a href="#cb110-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-69"><a href="#cb110-69" aria-hidden="true" tabindex="-1"></a>  both <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(mu, surv, <span class="at">common.legend =</span> T, <span class="at">legend =</span> <span class="st">"bottom"</span>)</span>
<span id="cb110-70"><a href="#cb110-70" aria-hidden="true" tabindex="-1"></a>  both</span>
<span id="cb110-71"><a href="#cb110-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-72"><a href="#cb110-72" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">np_ests</span>(<span class="at">endpointdat =</span> leader_mi)</span>
<span id="cb110-73"><a href="#cb110-73" aria-hidden="true" tabindex="-1"></a>fig6<span class="fl">.11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch6_files/figure-html/figure-6.11-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell" data-hash="Ch6_cache/html/figure-6.11-sas_fff2edf0e5a573856c5e16b849d99839">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Using "fine-gray model" in PHREG gives an alternative solution to </span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co">  the estimator for CMF using the Breslow type estimator for </span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co">  the baseline mean function (see p. 199 in book). The estimator is not</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co">    exactly the same as Cook-Lawless because of a different procedures </span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co">    for ties of terminating events and censorings. If no ties </span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="co">    (or no censorings) it equals Cook &amp; Lawless */</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co">* Left plot;</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=leader_mi noprint;</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">model</span> (start, <span class="kw">stop</span>)*status(<span class="dv">0</span>)=/eventcode=<span class="dv">1</span>; </span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  strata treat;</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>  baseline out=cmf cif=cuminc;</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> cmf;</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> cmf; </span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    cumevent = -<span class="fu">log</span>(<span class="dv">1</span>-cuminc); </span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span> = <span class="kw">stop</span>/(<span class="dv">365.25</span>/<span class="dv">12</span>);</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>ods graphics <span class="kw">on</span>;</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sgplot<span class="kw"> data</span>=cmf;</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    step <span class="kw">x</span>=<span class="fu">time</span> y=cumevent/<span class="kw">group</span>=treat justify=<span class="fu">left</span>;</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>    xaxis grid values=(<span class="dv">0</span> <span class="kw">to</span> <span class="dv">60</span> <span class="kw">by</span> <span class="dv">12</span>);</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>    yaxis grid values=(<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.12</span> <span class="kw">by</span> <span class="dv">0.02</span>);</span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="fu">time</span>=<span class="st">"Time since randomisation (months)"</span>;</span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> cumevent=<span class="st">"Expected number events per subject"</span>; </span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a><span class="co">/*** Calc Cook &amp; Lawless or (Ghosh &amp; Lin (GL)) estimator for CMF 'by hand' ***/</span></span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a><span class="co">/* First create KM data for death */</span></span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=leader_mi noprint;</span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">0</span> <span class="dv">1</span>)= / entry=start; <span class="co">/* status=2=death */</span></span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>  strata treat;</span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>  baseline out=kmdata survival=km / method=pl ;</span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a><span class="co">/* Second create NAa data */</span></span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=leader_mi noprint;</span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">0</span> <span class="dv">2</span>)= / entry=start; <span class="co">/* status=1=event */</span></span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a>  strata treat;</span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a>  baseline out=nadata cumhaz=na;</span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a><span class="co">/* Use NA data to calculate dA(u), i.e., increments in NAa */</span></span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> na;</span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> nadata;</span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>  dAu=na-<span class="fu">lag</span>(na);</span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="kw">stop</span>=<span class="dv">0</span> <span class="kw">then</span> dAu=<span class="dv">0</span>;</span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> treat <span class="kw">stop</span> dAu na;</span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a><span class="co">/* merge NAa and KM data */</span></span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> merged;</span>
<span id="cb111-51"><a href="#cb111-51" aria-hidden="true" tabindex="-1"></a>  <span class="kw">merge</span> na kmdata;</span>
<span id="cb111-52"><a href="#cb111-52" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> treat <span class="kw">stop</span>;</span>
<span id="cb111-53"><a href="#cb111-53" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-54"><a href="#cb111-54" aria-hidden="true" tabindex="-1"></a><span class="co">/* multiply S(u-) and dA(u) */</span></span>
<span id="cb111-55"><a href="#cb111-55" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> fill;</span>
<span id="cb111-56"><a href="#cb111-56" aria-hidden="true" tabindex="-1"></a>   <span class="kw">set</span> merged;</span>
<span id="cb111-57"><a href="#cb111-57" aria-hidden="true" tabindex="-1"></a>   <span class="kw">retain</span> _km;</span>
<span id="cb111-58"><a href="#cb111-58" aria-hidden="true" tabindex="-1"></a>   <span class="kw">if</span> <span class="kw">not</span> missing(km) <span class="kw">then</span> _km=km;</span>
<span id="cb111-59"><a href="#cb111-59" aria-hidden="true" tabindex="-1"></a>   <span class="kw">else</span> km=_km;</span>
<span id="cb111-60"><a href="#cb111-60" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* S(u-) */</span></span>
<span id="cb111-61"><a href="#cb111-61" aria-hidden="true" tabindex="-1"></a>   S_uminus=<span class="fu">lag</span>(km);</span>
<span id="cb111-62"><a href="#cb111-62" aria-hidden="true" tabindex="-1"></a>   <span class="kw">if</span> <span class="kw">stop</span>=<span class="dv">0</span> <span class="kw">then</span> S_uminus=<span class="dv">1</span>;</span>
<span id="cb111-63"><a href="#cb111-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-64"><a href="#cb111-64" aria-hidden="true" tabindex="-1"></a>   <span class="kw">if</span> dAu=. <span class="kw">then</span> dAu=<span class="dv">0</span>;</span>
<span id="cb111-65"><a href="#cb111-65" aria-hidden="true" tabindex="-1"></a>   GLfactor=S_uminus*dAu;</span>
<span id="cb111-66"><a href="#cb111-66" aria-hidden="true" tabindex="-1"></a>   <span class="kw">keep</span> treat <span class="kw">stop</span> na dAu S_uminus GLfactor;</span>
<span id="cb111-67"><a href="#cb111-67" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-68"><a href="#cb111-68" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> GLdata;</span>
<span id="cb111-69"><a href="#cb111-69" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> fill;</span>
<span id="cb111-70"><a href="#cb111-70" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> treat;</span>
<span id="cb111-71"><a href="#cb111-71" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.treat <span class="kw">then</span> GL=<span class="dv">0</span>;</span>
<span id="cb111-72"><a href="#cb111-72" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span> GL+GLfactor;</span>
<span id="cb111-73"><a href="#cb111-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span> = <span class="kw">stop</span>/(<span class="dv">365.25</span>/<span class="dv">12</span>);</span>
<span id="cb111-74"><a href="#cb111-74" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-75"><a href="#cb111-75" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sgplot<span class="kw"> data</span>=GLdata;</span>
<span id="cb111-76"><a href="#cb111-76" aria-hidden="true" tabindex="-1"></a>  step <span class="kw">x</span>=<span class="fu">time</span> y=GL / <span class="kw">group</span>=treat;</span>
<span id="cb111-77"><a href="#cb111-77" aria-hidden="true" tabindex="-1"></a>    xaxis grid values=(<span class="dv">0</span> <span class="kw">to</span> <span class="dv">60</span> <span class="kw">by</span> <span class="dv">12</span>);</span>
<span id="cb111-78"><a href="#cb111-78" aria-hidden="true" tabindex="-1"></a>    yaxis grid values=(<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.12</span> <span class="kw">by</span> <span class="dv">0.02</span>);</span>
<span id="cb111-79"><a href="#cb111-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="fu">time</span>=<span class="st">"Time since randomisation (months)"</span>;</span>
<span id="cb111-80"><a href="#cb111-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> na=<span class="st">"Expected number events per subject"</span>; </span>
<span id="cb111-81"><a href="#cb111-81" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-82"><a href="#cb111-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-83"><a href="#cb111-83" aria-hidden="true" tabindex="-1"></a><span class="co">* Right plot: Kaplan-Meier;</span></span>
<span id="cb111-84"><a href="#cb111-84" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> kmplot;</span>
<span id="cb111-85"><a href="#cb111-85" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> kmdata;</span>
<span id="cb111-86"><a href="#cb111-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span> = <span class="kw">stop</span>/(<span class="dv">365.25</span>/<span class="dv">12</span>);</span>
<span id="cb111-87"><a href="#cb111-87" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb111-88"><a href="#cb111-88" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sgplot<span class="kw"> data</span>=kmplot;</span>
<span id="cb111-89"><a href="#cb111-89" aria-hidden="true" tabindex="-1"></a>  step <span class="kw">x</span>=<span class="fu">time</span> y=km / <span class="kw">group</span>=treat;</span>
<span id="cb111-90"><a href="#cb111-90" aria-hidden="true" tabindex="-1"></a>    xaxis grid values=(<span class="dv">0</span> <span class="kw">to</span> <span class="dv">60</span> <span class="kw">by</span> <span class="dv">12</span>);</span>
<span id="cb111-91"><a href="#cb111-91" aria-hidden="true" tabindex="-1"></a>    yaxis grid values=(<span class="dv">0</span> <span class="kw">to</span> <span class="dv">1</span> <span class="kw">by</span> <span class="dv">0.01</span>);</span>
<span id="cb111-92"><a href="#cb111-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="fu">time</span>=<span class="st">"Time since randomisation (months)"</span>;</span>
<span id="cb111-93"><a href="#cb111-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> na=<span class="st">"Kaplan-Meier estimates"</span>; </span>
<span id="cb111-94"><a href="#cb111-94" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-6.8" class="level3">
<h3 class="anchored" data-anchor-id="table-6.8">Table 6.8</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="cell" data-hash="Ch6_cache/html/table-6.8-r_164f526b2c6a43ae567ee23490a0c33f">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recurrentpseudo)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>leader_pseudo <span class="ot">&lt;-</span> <span class="fu">pseudo.twodim</span>(<span class="at">tstart =</span> leader_mi<span class="sc">$</span>start,</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">tstop =</span> leader_mi<span class="sc">$</span>stop,</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">status =</span> leader_mi<span class="sc">$</span>status,</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">id =</span> leader_mi<span class="sc">$</span>id,</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">covar_names =</span> <span class="st">"treat"</span>,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">tk =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>) <span class="sc">*</span> (<span class="fl">365.25</span> <span class="sc">/</span> <span class="dv">12</span>),</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> leader_mi)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>leader_pseudo30 <span class="ot">&lt;-</span> <span class="fu">pseudo.twodim</span>(<span class="at">tstart =</span> leader_mi<span class="sc">$</span>start,</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">tstop =</span> leader_mi<span class="sc">$</span>stop,</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">status =</span> leader_mi<span class="sc">$</span>status,</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">id =</span> leader_mi<span class="sc">$</span>id,</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">covar_names =</span> <span class="st">"treat"</span>,</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">tk =</span> <span class="dv">30</span> <span class="sc">*</span> (<span class="fl">365.25</span> <span class="sc">/</span> <span class="dv">12</span>),</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> leader_mi)</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>fit_leader <span class="ot">&lt;-</span> <span class="fu">pseudo.geefit</span>(<span class="at">pseudodata=</span>leader_pseudo, <span class="at">covar_names=</span><span class="fu">c</span>(<span class="st">"treat"</span>))</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>fit_leader</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$xi
                                   
esttypemu                -2.5130463
esttypemu:Ztime608.75    -0.6532086
esttypemu:Ztime913.125   -0.2332569
esttypemu:treat          -0.2141778
esttypesurv              -2.4979792
esttypesurv:Ztime608.75  -1.0071938
esttypesurv:Ztime913.125 -0.3902762
esttypesurv:treat        -0.1535287

$sigma
                             esttypemu esttypemu:Ztime608.75
esttypemu                 4.095910e-03          1.067437e-04
esttypemu:Ztime608.75     1.067437e-04          1.535996e-03
esttypemu:Ztime913.125    1.273763e-05          4.793399e-04
esttypemu:treat          -4.219569e-03         -1.105399e-04
esttypesurv               4.080457e-04         -3.716112e-05
esttypesurv:Ztime608.75   7.830750e-05          1.918207e-04
esttypesurv:Ztime913.125  2.571477e-05          5.097824e-05
esttypesurv:treat        -4.283062e-04          1.449234e-05
                         esttypemu:Ztime913.125 esttypemu:treat   esttypesurv
esttypemu                          1.273763e-05   -4.219569e-03  4.080457e-04
esttypemu:Ztime608.75              4.793399e-04   -1.105399e-04  7.830750e-05
esttypemu:Ztime913.125             4.588990e-04   -7.874480e-05  2.571477e-05
esttypemu:treat                   -7.874480e-05    9.099506e-03 -4.283062e-04
esttypesurv                       -2.000511e-05   -4.184816e-04  2.788591e-03
esttypesurv:Ztime608.75            7.195305e-05   -5.242195e-05  5.384024e-05
esttypesurv:Ztime913.125           5.279726e-05   -1.410649e-05  4.479532e-06
esttypesurv:treat                 -1.231597e-05    7.542122e-04 -2.886885e-03
                         esttypesurv:Ztime608.75 esttypesurv:Ztime913.125
esttypemu                          -3.716112e-05            -2.000511e-05
esttypemu:Ztime608.75               1.918207e-04             7.195305e-05
esttypemu:Ztime913.125              5.097824e-05             5.279726e-05
esttypemu:treat                     1.449234e-05            -1.231597e-05
esttypesurv                         5.384024e-05             4.479532e-06
esttypesurv:Ztime608.75             2.523407e-03             7.021897e-04
esttypesurv:Ztime913.125            7.021897e-04             7.090308e-04
esttypesurv:treat                  -2.019255e-04            -5.312963e-05
                         esttypesurv:treat
esttypemu                    -4.184816e-04
esttypemu:Ztime608.75        -5.242195e-05
esttypemu:Ztime913.125       -1.410649e-05
esttypemu:treat               7.542122e-04
esttypesurv                  -2.886885e-03
esttypesurv:Ztime608.75      -2.019255e-04
esttypesurv:Ztime913.125     -5.312963e-05
esttypesurv:treat             6.268833e-03

attr(,"class")
[1] "pseudo.geefit"</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment differences</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>xi_diff_2d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">c</span>(fit_leader<span class="sc">$</span>xi[<span class="dv">4</span>], fit_leader<span class="sc">$</span>xi[<span class="dv">8</span>]), <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>mslabels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"treat, mu"</span>, <span class="st">"treat, surv"</span>)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(xi_diff_2d) <span class="ot">&lt;-</span> mslabels</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xi_diff_2d) <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>xi_diff_2d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      
treat, mu   -0.2141778
treat, surv -0.1535287</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance matrix for differences</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>sigma_diff_2d <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(fit_leader<span class="sc">$</span>sigma[<span class="dv">4</span>,<span class="dv">4</span>],</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                          fit_leader<span class="sc">$</span>sigma[<span class="dv">4</span>,<span class="dv">8</span>],</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                          fit_leader<span class="sc">$</span>sigma[<span class="dv">4</span>,<span class="dv">8</span>],</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                          fit_leader<span class="sc">$</span>sigma[<span class="dv">8</span>,<span class="dv">8</span>]),</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">byrow =</span> T)</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sigma_diff_2d) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(sigma_diff_2d) <span class="ot">&lt;-</span> mslabels</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>sigma_diff_2d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               treat, mu  treat, surv
treat, mu   0.0090995056 0.0007542122
treat, surv 0.0007542122 0.0062688329</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sigma_diff_2d) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(sigma_diff_2d) <span class="ot">&lt;-</span> mslabels</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(sigma_diff_2d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             treat, mu treat, surv
treat, mu   0.09539133  0.02746292
treat, surv 0.02746292  0.07917596</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cov2cor</span>(sigma_diff_2d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             treat, mu treat, surv
treat, mu   1.00000000  0.09985994
treat, surv 0.09985994  1.00000000</code></pre>
</div>
</div>
<div class="cell" data-hash="Ch6_cache/html/table-6.8-time30-r_552add22535fb81d956311d2570bbf3c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recurrentpseudo)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>leader_pseudo30 <span class="ot">&lt;-</span> <span class="fu">pseudo.twodim</span>(<span class="at">tstart =</span> leader_mi<span class="sc">$</span>start,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">tstop =</span> leader_mi<span class="sc">$</span>stop,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">status =</span> leader_mi<span class="sc">$</span>status,</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">id =</span> leader_mi<span class="sc">$</span>id,</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">covar_names =</span> <span class="st">"treat"</span>,</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">tk =</span> <span class="dv">30</span> <span class="sc">*</span> (<span class="fl">365.25</span> <span class="sc">/</span> <span class="dv">12</span>),</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> leader_mi)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>fit_leader30 <span class="ot">&lt;-</span> <span class="fu">pseudo.geefit</span>(<span class="at">pseudodata=</span>leader_pseudo30, <span class="at">covar_names=</span><span class="fu">c</span>(<span class="st">"treat"</span>))</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>fit_leader</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>xi_diff_2d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">c</span>(fit_leader<span class="sc">$</span>xi[<span class="dv">2</span>], fit_leader<span class="sc">$</span>xi[<span class="dv">4</span>]), <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>sigma_diff_2d <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(fit_leader<span class="sc">$</span>sigma[<span class="dv">2</span>,<span class="dv">2</span>],</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>                          fit_leader<span class="sc">$</span>sigma[<span class="dv">2</span>,<span class="dv">4</span>],</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>                          fit_leader<span class="sc">$</span>sigma[<span class="dv">2</span>,<span class="dv">4</span>],</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>                          fit_leader<span class="sc">$</span>sigma[<span class="dv">4</span>,<span class="dv">4</span>]),</span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">byrow =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">

</div>
</div>
</div>
</section>
<section id="in-text-p.-236-test-for-beta_r-beta_s-00" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-236-test-for-beta_r-beta_s-00">In-text, p.&nbsp;236: Test for <span class="math inline">\((\beta_R, \beta_S) = (0,0)\)</span></h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell" data-hash="Ch6_cache/html/in-text-r_5331c6da22d71e9c04ed6ba83938e4d7">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the pseudo-observations</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>pseudo <span class="ot">&lt;-</span> <span class="fu">pseudoci</span>(<span class="at">time=</span>pbc3<span class="sc">$</span>days<span class="sc">/</span><span class="fl">365.25</span>,<span class="at">event=</span>pbc3<span class="sc">$</span>status,<span class="at">tmax=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co">#rearrange the data into a long data set, use only pseudo-observations for death,</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e.,  status=2:  pseudo$pseudo[[2]],</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pseudo<span class="sc">$</span>time)){</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rbind</span>(b,<span class="fu">cbind</span>(pbc3,<span class="at">death.pseudo =</span> pseudo<span class="sc">$</span>pseudo[[<span class="dv">2</span>]][,it],</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="at">tpseudo =</span> pseudo<span class="sc">$</span>time[it],<span class="at">idno=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pbc3)))</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>dataci3 <span class="ot">&lt;-</span> b[<span class="fu">order</span>(b<span class="sc">$</span>idno),]</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a><span class="co"># geese</span></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summgeese</span>(<span class="fu">geese</span>(death.pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">factor</span>(tpseudo),</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(dataci3,<span class="sc">!</span><span class="fu">is.na</span>(alb)), <span class="at">id=</span>idno,</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">family=</span>gaussian, <span class="at">mean.link =</span> <span class="st">"cloglog"</span>, <span class="at">corstr=</span><span class="st">"independence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      beta SD.robust exp.beta  exp.lci   exp.uci   PVal.N
(Intercept)      -0.261582  1.344886 0.769832 0.055158 10.744500 0.845783
tment            -0.509819  0.348199 0.600604 0.303525  1.188452 0.143150
alb              -0.106465  0.031640 0.899006 0.844949  0.956522 0.000766
log2bili          0.517712  0.116717 1.678183 1.335020  2.109555 0.000009
factor(tpseudo)1 -1.090629  0.225800 0.336005 0.215845  0.523059 0.000001
factor(tpseudo)2 -0.451689  0.132065 0.636552 0.491380  0.824613 0.000626</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># svyglm</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>svydata3 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="sc">~</span>idno, <span class="at">variables=</span> <span class="sc">~</span>., <span class="at">data=</span>dataci3, <span class="at">weight=</span> <span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summsvy</span>(<span class="fu">svyglm</span>(death.pseudo <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili<span class="sc">+</span><span class="fu">factor</span>(tpseudo)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">design=</span>svydata3, <span class="at">family=</span> <span class="fu">gaussian</span>(<span class="at">link=</span> <span class="fu">bcloglog</span>())))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     beta SD.robust exp.beta exp.lci  exp.uci  PVal.N
tment            -0.50982   0.34870  0.60061 0.30323  1.18962 0.14373
alb              -0.10646   0.03168  0.89901 0.84488  0.95661 0.00078
log2bili          0.51771   0.11688  1.67818 1.33458  2.11024 0.00001
factor(tpseudo)1 -1.35232   1.31432  0.25864 0.01968  3.39993 0.30352
factor(tpseudo)2 -0.71337   1.33521  0.48999 0.03578  6.71032 0.59315
factor(tpseudo)3 -0.26168   1.34680  0.76976 0.05495 10.78386 0.84595</code></pre>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">

</div>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<p>The SAS solutions are available as a single file for download:</p>
<ul>
<li><a href="./SAS/chapter6_solutions_cphholter.sas">Exercises 6.3 - 6.5 (The Copenhagen Holter study)</a></li>
</ul>
<section id="exercise-6.1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.1">Exercise 6.1 (*)</h3>
<p><em>The influence function for the survival function <span class="math inline">\(S(t)\)</span> is</em> <span class="math display">\[\dot{\phi}(X_i^*)=-S(t)\int_0^t\frac{dM_i(u)}{S(u)G(u)}\]</span> <em>with <span class="math inline">\(M_i(u)=N_i(u)-\int_0^uY_i(s)dA(s)\)</span> being the martingale for the failure counting process for subject <span class="math inline">\(i\)</span> (Overgaard et al.&nbsp;2017). The corresponding `plug-in’ approximation is then</em> <span class="math display">\[\widehat{\dot{\phi}}(X_i^*)=-\widehat{S}(t)\left(\frac{N_i(t)}{Y(t\wedge X_i)/n}-\int_0^{t\wedge X_i}\frac{dN(u)}{Y(u)^2/n}\right).\]</span></p>
<section id="section" class="level4">
<h4 class="anchored" data-anchor-id="section">1.</h4>
<p><em>Show that, writing the estimator in the</em> `<span class="math inline">\(\exp(-\mbox{Nelson-Aalen})\)</span>’ <em>form</em> <span class="math inline">\(\widehat{S}^w(t)=\exp(-\int_0^t(\sum_iw_idN_i(u)/\sum_iw_iY_i(u)))\)</span><em>, this expression is obtained as</em> <span class="math display">\[\dot{\widehat{\phi}}(X_i^*)=\frac{\partial \widehat{S}^w(t)}{\partial w_i}\vert_{\mathbf{w}=1/n}.\]</span> The derivative <span class="math inline">\(\frac{\partial \widehat{S}^w(t)}{\partial w_i}\vert_{\mathbf{w}=1/n}\)</span> is <span class="math display">\[-\widehat{S}(t)\int_0^t\frac{(Y(u)/n)dN_i(u)-Y_i(u)dN(u)/n}{(Y(u)/n)^2}\]</span> <span class="math display">\[=-\widehat{S}(t)(\int_0^t\frac{dN_i(u)}{Y(u)/n}-\int_0^tY_i(u)\frac{dN(u)}{Y(u)^2/n}),\]</span> which equals the desired expression.</p>
</section>
<section id="section-1" class="level4">
<h4 class="anchored" data-anchor-id="section-1">2.</h4>
<p><em>Show that for the standard Kaplan-Meier estimator</em> <span class="math display">\[\widehat{S}^w(t)=\prod_{[0,t]}(1-\sum_iw_idN_i(u)/\sum_iw_iY(u))\]</span> <em>it holds that</em> <span class="math display">\[\frac{\partial \widehat{S}^w(t)}{\partial w_i}\vert_{\mathbf{w}=1/n}=
-n\widehat{S}(t)\left(\frac{N_i(t)}{Y(t\wedge X_i)-dN(t\wedge X_i)}-\int_0^{t\wedge X_i}\frac{dN(u)}{Y(u)(Y(u)-dN(u))}\right).\]</span></p>
<p>Note that the factor <span class="math inline">\(n\)</span> is missing in the exercise text in the book.</p>
<p>The Kaplan-Meier estimator is a product, say <span class="math inline">\(f(\mathbf{w})=\prod_jf_j(\mathbf{w})\)</span>, with a factor for each observation time <span class="math inline">\(u=X_j\)</span> and with derivative <span class="math display">\[f^{\prime}(\mathbf{w})=\sum_jf_j^{\prime}(\mathbf{w})\prod_{k\neq j}f_k(\mathbf{w})=f(\mathbf{w})\sum_j\frac{f_j^{\prime}(\mathbf{w})}{f_j(\mathbf{w})}.\]</span> The <span class="math inline">\(j\)</span>th factor is <span class="math inline">\(f_j(\mathbf{w})=1-\frac{\sum_iw_idN_i(u)}{\sum_iw_iY(u)}\)</span> with <span class="math inline">\(i\)</span>th derivative, when <span class="math inline">\(\mathbf{w}=1/n\)</span>, <span class="math display">\[-\frac{(Y(u)/n)dN_i(u)-(dN(u)/n)Y_i(u)}{(Y(u)/n)^2}\]</span> and, hence, <span class="math display">\[\frac{f_j^{\prime}(\mathbf{w})}{f_j(\mathbf{w})}=-\frac{Y(u)dN_i(u)-dN(u)Y_i(u)}{(Y(u)-dN(u))Y(u)/n}.\]</span> Summing (integrating) over all observation times, the desired expression is obtained.</p>
</section>
<section id="section-2" class="level4">
<h4 class="anchored" data-anchor-id="section-2">3.</h4>
<p><em>Show that, in the case of no censoring, the influence function reduces to</em> <span class="math display">\[\dot{\phi}(X_i^*)=I(T_i&gt;t)-S(t).\]</span></p>
<p>Using the infinitesimal jackknife approach on the complete data estimator <span class="math inline">\(\widehat{S}^w(t)={\sum_iw_iI(T_i&gt;t)}/{\sum_iw_i}\)</span>, the <span class="math inline">\(i\)</span>th derivative is, when <span class="math inline">\(\mathbf{w}=1/n\)</span>, <span class="math display">\[I(T_i&gt;t)-\sum_jI(T_j&gt;t)/n=I(T_i&gt;t)-\widehat{S}(t).\]</span> Alternatively, evaluating the expression for <span class="math inline">\(\dot{\phi}(X_i^*)\)</span> for uncensored data (<span class="math inline">\(G(u)=1\)</span>), we get <span class="math display">\[-S(t)\int_0^t(dN_i(u)-\alpha(u)Y_i(u))/S(u)du=-S(t)(\frac{N_i(t)}{S(t\wedge T_i)}-\int_0^tY_i(u)\alpha(u)/S(u)du,\]</span> where the latter integral (using that the density <span class="math inline">\(\alpha(u)S(u)\)</span> is minus the derivative of <span class="math inline">\(S(u)\)</span>) can be evaluated as <span class="math inline">\(1-1/S(t\wedge T_i)\)</span>. All in all, we get <span class="math inline">\(-S(t)\)</span> for <span class="math inline">\(T_i\leq t\)</span> and <span class="math inline">\(1-S(t)\)</span> for <span class="math inline">\(T_i&gt;t\)</span>, i.e., <span class="math inline">\(I(T_i&gt;t)-S(t)\)</span>.</p>
</section>
</section>
<section id="exercise-6.2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.2">Exercise 6.2 (*)</h3>
<section id="section-3" class="level4">
<h4 class="anchored" data-anchor-id="section-3">1.</h4>
<p><em>Show that, for the Aalen-Johansen estimator, the calculation</em> <span class="math display">\[\dot{\widehat{\phi}}(X_i^*)=\frac{\partial \widehat{F}^w_h(t)}{\partial w_i}\vert_{\mathbf{w}=1/n},\]</span> with <span class="math inline">\(\widehat{F}^w_h(t)\)</span> <em>given by (6.11), leads to the pseudo-value approximation obtained by plugging-in estimators into (6.10).</em></p>
<p>The <span class="math inline">\(i\)</span>th derivative of <span class="math inline">\(\widehat{F}^w_h(t)\)</span> when <span class="math inline">\(\mathbf{w}=1/n\)</span> is <span class="math display">\[\int_0^t(-\widehat{S}(u-)(\sum_j\int_0^u\frac{(Y(s)/n)dN_{ji}(s)-(dN_j(s)/n)Y_i(s)}{(Y(s)/n)^2}d\widehat{A}_h(u))\]</span> <span class="math display">\[+\widehat{S}(u-)(\frac{(Y(u)/n)dN_{hi}(u)-(dN_h(u)/n)Y_i(u)}{(Y(s)/n)^2})).\]</span> Using the relation <span class="math inline">\(\widehat{S}(u-)\widehat{G}(u-)=Y(u)/n\)</span>, the second line reduces to <span class="math display">\[\int_0^t\frac{dN_{hi}(u)}{\widehat{G}(u-)}-\int_0^tY_i(u)\frac{d\widehat{A}_h(u)}{\widehat{G}(u-)}\]</span> which is the estimate for the first term in (6.10) because <span class="math inline">\(M_{hi}(t)=N_{hi}(t)-\int_0^tY_i(u)dA_h(u)\)</span>. Using the same relation for the first line, this reduces to <span class="math display">\[-\int_0^t\widehat{S}(u-)\left(\int_0^u\sum_h(\frac{dN_{ji}(s)}{\widehat{S}(s-)\widehat{G}(s-)}-
Y_i(s)\frac{dN_h(s)}{\widehat{S}(s-)\widehat{G}(s-)Y(s)})\right)\]</span> which is the estimate of the second term in (6.10) because <span class="math display">\[M_{i}(t)=\sum_j (N_{ji}(t)-\int_0^tY_i(u)dA_j(u)).\]</span></p>
</section>
<section id="section-4" class="level4">
<h4 class="anchored" data-anchor-id="section-4">2.</h4>
<p><em>Show that, in the case of no censoring, the influence function reduces to</em> <span class="math display">\[\dot{\phi}(X_i^*)=I(T_i\leq t, D=h)-F_h(t).\]</span></p>
<p>Looking at Equation (6.6), the result follows directly because <span class="math inline">\(G(u)=1\)</span> and <span class="math inline">\(M_{0i}(t)=0\)</span>. Using, as an alternative, the infinitesimal jackknife approach on the complete data estimator <span class="math inline">\(\widehat{F}_h^w(t)={\sum_iw_iI(T_i\leq t, D_i=h)}/{\sum_iw_i}\)</span>, the <span class="math inline">\(i\)</span>th derivative is, when <span class="math inline">\(\mathbf{w}=1/n\)</span>, <span class="math display">\[I(T_i\leq t, D_i=h)-\sum_jI(T_j\leq t, D_j=h)/n=I(T_i\leq t, D_i=h)-\widehat{F}_h(t).\]</span></p>
</section>
</section>
<section id="exercise-6.3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.3">Exercise 6.3</h3>
<p>This and the next two exercises are using the Copenhagen Holter study, and we start by loading and preparing data.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<p>The data should be loaded as <strong>chs_data</strong></p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-58_a2956da5867be87045eb99260760bfec">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/cphholter.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then load the relevant packages</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-59_626d54d8910fcabd5cc6ff77c0a57deb">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co">#Data manipulations and plots</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co">#Core survival analysis routines</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer) <span class="co">#Plots of survival curves</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survRM2) <span class="co">#RMST </span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mstate) <span class="co">#probtrans, LMAJ, ELOS</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mets) <span class="co">#binreg</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pseudo)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geepack)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, we will convert the time variables to years and add a time variable and status indicator for the composite end-point stroke-free survival.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-60_008e6fa2f29e619802b574ee249e818b">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">timeafib =</span> timeafib<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timestroke =</span> timestroke<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timedeath =</span> timedeath<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timestrokeordeath =</span> <span class="fu">ifelse</span>(stroke <span class="sc">==</span> <span class="dv">1</span>, timestroke, timedeath),</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">strokeordeath =</span> <span class="fu">ifelse</span>(stroke <span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>, death))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-61_ac8b68e30be058c93d1121665552962a">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out = chs_<span class="kw">data</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>    datafile = <span class="st">'data/cphholter.csv'</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    dbms= csv <span class="kw">replace</span>;</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    getnames=yes;</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="co">* We will convert the time variables, timeafib, timestroke, and timedeath, from days to years;</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>    timeafib = timeafib/<span class="dv">365.25</span>;</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>    timestroke = timestroke/<span class="dv">365.25</span>;</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>    timedeath = timedeath/<span class="dv">365.25</span>;</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a><span class="co">* Furthermore, we add variables for the composite end-point of stroke or death without stroke;</span></span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>    timestrokeordeath = timedeath;</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stroke = <span class="dv">1</span> <span class="kw">then</span> timestrokeordeath = timestroke;</span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>    strokeordeath = death;</span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stroke = <span class="dv">1</span> <span class="kw">then</span> strokeordeath = <span class="dv">1</span>;</span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p><em>Consider the Copenhagen Holter study and the composite end-point strokefree survival.</em></p>
<section id="section-5" class="level4">
<h4 class="anchored" data-anchor-id="section-5">1.</h4>
<p><em>Fit, using pseudo-values, a cloglog model for experiencing that end-point before time 3 years including the covariates ESVEA, sex, age, and systolic blood pressure.</em></p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<p>We will compute the pseudo observations for the incompletely observed survival indicators <span class="math inline">\(I(T_i &gt; 3 \text{ years})\)</span>, <span class="math inline">\(i = 1,...,678\)</span> using the <strong>pseudosurv</strong> function from the <em>pseudo</em> package. The function takes a time variable, <strong>time</strong>, status indicator, <strong>event</strong>, and time point(s) where the pseudo observations should be computed, <strong>tmax</strong>, as arguments. The pseudo observations are returned as a list called <strong>pseudo</strong>.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-62_78a0058194219ddc4d9cd3c322b7387d">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the pseudo observations </span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>pseudo631 <span class="ot">&lt;-</span> <span class="fu">pseudosurv</span>(<span class="at">time =</span> chs_data<span class="sc">$</span>timestrokeordeath, <span class="at">event =</span> chs_data<span class="sc">$</span>strokeordeath, <span class="at">tmax =</span> <span class="dv">3</span>)<span class="sc">$</span>pseudo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The cloglog model for experiencing stroke-free survival is fitted using the <strong>geese</strong> function from the <em>geepack</em> library where we must provide the arguments <strong>formula</strong>, <strong>data</strong> and <strong>mean.link</strong>. Since the cloglog link function is implemented as <span class="math inline">\(\log(-\log(1-x))\)</span> we must use 1 minus the pseudo observations as responses in the GEE. Furthermore, we must exclude the three observations with missing values of systolic blood pressure in the data argument.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-63_fec5b1aa985a8dd21677af7d851a1b46">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting the GEE</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>fit631 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">-</span> pseudo631) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> <span class="fu">subset</span>(chs_data, <span class="sc">!</span><span class="fu">is.na</span>(sbp)), <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit631)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = I(1 - pseudo631) ~ esvea + sex + age + sbp, data = subset(chs_data, 
    !is.na(sbp)), mean.link = "cloglog")

Mean Model:
 Mean Link:                 cloglog 
 Variance to Mean Relation: gaussian 

 Coefficients:
                estimate      san.se        wald            p
(Intercept) -8.417674445 2.250118633 13.99501663 0.0001832958
esvea        0.235836070 0.473373013  0.24820668 0.6183406485
sex          0.552503402 0.424275723  1.69579578 0.1928387168
age          0.081000941 0.030941929  6.85307312 0.0088488936
sbp         -0.001947476 0.008978799  0.04704438 0.8282884941

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
              estimate      san.se     wald            p
(Intercept) 0.04417044 0.007098887 38.71532 4.903444e-10

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   675   Maximum cluster size: 1 </code></pre>
</div>
</div>
<p>Thus, we obtain the following model for stroke-free survival at three years including the covariates ESVEA, sex, age, and systolic blood pressure</p>
<p><span class="math display">\[ S(3|Z) = \exp(-\exp(-8.417674 + 0.235836\cdot Z_1\]</span> <span class="math display">\[+ 0.552503\cdot Z_2 +  0.081001\cdot Z_3 -0.001947\cdot Z_4 ) ),\]</span></p>
<p>where <span class="math inline">\(Z_1, Z_2, Z_3\)</span>, and <span class="math inline">\(Z_4\)</span> are ESVEA, sex, age, and systolic blood pressure, respectively.</p>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-64_6cef7cf8eb9629dca3e28f773b6420cd">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We will compute the pseudo observations for the incompletely observed survival indicators I(T_i &gt; 3 years), i = 1,...,678 using </span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co">  the pseudosurv MACRO.;</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co">* 'noprint plots = none' are included twice in the proc lifetest statement of the MACRO to avoid none important outputs being </span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="co">  printed;</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudosurv(indata,time,dead,howmany,datatau,outdata);</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="co">/* The subsequent SAS code is adapted from that described by J.P.Klein,</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="co">    M.Gerster, P.K.Andersen, S.Tarima, M.Pohar Perme (2008): "SAS and R</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="co">    functions to compute pseudo-values for censored data regression"</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Comp. Meth. Progr. Biomed., vol. 89,pp. 289-300. */</span> </span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="co">/*    MACRO COMPUTES PSEUDOVALUES BASED ON THE KAPLAN-MEIER ESTIMATOR AT EACH</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a><span class="co">      INPUTS:</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a><span class="co">      INDATA---INPUT DATA SET</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME--TIME VARIABLE</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="co">      DEAD---EVENT INDICATOR (1-EVENT, 0-CENSORED)</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY---SAMPLE SIZE</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a><span class="co">      DATATAU---SUBSET OF INPUT DATA SET AT WHICH PSEUDO VALUES ARE COMPUTED DATA</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a><span class="co">                SET HAS SINGLE VARIABLE TIME</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a><span class="co">     </span></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a><span class="co">      OUTDATA---OUTPUT DATA SET WHICH CONTAINS PSUK,K=1,...,HOWMANY THE PSEUDO</span></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a><span class="co">      VALUES AT EACH TIME POINT (Note output data set includes orginal data sorted</span></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a><span class="co">                           by time</span></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a><span class="co">      </span></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;indata;</span></span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">keep</span>;  <span class="kw">set</span> <span class="kw">&amp;datatau;</span></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>find=<span class="dv">1</span>;</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;time;</span></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span>=<span class="dv">1</span>;</span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">merge</span> <span class="fu">point</span> <span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> find <span class="kw">keep</span>;</span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> useme;  <span class="kw">set</span> <span class="fu">point</span>;</span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> temp -<span class="dv">1</span>;</span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">keep</span> = <span class="dv">1</span> <span class="kw">then</span> temp=<span class="fu">time</span>;</span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>tuse=temp; </span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;time=</span>tuse;</span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a><span class="kw"> run</span>;</span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a><span class="co">/* WORKING DATA SET THAT INCLUDE A SET OF N INDICATORS WHERE FOR THE KTH INDICATOR</span></span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a><span class="co"> THE EVENT IS MISSING */</span></span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> newdat;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb134-56"><a href="#cb134-56" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobs(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb134-57"><a href="#cb134-57" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb134-58"><a href="#cb134-58" aria-hidden="true" tabindex="-1"></a>iobs(j)=<span class="kw">&amp;dead;</span></span>
<span id="cb134-59"><a href="#cb134-59" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> j=id <span class="kw">then</span> iobs(j)=.;</span>
<span id="cb134-60"><a href="#cb134-60" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb134-61"><a href="#cb134-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-62"><a href="#cb134-62" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> newdat;</span>
<span id="cb134-63"><a href="#cb134-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-64"><a href="#cb134-64" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE KME FOR FULL SAMPLE */</span></span>
<span id="cb134-65"><a href="#cb134-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-66"><a href="#cb134-66" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> lifetest<span class="kw"> data</span>=newdat noprint plots = none;</span>
<span id="cb134-67"><a href="#cb134-67" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span> <span class="kw">&amp;TIME*&amp;dead(</span><span class="dv">0</span>);</span>
<span id="cb134-68"><a href="#cb134-68" aria-hidden="true" tabindex="-1"></a>survival out=sall;</span>
<span id="cb134-69"><a href="#cb134-69" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> sall;  <span class="kw">set</span> sall;</span>
<span id="cb134-70"><a href="#cb134-70" aria-hidden="true" tabindex="-1"></a>sall=survival;</span>
<span id="cb134-71"><a href="#cb134-71" aria-hidden="true" tabindex="-1"></a> <span class="kw">keep</span> <span class="kw">&amp;time </span>sall;</span>
<span id="cb134-72"><a href="#cb134-72" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-73"><a href="#cb134-73" aria-hidden="true" tabindex="-1"></a><span class="kw">%do</span> ip=<span class="dv">1</span> <span class="kw">%to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb134-74"><a href="#cb134-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-75"><a href="#cb134-75" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE KME FOR REDUCED SAMPLE */</span></span>
<span id="cb134-76"><a href="#cb134-76" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> lifetest<span class="kw"> data</span>=newdat noprint plots = none;</span>
<span id="cb134-77"><a href="#cb134-77" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span> <span class="kw">&amp;time*</span>dead<span class="kw">&amp;ip(</span><span class="dv">0</span>);</span>
<span id="cb134-78"><a href="#cb134-78" aria-hidden="true" tabindex="-1"></a>survival out=stmp;</span>
<span id="cb134-79"><a href="#cb134-79" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> stmp;  <span class="kw">set</span> stmp;</span>
<span id="cb134-80"><a href="#cb134-80" aria-hidden="true" tabindex="-1"></a>s<span class="kw">&amp;ip=</span>survival;</span>
<span id="cb134-81"><a href="#cb134-81" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;time </span>s<span class="kw">&amp;ip;</span></span>
<span id="cb134-82"><a href="#cb134-82" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-83"><a href="#cb134-83" aria-hidden="true" tabindex="-1"></a><span class="co">/*merge KMEs AND COMPUTE PSEUDOVALUES FOR OBSERVATION IP*/</span></span>
<span id="cb134-84"><a href="#cb134-84" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pstmp; <span class="kw">merge</span> sall stmp;  <span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb134-85"><a href="#cb134-85" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> stemp <span class="dv">1</span>;</span>
<span id="cb134-86"><a href="#cb134-86" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> s<span class="kw">&amp;ip=</span>. <span class="kw">then</span> s<span class="kw">&amp;ip=</span>stemp;</span>
<span id="cb134-87"><a href="#cb134-87" aria-hidden="true" tabindex="-1"></a>stemp=s<span class="kw">&amp;ip;</span></span>
<span id="cb134-88"><a href="#cb134-88" aria-hidden="true" tabindex="-1"></a>psu<span class="kw">&amp;ip=&amp;howmany*</span>sall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*s<span class="kw">&amp;ip;</span></span>
<span id="cb134-89"><a href="#cb134-89" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-90"><a href="#cb134-90" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out; <span class="kw">merge</span> out pstmp useme ;  <span class="kw">by</span> <span class="kw">&amp;time;</span></span>
<span id="cb134-91"><a href="#cb134-91" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb134-92"><a href="#cb134-92" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;time </span>psu1-psu<span class="kw">&amp;ip;</span></span>
<span id="cb134-93"><a href="#cb134-93" aria-hidden="true" tabindex="-1"></a><span class="kw">%end</span>;</span>
<span id="cb134-94"><a href="#cb134-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-95"><a href="#cb134-95" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> out;</span>
<span id="cb134-96"><a href="#cb134-96" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> dup -<span class="dv">1</span>;</span>
<span id="cb134-97"><a href="#cb134-97" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">&amp;time=</span>dup <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb134-98"><a href="#cb134-98" aria-hidden="true" tabindex="-1"></a> <span class="kw">else</span> dup=<span class="kw">&amp;time;</span></span>
<span id="cb134-99"><a href="#cb134-99" aria-hidden="true" tabindex="-1"></a> jd+<span class="dv">1</span>;</span>
<span id="cb134-100"><a href="#cb134-100" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-101"><a href="#cb134-101" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> io;  <span class="kw">set</span> out;</span>
<span id="cb134-102"><a href="#cb134-102" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> ps psu1-psu<span class="kw">&amp;howmany;</span></span>
<span id="cb134-103"><a href="#cb134-103" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> id=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb134-104"><a href="#cb134-104" aria-hidden="true" tabindex="-1"></a>pseudo=ps(id);</span>
<span id="cb134-105"><a href="#cb134-105" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;time;</span></span>
<span id="cb134-106"><a href="#cb134-106" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span>;</span>
<span id="cb134-107"><a href="#cb134-107" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb134-108"><a href="#cb134-108" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> id pseudo jd;</span>
<span id="cb134-109"><a href="#cb134-109" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=io ;</span>
<span id="cb134-110"><a href="#cb134-110" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> id;</span>
<span id="cb134-111"><a href="#cb134-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-112"><a href="#cb134-112" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> a;  <span class="kw">set</span> <span class="kw">&amp;indata;</span></span>
<span id="cb134-113"><a href="#cb134-113" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb134-114"><a href="#cb134-114" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> io;  <span class="kw">merge</span> a io;  <span class="kw">by</span> id;</span>
<span id="cb134-115"><a href="#cb134-115" aria-hidden="true" tabindex="-1"></a><span class="kw"> proc</span> sort<span class="kw"> data</span>=io;  <span class="kw">by</span> jd;</span>
<span id="cb134-116"><a href="#cb134-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-117"><a href="#cb134-117" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datatau;</span></span>
<span id="cb134-118"><a href="#cb134-118" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb134-119"><a href="#cb134-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-120"><a href="#cb134-120" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> taus;  <span class="kw">set</span> <span class="kw">&amp;datatau </span>;</span>
<span id="cb134-121"><a href="#cb134-121" aria-hidden="true" tabindex="-1"></a> jd+<span class="dv">1</span>;</span>
<span id="cb134-122"><a href="#cb134-122" aria-hidden="true" tabindex="-1"></a> tpseudo=<span class="fu">time</span>;</span>
<span id="cb134-123"><a href="#cb134-123" aria-hidden="true" tabindex="-1"></a> <span class="kw">keep</span> jd tpseudo;</span>
<span id="cb134-124"><a href="#cb134-124" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-125"><a href="#cb134-125" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb134-126"><a href="#cb134-126" aria-hidden="true" tabindex="-1"></a><span class="kw">  data</span> <span class="kw">&amp;outdata;</span>  <span class="kw">merge</span> io taus;  <span class="kw">by</span> jd;</span>
<span id="cb134-127"><a href="#cb134-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> jd id <span class="kw">&amp;time &amp;dead;</span></span>
<span id="cb134-128"><a href="#cb134-128" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span>;</span>
<span id="cb134-129"><a href="#cb134-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-130"><a href="#cb134-130" aria-hidden="true" tabindex="-1"></a><span class="co">* Inside the MACRO a variable called 'id' is created which interferes with the 'id' variable in our data set, chs_data. Therefore,</span></span>
<span id="cb134-131"><a href="#cb134-131" aria-hidden="true" tabindex="-1"></a><span class="co">  we will first rename the 'id' variable in the chs_data;</span></span>
<span id="cb134-132"><a href="#cb134-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-133"><a href="#cb134-133" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>; </span>
<span id="cb134-134"><a href="#cb134-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>; </span>
<span id="cb134-135"><a href="#cb134-135" aria-hidden="true" tabindex="-1"></a>    ptno = id;</span>
<span id="cb134-136"><a href="#cb134-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> id;</span>
<span id="cb134-137"><a href="#cb134-137" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb134-138"><a href="#cb134-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-139"><a href="#cb134-139" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, we make a data set named 'timepoint' which contains one column 'time' with the timepoint where we wish the pseudo observations to</span></span>
<span id="cb134-140"><a href="#cb134-140" aria-hidden="true" tabindex="-1"></a><span class="co">  be computed.;</span></span>
<span id="cb134-141"><a href="#cb134-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-142"><a href="#cb134-142" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> timepoint;</span>
<span id="cb134-143"><a href="#cb134-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> <span class="fu">time</span>;</span>
<span id="cb134-144"><a href="#cb134-144" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines;</span></span>
<span id="cb134-145"><a href="#cb134-145" aria-hidden="true" tabindex="-1"></a><span class="ot">    3</span></span>
<span id="cb134-146"><a href="#cb134-146" aria-hidden="true" tabindex="-1"></a><span class="ot">    ;</span></span>
<span id="cb134-147"><a href="#cb134-147" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-148"><a href="#cb134-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-149"><a href="#cb134-149" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudosurv MACRO is then called with 'chs_data', 'timestrokeordeath', 'strokeordeath', '678'. 'timepoint' and 'outdatadata631' </span></span>
<span id="cb134-150"><a href="#cb134-150" aria-hidden="true" tabindex="-1"></a><span class="co">  as arguments;</span></span>
<span id="cb134-151"><a href="#cb134-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-152"><a href="#cb134-152" aria-hidden="true" tabindex="-1"></a><span class="co">* The MACRO returns a data set 'outdata631' where the pseudo observations are stored in the column 'pseudo'.;</span></span>
<span id="cb134-153"><a href="#cb134-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-154"><a href="#cb134-154" aria-hidden="true" tabindex="-1"></a>%pseudosurv(chs_data, timestrokeordeath, strokeordeath, 678, timepoint, outdata631);</span>
<span id="cb134-155"><a href="#cb134-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-156"><a href="#cb134-156" aria-hidden="true" tabindex="-1"></a><span class="co">* The output of the MACRO 'outdata631' is then used as data when fitting the cloglog model using the genmod procedure.;</span></span>
<span id="cb134-157"><a href="#cb134-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-158"><a href="#cb134-158" aria-hidden="true" tabindex="-1"></a><span class="co">* We must specify the link function and the inverse link function in the fwdlink and invlink statements;</span></span>
<span id="cb134-159"><a href="#cb134-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-160"><a href="#cb134-160" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.3.1'</span>;</span>
<span id="cb134-161"><a href="#cb134-161" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata631;</span>
<span id="cb134-162"><a href="#cb134-162" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb134-163"><a href="#cb134-163" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=<span class="fu">log</span>(-<span class="fu">log</span>(_mean_));</span>
<span id="cb134-164"><a href="#cb134-164" aria-hidden="true" tabindex="-1"></a>    invlink ilink=<span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb134-165"><a href="#cb134-165" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> pseudo= esvea sex age sbp/dist=<span class="fu">normal</span> noscale;</span>
<span id="cb134-166"><a href="#cb134-166" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb134-167"><a href="#cb134-167" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-168"><a href="#cb134-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-169"><a href="#cb134-169" aria-hidden="true" tabindex="-1"></a><span class="co">* Thus, we obtain the following model for stroke-free survival at three years including the covariates ESVEA, sex, age, and systolic </span></span>
<span id="cb134-170"><a href="#cb134-170" aria-hidden="true" tabindex="-1"></a><span class="co">  blood pressure</span></span>
<span id="cb134-171"><a href="#cb134-171" aria-hidden="true" tabindex="-1"></a><span class="co">  S(3|Z) = exp(-exp(-8.4177 + 0.2358*Z1 + 0.5525*Z2 +  0.0810*Z3 - 0.0019*Z4)),</span></span>
<span id="cb134-172"><a href="#cb134-172" aria-hidden="true" tabindex="-1"></a><span class="co">  where Z1, Z2, Z3, and Z4 are ESVEA, sex, age, and systolic blood pressure, respectively.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-6" class="level4">
<h4 class="anchored" data-anchor-id="section-6">2.</h4>
<p><em>Compare the results with those of Exercise 2.4.</em></p>
<p>In Exercise 2.4, we obtained the following estimates of the coefficients for ESVEA, sex, age, and systolic blood pressure assuming the Cox model and almost identical estimates was found assuming a Poisson model</p>
<p><span class="math display">\[ \beta_{ESVEA} = 0.318284 \quad \beta_{sex} = 0.577585 \quad \beta_{age} = 0.076658   \quad \beta_{sbp} = 0.005152   \]</span></p>
<p>Thus, the models agree in the direction and in some degree the magnitude of the effect of ESVEA, sex, and age. The effect of systolic blood pressure is on the other hand estimated to have the opposite effect in the model using pseudo observations compared with the Cox and Poisson models. However, the effect of systolic blood pressure (and also ESVEA and sex) is not significant at a 0.05 level in the model based on pseudo values.</p>
</section>
</section>
<section id="exercise-6.4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.4">Exercise 6.4</h3>
<p><em>Consider the Copenhagen Holter study and the composite end-point strokefree survival.</em></p>
<section id="section-7" class="level4">
<h4 class="anchored" data-anchor-id="section-7">1.</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-25-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<p><em>Fit, using pseudo-values a linear model for the 3-year restricted mean time to the composite event including the covariates ESVEA, sex, age, and systolic blood pressure.</em></p>
<p>The pseudo observations for the 3 year restricted mean time to the composite end-point are fitted using the <strong>pseudomean</strong> function from the <em>pseudo</em> package.</p>
<p>The values are then used as responses in the <strong>formula</strong> argument of the <strong>geese</strong> function.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-65_2b988aebfc57b074ca1a5d84198f9fc1">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the pseudo observations</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>pseudo641 <span class="ot">&lt;-</span> <span class="fu">pseudomean</span>(<span class="at">time =</span> chs_data<span class="sc">$</span>timestrokeordeath,<span class="at">event =</span> chs_data<span class="sc">$</span>strokeordeath, <span class="at">tmax =</span> <span class="dv">3</span>)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting the GEE</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>fit641 <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> pseudo641 <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> <span class="fu">subset</span>(chs_data, <span class="sc">!</span><span class="fu">is.na</span>(sbp)), <span class="at">mean.link =</span> <span class="st">"identity"</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit641)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo641 ~ esvea + sex + age + sbp, data = subset(chs_data, 
    !is.na(sbp)), mean.link = "identity")

Mean Model:
 Mean Link:                 identity 
 Variance to Mean Relation: gaussian 

 Coefficients:
                 estimate       san.se        wald          p
(Intercept)  3.3551746975 0.2078355430 260.6097352 0.00000000
esvea       -0.0273741987 0.0527081358   0.2697289 0.60351367
sex         -0.0540324232 0.0352191476   2.3537005 0.12498600
age         -0.0073221791 0.0028486997   6.6067420 0.01015934
sbp          0.0005144224 0.0006748332   0.5810945 0.44588365

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
             estimate    san.se     wald            p
(Intercept) 0.1396737 0.0310223 20.27127 6.720211e-06

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    0 
Number of clusters:   675   Maximum cluster size: 1 </code></pre>
</div>
</div>
<p>We get the following model for the 3-year restricted mean time to the composite end-point stroke-free survival</p>
<p><span class="math display">\[ \varepsilon(3|Z) = 3.355175 - 0.027374 \cdot Z_1 - 0.054032 \cdot Z_2 - 0.007322 \cdot Z_3 + 0.000514 \cdot Z_4,\]</span></p>
<p>where <span class="math inline">\(Z_1, Z_2, Z_3\)</span>, and <span class="math inline">\(Z_4\)</span> are ESVEA, sex, age, and systolic blood pressure, respectively.</p>
</div>
<div id="tabset-25-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-66_16f238bef5e733fc933f345b308617a2">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudo observations for the 3 year restricted mean time to the composite end-point are computed using the pseudomean MACRO;</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudomean(indata,time,dead,howmany,tmax,outdata);</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a> <span class="co">/* MACRO ARGUMENTS</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="co">      INDATA--NAME OF INPUT DATA SET</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME--NAME OF TIME VARIABLE</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="co">      DEAD--NAME OF EVENT INDICATOR VARIABLE--(1-DEAD,0-CENSORED)</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY--SAMPLE SIZE</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co">      TMAX--UPPER LIMIT OF INTEGRATION FOR RESTRICTED MEAN</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="co">      OUTDATA--NAME OF OUTPUT DATA SET WITH PSEUDOVALUES FPR RESTRICTED</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="co">               MEAN IN VARIABLE "PSUMEAN"  */</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a> <span class="co">/* CREATE A DATA SET WHERE EVERYTHING ABOVE TMAX IS CENSORED */</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> work; <span class="kw">SET</span> <span class="kw">&amp;indata;</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  restime = <span class="fu">MIN</span>(<span class="kw">&amp;tmax,</span> <span class="kw">&amp;time)</span>;</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  resdead = <span class="kw">&amp;dead;</span></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">IF</span> restime EQ <span class="kw">&amp;tmax THEN</span> resdead = <span class="dv">0</span>;</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a><span class="co">/* CREATE DATA SET WITH SET OF INDICATORS DEADK THAT HAS MISSING VALUE</span></span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a><span class="co">     FOR KTH OBSERVATION, K=1,...,HOWMANY*/</span></span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> work;  <span class="kw">SET</span> work;</span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>   id+<span class="dv">1</span>;</span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a>   <span class="kw">ARRAY</span> iobs(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a><span class="kw">   DO</span> j = <span class="dv">1</span> <span class="kw">TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a>    iobs(j) = resdead;</span>
<span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> j = id <span class="kw">THEN</span> iobs(j) = .;</span>
<span id="cb137-27"><a href="#cb137-27" aria-hidden="true" tabindex="-1"></a><span class="kw">   END</span>;</span>
<span id="cb137-28"><a href="#cb137-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-29"><a href="#cb137-29" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE RESTRICTED MEAN FOR COMPLETE SAMPLE USING PROC LIFETEST */</span></span>
<span id="cb137-30"><a href="#cb137-30" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-31"><a href="#cb137-31" aria-hidden="true" tabindex="-1"></a><span class="kw"> PROC</span> LIFETEST<span class="kw"> DATA</span> = work OUTSURV = km;</span>
<span id="cb137-32"><a href="#cb137-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">TIME</span> restime*resdead(<span class="dv">0</span>);</span>
<span id="cb137-33"><a href="#cb137-33" aria-hidden="true" tabindex="-1"></a>   ODS <span class="kw">SELECT</span> MEANS;</span>
<span id="cb137-34"><a href="#cb137-34" aria-hidden="true" tabindex="-1"></a>   ODS <span class="kw">OUTPUT</span> MEANS = mall;</span>
<span id="cb137-35"><a href="#cb137-35" aria-hidden="true" tabindex="-1"></a><span class="kw"> RUN</span>;</span>
<span id="cb137-36"><a href="#cb137-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-37"><a href="#cb137-37" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> km; <span class="kw">SET</span> km;</span>
<span id="cb137-38"><a href="#cb137-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> _CENSOR_ EQ <span class="dv">0</span>;</span>
<span id="cb137-39"><a href="#cb137-39" aria-hidden="true" tabindex="-1"></a><span class="kw">  PROC</span> SORT<span class="kw"> DATA</span>=km;</span>
<span id="cb137-40"><a href="#cb137-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">BY</span> restime;</span>
<span id="cb137-41"><a href="#cb137-41" aria-hidden="true" tabindex="-1"></a><span class="kw">  RUN</span>; </span>
<span id="cb137-42"><a href="#cb137-42" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> km; <span class="kw">SET</span> km<span class="kw"> END</span>=LAST;</span>
<span id="cb137-43"><a href="#cb137-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IF</span> <span class="kw">NOT</span>(LAST) <span class="kw">THEN</span> <span class="kw">DELETE</span>;</span>
<span id="cb137-44"><a href="#cb137-44" aria-hidden="true" tabindex="-1"></a>    area = (<span class="kw">&amp;tmax </span>- restime)*survival;</span>
<span id="cb137-45"><a href="#cb137-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">KEEP</span> area;</span>
<span id="cb137-46"><a href="#cb137-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-47"><a href="#cb137-47" aria-hidden="true" tabindex="-1"></a><span class="kw">  DATA</span> psu; <span class="kw">MERGE</span> km mall;</span>
<span id="cb137-48"><a href="#cb137-48" aria-hidden="true" tabindex="-1"></a>    meanall = <span class="fu">mean</span> + area;</span>
<span id="cb137-49"><a href="#cb137-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">KEEP</span> meanall;</span>
<span id="cb137-50"><a href="#cb137-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb137-51"><a href="#cb137-51" aria-hidden="true" tabindex="-1"></a> <span class="kw">%DO</span> ip = <span class="dv">1</span> <span class="kw">%TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb137-52"><a href="#cb137-52" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-53"><a href="#cb137-53" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* COMPUTE RESTRICTED MEAN FOR SAMPLE WITH IPTH OBSERVATION DELETED</span></span>
<span id="cb137-54"><a href="#cb137-54" aria-hidden="true" tabindex="-1"></a><span class="co">      USING PROC LIFETEST */</span></span>
<span id="cb137-55"><a href="#cb137-55" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-56"><a href="#cb137-56" aria-hidden="true" tabindex="-1"></a><span class="kw">   PROC</span> LIFETEST<span class="kw"> DATA</span> = work OUTSURV = km1;</span>
<span id="cb137-57"><a href="#cb137-57" aria-hidden="true" tabindex="-1"></a>     <span class="fu">TIME</span> restime*dead<span class="kw">&amp;ip(</span><span class="dv">0</span>);</span>
<span id="cb137-58"><a href="#cb137-58" aria-hidden="true" tabindex="-1"></a>     ODS <span class="kw">SELECT</span> means;</span>
<span id="cb137-59"><a href="#cb137-59" aria-hidden="true" tabindex="-1"></a>     ODS <span class="kw">OUTPUT</span> MEANS = m1;</span>
<span id="cb137-60"><a href="#cb137-60" aria-hidden="true" tabindex="-1"></a><span class="kw">   RUN</span>;</span>
<span id="cb137-61"><a href="#cb137-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-62"><a href="#cb137-62" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">SET</span> km1;</span>
<span id="cb137-63"><a href="#cb137-63" aria-hidden="true" tabindex="-1"></a>     <span class="kw">IF</span> _CENSOR_ EQ <span class="dv">0</span>;</span>
<span id="cb137-64"><a href="#cb137-64" aria-hidden="true" tabindex="-1"></a><span class="kw">   PROC</span> SORT<span class="kw"> DATA</span> = km1;</span>
<span id="cb137-65"><a href="#cb137-65" aria-hidden="true" tabindex="-1"></a>     <span class="kw">BY</span> restime;</span>
<span id="cb137-66"><a href="#cb137-66" aria-hidden="true" tabindex="-1"></a><span class="kw">   RUN</span>;</span>
<span id="cb137-67"><a href="#cb137-67" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">SET</span> km1<span class="kw"> END</span>=LAST;</span>
<span id="cb137-68"><a href="#cb137-68" aria-hidden="true" tabindex="-1"></a>     <span class="kw">IF</span> <span class="kw">NOT</span>(LAST) <span class="kw">THEN</span> <span class="kw">DELETE</span>;</span>
<span id="cb137-69"><a href="#cb137-69" aria-hidden="true" tabindex="-1"></a>     area = (<span class="kw">&amp;tmax </span>- restime)*survival;</span>
<span id="cb137-70"><a href="#cb137-70" aria-hidden="true" tabindex="-1"></a>     <span class="kw">KEEP</span> area;</span>
<span id="cb137-71"><a href="#cb137-71" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> km1; <span class="kw">MERGE</span> km1 m1;</span>
<span id="cb137-72"><a href="#cb137-72" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span> = <span class="fu">mean</span> + area;</span>
<span id="cb137-73"><a href="#cb137-73" aria-hidden="true" tabindex="-1"></a>     <span class="kw">KEEP</span> <span class="fu">mean</span>;</span>
<span id="cb137-74"><a href="#cb137-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-75"><a href="#cb137-75" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* COMPUTE PSEUDOVALUE FOR IPTH OBSERVATION*/</span></span>
<span id="cb137-76"><a href="#cb137-76" aria-hidden="true" tabindex="-1"></a><span class="kw">   DATA</span> psu; <span class="kw">MERGE</span> psu km1;</span>
<span id="cb137-77"><a href="#cb137-77" aria-hidden="true" tabindex="-1"></a>     psu<span class="kw">&amp;ip=&amp;howmany*</span>meanall-(<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*<span class="fu">mean</span>;</span>
<span id="cb137-78"><a href="#cb137-78" aria-hidden="true" tabindex="-1"></a> <span class="kw">%END</span>;</span>
<span id="cb137-79"><a href="#cb137-79" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-80"><a href="#cb137-80" aria-hidden="true" tabindex="-1"></a> <span class="co">/* TRANSPOSE DATASET AND MERGE WITH RAW DATA*/</span></span>
<span id="cb137-81"><a href="#cb137-81" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> out;  <span class="kw">SET</span> psu;</span>
<span id="cb137-82"><a href="#cb137-82" aria-hidden="true" tabindex="-1"></a>   <span class="kw">ARRAY</span> y(<span class="kw">&amp;howmany)</span> psu1-psu<span class="kw">&amp;howmany;</span></span>
<span id="cb137-83"><a href="#cb137-83" aria-hidden="true" tabindex="-1"></a><span class="kw">   DO</span> j = <span class="dv">1</span> <span class="kw">TO</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb137-84"><a href="#cb137-84" aria-hidden="true" tabindex="-1"></a>     psumean=y(j);</span>
<span id="cb137-85"><a href="#cb137-85" aria-hidden="true" tabindex="-1"></a>     <span class="kw">OUTPUT</span>;</span>
<span id="cb137-86"><a href="#cb137-86" aria-hidden="true" tabindex="-1"></a><span class="kw">   END</span>;</span>
<span id="cb137-87"><a href="#cb137-87" aria-hidden="true" tabindex="-1"></a> <span class="kw">KEEP</span> psumean;</span>
<span id="cb137-88"><a href="#cb137-88" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-89"><a href="#cb137-89" aria-hidden="true" tabindex="-1"></a><span class="kw"> DATA</span> <span class="kw">&amp;outdata;</span> <span class="kw">MERGE</span> <span class="kw">&amp;indata </span>out;</span>
<span id="cb137-90"><a href="#cb137-90" aria-hidden="true" tabindex="-1"></a><span class="kw"> run</span>; </span>
<span id="cb137-91"><a href="#cb137-91" aria-hidden="true" tabindex="-1"></a><span class="kw">%MEND</span>;</span>
<span id="cb137-92"><a href="#cb137-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-93"><a href="#cb137-93" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudomean MACRO is now called with 'chs_data', 'timestrokeordeath', 'strokeordeath', '678'. '3' and 'outdatadata641' </span></span>
<span id="cb137-94"><a href="#cb137-94" aria-hidden="true" tabindex="-1"></a><span class="co">  as arguments;</span></span>
<span id="cb137-95"><a href="#cb137-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-96"><a href="#cb137-96" aria-hidden="true" tabindex="-1"></a><span class="co">* The MACRO returns a data set 'outdata641' where the pseudo observations are stored in the column 'psumean'.;</span></span>
<span id="cb137-97"><a href="#cb137-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-98"><a href="#cb137-98" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.4.1'</span>;</span>
<span id="cb137-99"><a href="#cb137-99" aria-hidden="true" tabindex="-1"></a>%pseudomean(chs_data, timestrokeordeath, strokeordeath, 678, 3, outdata641);</span>
<span id="cb137-100"><a href="#cb137-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-101"><a href="#cb137-101" aria-hidden="true" tabindex="-1"></a><span class="co">* The model is then fitted with the genmod procedure;</span> </span>
<span id="cb137-102"><a href="#cb137-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-103"><a href="#cb137-103" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata641;</span>
<span id="cb137-104"><a href="#cb137-104" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb137-105"><a href="#cb137-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> psumean=esvea sex age sbp /dist=<span class="fu">normal</span>;</span>
<span id="cb137-106"><a href="#cb137-106" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb137-107"><a href="#cb137-107" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb137-108"><a href="#cb137-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-109"><a href="#cb137-109" aria-hidden="true" tabindex="-1"></a><span class="co">* We get the following model for the 3-year restricted mean time to the composite end-point stroke-free survival</span></span>
<span id="cb137-110"><a href="#cb137-110" aria-hidden="true" tabindex="-1"></a><span class="co">  epsilon(3|Z) = 3.3552 - 0.0274*Z1 - 0.0540*Z2 - 0.0073*Z3 + 0.0005*Z4,</span></span>
<span id="cb137-111"><a href="#cb137-111" aria-hidden="true" tabindex="-1"></a><span class="co">  where Z1, Z2, Z3, and Z4 are ESVEA, sex, age, and systolic blood pressure, respectively.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-8" class="level4">
<h4 class="anchored" data-anchor-id="section-8">2.</h4>
<p><em>Compare with the results of Exercise 4.3.</em></p>
<p>The model obtained in Exercise 4.3 is identical to the model fitted using pseudo observations. This is because none of the subjects are censored before 3 years and the pseudo observation for subject <span class="math inline">\(i\)</span> is thus <span class="math inline">\(\min(3,T_i)\)</span> where <span class="math inline">\(T_i\)</span> is the time of stroke or death without stroke for subject <span class="math inline">\(i\)</span>.</p>
</section>
</section>
<section id="exercise-6.5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6.5">Exercise 6.5</h3>
<p><em>Consider the competing outcomes stroke and death without stroke in the Copenhagen Holter study.</em></p>
<section id="section-9" class="level4">
<h4 class="anchored" data-anchor-id="section-9">1.</h4>
<p><em>Fit, using pseudo-values, a cloglog-model for the cumulative incidences at 3 years including ESVEA, sex, age, and systolic blood pressure.</em></p>
<p>NB: The results from R and SAS do not quite agree for the outcome death without stroke.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-26-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-1" role="tab" aria-controls="tabset-26-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-2" role="tab" aria-controls="tabset-26-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-26-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-26-1-tab">
<p>To estimate the cumulative incidences at 3 years we will first create a variable called <strong>event</strong> where 1 indicates stroke, 2 indicates death without stroke and 0 indicates censoring.</p>
<p>The pseudo observations for the cumulative incidences are then computed using the <strong>pseudoci</strong> function from the <em>pseudo</em> package. The output <strong>pseudo</strong> is a list of two cmponents; the first containing the pseudo observation for cause 1 (stroke) and the second containing the pseudo observations for cause 2 (death without stroke). The pseudo observations are stored as <strong>pseudo651_stroke</strong> and <strong>pseudo651_death</strong>, respectively.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-67_375d34a26b4e20268bc86b912bfdbee4">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Status indicator for death without stroke</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>death_wo_stroke <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(chs_data<span class="sc">$</span>stroke <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, chs_data<span class="sc">$</span>death)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Event variable</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(chs_data<span class="sc">$</span>death_wo_stroke <span class="sc">==</span> <span class="dv">0</span>, chs_data<span class="sc">$</span>stroke, chs_data<span class="sc">$</span>death_wo_stroke<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the pseudo observations</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>pseudo651 <span class="ot">&lt;-</span> <span class="fu">pseudoci</span>(<span class="at">time =</span> chs_data<span class="sc">$</span>timestrokeordeath, <span class="at">event =</span> chs_data<span class="sc">$</span>event, <span class="at">tmax =</span> <span class="dv">3</span>)<span class="sc">$</span>pseudo</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pseudo651_stroke =</span> pseudo651[[<span class="dv">1</span>]],</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">pseudo651_death =</span> pseudo651[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then fit a cloglog model for the cumulative incidence of stroke at 3 years using the <strong>geese</strong> function.</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-68_d7dedc6bc4a843fcbd8f1938a7b1a040">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting GEE for the end-point stroke</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>fit651_stroke <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> pseudo651_stroke <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> <span class="fu">subset</span>(chs_data, <span class="sc">!</span><span class="fu">is.na</span>(sbp)), <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit651_stroke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo651_stroke ~ esvea + sex + age + sbp, data = subset(chs_data, 
    !is.na(sbp)), mean.link = "cloglog")

Mean Model:
 Mean Link:                 cloglog 
 Variance to Mean Relation: gaussian 

 Coefficients:
                estimate      san.se         wald           p
(Intercept) -13.22924598 4.176619986 10.032756198 0.001537808
esvea         0.03121341 0.735520028  0.001800916 0.966150174
sex           0.97102501 0.750193280  1.675384486 0.195538876
age           0.11987793 0.060010682  3.990445009 0.045758977
sbp           0.00402910 0.007673721  0.275679233 0.599547288

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
              estimate      san.se     wald            p
(Intercept) 0.01706673 0.004691019 13.23629 0.0002745808

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    1 
Number of clusters:   675   Maximum cluster size: 1 </code></pre>
</div>
</div>
<p>Thus, we obtain the following model for the cumulative incidence of stroke at 3 years <span class="math display">\[ F_{stroke}(3|Z) = 1 - \exp(-\exp(-13.229246 + 0.031213\cdot Z_1\]</span> <span class="math display">\[+ 0.971025 \cdot Z_2 + 0.119878 \cdot Z_3  + 0.004029\cdot Z_4)),\]</span> where <span class="math inline">\(Z_1, Z_2, Z_3\)</span>, and <span class="math inline">\(Z_4\)</span> are ESVEA, sex, age, and systolic blood pressure, respectively.</p>
<p>Likewise, we will fit a model for the cumulative incidence of death without stroke at 3 years</p>
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-69_296b72043131830871ef1c37f85ff00a">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>fit651_death <span class="ot">&lt;-</span> <span class="fu">geese</span>(<span class="at">formula =</span> pseudo651_death <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> <span class="fu">subset</span>(chs_data, <span class="sc">!</span><span class="fu">is.na</span>(sbp)), <span class="at">mean.link =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit651_death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geese(formula = pseudo651_death ~ esvea + sex + age + sbp, data = subset(chs_data, 
    !is.na(sbp)), mean.link = "cloglog")

Mean Model:
 Mean Link:                 cloglog 
 Variance to Mean Relation: gaussian 

 Coefficients:
               estimate     san.se      wald          p
(Intercept) -3.18491794 4.09532929 0.6048098 0.43674872
esvea        0.33067549 0.93749873 0.1244121 0.72429761
sex          1.20812564 0.75670860 2.5489826 0.11036531
age          0.07407931 0.05731313 1.6706507 0.19617140
sbp         -0.04396479 0.01864246 5.5616450 0.01835816

Scale Model:
 Scale Link:                identity 

 Estimated Scale Parameters:
              estimate      san.se     wald            p
(Intercept) 0.02840673 0.006072949 21.87979 2.902748e-06

Correlation Model:
 Correlation Structure:     independence 

Returned Error Value:    1 
Number of clusters:   675   Maximum cluster size: 1 </code></pre>
</div>
</div>
<p>We obtain the following model for the cumulative incidence of death without stroke at 3 years</p>
<p><span class="math display">\[ F_{death}(3|Z) = 1 - \exp(-\exp(-3.184918 + 0.330675\cdot Z_1 + 1.208126 \cdot Z_2\]</span> <span class="math display">\[+ 0.074079 \cdot Z_3  - 0.043965\cdot Z_4)),\]</span></p>
<p>where <span class="math inline">\(Z_1, Z_2, Z_3\)</span>, and <span class="math inline">\(Z_4\)</span> are ESVEA, sex, age, and systolic blood pressure, respectively.</p>
</div>
<div id="tabset-26-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-26-2-tab">
<div class="cell" data-hash="Ch6_cache/html/unnamed-chunk-70_a42f79e38bf07da13b16391f948f9026">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudo observations for the cumulative incidences of stroke and death without stroke at three years are computed using the  pseudoci MACRO. To use this MACRO we must remember to include the cuminc MACRO.;</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> cuminc(datain,x,re,de,dataout,cir,cid);</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co">/*  THIS MACRO COMPUTES THE CUMULATIVE INCIDENCE FUNCTIONS FOR</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co">    BOTH COMPETING RISKS USING PROC PHREG OUTPUT</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="co">    INPUTS TO MACRO</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="co">    DATAIN--NAME OF INPUT DATA SET CONTAINING </span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="co">        X--TIME TO EVENT</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="co">        RE--INDICATOR OF FIRST COMPETING RISK (1-YES, 0-NO)</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a><span class="co">        DE--INDICATOR OF SECOND COMPETING RISK</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="co">    DATAOUT--NAME OF OUTPUT DATA SET CONTAINING</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a><span class="co">        CIR--CUMULATIVE INCIDENCE FUNCTION FOR 1ST COMPETING RISK</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a><span class="co">        CID--CUMULATIVE INCIDENCE FUNCTION FOR 2ST COMPETING RISK</span></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> work;  <span class="kw">set</span> <span class="kw">&amp;datain;</span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>t=<span class="kw">&amp;x;</span></span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a>r=<span class="kw">&amp;re;</span></span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>d=<span class="kw">&amp;de;</span></span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a>zero=<span class="dv">0</span>;</span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CRUDE CUMUALTIVE HAZARD FOR FIRST COMPETING RISK */</span></span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=work noprint; </span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> t*r(<span class="dv">0</span>)=zero;</span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span> out=rel  logsurv=chr  /method=emp;</span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb143-28"><a href="#cb143-28" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE CRUDE CUMUALTIVE HAZARD FOR SECOND COMPETING RISK */</span></span>
<span id="cb143-29"><a href="#cb143-29" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=work noprint; </span>
<span id="cb143-30"><a href="#cb143-30" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> t*d(<span class="dv">0</span>)=zero;</span>
<span id="cb143-31"><a href="#cb143-31" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span> out=dead  logsurv=chd  /method=emp;</span>
<span id="cb143-32"><a href="#cb143-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb143-33"><a href="#cb143-33" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb143-34"><a href="#cb143-34" aria-hidden="true" tabindex="-1"></a> <span class="co">/* COMPUTE cumualtive incidence */</span></span>
<span id="cb143-35"><a href="#cb143-35" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> both;  <span class="kw">merge</span> rel dead;  <span class="kw">by</span> t;</span>
<span id="cb143-36"><a href="#cb143-36" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> s <span class="dv">1</span></span>
<span id="cb143-37"><a href="#cb143-37" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cr <span class="dv">0</span>;</span>
<span id="cb143-38"><a href="#cb143-38" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cd <span class="dv">0</span>;</span>
<span id="cb143-39"><a href="#cb143-39" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cumincr <span class="dv">0</span>;</span>
<span id="cb143-40"><a href="#cb143-40" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cumincd <span class="dv">0</span>;</span>
<span id="cb143-41"><a href="#cb143-41" aria-hidden="true" tabindex="-1"></a>hr=-(cr+chr);</span>
<span id="cb143-42"><a href="#cb143-42" aria-hidden="true" tabindex="-1"></a>hd=-(cd+chd);</span>
<span id="cb143-43"><a href="#cb143-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-44"><a href="#cb143-44" aria-hidden="true" tabindex="-1"></a><span class="co">/* NOTE HR AND HD ARE THE JUMPS IN THE CUMUALTIVE CRUDE HAZARDS AT THIS TIME */</span></span>
<span id="cb143-45"><a href="#cb143-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-46"><a href="#cb143-46" aria-hidden="true" tabindex="-1"></a>cr=-chr;</span>
<span id="cb143-47"><a href="#cb143-47" aria-hidden="true" tabindex="-1"></a>cd=-chd;</span>
<span id="cb143-48"><a href="#cb143-48" aria-hidden="true" tabindex="-1"></a>cir=cumincr+hr*s;</span>
<span id="cb143-49"><a href="#cb143-49" aria-hidden="true" tabindex="-1"></a>cumincr=cir;</span>
<span id="cb143-50"><a href="#cb143-50" aria-hidden="true" tabindex="-1"></a>cid=cumincd+hd*s;</span>
<span id="cb143-51"><a href="#cb143-51" aria-hidden="true" tabindex="-1"></a>cumincd=cid;</span>
<span id="cb143-52"><a href="#cb143-52" aria-hidden="true" tabindex="-1"></a>s=s*(<span class="dv">1</span>-hr-hd);</span>
<span id="cb143-53"><a href="#cb143-53" aria-hidden="true" tabindex="-1"></a><span class="co">/* NOTE S IS KAPLAN-MEIER ESTIMATE IGNORING CAUSE OF FAILURE */</span></span>
<span id="cb143-54"><a href="#cb143-54" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">&amp;dataout;</span>  <span class="kw">set</span> both;</span>
<span id="cb143-55"><a href="#cb143-55" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;x=</span>t;</span>
<span id="cb143-56"><a href="#cb143-56" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;cir=</span>cir;  <span class="kw">&amp;cid=</span>cid;</span>
<span id="cb143-57"><a href="#cb143-57" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">&amp;x &amp;cir &amp;cid;</span></span>
<span id="cb143-58"><a href="#cb143-58" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span>;</span>
<span id="cb143-59"><a href="#cb143-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-60"><a href="#cb143-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-61"><a href="#cb143-61" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> pseudoci(datain,x,r,d,howmany,datatau,dataout);</span>
<span id="cb143-62"><a href="#cb143-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-63"><a href="#cb143-63" aria-hidden="true" tabindex="-1"></a><span class="co">/*    MACRO COMPUTES PSEUDOVALUES BASED ON THE CUMUALTIVE INCIDENCE FUNCTION</span></span>
<span id="cb143-64"><a href="#cb143-64" aria-hidden="true" tabindex="-1"></a><span class="co">      FOR BOTH OF TWO COMPETING RISKS  </span></span>
<span id="cb143-65"><a href="#cb143-65" aria-hidden="true" tabindex="-1"></a><span class="co">      TIME</span></span>
<span id="cb143-66"><a href="#cb143-66" aria-hidden="true" tabindex="-1"></a><span class="co">      INPUTS:</span></span>
<span id="cb143-67"><a href="#cb143-67" aria-hidden="true" tabindex="-1"></a><span class="co">      DATAIN---INPUT DATA SET</span></span>
<span id="cb143-68"><a href="#cb143-68" aria-hidden="true" tabindex="-1"></a><span class="co">      X--TIME VARIABLE</span></span>
<span id="cb143-69"><a href="#cb143-69" aria-hidden="true" tabindex="-1"></a><span class="co">      R--INDICATOR OF FIRST COMPETING RISK (1-YES, 0-NO)</span></span>
<span id="cb143-70"><a href="#cb143-70" aria-hidden="true" tabindex="-1"></a><span class="co">      D--INDICATOR OF SECOND COMPETING RISK</span></span>
<span id="cb143-71"><a href="#cb143-71" aria-hidden="true" tabindex="-1"></a><span class="co">      HOWMANY---SAMPLE SIZE</span></span>
<span id="cb143-72"><a href="#cb143-72" aria-hidden="true" tabindex="-1"></a><span class="co">     </span></span>
<span id="cb143-73"><a href="#cb143-73" aria-hidden="true" tabindex="-1"></a><span class="co">      DATATAU---SUBSET OF INPUT DATA SET AT WHICH PSEUDO VALUES ARE COMPUTED </span></span>
<span id="cb143-74"><a href="#cb143-74" aria-hidden="true" tabindex="-1"></a><span class="co">                DATA SET HAS SINGLE VARIABLE "TIME"</span></span>
<span id="cb143-75"><a href="#cb143-75" aria-hidden="true" tabindex="-1"></a><span class="co">                </span></span>
<span id="cb143-76"><a href="#cb143-76" aria-hidden="true" tabindex="-1"></a><span class="co">      DATAOUT---OUTPUT DATA SET WHICH CONATINS PSUK,K=1,...,HOWMANY THE PSEUDO</span></span>
<span id="cb143-77"><a href="#cb143-77" aria-hidden="true" tabindex="-1"></a><span class="co">                VALUES AT EACH TIME POINT (Note output data set</span></span>
<span id="cb143-78"><a href="#cb143-78" aria-hidden="true" tabindex="-1"></a><span class="co">                 includes orginal data sorted by time)</span></span>
<span id="cb143-79"><a href="#cb143-79" aria-hidden="true" tabindex="-1"></a><span class="co">      </span></span>
<span id="cb143-80"><a href="#cb143-80" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb143-81"><a href="#cb143-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-82"><a href="#cb143-82" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datain;</span>  <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb143-83"><a href="#cb143-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-84"><a href="#cb143-84" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">keep</span>;  <span class="kw">set</span> <span class="kw">&amp;datatau;</span></span>
<span id="cb143-85"><a href="#cb143-85" aria-hidden="true" tabindex="-1"></a>find=<span class="dv">1</span>;</span>
<span id="cb143-86"><a href="#cb143-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-87"><a href="#cb143-87" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb143-88"><a href="#cb143-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-89"><a href="#cb143-89" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">set</span> <span class="kw">&amp;datain;</span></span>
<span id="cb143-90"><a href="#cb143-90" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>=<span class="kw">&amp;x;</span></span>
<span id="cb143-91"><a href="#cb143-91" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span>=<span class="dv">1</span>;</span>
<span id="cb143-92"><a href="#cb143-92" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">point</span>;  <span class="kw">merge</span> <span class="fu">point</span> <span class="kw">keep</span>;  <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb143-93"><a href="#cb143-93" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> find <span class="kw">keep</span>;</span>
<span id="cb143-94"><a href="#cb143-94" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb143-95"><a href="#cb143-95" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> useme;  <span class="kw">set</span> <span class="fu">point</span>;</span>
<span id="cb143-96"><a href="#cb143-96" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> temp -<span class="dv">1</span>;</span>
<span id="cb143-97"><a href="#cb143-97" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="kw">keep</span> = <span class="dv">1</span> <span class="kw">then</span> temp=<span class="fu">time</span>;</span>
<span id="cb143-98"><a href="#cb143-98" aria-hidden="true" tabindex="-1"></a>tuse=temp; </span>
<span id="cb143-99"><a href="#cb143-99" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb143-100"><a href="#cb143-100" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;x=</span>tuse;</span>
<span id="cb143-101"><a href="#cb143-101" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb143-102"><a href="#cb143-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-103"><a href="#cb143-103" aria-hidden="true" tabindex="-1"></a><span class="co">/* PREPARE DATA SET WITH MISSING VALUES FOR DEADK AND RELAPSEK TO BE USED IN COMPUTING</span></span>
<span id="cb143-104"><a href="#cb143-104" aria-hidden="true" tabindex="-1"></a><span class="co">   ESTIMATED CUMULATIVE INCIDENCE WITH KTH OBSERVATION DELETED*/</span></span>
<span id="cb143-105"><a href="#cb143-105" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="kw">&amp;datain;</span></span>
<span id="cb143-106"><a href="#cb143-106" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb143-107"><a href="#cb143-107" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> newdat;  <span class="kw">set</span> <span class="kw">&amp;datain </span>;</span>
<span id="cb143-108"><a href="#cb143-108" aria-hidden="true" tabindex="-1"></a>id+<span class="dv">1</span>;</span>
<span id="cb143-109"><a href="#cb143-109" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobsd(<span class="kw">&amp;howmany)</span> dead1-dead<span class="kw">&amp;howmany;</span></span>
<span id="cb143-110"><a href="#cb143-110" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> iobsr(<span class="kw">&amp;howmany)</span> relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb143-111"><a href="#cb143-111" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb143-112"><a href="#cb143-112" aria-hidden="true" tabindex="-1"></a>iobsd(j)=<span class="kw">&amp;d;</span></span>
<span id="cb143-113"><a href="#cb143-113" aria-hidden="true" tabindex="-1"></a>iobsr(j)=<span class="kw">&amp;r;</span></span>
<span id="cb143-114"><a href="#cb143-114" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> j=id <span class="kw">then do</span>; iobsr(j)=.; iobsd(j)=.<span class="kw">; end</span>;</span>
<span id="cb143-115"><a href="#cb143-115" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb143-116"><a href="#cb143-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-117"><a href="#cb143-117" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out;  <span class="kw">set</span> newdat;</span>
<span id="cb143-118"><a href="#cb143-118" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> dead1-dead<span class="kw">&amp;howmany </span>relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb143-119"><a href="#cb143-119" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CI FOR 1ST (CIRALL) AND 2ND (CIDALL) FOR FULL SAMPLE, STORE IN SALL*/</span></span>
<span id="cb143-120"><a href="#cb143-120" aria-hidden="true" tabindex="-1"></a>%cuminc(newdat,&amp;x,&amp;r,&amp;d,sall,cirall,cidall);</span>
<span id="cb143-121"><a href="#cb143-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-122"><a href="#cb143-122" aria-hidden="true" tabindex="-1"></a><span class="kw">%do</span> ip=<span class="dv">1</span> <span class="kw">%to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb143-123"><a href="#cb143-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-124"><a href="#cb143-124" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE CI FOR 1ST (CIRALL) AND 2ND (CIDALL) FOR REDUCED SAMPLE, STORE IN SIP*/</span></span>
<span id="cb143-125"><a href="#cb143-125" aria-hidden="true" tabindex="-1"></a>%cuminc(newdat,&amp;x,relapse&amp;ip,dead&amp;ip,stemp,cir1,cid1);</span>
<span id="cb143-126"><a href="#cb143-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-127"><a href="#cb143-127" aria-hidden="true" tabindex="-1"></a><span class="co">/* COMPUTE PSEUDOVALUES FOR BOTH RISK AT EVERY DATA POINT AND ADD TO FILE */</span> </span>
<span id="cb143-128"><a href="#cb143-128" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> ps; <span class="kw">merge</span> sall stemp;  <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb143-129"><a href="#cb143-129" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cirtemp <span class="dv">0</span>;</span>
<span id="cb143-130"><a href="#cb143-130" aria-hidden="true" tabindex="-1"></a><span class="kw">retain</span> cidtemp <span class="dv">0</span>;</span>
<span id="cb143-131"><a href="#cb143-131" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> cir1=. <span class="kw">then</span> cir1=cirtemp;</span>
<span id="cb143-132"><a href="#cb143-132" aria-hidden="true" tabindex="-1"></a>cirtemp=cir1;</span>
<span id="cb143-133"><a href="#cb143-133" aria-hidden="true" tabindex="-1"></a>rpsu<span class="kw">&amp;ip=&amp;howmany*</span>cirall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*cir1;</span>
<span id="cb143-134"><a href="#cb143-134" aria-hidden="true" tabindex="-1"></a> <span class="kw">if</span> cid1=. <span class="kw">then</span> cid1=cidtemp;</span>
<span id="cb143-135"><a href="#cb143-135" aria-hidden="true" tabindex="-1"></a>cidtemp=cid1;</span>
<span id="cb143-136"><a href="#cb143-136" aria-hidden="true" tabindex="-1"></a>dpsu<span class="kw">&amp;ip=&amp;howmany*</span>cidall- (<span class="kw">&amp;howmany-</span><span class="dv">1</span>)*cid1;</span>
<span id="cb143-137"><a href="#cb143-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-138"><a href="#cb143-138" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> out; <span class="kw">merge</span> out ps useme; <span class="kw">by</span> <span class="kw">&amp;x;</span></span>
<span id="cb143-139"><a href="#cb143-139" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> find ne <span class="dv">1</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb143-140"><a href="#cb143-140" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">time</span> rpsu1-rpsu<span class="kw">&amp;ip </span>dpsu1-dpsu<span class="kw">&amp;ip &amp;x;</span></span>
<span id="cb143-141"><a href="#cb143-141" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-142"><a href="#cb143-142" aria-hidden="true" tabindex="-1"></a><span class="kw">%end</span>;</span>
<span id="cb143-143"><a href="#cb143-143" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb143-144"><a href="#cb143-144" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> <span class="kw">&amp;dataout;</span>  <span class="kw">set</span> newdat; </span>
<span id="cb143-145"><a href="#cb143-145" aria-hidden="true" tabindex="-1"></a> <span class="kw">drop</span> dead1-dead<span class="kw">&amp;howmany </span>relapse1-relapse<span class="kw">&amp;howmany;</span></span>
<span id="cb143-146"><a href="#cb143-146" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb143-147"><a href="#cb143-147" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> all;  <span class="kw">set</span> out;</span>
<span id="cb143-148"><a href="#cb143-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-149"><a href="#cb143-149" aria-hidden="true" tabindex="-1"></a> <span class="kw">array</span> yr(<span class="kw">&amp;howmany)</span> rpsu1-rpsu<span class="kw">&amp;howmany;</span></span>
<span id="cb143-150"><a href="#cb143-150" aria-hidden="true" tabindex="-1"></a><span class="kw">array</span> yd(<span class="kw">&amp;howmany)</span> dpsu1-dpsu<span class="kw">&amp;howmany;</span></span>
<span id="cb143-151"><a href="#cb143-151" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j=<span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;howmany;</span></span>
<span id="cb143-152"><a href="#cb143-152" aria-hidden="true" tabindex="-1"></a>rpseudo=yr(j);</span>
<span id="cb143-153"><a href="#cb143-153" aria-hidden="true" tabindex="-1"></a>dpseudo=yd(j);</span>
<span id="cb143-154"><a href="#cb143-154" aria-hidden="true" tabindex="-1"></a>id=j;</span>
<span id="cb143-155"><a href="#cb143-155" aria-hidden="true" tabindex="-1"></a><span class="kw">output</span>;</span>
<span id="cb143-156"><a href="#cb143-156" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb143-157"><a href="#cb143-157" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> id <span class="fu">time</span> rpseudo dpseudo;</span>
<span id="cb143-158"><a href="#cb143-158" aria-hidden="true" tabindex="-1"></a><span class="kw"> proc</span> sort<span class="kw"> data</span>=all;  <span class="kw">by</span> id;</span>
<span id="cb143-159"><a href="#cb143-159" aria-hidden="true" tabindex="-1"></a><span class="kw"> data</span> <span class="kw">&amp;dataout;</span> <span class="kw">merge</span> <span class="kw">&amp;dataout </span>all;</span>
<span id="cb143-160"><a href="#cb143-160" aria-hidden="true" tabindex="-1"></a> <span class="kw">by</span> id;</span>
<span id="cb143-161"><a href="#cb143-161" aria-hidden="true" tabindex="-1"></a> <span class="kw">retain</span> otime -<span class="dv">1</span>;</span>
<span id="cb143-162"><a href="#cb143-162" aria-hidden="true" tabindex="-1"></a> <span class="kw">retain</span> oid -<span class="dv">1</span>;</span>
<span id="cb143-163"><a href="#cb143-163" aria-hidden="true" tabindex="-1"></a> <span class="kw">if</span> id eq oid <span class="kw">and</span> otime=<span class="fu">time</span> <span class="kw">then</span> <span class="kw">delete</span>;</span>
<span id="cb143-164"><a href="#cb143-164" aria-hidden="true" tabindex="-1"></a> <span class="kw">else do</span>; oid=id; otime=<span class="fu">time</span><span class="kw">; end</span>;</span>
<span id="cb143-165"><a href="#cb143-165" aria-hidden="true" tabindex="-1"></a> <span class="kw">%mend</span>;</span>
<span id="cb143-166"><a href="#cb143-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-167"><a href="#cb143-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-168"><a href="#cb143-168" aria-hidden="true" tabindex="-1"></a><span class="co">* We must create a variable for the end-point death without stroke;</span></span>
<span id="cb143-169"><a href="#cb143-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-170"><a href="#cb143-170" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb143-171"><a href="#cb143-171" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb143-172"><a href="#cb143-172" aria-hidden="true" tabindex="-1"></a>    death_wo_stroke = death;</span>
<span id="cb143-173"><a href="#cb143-173" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stroke = <span class="dv">1</span> <span class="kw">then</span> death_wo_stroke = <span class="dv">0</span>;</span>
<span id="cb143-174"><a href="#cb143-174" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-175"><a href="#cb143-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-176"><a href="#cb143-176" aria-hidden="true" tabindex="-1"></a><span class="co">* The pseudoci MACRO is called with 'chs_data', 'timestrokeordeath', 'stroke', 'death_wo_stroke', '678'. 'timepoint' and 'outdatadata651'</span></span>
<span id="cb143-177"><a href="#cb143-177" aria-hidden="true" tabindex="-1"></a><span class="co">  as arguments;</span></span>
<span id="cb143-178"><a href="#cb143-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-179"><a href="#cb143-179" aria-hidden="true" tabindex="-1"></a><span class="co">* The MACRO returns a data set 'outdata651' where the pseudo observations for the end-point stroke are stored in the column 'rpseudo'</span></span>
<span id="cb143-180"><a href="#cb143-180" aria-hidden="true" tabindex="-1"></a><span class="co">  and the pseudo observations for death without stroke are stored in the column 'dpseudo'.;</span></span>
<span id="cb143-181"><a href="#cb143-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-182"><a href="#cb143-182" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.5.1'</span>;</span>
<span id="cb143-183"><a href="#cb143-183" aria-hidden="true" tabindex="-1"></a> %pseudoci(chs_data, timestrokeordeath, stroke, death_wo_stroke, 678, timepoint, outdata651);</span>
<span id="cb143-184"><a href="#cb143-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-185"><a href="#cb143-185" aria-hidden="true" tabindex="-1"></a><span class="co">* We fit a cloglog model for the cumulative incidence of stroke with the genmod procedure where we specify the 'fwdlink' and 'invlink' </span></span>
<span id="cb143-186"><a href="#cb143-186" aria-hidden="true" tabindex="-1"></a><span class="co">  statements;</span></span>
<span id="cb143-187"><a href="#cb143-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-188"><a href="#cb143-188" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.5.1 - stroke'</span>;</span>
<span id="cb143-189"><a href="#cb143-189" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata651;</span>
<span id="cb143-190"><a href="#cb143-190" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb143-191"><a href="#cb143-191" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=<span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb143-192"><a href="#cb143-192" aria-hidden="true" tabindex="-1"></a>    invlink ilink= <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb143-193"><a href="#cb143-193" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> rpseudo= esvea sex age sbp /dist=<span class="fu">normal</span>  noscale ; </span>
<span id="cb143-194"><a href="#cb143-194" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb143-195"><a href="#cb143-195" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-196"><a href="#cb143-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-197"><a href="#cb143-197" aria-hidden="true" tabindex="-1"></a><span class="co">* Thus, we obtain the following model for the cumulative incidence of stroke at 3 years</span></span>
<span id="cb143-198"><a href="#cb143-198" aria-hidden="true" tabindex="-1"></a><span class="co">  F_stroke(3|Z) = 1 - exp(-exp(-13.2294 + 0.0312*Z1 + 0.9711*Z2 + 0.1199*Z3  + 0.0040*Z4)),  </span></span>
<span id="cb143-199"><a href="#cb143-199" aria-hidden="true" tabindex="-1"></a><span class="co">  where Z1, Z2, Z3, and Z4 are ESVEA, sex, age, and systolic blood pressure, respectively.;</span></span>
<span id="cb143-200"><a href="#cb143-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-201"><a href="#cb143-201" aria-hidden="true" tabindex="-1"></a><span class="co">* Likewise, we will fit a model for the cumulative incidence of death without stroke at 3 years;</span></span>
<span id="cb143-202"><a href="#cb143-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-203"><a href="#cb143-203" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'6.5.1 - death without stroke'</span>;</span>
<span id="cb143-204"><a href="#cb143-204" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=outdata651;</span>
<span id="cb143-205"><a href="#cb143-205" aria-hidden="true" tabindex="-1"></a>    class ptno;</span>
<span id="cb143-206"><a href="#cb143-206" aria-hidden="true" tabindex="-1"></a>    fwdlink <span class="kw">link</span>=<span class="fu">log</span>(-<span class="fu">log</span>(<span class="dv">1</span>-_mean_));</span>
<span id="cb143-207"><a href="#cb143-207" aria-hidden="true" tabindex="-1"></a>    invlink ilink= <span class="dv">1</span> - <span class="fu">exp</span>(-<span class="fu">exp</span>(_xbeta_));</span>
<span id="cb143-208"><a href="#cb143-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> dpseudo= esvea sex age sbp /dist=<span class="fu">normal</span> noscale ; </span>
<span id="cb143-209"><a href="#cb143-209" aria-hidden="true" tabindex="-1"></a>    repeated subject=ptno/corr=ind;</span>
<span id="cb143-210"><a href="#cb143-210" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-211"><a href="#cb143-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-212"><a href="#cb143-212" aria-hidden="true" tabindex="-1"></a><span class="co">* We obtain the following model for the cumulative incidence of death without stroke at 3 years</span></span>
<span id="cb143-213"><a href="#cb143-213" aria-hidden="true" tabindex="-1"></a><span class="co">  F_death(3|Z) = 1 - exp(-exp(-3.3924 + 0.2862*Z1 + 1.2618*Z2 + 0.0771*Z3 - 0.0442*Z4)), </span></span>
<span id="cb143-214"><a href="#cb143-214" aria-hidden="true" tabindex="-1"></a><span class="co">  where Z1, Z2, Z3, and Z4 are ESVEA, sex, age, and systolic blood pressure, respectively.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-10" class="level4">
<h4 class="anchored" data-anchor-id="section-10">2.</h4>
<p><em>Compare with the results of Exercises 4.4 and 5.8.</em></p>
<p>Errata: we compare with Exercise <em>4.5</em>, where we used Fine-Gray models to estimate the cumulative incidence functions for stroke and death without stroke. For the end-point stroke we obtained the following coefficients</p>
<p><span class="math display">\[ \beta_{ESVEA} = 0.593921   \quad \beta_{sex} = 0.379189   \quad \beta_{age} = 0.063347   \quad \beta_{sbp} = 0.010629,     \]</span></p>
<p>and for death without stroke we obtained the following coefficients</p>
<p><span class="math display">\[ \beta_{ESVEA} = -0.006269     \quad \beta_{sex} = 0.530219     \quad \beta_{age} = 0.066495       \quad \beta_{sbp} = 0.001601.\]</span></p>
<p>The estimates of the coefficients are quite different for the Fine-Gray model and the model based on pseudo observations for both end-points. This is likely due to the fact that the Fine-Gray model assumes that the linear predictor has the same association with the cumulative incidence at all time points. We also notice that only one of the covariates in each model using pseudo values (age in the case of stroke and systolic blood pressure in the case of death without stroke) are associated with <span class="math inline">\(p\)</span>-values smaller than 0.05.</p>
<p>Comparison with Exercise 5.8 is not meaningful - sorry!</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch5.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch7.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</div>   
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a> and <a href="https://posit.co/products/open-source/rstudio/">RStudio</a></div>
  </div>
</footer>



</body></html>