<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models for Multi-State Survival Data - 2&nbsp; Intuition for intensity models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch3.html" rel="next">
<link href="./Ch1.html" rel="prev">
<link href="./corvos.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./MSBfrontbirds.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/multi-state-book/companion" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./errata.html" class="sidebar-item-text sidebar-link">Errata</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pbc3-trial-in-liver-cirrhosis" id="toc-pbc3-trial-in-liver-cirrhosis" class="nav-link active" data-scroll-target="#pbc3-trial-in-liver-cirrhosis">PBC3 trial in liver cirrhosis</a>
  <ul>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">Read data</a></li>
  <li><a href="#figure-2.1" id="toc-figure-2.1" class="nav-link" data-scroll-target="#figure-2.1">Figure 2.1</a></li>
  <li><a href="#in-text-p.-37-nelson-aalen-estimates-at-2-years" id="toc-in-text-p.-37-nelson-aalen-estimates-at-2-years" class="nav-link" data-scroll-target="#in-text-p.-37-nelson-aalen-estimates-at-2-years">In-text, p.&nbsp;37: Nelson-Aalen estimates at 2 years</a></li>
  <li><a href="#in-text-p.-38-lrt-test-piece-wise-exponential-model" id="toc-in-text-p.-38-lrt-test-piece-wise-exponential-model" class="nav-link" data-scroll-target="#in-text-p.-38-lrt-test-piece-wise-exponential-model">In-text, p.&nbsp;38: LRT test piece-wise exponential model</a></li>
  <li><a href="#figure-2.2" id="toc-figure-2.2" class="nav-link" data-scroll-target="#figure-2.2">Figure 2.2</a></li>
  <li><a href="#table-2.1" id="toc-table-2.1" class="nav-link" data-scroll-target="#table-2.1">Table 2.1</a></li>
  <li><a href="#in-text-p.-40-logrank-test-and-p-value" id="toc-in-text-p.-40-logrank-test-and-p-value" class="nav-link" data-scroll-target="#in-text-p.-40-logrank-test-and-p-value">In-text, p.&nbsp;40: Logrank test and p-value</a></li>
  <li><a href="#figure-2.3" id="toc-figure-2.3" class="nav-link" data-scroll-target="#figure-2.3">Figure 2.3</a></li>
  <li><a href="#in-text-p.-43-cox-model-with-treatment-only" id="toc-in-text-p.-43-cox-model-with-treatment-only" class="nav-link" data-scroll-target="#in-text-p.-43-cox-model-with-treatment-only">In-text, p.&nbsp;43: Cox model with treatment only</a></li>
  <li><a href="#figure-2.5" id="toc-figure-2.5" class="nav-link" data-scroll-target="#figure-2.5">Figure 2.5</a></li>
  <li><a href="#table-2.3" id="toc-table-2.3" class="nav-link" data-scroll-target="#table-2.3">Table 2.3</a></li>
  <li><a href="#table-2.4" id="toc-table-2.4" class="nav-link" data-scroll-target="#table-2.4">Table 2.4</a></li>
  <li><a href="#sec-ch2-pbc3-poisson" id="toc-sec-ch2-pbc3-poisson" class="nav-link" data-scroll-target="#sec-ch2-pbc3-poisson">In-text, p.&nbsp;45: Poisson model with treatment</a></li>
  <li><a href="#table-2.5" id="toc-table-2.5" class="nav-link" data-scroll-target="#table-2.5">Table 2.5</a></li>
  <li><a href="#table-2.6" id="toc-table-2.6" class="nav-link" data-scroll-target="#table-2.6">Table 2.6</a></li>
  <li><a href="#figure-2.6" id="toc-figure-2.6" class="nav-link" data-scroll-target="#figure-2.6">Figure 2.6</a></li>
  <li><a href="#figure-2.7" id="toc-figure-2.7" class="nav-link" data-scroll-target="#figure-2.7">Figure 2.7</a></li>
  <li><a href="#figure-2.8" id="toc-figure-2.8" class="nav-link" data-scroll-target="#figure-2.8">Figure 2.8</a></li>
  <li><a href="#table-2.7" id="toc-table-2.7" class="nav-link" data-scroll-target="#table-2.7">Table 2.7</a></li>
  <li><a href="#table-2.8" id="toc-table-2.8" class="nav-link" data-scroll-target="#table-2.8">Table 2.8</a></li>
  <li><a href="#table-2.9" id="toc-table-2.9" class="nav-link" data-scroll-target="#table-2.9">Table 2.9</a></li>
  <li><a href="#in-text-p.-51-stratified-cox-model" id="toc-in-text-p.-51-stratified-cox-model" class="nav-link" data-scroll-target="#in-text-p.-51-stratified-cox-model">In-text, p.&nbsp;51: stratified Cox model</a></li>
  <li><a href="#figure-2.10" id="toc-figure-2.10" class="nav-link" data-scroll-target="#figure-2.10">Figure 2.10</a></li>
  <li><a href="#figure-2.11" id="toc-figure-2.11" class="nav-link" data-scroll-target="#figure-2.11">Figure 2.11</a></li>
  <li><a href="#in-text-p.-55-simple-aalen-model" id="toc-in-text-p.-55-simple-aalen-model" class="nav-link" data-scroll-target="#in-text-p.-55-simple-aalen-model">In-text, p.&nbsp;55: simple Aalen model</a></li>
  <li><a href="#figure-2.12" id="toc-figure-2.12" class="nav-link" data-scroll-target="#figure-2.12">Figure 2.12</a></li>
  <li><a href="#table-2.10" id="toc-table-2.10" class="nav-link" data-scroll-target="#table-2.10">Table 2.10</a></li>
  <li><a href="#in-text-p.-57-aalen-models" id="toc-in-text-p.-57-aalen-models" class="nav-link" data-scroll-target="#in-text-p.-57-aalen-models">In-text, p.&nbsp;57: Aalen models</a></li>
  <li><a href="#in-text-p.-58-additive-poisson-model" id="toc-in-text-p.-58-additive-poisson-model" class="nav-link" data-scroll-target="#in-text-p.-58-additive-poisson-model">In-text, p.&nbsp;58: additive Poisson model</a></li>
  <li><a href="#table-2.11" id="toc-table-2.11" class="nav-link" data-scroll-target="#table-2.11">Table 2.11</a></li>
  <li><a href="#table-2.13" id="toc-table-2.13" class="nav-link" data-scroll-target="#table-2.13">Table 2.13</a></li>
  </ul></li>
  <li><a href="#guinea-bissau-childhood-vaccination-study" id="toc-guinea-bissau-childhood-vaccination-study" class="nav-link" data-scroll-target="#guinea-bissau-childhood-vaccination-study">Guinea-Bissau childhood vaccination study</a>
  <ul>
  <li><a href="#read-data-1" id="toc-read-data-1" class="nav-link" data-scroll-target="#read-data-1">Read data</a></li>
  <li><a href="#in-text-p.-58-cox-model-unadjusted-for-age" id="toc-in-text-p.-58-cox-model-unadjusted-for-age" class="nav-link" data-scroll-target="#in-text-p.-58-cox-model-unadjusted-for-age">In-text, p.&nbsp;58: Cox model unadjusted for age</a></li>
  <li><a href="#table-2.12" id="toc-table-2.12" class="nav-link" data-scroll-target="#table-2.12">Table 2.12</a></li>
  <li><a href="#figure-2.13" id="toc-figure-2.13" class="nav-link" data-scroll-target="#figure-2.13">Figure 2.13</a></li>
  <li><a href="#figure-2.14" id="toc-figure-2.14" class="nav-link" data-scroll-target="#figure-2.14">Figure 2.14</a></li>
  </ul></li>
  <li><a href="#recurrent-episodes-in-affective-disorders" id="toc-recurrent-episodes-in-affective-disorders" class="nav-link" data-scroll-target="#recurrent-episodes-in-affective-disorders">Recurrent episodes in affective disorders</a>
  <ul>
  <li><a href="#read-data-2" id="toc-read-data-2" class="nav-link" data-scroll-target="#read-data-2">Read data</a></li>
  <li><a href="#table-2.14" id="toc-table-2.14" class="nav-link" data-scroll-target="#table-2.14">Table 2.14</a></li>
  </ul></li>
  <li><a href="#leader-cardiovascular-trial-in-type-2-diabetes" id="toc-leader-cardiovascular-trial-in-type-2-diabetes" class="nav-link" data-scroll-target="#leader-cardiovascular-trial-in-type-2-diabetes">LEADER cardiovascular trial in type 2 diabetes</a>
  <ul>
  <li><a href="#read-data-3" id="toc-read-data-3" class="nav-link" data-scroll-target="#read-data-3">Read data</a></li>
  <li><a href="#figure-2.15" id="toc-figure-2.15" class="nav-link" data-scroll-target="#figure-2.15">Figure 2.15</a></li>
  <li><a href="#table-2.15" id="toc-table-2.15" class="nav-link" data-scroll-target="#table-2.15">Table 2.15</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#exercise-2.1" id="toc-exercise-2.1" class="nav-link" data-scroll-target="#exercise-2.1">Exercise 2.1</a></li>
  <li><a href="#exercise-2.2" id="toc-exercise-2.2" class="nav-link" data-scroll-target="#exercise-2.2">Exercise 2.2</a>
  <ul>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3">1.</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4">2.</a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5">3.</a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6">4.</a></li>
  </ul></li>
  <li><a href="#exercise-2.3" id="toc-exercise-2.3" class="nav-link" data-scroll-target="#exercise-2.3">Exercise 2.3</a>
  <ul>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7">1.</a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8">2.</a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9">3.</a></li>
  </ul></li>
  <li><a href="#exercise-2.4" id="toc-exercise-2.4" class="nav-link" data-scroll-target="#exercise-2.4">Exercise 2.4</a>
  <ul>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10">1.</a></li>
  <li><a href="#section-11" id="toc-section-11" class="nav-link" data-scroll-target="#section-11">2.</a></li>
  <li><a href="#section-12" id="toc-section-12" class="nav-link" data-scroll-target="#section-12">3.</a></li>
  </ul></li>
  <li><a href="#exercise-2.5" id="toc-exercise-2.5" class="nav-link" data-scroll-target="#exercise-2.5">Exercise 2.5</a>
  <ul>
  <li><a href="#section-13" id="toc-section-13" class="nav-link" data-scroll-target="#section-13">1.</a></li>
  <li><a href="#section-14" id="toc-section-14" class="nav-link" data-scroll-target="#section-14">2.</a></li>
  <li><a href="#section-15" id="toc-section-15" class="nav-link" data-scroll-target="#section-15">3.</a></li>
  </ul></li>
  <li><a href="#exercise-2.6" id="toc-exercise-2.6" class="nav-link" data-scroll-target="#exercise-2.6">Exercise 2.6</a>
  <ul>
  <li><a href="#section-16" id="toc-section-16" class="nav-link" data-scroll-target="#section-16">1.</a></li>
  <li><a href="#section-17" id="toc-section-17" class="nav-link" data-scroll-target="#section-17">2.</a></li>
  <li><a href="#section-18" id="toc-section-18" class="nav-link" data-scroll-target="#section-18">3.</a></li>
  </ul></li>
  <li><a href="#exercise-2.7" id="toc-exercise-2.7" class="nav-link" data-scroll-target="#exercise-2.7">Exercise 2.7</a>
  <ul>
  <li><a href="#section-19" id="toc-section-19" class="nav-link" data-scroll-target="#section-19">1.</a></li>
  <li><a href="#section-20" id="toc-section-20" class="nav-link" data-scroll-target="#section-20">2.</a></li>
  </ul></li>
  <li><a href="#exercise-2.8" id="toc-exercise-2.8" class="nav-link" data-scroll-target="#exercise-2.8">Exercise 2.8</a>
  <ul>
  <li><a href="#section-21" id="toc-section-21" class="nav-link" data-scroll-target="#section-21">1.</a></li>
  <li><a href="#section-22" id="toc-section-22" class="nav-link" data-scroll-target="#section-22">2.</a></li>
  <li><a href="#section-23" id="toc-section-23" class="nav-link" data-scroll-target="#section-23">3.</a></li>
  <li><a href="#section-24" id="toc-section-24" class="nav-link" data-scroll-target="#section-24">4.</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/multi-state-book/companion/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Show/hide all code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="pbc3-trial-in-liver-cirrhosis" class="level2">
<h2 class="anchored" data-anchor-id="pbc3-trial-in-liver-cirrhosis">PBC3 trial in liver cirrhosis</h2>
<section id="read-data" class="level3">
<h3 class="anchored" data-anchor-id="read-data">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="Ch2_cache/html/read-pbc3-r_2486146fd33e23774d78ecdc96a77f29">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pbc3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/pbc3.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>fail <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pbc3<span class="sc">$</span>status <span class="sc">!=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="co"># event/failure indicator</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pbc3<span class="sc">$</span>tment <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add transformations of covariates </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>albnorm <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (alb<span class="dv">-35</span>)<span class="sc">*</span>(alb<span class="sc">&gt;</span><span class="dv">35</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb10 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, alb<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, alb10<span class="sc">*</span>alb10)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilihigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-17.1</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilitoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-34.2</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilimuchtoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-51.3</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili100 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, bili<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, bili100<span class="sc">*</span>bili100)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fu">log2</span>(bili))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, log2bili<span class="sc">*</span>log2bili)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilihigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">17.1</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilitoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">34.2</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilimuchtoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">51.3</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="Ch2_cache/html/read-pbc3-sas_211d051ef9140fdfeabdea1656bc12af">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=pbc3</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/pbc3.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3; </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3;</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    albnorm=(alb<span class="dv">-35</span>)*(alb&gt;<span class="dv">35</span>);</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    alb10=alb/<span class="dv">10</span>;</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    alb2=alb*alb;</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    bilihigh=(bili<span class="dv">-17.1</span>)*(bili&gt;<span class="dv">17.1</span>);</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    bilitoohigh=(bili<span class="dv">-34.2</span>)*(bili&gt;<span class="dv">34.2</span>);</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    bilimuchtoohigh=(bili<span class="dv">-51.3</span>)*(bili&gt;<span class="dv">51.3</span>);</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    bili100=bili/<span class="dv">100</span>;</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    bili2=bili*bili;</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    log2bili=<span class="fu">log2</span>(bili);</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    logbilihigh=(log2bili-<span class="fu">log2</span>(<span class="dv">17.1</span>))*(bili&gt;<span class="dv">17.1</span>);</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    logbilitoohigh=(log2bili-<span class="fu">log2</span>(<span class="dv">34.2</span>))*(bili&gt;<span class="dv">34.2</span>);</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    logbilimuchtoohigh=(log2bili-<span class="fu">log2</span>(<span class="dv">51.3</span>))*(bili&gt;<span class="dv">51.3</span>);</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    log2bili2=log2bili*log2bili;</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.1" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.1">Figure 2.1</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.1-r_b137ee19c96480d79b9112b2e9bc6e40">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General plotting style </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Nelson Aalen estimate by treatment</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>nafit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>nadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> nafit<span class="sc">$</span>cumhaz, <span class="at">time =</span> nafit<span class="sc">$</span>time, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sd =</span> nafit<span class="sc">$</span>std.err,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">1</span>], nafit<span class="sc">$</span>strata[<span class="dv">1</span>]), </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">2</span>], nafit<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.1</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> nadata) <span class="sc">+</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)) <span class="sc">+</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>))  <span class="sc">+</span> </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  theme_general </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.1-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.1-sas_da6e3e474c095e0f9cb5680194299c16">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3; </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    strata tment;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    baseline out=hazdat cumhaz=naa stdcumhaz=sdnaa;</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> hazdat; </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> hazdat; </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    daysyears = days/<span class="dv">365.25</span>; </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=hazdat;</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    plot naa*daysyears=tment/haxis=axis1 vaxis=axis2;</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">6</span> <span class="kw">by</span> <span class="dv">1</span> minor=none</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>=(<span class="st">'Years'</span>);</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.7</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=red;</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=stepjl c=blue;</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-37-nelson-aalen-estimates-at-2-years" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-37-nelson-aalen-estimates-at-2-years">In-text, p.&nbsp;37: Nelson-Aalen estimates at 2 years</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">subset</span>(nadata, nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span><span class="sc">*</span><span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=0"</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     cumhaz time         sd   tment
60 0.183065  724 0.03560398 tment=0</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">subset</span>(nadata, nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span><span class="sc">*</span><span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=1"</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       cumhaz time         sd   tment
209 0.1668539  725 0.03449431 tment=1</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-Naa2-sas_931fac525947ac258b7a6ec8ba8fd72d">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span>=hazdat;</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="dv">1.5</span>&lt;daysyears&lt;=<span class="dv">2</span>; </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-38-lrt-test-piece-wise-exponential-model" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-38-lrt-test-piece-wise-exponential-model">In-text, p.&nbsp;38: LRT test piece-wise exponential model</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-lrt-pcw-r_8f03aaf506c499222228b617baae9fc5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>poisfull <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> timegroup <span class="sc">+</span> tment<span class="sc">*</span>timegroup <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">offset</span>(<span class="fu">log</span>(risktime<span class="sc">/</span><span class="dv">36525</span>)), <span class="at">data =</span> pbc3mult, <span class="at">family=</span>poisson)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>poisred <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span>  timegroup <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">offset</span>(<span class="fu">log</span>(risktime<span class="sc">/</span><span class="dv">36525</span>)), <span class="at">data =</span> pbc3mult, <span class="at">family=</span>poisson)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(poisred,poisfull,<span class="at">test=</span><span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: fail ~ timegroup + offset(log(risktime/36525))
Model 2: fail ~ tment + timegroup + tment * timegroup + offset(log(risktime/36525))
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1       620     459.66                     
2       617     459.35  3  0.30813   0.9585</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poisred,poisfull)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + offset(log(risktime/36525))
Model 2: fail ~ tment + timegroup + tment * timegroup + offset(log(risktime/36525))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   3 -319.83                     
2   6 -319.68  3 0.3081     0.9585</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-lrt-pcw-sas_5ba284ce1b1e6876f0df5c78c795b738">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ods <span class="kw">output</span> modelfit=full;</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    class interv tment;</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail=interv|tment /dist=poi offset=logrisk;</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> full;</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> full;</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">where</span> Criterion=<span class="st">"Deviance"</span>;</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>     full_like=value;</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>     full_df=df;</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>     <span class="kw">keep</span> full_like full_df;</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw">;run</span>;</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>ods <span class="kw">output</span> modelfit=reduced;</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    class interv tment;</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail=interv /dist=poi offset=logrisk;</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> reduced;</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> reduced;</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>     <span class="kw">where</span> Criterion=<span class="st">"Deviance"</span>;</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>     reduced_like=value;</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>     reduced_df=df;</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>     <span class="kw">keep</span> reduced_like reduced_df;</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> lrt_pval;</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a> <span class="kw">merge</span> full reduced;</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  lrt = reduced_like - full_like;</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    df  = reduced_df - full_df;</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  p_value = <span class="dv">1</span> - <span class="fu">probchi</span>(lrt,df);</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span>=lrt_pval;</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">title</span> <span class="st">"LR test statistic and p-value"</span>;</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.2">Figure 2.2</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.2_cdfa8e9228fb317f206323bf02d03908">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rates + cuts from Table 2.1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>rateCyA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">8.1</span>,<span class="fl">13.1</span>,<span class="fl">9.6</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>ratePbo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.4</span>,<span class="fl">12.5</span>,<span class="fl">8.5</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>pcwtime <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rates =</span> <span class="fu">c</span>(rateCyA, ratePbo),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"CyA"</span>, <span class="fu">length</span>(rateCyA)), </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Placebo"</span>, <span class="fu">length</span>(ratePbo))),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times_s =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">4</span>], <span class="dv">2</span>),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.2</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rates, <span class="at">linetype =</span> tment), <span class="at">data =</span> plotdata) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> times_s, <span class="at">y =</span> rates, <span class="at">xend =</span> times, <span class="at">yend =</span> rates),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>))  <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimated hazard function (per 100 years)"</span>) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">1</span>))  <span class="sc">+</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">14</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.2-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">

</div>
</div>
</div>
</section>
<section id="table-2.1" class="level3">
<h3 class="anchored" data-anchor-id="table-2.1">Table 2.1</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.1-r_e93318fa26c35aaac27a16a5204129f5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data for Table 2.1</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cuts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>) <span class="sc">*</span> <span class="fl">365.25</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data ready using survSplit from survival package</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>pbc3mult <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">survSplit</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> ., pbc3,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">episode =</span> <span class="st">"timegroup"</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>risktime <span class="ot">&lt;-</span> pbc3mult<span class="sc">$</span>days <span class="sc">-</span> cuts[pbc3mult<span class="sc">$</span>timegroup] </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>pcwdata <span class="ot">&lt;-</span> pbc3mult <span class="sc">%&gt;%</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tment, timegroup) <span class="sc">%&gt;%</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fail =</span> <span class="fu">sum</span>(fail), <span class="at">risktime =</span> <span class="fu">sum</span>(days <span class="sc">-</span> cuts[timegroup]))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>risktimeyrs <span class="ot">&lt;-</span> pcwdata<span class="sc">$</span>risktime<span class="sc">/</span><span class="fl">365.25</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>hazard <span class="ot">&lt;-</span> <span class="dv">36525</span><span class="sc">*</span>pcwdata<span class="sc">$</span>fail<span class="sc">/</span>pcwdata<span class="sc">$</span>risktime</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>SD <span class="ot">&lt;-</span> <span class="dv">36525</span><span class="sc">*</span><span class="fu">sqrt</span>(pcwdata<span class="sc">$</span>fail)<span class="sc">/</span>pcwdata<span class="sc">$</span>risktime</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(pcwdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  tment timegroup fail risktime risktimeyrs    hazard       SD
1     0         1   27 104856.0   287.08008  9.405041 1.810001
2     0         2   17  49673.0   135.99726 12.500252 3.031756
3     0         3    2   8642.0    23.66051  8.452904 5.977106
4     1         1   24 107931.5   295.50034  8.121818 1.657859
5     1         2   18  50284.5   137.67146 13.074605 3.081714
6     1         3    2   7599.0    20.80493  9.613107 6.797493</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.1-sas_07ae35c960b5c517dc8fa8b9af7dfc50">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* prepare for poisson model */</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3mult; </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3;</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    fail=(days&lt;=<span class="dv">2</span> * <span class="dv">365.25</span>)*(status ne <span class="dv">0</span>);</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    risktime=<span class="fu">min</span>(<span class="dv">2</span> * <span class="dv">365.25</span>, days);</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); interv=<span class="dv">1</span>; <span class="kw">output</span>;  </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> days&gt;<span class="dv">2</span> * <span class="dv">365.25</span> <span class="kw">then do</span>;</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    fail=(days&lt;=<span class="dv">4</span> * <span class="dv">365.25</span>)*(status ne <span class="dv">0</span>);</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    risktime=<span class="fu">min</span>(<span class="dv">2</span> * <span class="dv">365.25</span> ,days<span class="dv">-2</span> * <span class="dv">365.25</span>);</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); interv=<span class="dv">2</span>; <span class="kw">output; end</span>;</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> days&gt;<span class="dv">4</span> * <span class="dv">365.25</span>  <span class="kw">then do</span>;</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    fail=status ne <span class="dv">0</span>; </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    risktime=days<span class="dv">-4</span> * <span class="dv">365.25</span>;</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); interv=<span class="dv">3</span>; <span class="kw">output; end</span>;</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means <span class="fu">sum</span><span class="kw">  data</span>=pbc3mult;</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    class tment interv;</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">var</span> fail risktime;</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> tment=<span class="dv">1</span>;</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    class interv;</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail=interv/dist=poi offset=logrisk;</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'0-2 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>/<span class="fu">exp</span>;</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'2-4 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>/<span class="fu">exp</span>;</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'4-6 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>/<span class="fu">exp</span>;</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> tment=<span class="dv">0</span>;</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    class interv;</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail=interv/dist=poi offset=logrisk;</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'0-2 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>/<span class="fu">exp</span>;</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'2-4 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>/<span class="fu">exp</span>;</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'4-6 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>/<span class="fu">exp</span>;</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-40-logrank-test-and-p-value" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-40-logrank-test-and-p-value">In-text, p.&nbsp;40: Logrank test and p-value</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-logrank-r_deb82937db16f6a04f42a770e94e15d2">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>lr<span class="ot">&lt;-</span><span class="fu">survdiff</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(lr<span class="sc">$</span>obs[<span class="dv">1</span>],lr<span class="sc">$</span>exp[<span class="dv">1</span>],lr<span class="sc">$</span>var[<span class="dv">1</span>,<span class="dv">1</span>],lr<span class="sc">$</span>chisq,lr<span class="sc">$</span>pvalue), <span class="at">d=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 46.00000 44.68367 22.47967  0.07708  0.78129</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-logrank-sas_2303980a1b3e50ab0b8d9fb3f2cbd737">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> lifetest<span class="kw"> data</span>=pbc3 notable; </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span> days*status(<span class="dv">0</span>);</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    strata tment;</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.3" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.3">Figure 2.3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.3-r_751567ad599182622ec131bb16a04c3c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NA data from figure 2.1 model fit</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>tment1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(nadata, tment <span class="sc">==</span> <span class="st">"tment=1"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated hazard per time group</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>hazard_timegroup <span class="ot">&lt;-</span> pcwdata<span class="sc">$</span>fail <span class="sc">/</span> pcwdata<span class="sc">$</span>risktime</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a numeric version of the treatment to the NA estimates</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>tmentnum <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=1"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add piecewise constant hazard to data</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Between time 0 and 2</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="ot">&lt;-</span> nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">*</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Between time 2 and 4</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span><span class="sc">*</span> <span class="fl">365.25</span> ] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  (nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>) <span class="sc">*</span> </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">5</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># After time 4</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">5</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  (nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>) <span class="sc">*</span> </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">3</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">6</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Reformat for plot</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>piecepdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> <span class="fu">c</span>(nadata<span class="sc">$</span>cumhaz, nadata<span class="sc">$</span>pwch), </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">time =</span> <span class="fu">rep</span>(nadata<span class="sc">$</span>time, <span class="dv">2</span>),</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tmentnum =</span> <span class="fu">rep</span>(nadata<span class="sc">$</span>tmentnum, <span class="dv">2</span>),</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Nelson-Aalen"</span>, <span class="fu">length</span>(nadata<span class="sc">$</span>time)), </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Piece-wise exponential"</span>, <span class="fu">length</span>(nadata<span class="sc">$</span>time))))</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Only for treatment 1</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>piecepdata1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(piecepdata, tmentnum <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.3</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> type), </span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(piecepdata1, type <span class="sc">==</span> <span class="st">"Nelson-Aalen"</span>)) <span class="sc">+</span> </span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> type), <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">subset</span>(piecepdata1, type <span class="sc">==</span> <span class="st">"Piece-wise exponential"</span>)) <span class="sc">+</span> </span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">linetype =</span> <span class="st">"Type"</span>) <span class="sc">+</span> </span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>))  <span class="sc">+</span> </span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>  theme_general<span class="sc">+</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.3-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.3-sas_63bf7cd3ed67b92dfa39f08037cc5798">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> hazdat; </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> hazdat;</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> days&lt;=<span class="dv">2</span> * <span class="dv">365.25</span> <span class="kw">then</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        pwch=days*(<span class="dv">27.0000000</span>/<span class="dv">104856</span>*(<span class="dv">1</span>-tment)+<span class="dv">24.0000000</span>/<span class="dv">107931.5</span>*tment);</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="dv">2</span> * <span class="dv">365.25</span> &lt;days&lt;=<span class="dv">4</span> * <span class="dv">365.25</span> <span class="kw">then</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        pwch=<span class="dv">2</span>* <span class="dv">365.25</span>*(<span class="dv">27.0000000</span>/<span class="dv">104856</span>*(<span class="dv">1</span>-tment)+<span class="dv">24.0000000</span>/<span class="dv">107931.5</span>*tment)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        +(days<span class="dv">-2</span>* <span class="dv">365.25</span>)*(<span class="dv">17.0000000</span>/<span class="dv">49673</span>*(<span class="dv">1</span>-tment)+<span class="dv">18.0000000</span>/<span class="dv">50284</span>*tment);</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="dv">4</span> * <span class="dv">365.25</span> &lt;days <span class="kw">then</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        pwch=<span class="dv">2</span>* <span class="dv">365.25</span> *(<span class="dv">27.0000000</span>/<span class="dv">104856</span>*(<span class="dv">1</span>-tment)+<span class="dv">24.0000000</span>/<span class="dv">107931.5</span>*tment)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        +(<span class="dv">2</span>* <span class="dv">365.25</span>)*(<span class="dv">17.0000000</span>/<span class="dv">49673</span>*(<span class="dv">1</span>-tment)+<span class="dv">18.0000000</span>/<span class="dv">50284</span>*tment)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        +(days<span class="dv">-4</span>* <span class="dv">365.25</span>)*(<span class="dv">2.0000000</span>/<span class="dv">8642</span>*(<span class="dv">1</span>-tment)+<span class="dv">2.0000000</span>/<span class="dv">7599</span>*tment);</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    daysyears = days/<span class="dv">365.25</span>; </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=hazdat; <span class="kw">where</span> tment=<span class="dv">1</span>;</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    plot (naa pwch)*daysyears/overlay haxis=axis1 vaxis=axis2;</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">6</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'Years'</span>);</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.7</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl r=<span class="dv">1</span> c=red;</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    symbol2 v=none i=join r=<span class="dv">1</span> c=blue;</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-43-cox-model-with-treatment-only" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-43-cox-model-with-treatment-only">In-text, p.&nbsp;43: Cox model with treatment only</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-cox-r_57aba7dde2cf1a25e1b68a938d209238">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a Cox model using the pbc3 data with treatment as a covariate</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment, data = pbc3, 
    method = "breslow")

  n= 349, number of events= 90 

          coef exp(coef) se(coef)      z Pr(&gt;|z|)
tment -0.05854   0.94314  0.21092 -0.278    0.781

      exp(coef) exp(-coef) lower .95 upper .95
tment    0.9431       1.06    0.6238     1.426

Concordance= 0.517  (se = 0.029 )
Likelihood ratio test= 0.08  on 1 df,   p=0.8
Wald test            = 0.08  on 1 df,   p=0.8
Score (logrank) test = 0.08  on 1 df,   p=0.8</code></pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-cox-sas_514acc5c037c5dcde9ac648a0b3e7da4">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment/rl;</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.5" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.5">Figure 2.5</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.5-r_16a3aeb8cec919a3577478e6a6d7cd24">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxfit, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot (Breslow estimate)</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>coxdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> coxcumhaz<span class="sc">$</span>hazard, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> coxcumhaz<span class="sc">$</span>time, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tment =</span> <span class="fu">rep</span>(<span class="st">"0"</span>, <span class="fu">nrow</span>(coxcumhaz)), </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Breslow estimate"</span>, <span class="fu">nrow</span>(coxcumhaz)))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> coxdata) <span class="sc">+</span> </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard"</span>) <span class="sc">+</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>)) <span class="sc">+</span> </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  theme_general<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.5-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.5-sas_2bc95d2ae6c1aa283f6083b8fefce4cc">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> cov;</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    tment=<span class="dv">0</span>;</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment/rl;</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    baseline out=breslow cumhaz=breslow covariates=cov;</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow; </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> breslow; </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    daysyears = days/<span class="dv">365.25</span>; </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=breslow;</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    plot breslow*daysyears=tment/haxis=axis1 vaxis=axis2;</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">6</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'Years'</span>);</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.7</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative baseline hazard'</span>);</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=blue;</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.3" class="level3">
<h3 class="anchored" data-anchor-id="table-2.3">Table 2.3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.3-r_0f48d152ab7a2f02efae28eaec43977b">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Average covariate values of albumin and bilirubin per treatment </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>tabledata <span class="ot">&lt;-</span> pbc3 <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tment, tment_char) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(id <span class="sc">!=</span> <span class="dv">0</span>),  </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">average_albumin =</span> <span class="fu">mean</span>(alb, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># </span><span class="al">NOTE</span><span class="co">: Removes missing observations from mean computation</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">average_bilirubin =</span> <span class="fu">mean</span>(bili, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(tabledata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  tment tment_char   n average_albumin average_bilirubin
1     0    Placebo 173        39.26101          42.33674
2     1        CyA 176        37.50731          48.55540</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.3-sas_eff05423a2b6a3e8f0fc8bcfe4c88a17">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span>=pbc3 <span class="fu">mean</span>;</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  class tment;</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">var</span> alb bili;</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.4" class="level3">
<h3 class="anchored" data-anchor-id="table-2.4">Table 2.4</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.4-r_4e76897f2f03e0a0d6a41302c6a9edc6">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model with treatment, albumin and bilirubin as covariates </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> pbc3)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>coxfit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)

            coef  exp(coef)   se(coef)      z        p
tment -0.4965639  0.6086184  0.2256162 -2.201   0.0277
alb   -0.1156596  0.8907784  0.0212810 -5.435 5.48e-08
bili   0.0089494  1.0089895  0.0009801  9.131  &lt; 2e-16

Likelihood ratio test=99.06  on 3 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.4-sas_bfd9f9a360342b76c0616dd50400e83b">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb bili / rl;</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="sec-ch2-pbc3-poisson" class="level3">
<h3 class="anchored" data-anchor-id="sec-ch2-pbc3-poisson">In-text, p.&nbsp;45: Poisson model with treatment</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-poisson-r_8da170e8c9a08cafce9d8caa3ef4b2af">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools) <span class="co"># For using summ() function to get exp(beta)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts=</span><span class="fu">c</span>(<span class="st">"contr.treatment"</span>, <span class="st">"contr.poly"</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>poism <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>tment <span class="sc">+</span> timegroup <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">offset</span>(<span class="fu">log</span>(risktime<span class="sc">/</span><span class="fl">365.25</span>)), <span class="at">data =</span> pbc3mult,<span class="at">family =</span> poisson)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(poism, <span class="at">exp =</span> T,<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">model.info =</span> F, <span class="at">model.fit =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
exp(Est.)
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
97.5%
</th>
<th style="text-align:right;">
z val.
</th>
<th style="text-align:right;">
p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
tment
</td>
<td style="text-align:right;">
0.942
</td>
<td style="text-align:right;">
0.623
</td>
<td style="text-align:right;">
1.424
</td>
<td style="text-align:right;">
-0.284
</td>
<td style="text-align:right;">
0.776
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
timegroup1
</td>
<td style="text-align:right;">
0.090
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.127
</td>
<td style="text-align:right;">
-13.801
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
timegroup2
</td>
<td style="text-align:right;">
0.132
</td>
<td style="text-align:right;">
0.089
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:right;">
-10.242
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
timegroup3
</td>
<td style="text-align:right;">
0.092
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
-4.677
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> Standard errors: MLE
</td>
</tr>
</tfoot>

</table>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-poisson-sas_64314971f7a760701ae4dc2faa2d33d8">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  class tment(ref=<span class="st">"0"</span>) interv ;</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">model</span> fail = tment interv / dist=poi offset=logrisk;</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'CyA  vs placebo'</span> tment <span class="dv">1</span> -<span class="dv">1</span> / <span class="fu">exp</span>;</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  estimate <span class="st">'0-2 years'</span> intercept <span class="dv">1</span> tment <span class="dv">0</span> <span class="dv">1</span> interv <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> / <span class="fu">exp</span>;</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  estimate <span class="st">'2-4 years'</span> intercept <span class="dv">1</span> tment <span class="dv">0</span> <span class="dv">1</span> interv <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> / <span class="fu">exp</span>;</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  estimate <span class="st">'4+ years'</span>  intercept <span class="dv">1</span> tment <span class="dv">0</span> <span class="dv">1</span> interv <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> / <span class="fu">exp</span>;</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.5" class="level3">
<h3 class="anchored" data-anchor-id="table-2.5">Table 2.5</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.5-r_005b79a7428749fbb41f846085812d94">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model with treatment, albumin and bilirubin as covariates</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>poismod_t25 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili<span class="sc">+</span> timegroup<span class="dv">-1</span> <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">offset</span>(<span class="fu">log</span>(risktime<span class="sc">/</span><span class="fl">365.25</span>)),<span class="at">data=</span>pbc3mult,<span class="at">family=</span>poisson)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t25)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ tment + alb + bili + timegroup - 1 + offset(log(risktime/365.25)), 
    family = poisson, data = pbc3mult)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
tment      -0.4753406  0.2240970  -2.121  0.03391 *  
alb        -0.1123359  0.0212829  -5.278  1.3e-07 ***
bili        0.0084593  0.0009392   9.007  &lt; 2e-16 ***
timegroup1  1.2879891  0.8058179   1.598  0.10996    
timegroup2  2.1457404  0.8328628   2.576  0.00999 ** 
timegroup3  1.6076330  1.0120683   1.588  0.11218    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 1637.87  on 611  degrees of freedom
Residual deviance:  350.73  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 538.73

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.5-sas_3ff93f4f641296022cf4fedf19f7180c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= tment interv alb  bili / dist=poi offset=logrisk ;</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.6" class="level3">
<h3 class="anchored" data-anchor-id="table-2.6">Table 2.6</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.6-r_e9d28d969f64b6b0e137470b575d8aab">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.6 Cox models </span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Models for LR tests</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>base_coxmod <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>base_coxmod_log <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Cox 1</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> albnorm <span class="sc">+</span> bili,</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + albnorm + 
    bili, data = pbc3, method = "breslow", eps = 1e-08)

              coef  exp(coef)   se(coef)      z      p
tment   -0.4750722  0.6218402  0.2261462 -2.101 0.0357
alb     -0.0854244  0.9181225  0.0453150 -1.885 0.0594
albnorm -0.0557001  0.9458228  0.0726447 -0.767 0.4432
bili     0.0089810  1.0090214  0.0009843  9.124 &lt;2e-16

Likelihood ratio test=99.66  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l1, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + albnorm + bili
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -413.12                     
2   3 -413.42 -1 0.6001     0.4386</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Cox 1</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">*</span>alb) <span class="sc">+</span> bili,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + I(alb * 
    alb) + bili, data = pbc3, method = "breslow", eps = 1e-08)

                   coef  exp(coef)   se(coef)      z      p
tment        -0.4983093  0.6075570  0.2274284 -2.191 0.0284
alb          -0.1295361  0.8785029  0.2130539 -0.608 0.5432
I(alb * alb)  0.0001944  1.0001945  0.0029754  0.065 0.9479
bili          0.0089499  1.0089901  0.0009801  9.132 &lt;2e-16

Likelihood ratio test=99.07  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_q1, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + I(alb * alb) + bili
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -413.41                     
2   3 -413.42 -1 0.0042      0.948</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Cox 2</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                         bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili + 
    bilihigh + bilitoohigh + bilimuchtoohigh, data = pbc3, method = "breslow", 
    eps = 1e-08)

                     coef exp(coef)  se(coef)      z        p
tment           -0.598494  0.549639  0.229637 -2.606  0.00915
alb             -0.090970  0.913045  0.021894 -4.155 3.25e-05
bili             0.062425  1.064414  0.062296  1.002  0.31631
bilihigh        -0.014631  0.985476  0.085327 -0.171  0.86386
bilitoohigh     -0.002584  0.997419  0.052961 -0.049  0.96109
bilimuchtoohigh -0.040017  0.960773  0.026486 -1.511  0.13082

Likelihood ratio test=123.5  on 6 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l2, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + 
    bilimuchtoohigh
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   6 -401.22                         
2   3 -413.42 -3 24.396  2.064e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Cox 2</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment<span class="sc">+</span>alb<span class="sc">+</span>bili <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">*</span>bili),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili + 
    I(bili * bili), data = pbc3, method = "breslow", eps = 1e-08)

                     coef  exp(coef)   se(coef)      z        p
tment          -5.210e-01  5.939e-01  2.233e-01 -2.333 0.019640
alb            -1.019e-01  9.031e-01  2.168e-02 -4.703 2.56e-06
bili            1.998e-02  1.020e+00  3.263e-03  6.122 9.21e-10
I(bili * bili) -3.051e-05  1.000e+00  9.098e-06 -3.354 0.000798

Likelihood ratio test=111.4  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_q2, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili + I(bili * bili)
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   4 -407.24                         
2   3 -413.42 -1 12.351  0.0004408 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Cox 3</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                         logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    logbilihigh + logbilitoohigh + logbilimuchtoohigh, data = pbc3, 
    method = "breslow", eps = 1e-08)

                       coef exp(coef) se(coef)      z        p
tment              -0.58019   0.55979  0.22957 -2.527   0.0115
alb                -0.08852   0.91528  0.02182 -4.056 4.99e-05
log2bili            0.20135   1.22306  0.46511  0.433   0.6651
logbilihigh         0.93567   2.54893  0.91503  1.023   0.3065
logbilitoohigh     -0.38647   0.67945  1.29333 -0.299   0.7651
logbilimuchtoohigh -0.18140   0.83410  0.98801 -0.184   0.8543

Likelihood ratio test=121.6  on 6 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l3, base_coxmod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + 
    logbilitoohigh + logbilimuchtoohigh
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -402.13                     
2   3 -402.94 -3 1.6144     0.6561</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Cox 3</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili <span class="sc">+</span> log2bili2,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    log2bili2, data = pbc3, method = "breslow", eps = 1e-08)

              coef exp(coef) se(coef)      z        p
tment     -0.57408   0.56323  0.22454 -2.557   0.0106
alb       -0.09150   0.91256  0.02192 -4.175 2.98e-05
log2bili   0.58231   1.79017  0.49992  1.165   0.2441
log2bili2  0.00715   1.00717  0.04277  0.167   0.8672

Likelihood ratio test=120  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_q3, base_coxmod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + log2bili + log2bili2
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -402.93                     
2   3 -402.94 -1 0.0277     0.8677</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.6 Poisson models </span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data ready for Poisson models using survSplit from survival package</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>pbc3mult <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">survSplit</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> ., pbc3,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">episode =</span> <span class="st">"timegroup"</span>))</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>risktime <span class="ot">&lt;-</span> pbc3mult<span class="sc">$</span>days <span class="sc">-</span> cuts[pbc3mult<span class="sc">$</span>timegroup] </span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Models for LR test</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>base_poismod <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>base_poismod_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data=</span>pbc3mult,<span class="at">family=</span>poisson)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Poisson 1</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>poismod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> albnorm <span class="sc">+</span> bili <span class="sc">+</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data=</span>pbc3mult, <span class="at">family=</span>poisson)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ timegroup + tment + alb + albnorm + bili + 
    offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -5.1177409  1.6273358  -3.145  0.00166 ** 
timegroup1  -0.3106216  0.6042733  -0.514  0.60722    
timegroup2   0.5433694  0.6022062   0.902  0.36690    
tment       -0.4576984  0.2247281  -2.037  0.04168 *  
alb         -0.0864388  0.0451742  -1.913  0.05569 .  
albnorm     -0.0473832  0.0720301  -0.658  0.51065    
bili         0.0084777  0.0009419   9.001  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.28  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 540.28

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l1, base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + albnorm + bili + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -263.14                     
2   6 -263.36 -1 0.4404     0.5069</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Poisson 1</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">*</span>alb) <span class="sc">+</span> bili <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ timegroup + tment + alb + I(alb * alb) + 
    bili + offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -3.8279840  3.8141837  -1.004   0.3156    
timegroup1   -0.3227765  0.6048377  -0.534   0.5936    
timegroup2    0.5362133  0.6024251   0.890   0.3734    
tment        -0.4786804  0.2258499  -2.119   0.0341 *  
alb          -0.1387716  0.2101463  -0.660   0.5090    
I(alb * alb)  0.0003705  0.0029295   0.126   0.8993    
bili          0.0084614  0.0009391   9.010   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.71  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 540.71

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q1, base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + I(alb * alb) + bili + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -263.36                     
2   6 -263.36 -1 0.0158     0.8999</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Poisson 2</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_l2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                        bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ timegroup + tment + alb + bili + bilihigh + 
    bilitoohigh + bilimuchtoohigh + offset(log(risktime)), family = poisson, 
    data = pbc3mult)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -6.453990   1.368380  -4.717  2.4e-06 ***
timegroup1      -0.427435   0.604700  -0.707   0.4797    
timegroup2       0.425435   0.603554   0.705   0.4809    
tment           -0.569111   0.226892  -2.508   0.0121 *  
alb             -0.086487   0.021876  -3.954  7.7e-05 ***
bili             0.061654   0.062308   0.989   0.3224    
bilihigh        -0.016757   0.085194  -0.197   0.8441    
bilitoohigh      0.002652   0.052566   0.050   0.9598    
bilimuchtoohigh -0.042801   0.026193  -1.634   0.1022    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 326.18  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.18

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l2, base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + bili + bilihigh + bilitoohigh + 
    bilimuchtoohigh + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   9 -251.09                         
2   6 -263.36 -3 24.545  1.922e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Poisson 2</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">*</span>bili) <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ timegroup + tment + alb + bili + I(bili * 
    bili) + offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -5.163e+00  1.053e+00  -4.902 9.47e-07 ***
timegroup1     -3.819e-01  6.047e-01  -0.631  0.52774    
timegroup2      4.555e-01  6.033e-01   0.755  0.45030    
tment          -4.987e-01  2.217e-01  -2.250  0.02447 *  
alb            -9.774e-02  2.163e-02  -4.518 6.24e-06 ***
bili            1.998e-02  3.266e-03   6.118 9.49e-10 ***
I(bili * bili) -3.152e-05  9.069e-06  -3.475  0.00051 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 337.38  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 527.38

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q2, base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + bili + I(bili * bili) + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   7 -256.69                         
2   6 -263.36 -1 13.345  0.0002591 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Poisson 3</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                        log2bili <span class="sc">+</span> logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ timegroup + tment + alb + log2bili + logbilihigh + 
    logbilitoohigh + logbilimuchtoohigh + offset(log(risktime)), 
    family = poisson, data = pbc3mult)

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)        -6.52003    1.99572  -3.267 0.001087 ** 
timegroup1         -0.40679    0.60392  -0.674 0.500579    
timegroup2          0.41834    0.60355   0.693 0.488223    
tment              -0.55563    0.22703  -2.447 0.014390 *  
alb                -0.08440    0.02181  -3.870 0.000109 ***
log2bili            0.19800    0.46549   0.425 0.670583    
logbilihigh         0.88154    0.91202   0.967 0.333756    
logbilitoohigh     -0.23363    1.27745  -0.183 0.854884    
logbilimuchtoohigh -0.31390    0.97076  -0.323 0.746425    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.54  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 521.54

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l3, base_poismod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + log2bili + logbilihigh + logbilitoohigh + 
    logbilimuchtoohigh + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   9 -251.77                     
2   6 -252.62 -3 1.7135     0.6339</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Poisson 3</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili2 <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ timegroup + tment + alb + log2bili + log2bili2 + 
    offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -7.860086   1.851557  -4.245 2.18e-05 ***
timegroup1  -0.406020   0.604625  -0.672   0.5019    
timegroup2   0.439074   0.603467   0.728   0.4669    
tment       -0.545495   0.222667  -2.450   0.0143 *  
alb         -0.087106   0.021892  -3.979 6.92e-05 ***
log2bili     0.627828   0.497489   1.262   0.2070    
log2bili2    0.001641   0.042356   0.039   0.9691    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.25  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.25

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q3, base_poismod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + log2bili + log2bili2 + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -252.62                     
2   6 -252.62 -1 0.0015     0.9691</code></pre>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.6-sas_b9ca816f2e90000c3998d0b1451ebe0a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">** Cox models **;</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co">* Base models for LR tests;</span> </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb bili/rl ties=breslow CONVERGELIKE=<span class="dv">1E-8</span> type3(lr);</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili/rl ties=breslow CONVERGELIKE=<span class="dv">1E-8</span> type3(lr);</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co">* Splines Cox 1;</span> </span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT can here be read of type3 test result;</span> </span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb albnorm bili/rl ties=breslow CONVERGELIKE=<span class="dv">1E-8</span> type3(lr);</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="co">* Quadratic Cox 1;</span> </span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT can here be read of type3 test result;</span> </span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>  alb2=alb*alb;</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb10 alb2 bili100/rl type3(LR);</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a><span class="co">* Splines Cox 2;</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb bili bilihigh bilitoohigh </span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>                             bilimuchtoohigh/rl type3(lr) ties=breslow CONVERGELIKE=<span class="dv">1E-8</span>;</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>  Wald_same_as_LRT: test  bilihigh=bilitoohigh=bilimuchtoohigh=<span class="dv">0</span>;</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT;</span> </span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">826.830-802.434</span>;</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a><span class="co">* Quadratic Cox 2;</span> </span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT can here be read of type3 test result;</span> </span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a>  bili2=bili*bili;</span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb10 bili bili2 / rl type3(LR);</span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a><span class="co">* Splines Cox 3;</span></span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili logbilihigh </span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>                             logbilitoohigh logbilimuchtoohigh/rl ties=breslow CONVERGELIKE=<span class="dv">1E-8</span>;</span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>  Wald_same_as_LRT: test  logbilihigh=logbilitoohigh=logbilimuchtoohigh=<span class="dv">0</span>;</span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT;</span> </span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">805.881-804.267</span>;</span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a><span class="co">* Quadratic Cox 3;</span> </span>
<span id="cb88-65"><a href="#cb88-65" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT can here be read of type3 test result;</span> </span>
<span id="cb88-66"><a href="#cb88-66" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb88-67"><a href="#cb88-67" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb88-68"><a href="#cb88-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb10 log2bili log2bili2/rl type3(LR);</span>
<span id="cb88-69"><a href="#cb88-69" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-70"><a href="#cb88-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-71"><a href="#cb88-71" aria-hidden="true" tabindex="-1"></a><span class="co">* Split data into timegroups for Poisson models;</span> </span>
<span id="cb88-72"><a href="#cb88-72" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3mult; </span>
<span id="cb88-73"><a href="#cb88-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3;</span>
<span id="cb88-74"><a href="#cb88-74" aria-hidden="true" tabindex="-1"></a>    fail=(days&lt;=<span class="dv">2</span> * <span class="dv">365.25</span>)*(status ne <span class="dv">0</span>);</span>
<span id="cb88-75"><a href="#cb88-75" aria-hidden="true" tabindex="-1"></a>    risktime=<span class="fu">min</span>(<span class="dv">2</span> * <span class="dv">365.25</span>,days);</span>
<span id="cb88-76"><a href="#cb88-76" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); interv=<span class="dv">1</span>; <span class="kw">output</span>;  </span>
<span id="cb88-77"><a href="#cb88-77" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> days&gt;<span class="dv">2</span>* <span class="dv">365.25</span> <span class="kw">then do</span>;</span>
<span id="cb88-78"><a href="#cb88-78" aria-hidden="true" tabindex="-1"></a>    fail=(days&lt;=<span class="dv">4</span>* <span class="dv">365.25</span>)*(status ne <span class="dv">0</span>);</span>
<span id="cb88-79"><a href="#cb88-79" aria-hidden="true" tabindex="-1"></a>    risktime=<span class="fu">min</span>(<span class="dv">2</span>* <span class="dv">365.25</span>,days<span class="dv">-2</span>* <span class="dv">365.25</span>);</span>
<span id="cb88-80"><a href="#cb88-80" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); interv=<span class="dv">2</span>; <span class="kw">output; end</span>;</span>
<span id="cb88-81"><a href="#cb88-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> days&gt;<span class="dv">4</span>* <span class="dv">365.25</span> <span class="kw">then do</span>;</span>
<span id="cb88-82"><a href="#cb88-82" aria-hidden="true" tabindex="-1"></a>    fail=status ne <span class="dv">0</span>; </span>
<span id="cb88-83"><a href="#cb88-83" aria-hidden="true" tabindex="-1"></a>    risktime=days<span class="dv">-4</span>* <span class="dv">365.25</span>;</span>
<span id="cb88-84"><a href="#cb88-84" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); interv=<span class="dv">3</span>; <span class="kw">output; end</span>;</span>
<span id="cb88-85"><a href="#cb88-85" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-86"><a href="#cb88-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-87"><a href="#cb88-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-88"><a href="#cb88-88" aria-hidden="true" tabindex="-1"></a><span class="co">** Possion models **;</span></span>
<span id="cb88-89"><a href="#cb88-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-90"><a href="#cb88-90" aria-hidden="true" tabindex="-1"></a><span class="co">* Models to compare with for the LR tests;</span> </span>
<span id="cb88-91"><a href="#cb88-91" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb88-92"><a href="#cb88-92" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb88-93"><a href="#cb88-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb bili/ dist=poi offset=logrisk type3;</span>
<span id="cb88-94"><a href="#cb88-94" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-95"><a href="#cb88-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-96"><a href="#cb88-96" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb88-97"><a href="#cb88-97" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb88-98"><a href="#cb88-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili/ dist=poi offset=logrisk type3;</span>
<span id="cb88-99"><a href="#cb88-99" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-100"><a href="#cb88-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-101"><a href="#cb88-101" aria-hidden="true" tabindex="-1"></a><span class="co">* Splines Poisson 1;</span> </span>
<span id="cb88-102"><a href="#cb88-102" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT can here be read of type3 test result;</span> </span>
<span id="cb88-103"><a href="#cb88-103" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb88-104"><a href="#cb88-104" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb88-105"><a href="#cb88-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb albnorm bili/ dist=poi offset=logrisk type3;</span>
<span id="cb88-106"><a href="#cb88-106" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-107"><a href="#cb88-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-108"><a href="#cb88-108" aria-hidden="true" tabindex="-1"></a><span class="co">* Quadratic Poisson 1;</span></span>
<span id="cb88-109"><a href="#cb88-109" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT can here be read of type3 test result;</span> </span>
<span id="cb88-110"><a href="#cb88-110" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb88-111"><a href="#cb88-111" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb88-112"><a href="#cb88-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb10 alb2 bili100/ dist=poi offset=logrisk type3;</span>
<span id="cb88-113"><a href="#cb88-113" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-114"><a href="#cb88-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-115"><a href="#cb88-115" aria-hidden="true" tabindex="-1"></a><span class="co">* Splines Poisson 2;</span> </span>
<span id="cb88-116"><a href="#cb88-116" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb88-117"><a href="#cb88-117" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb88-118"><a href="#cb88-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb bili bilihigh bilitoohigh  </span>
<span id="cb88-119"><a href="#cb88-119" aria-hidden="true" tabindex="-1"></a>                 bilimuchtoohigh/ dist=poi offset=logrisk type3;</span>
<span id="cb88-120"><a href="#cb88-120" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-121"><a href="#cb88-121" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT;</span> </span>
<span id="cb88-122"><a href="#cb88-122" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb88-123"><a href="#cb88-123" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">350.7253-326.1805</span>;</span>
<span id="cb88-124"><a href="#cb88-124" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb88-125"><a href="#cb88-125" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb88-126"><a href="#cb88-126" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-127"><a href="#cb88-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-128"><a href="#cb88-128" aria-hidden="true" tabindex="-1"></a><span class="co">* Quadratic Poisson 2;</span></span>
<span id="cb88-129"><a href="#cb88-129" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT can here be read of type3 test result;</span> </span>
<span id="cb88-130"><a href="#cb88-130" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb88-131"><a href="#cb88-131" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb88-132"><a href="#cb88-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb10 bili100 bili2/ dist=poi offset=logrisk type3;</span>
<span id="cb88-133"><a href="#cb88-133" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-134"><a href="#cb88-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-135"><a href="#cb88-135" aria-hidden="true" tabindex="-1"></a><span class="co">* Splines Poisson 3;</span></span>
<span id="cb88-136"><a href="#cb88-136" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb88-137"><a href="#cb88-137" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb88-138"><a href="#cb88-138" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili logbilihigh logbilitoohigh </span>
<span id="cb88-139"><a href="#cb88-139" aria-hidden="true" tabindex="-1"></a>                 logbilimuchtoohigh / dist=poi offset=logrisk type3;</span>
<span id="cb88-140"><a href="#cb88-140" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-141"><a href="#cb88-141" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT;</span> </span>
<span id="cb88-142"><a href="#cb88-142" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb88-143"><a href="#cb88-143" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">329.2509-327.5375</span>;</span>
<span id="cb88-144"><a href="#cb88-144" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb88-145"><a href="#cb88-145" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb88-146"><a href="#cb88-146" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb88-147"><a href="#cb88-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-148"><a href="#cb88-148" aria-hidden="true" tabindex="-1"></a><span class="co">* Quadratic Poisson 3;</span></span>
<span id="cb88-149"><a href="#cb88-149" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT can here be read of type3 test result;</span> </span>
<span id="cb88-150"><a href="#cb88-150" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb88-151"><a href="#cb88-151" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb88-152"><a href="#cb88-152" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb10 log2bili log2bili2/ dist=poi offset=logrisk type3;</span>
<span id="cb88-153"><a href="#cb88-153" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.6">Figure 2.6</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.6-r_8a65ce537abb98d2b486fab46021dff3">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The below linear predictors include estimates from the following models</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>tment_char)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>base_poismod <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>                      tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>poismod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>                        tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> albnorm,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>                        tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>                        bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,<span class="at">family =</span> poisson)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataset with linear predictor information</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>lin2 <span class="ot">&lt;-</span> pbc3</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">1.6076-0.1123</span><span class="sc">*</span>alb)</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">0.7828-0.0864</span><span class="sc">*</span>alb<span class="fl">-0.0474</span><span class="sc">*</span>albnorm)</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">1.6076+0.0085</span><span class="sc">*</span>bili<span class="fl">-38.7</span><span class="sc">*</span><span class="fl">0.1123</span>)</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp4 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">0.5534+0.0617</span><span class="sc">*</span>bili<span class="fl">-0.0168</span><span class="sc">*</span>bilihigh<span class="sc">+</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>                   <span class="fl">0.0027</span><span class="sc">*</span>bilitoohigh<span class="fl">-0.0428</span><span class="sc">*</span>bilimuchtoohigh<span class="fl">-0.0865</span><span class="sc">*</span><span class="fl">38.7</span>)</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>lin2row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(lin2)),</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(lin2))), </span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>lp1, lin2<span class="sc">$</span>lp2), <span class="at">alb =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>alb, lin2<span class="sc">$</span>alb))</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alb, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> lin2row) <span class="sc">+</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Albumin"</span>) <span class="sc">+</span> </span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.6-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.6-sas_2976793234215e759921e8a71b04e970">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Below is estimates from the following models collected;</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb bili/ dist=poi offset=logrisk type3;</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb albnorm bili/ dist=poi offset=logrisk type3;</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb bili bilihigh bilitoohigh </span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>             logbilimuchtoohigh / dist=poi offset=logrisk type3;</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="co">* Collect linear predictor information;</span> </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> lin2; <span class="kw">set</span> pbc3;</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    lp1=<span class="dv">1.6076-0.1123</span>*alb; * bilirubin = <span class="dv">0</span>; </span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    lp2=<span class="dv">0.7828-0.0864</span>*alb<span class="dv">-0.0474</span>*albnorm;</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    lp3=<span class="dv">1.6076+0.0085</span>*bili<span class="dv">-38.7</span>*<span class="dv">0.1123</span>; *also an effect of albumin at <span class="dv">38.7</span>; </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    lp4=-<span class="dv">0.5534+0.0617</span>*bili<span class="dv">-0.0168</span>*bilihigh<span class="dv">+0.0027</span>*bilitoohigh</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>        -<span class="dv">0.0428</span>*bilimuchtoohigh<span class="dv">-0.0865</span>*<span class="dv">38.7</span>;</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=lin2; <span class="kw">by</span> alb<span class="kw">; run</span>;</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>legend1 <span class="kw">label</span>=none;</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=lin2;</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>    plot (lp2 lp1)*alb/overlay haxis=axis1 vaxis=axis2 legend=legend1;</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">20</span> <span class="kw">to</span> <span class="dv">60</span> <span class="kw">by</span> <span class="dv">10</span> minor=none <span class="kw">label</span>=(<span class="st">'Se-albumin'</span>);</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">6</span> <span class="kw">to</span> <span class="dv">0</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Linear predictor'</span>);</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>    symbol1 v=none i=join r=<span class="dv">1</span> c=red;</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>    symbol2 v=none i=join r=<span class="dv">1</span> c=blue;</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> lp2=<span class="st">"Effect as linear spline"</span>;</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> lp1=<span class="st">"Linear effect"</span>;</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.7" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.7">Figure 2.7</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.7-r_c3d02d08c4083d4825f644b23dbbba1c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bilirubin and the two last linear predictors</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>lin2row2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(lin2)),</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(lin2))), </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>lp3, lin2<span class="sc">$</span>lp4),</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bili =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>bili, lin2<span class="sc">$</span>bili))</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> lin2row2) <span class="sc">+</span> </span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span> </span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.7-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.7-sas_c70be1da4061b11d1133002bf9925c5a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=lin2; <span class="kw">by</span> bili<span class="kw">; run</span>;</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=lin2;</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    plot (lp4 lp3)*bili/overlay haxis=axis1 vaxis=axis2 legend=legend1;</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">500</span> <span class="kw">by</span> <span class="dv">100</span> minor=none <span class="kw">label</span>=(<span class="st">'Se-bilirubin'</span>);</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">5</span> <span class="kw">to</span> <span class="dv">2</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Linear predictor'</span>);</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    symbol1 v=none i=join r=<span class="dv">1</span> c=red;</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    symbol2 v=none i=join r=<span class="dv">1</span> c=blue;</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> lp4=<span class="st">"Effect as linear spline"</span>;</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> lp3=<span class="st">"Linear effect"</span>;</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;<span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.8" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.8">Figure 2.8</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.8-r_5caddf5615fa530dc0433e2b1e65fdea">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The below linear predictors include estimates from the following models</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>base_poismod2_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>                           tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>                        tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> </span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>                        logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataset with linear predictor information</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>log2 <span class="ot">&lt;-</span> pbc3</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>log2<span class="sc">$</span>lp3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">2.0162+0.6469</span><span class="sc">*</span>log2bili<span class="fl">-38.7</span><span class="sc">*</span><span class="fl">0.087</span>)</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>log2<span class="sc">$</span>lp4 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">0.6194+0.198</span><span class="sc">*</span>log2bili</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">+</span><span class="fl">0.8815</span><span class="sc">*</span>logbilihigh<span class="fl">-0.2336</span><span class="sc">*</span>logbilitoohigh</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span><span class="fl">0.3139</span><span class="sc">*</span>logbilimuchtoohigh<span class="fl">-0.0844</span><span class="sc">*</span><span class="fl">38.7</span>)</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>log2row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(log2)),</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(log2))), </span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(log2<span class="sc">$</span>lp3, log2<span class="sc">$</span>lp4),</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">log2bili =</span> <span class="fu">c</span>(log2<span class="sc">$</span>log2bili, log2<span class="sc">$</span>log2bili)</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> log2row) <span class="sc">+</span> </span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(log[<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.8-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.8-sas_2c6606445d1732845ebea224f667f9c5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Linear predictors from the following models;</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili / dist=poi offset=logrisk type3;</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili logbilihigh logbilitoohigh </span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>                 logbilimuchtoohigh / dist=poi offset=logrisk type3;</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co">* Create data with linear predictors as a function of bilirubin values;</span> </span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">log2</span>; </span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3;</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    lp3=-<span class="dv">2.0162+0.6469</span>*log2bili<span class="dv">-38.7</span>*<span class="dv">0.087</span>;</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    lp4=-<span class="dv">0.6194+0.198</span>*log2bili<span class="dv">+0.8815</span>*logbilihigh<span class="dv">-0.2336</span>*logbilitoohigh</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>        -<span class="dv">0.3139</span>*logbilimuchtoohigh<span class="dv">-0.0844</span>*<span class="dv">38.7</span>;</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=<span class="fu">log2</span>;<span class="kw">by</span> bili<span class="kw">; run</span>;</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=<span class="fu">log2</span>;</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>    plot (lp4 lp3)*log2bili/overlay haxis=axis1 vaxis=axis2 legend=legend1;</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">1</span> <span class="kw">to</span> <span class="dv">9</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'log2(Se-bilirubin)'</span>);</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=-<span class="dv">5</span> <span class="kw">to</span> <span class="dv">1</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Linear predictor'</span>);</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>    symbol1 v=none i=join r=<span class="dv">1</span> c=red;</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>    symbol2 v=none i=join r=<span class="dv">1</span> c=blue;</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> lp4=<span class="st">"Effect as linear spline"</span>;</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> lp3=<span class="st">"Linear effect"</span>;</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;<span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.7" class="level3">
<h3 class="anchored" data-anchor-id="table-2.7">Table 2.7</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.7-r_130a076fb8b5fd21eddb6404d2f9822c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>coxmod_t27 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>coxmod_t27</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, 
    data = pbc3, method = "breslow", eps = 1e-08)

             coef exp(coef) se(coef)      z        p
tment    -0.57406   0.56323  0.22447 -2.557   0.0105
alb      -0.09093   0.91308  0.02164 -4.201 2.65e-05
log2bili  0.66500   1.94449  0.07443  8.935  &lt; 2e-16

Likelihood ratio test=120  on 3 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>poismod_t27 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> timegroup <span class="sc">+</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t27) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ tment + alb + log2bili + timegroup + offset(log(risktime)), 
    family = poisson, data = pbc3mult)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -7.47780    0.97577  -7.663 1.81e-14 ***
tment       -0.54549    0.22265  -2.450 0.014288 *  
alb         -0.08697    0.02162  -4.024 5.73e-05 ***
log2bili     0.64689    0.07326   8.830  &lt; 2e-16 ***
timegroup3  -0.43894    0.60346  -0.727 0.466999    
timegroup1  -0.84401    0.22867  -3.691 0.000223 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.25  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 517.25

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.7-sas_8543f781b5a033b67275812c1b7a6943">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Cox model;</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili / rl;</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co">* Poisson model;</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili / dist=poi offset=logrisk;</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.8" class="level3">
<h3 class="anchored" data-anchor-id="table-2.8">Table 2.8</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.8-r_cd855995fdb9f18b7dccd6470973b134">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox models</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Model for LR comparison</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>coxmod_t28_base <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 1</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb0 <span class="ot">&lt;-</span> (pbc3<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">0</span>)<span class="sc">*</span>pbc3<span class="sc">$</span>alb</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb1 <span class="ot">&lt;-</span> (pbc3<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3<span class="sc">$</span>alb</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>coxmod_t28_1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb0 <span class="sc">+</span> alb1 <span class="sc">+</span> log2bili,</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>coxmod_t28_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb0 + alb1 + 
    log2bili, data = pbc3, method = "breslow", eps = 1e-08)

              coef exp(coef)  se(coef)      z        p
tment    -0.009736  0.990312  1.559670 -0.006 0.995020
alb0     -0.081319  0.921900  0.034031 -2.390 0.016869
alb1     -0.097043  0.907517  0.027344 -3.549 0.000387
log2bili  0.664413  1.943350  0.074494  8.919  &lt; 2e-16

Likelihood ratio test=120.2  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t28_1, coxmod_t28_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb0 + alb1 + log2bili
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -402.87                     
2   3 -402.94 -1 0.1338     0.7145</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 2</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili0 <span class="ot">&lt;-</span> (pbc3<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">0</span>)<span class="sc">*</span>pbc3<span class="sc">$</span>log2bili</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili1 <span class="ot">&lt;-</span> (pbc3<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3<span class="sc">$</span>log2bili</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>coxmod_t28_2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili0 <span class="sc">+</span> bili1,</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>coxmod_t28_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili0 + 
    bili1, data = pbc3, method = "breslow", eps = 1e-08)

          coef exp(coef) se(coef)      z        p
tment  0.19880   1.21994  0.85653  0.232    0.816
alb   -0.09331   0.91091  0.02191 -4.260 2.05e-05
bili0  0.72558   2.06593  0.09865  7.355 1.91e-13
bili1  0.59345   1.81022  0.10604  5.596 2.19e-08

Likelihood ratio test=120.9  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t28_2, coxmod_t28_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili0 + bili1
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -402.51                     
2   3 -402.94 -1 0.8644     0.3525</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson models</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Model for LR comparison - no interaction</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>poismod_t28_base <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili<span class="sc">+</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data=</span>pbc3mult, <span class="at">family=</span>poisson)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 1</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb0 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">0</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>poismod_t28_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb0 <span class="sc">+</span> alb1 <span class="sc">+</span> log2bili <span class="sc">+</span> timegroup <span class="sc">+</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ tment + alb0 + alb1 + log2bili + timegroup + 
    offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -7.86906    1.36181  -5.778 7.54e-09 ***
tment        0.09200    1.55226   0.059 0.952738    
alb0        -0.07628    0.03359  -2.271 0.023162 *  
alb1        -0.09406    0.02755  -3.414 0.000639 ***
log2bili     0.64624    0.07334   8.812  &lt; 2e-16 ***
timegroup3  -0.43125    0.60379  -0.714 0.475080    
timegroup1  -0.84426    0.22851  -3.695 0.000220 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.08  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.08

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t28_base, poismod_t28_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))
Model 2: fail ~ tment + alb0 + alb1 + log2bili + timegroup + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   7 -252.54  1 0.1723      0.678</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 2</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili0 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">0</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>poismod_t28_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili0 <span class="sc">+</span> bili1 <span class="sc">+</span> timegroup <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ tment + alb + bili0 + bili1 + timegroup + 
    offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -7.71515    1.01592  -7.594 3.10e-14 ***
tment        0.18058    0.84828   0.213 0.831422    
alb         -0.08909    0.02185  -4.078 4.54e-05 ***
bili0        0.70368    0.09717   7.242 4.42e-13 ***
bili1        0.57982    0.10472   5.537 3.08e-08 ***
timegroup3  -0.41713    0.60400  -0.691 0.489808    
timegroup1  -0.85694    0.22932  -3.737 0.000186 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.47  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 518.47

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t28_base, poismod_t28_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))
Model 2: fail ~ tment + alb + bili0 + bili1 + timegroup + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   7 -252.24  1 0.7787     0.3775</code></pre>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.8-sas_4a8e417b1bc5ff1b70e38011f9119d3b">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Cox model 1;</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb tment*alb log2bili /rl type3 (LR);</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'alb, tment=0'</span> alb <span class="dv">1</span>;</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'alb, tment=1'</span> alb <span class="dv">1</span> tment*alb <span class="dv">1</span>;</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co">* Cox model 2;</span> </span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili tment*log2bili/rl  type3 (LR);</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'log2bili, tment=0'</span> log2bili <span class="dv">1</span>;</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'log2bili, tment=1'</span> log2bili <span class="dv">1</span> tment*log2bili <span class="dv">1</span>;</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="co">* Poisson model 1;</span> </span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment log2bili alb(tment) / dist=poi offset=logrisk type3;</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>    contrast <span class="st">'LRT'</span> alb(tment) <span class="dv">1</span> -<span class="dv">1</span>;</span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a><span class="co">* Poisson model 2;</span> </span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv;</span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili(tment)/ dist=poi offset=logrisk type3;</span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>    contrast <span class="st">'LRT'</span> log2bili(tment) <span class="dv">1</span> -<span class="dv">1</span>;</span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.9" class="level3">
<h3 class="anchored" data-anchor-id="table-2.9">Table 2.9</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.9-r_0b5c3969ae0c256bbcaccab9eb835cc4">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>tment</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment2 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>tment</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment3 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">3</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>tment</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb2 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb3 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">3</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili2 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili3 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">3</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts=</span><span class="fu">c</span>(<span class="st">"contr.treatment"</span>, <span class="st">"contr.poly"</span>))</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>poismod_t29_base <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail<span class="sc">~</span>tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili<span class="sc">+</span>timegroup<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(risktime)),</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>poismod_t29_tment <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment1 <span class="sc">+</span> tment2 <span class="sc">+</span> tment3 <span class="sc">+</span> alb <span class="sc">+</span> log2bili<span class="sc">+</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>                       timegroup <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)),</span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_tment) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ tment1 + tment2 + tment3 + alb + log2bili + 
    timegroup + offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -7.64593    1.17030  -6.533 6.43e-11 ***
tment1      -0.56166    0.29091  -1.931   0.0535 .  
tment2      -0.46193    0.34460  -1.340   0.1801    
tment3      -1.26627    1.22939  -1.030   0.3030    
alb         -0.08640    0.02166  -3.988 6.65e-05 ***
log2bili     0.64871    0.07367   8.806  &lt; 2e-16 ***
timegroup1  -0.69911    0.74501  -0.938   0.3480    
timegroup2   0.09537    0.75000   0.127   0.8988    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.82  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.82

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, poismod_t29_tment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))
Model 2: fail ~ tment1 + tment2 + tment3 + alb + log2bili + timegroup + 
    offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   8 -252.41  2 0.4312     0.8061</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Albumin</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_alb <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb1 <span class="sc">+</span> alb2 <span class="sc">+</span> alb3 <span class="sc">+</span> log2bili<span class="sc">+</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>                       timegroup <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)),</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_alb) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ tment + alb1 + alb2 + alb3 + log2bili + 
    timegroup + offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -8.73232    5.94065  -1.470   0.1416    
tment       -0.56130    0.22300  -2.517   0.0118 *  
alb1        -0.11026    0.02791  -3.951 7.79e-05 ***
alb2        -0.05231    0.03472  -1.507   0.1319    
alb3        -0.06542    0.15336  -0.427   0.6697    
log2bili     0.64608    0.07361   8.777  &lt; 2e-16 ***
timegroup1   1.22609    6.02995   0.203   0.8389    
timegroup2  -0.01433    6.09060  -0.002   0.9981    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.45  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.45

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, poismod_t29_alb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))
Model 2: fail ~ tment + alb1 + alb2 + alb3 + log2bili + timegroup + offset(log(risktime))
  #Df  LogLik Df Chisq Pr(&gt;Chisq)
1   6 -252.62                    
2   8 -251.72  2 1.803      0.406</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bilirubin</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_bili <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili1 <span class="sc">+</span> bili2 <span class="sc">+</span> bili3 <span class="sc">+</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>                       timegroup <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)),</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_bili) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ tment + alb + bili1 + bili2 + bili3 + timegroup + 
    offset(log(risktime)), family = poisson, data = pbc3mult)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -6.36112    2.36067  -2.695  0.00705 ** 
tment       -0.51454    0.22373  -2.300  0.02146 *  
alb         -0.08570    0.02174  -3.942 8.10e-05 ***
bili1        0.71044    0.09260   7.672 1.69e-14 ***
bili2        0.55747    0.12113   4.602 4.18e-06 ***
bili3        0.30512    0.48171   0.633  0.52646    
timegroup1  -2.41998    2.30859  -1.048  0.29452    
timegroup2  -0.69600    2.32124  -0.300  0.76430    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.67  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.67

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, poismod_t29_bili)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))
Model 2: fail ~ tment + alb + bili1 + bili2 + bili3 + timegroup + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   8 -251.84  2 1.5777     0.4544</code></pre>
</div>
</div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.9-sas_09a4d52c43bf1a947693a729643b1e1e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Treatment;</span> </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co">* Estimates ;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv(ref=<span class="st">'1'</span>);</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment(interv) alb log2bili/ dist=poi offset=logrisk type3;</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT ;</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv(ref=<span class="st">'1'</span>);</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment interv*tment alb log2bili/ dist=poi offset=logrisk type3;</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a><span class="co">* Albumin;</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a><span class="co">* Estimates ;</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv(ref=<span class="st">'1'</span>);</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment log2bili alb(interv) / dist=poi offset=logrisk type3;</span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT ;</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv(ref=<span class="st">'1'</span>);</span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili alb*interv/ dist=poi offset=logrisk type3;</span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a><span class="co">* Bilirubin;</span></span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a><span class="co">* Estimates ;</span></span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv(ref=<span class="st">'1'</span>);</span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili(interv)/ dist=poi offset=logrisk type3;</span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT ;</span></span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3mult;</span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>) interv(ref=<span class="st">'1'</span>);</span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail= interv tment alb log2bili log2bili*interv/ dist=poi offset=logrisk type3;</span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-51-stratified-cox-model" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-51-stratified-cox-model">In-text, p.&nbsp;51: stratified Cox model</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-stratified-cox-r_2882679c537dd6c10f1a01e61f3002b3">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>coxmod_f29 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(tment) <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>coxmod_f29</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ strata(tment) + alb + 
    log2bili, data = pbc3, method = "breslow", eps = 1e-08)

             coef exp(coef) se(coef)      z        p
alb      -0.09002   0.91391  0.02168 -4.153 3.28e-05
log2bili  0.66328   1.94114  0.07531  8.807  &lt; 2e-16

Likelihood ratio test=119.3  on 2 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-stratified-cox-sas_7d2928af6964df2e6e9123d05953903e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)= alb log2bili / rl;</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    strata tment;</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.10" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.10">Figure 2.10</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.10-r_487d47ea9c1b454b9477ecd00da228dc">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting cumulative baseline hazards per treatment</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>cumhaz_treat <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxmod_f29, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>cumhaz_treat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cumhaz_treat)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Per treatment</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>hazard_t0 <span class="ot">&lt;-</span> cumhaz_treat[cumhaz_treat<span class="sc">$</span>strata <span class="sc">==</span> <span class="st">"tment=0"</span>,]</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>hazard_t0[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"tment=0"</span>)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>hazard_t0<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hazard_t0<span class="sc">$</span>time)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>hazard_t0<span class="sc">$</span>hazard <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hazard_t0<span class="sc">$</span>hazard)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>hazard_t1 <span class="ot">&lt;-</span> cumhaz_treat[cumhaz_treat<span class="sc">$</span>strata <span class="sc">==</span> <span class="st">"tment=1"</span>,]</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Match times</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>alltimes <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(cumhaz_treat<span class="sc">$</span>time))</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>hazard_t0_allt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alltimes),<span class="cf">function</span>(k) </span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(hazard_t0<span class="sc">$</span>hazard[hazard_t0<span class="sc">$</span>time <span class="sc">&lt;=</span> alltimes[k]], <span class="dv">1</span>)))</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>hazard_t1_allt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alltimes), <span class="cf">function</span>(k)</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(hazard_t1<span class="sc">$</span>hazard[hazard_t1<span class="sc">$</span>time <span class="sc">&lt;=</span> alltimes[k]], <span class="dv">1</span>))) </span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>hazards <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(hazard_t0_allt, hazard_t1_allt)</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficient</span></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>coxmod_f29_t <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Make plot</span></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hazard_t0_allt, <span class="at">y =</span> hazard_t1_allt), <span class="at">data =</span> hazards) <span class="sc">+</span> </span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(coxmod_f29_t)[[<span class="st">"tment"</span>]]), </span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cumulative baseline hazard: placebo"</span>) <span class="sc">+</span></span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard: CyA"</span>) <span class="sc">+</span> </span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.10-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.10-sas_c64f1a775c97702a5e8f2e98e714d788">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> covstr;</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>    alb=<span class="dv">0</span>; log2bili=<span class="dv">0</span>;</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)= alb log2bili/rl;</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    strata tment;</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    baseline out=breslowstr cumhaz=breslow covariates=covstr;</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow0;</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> breslowstr; </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> tment=<span class="dv">0</span>; </span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  a00=breslow; </span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow1; </span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> breslowstr; </span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> tment=<span class="dv">1</span>;     </span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>    a01=breslow; </span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow01; </span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">merge</span> breslow0 breslow1; </span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> days; </span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslowrev; </span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> breslow01;</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> days;</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">retain</span> last1 last2;</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> a00=. <span class="kw">then</span> cumhaz0=last1; <span class="kw">if</span> a00 ne . <span class="kw">then</span> cumhaz0=a00; </span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> a01=. <span class="kw">then</span> cumhaz1=last2; <span class="kw">if</span> a01 ne . <span class="kw">then</span> cumhaz1=a01;</span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span>;</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>    last1=cumhaz0; last2=cumhaz1; </span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslowrev; </span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> breslowrev;</span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>    line=<span class="fu">exp</span>(-<span class="dv">0.574</span>)*cumhaz0;</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=breslowrev;</span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>    plot cumhaz1*cumhaz0 line*cumhaz0/haxis=axis1 vaxis=axis2 overlay;</span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">1.5</span> <span class="kw">by</span> <span class="dv">0.5</span> minor=none <span class="kw">label</span>=(<span class="st">'Cumulative baseline hazard: placebo'</span>);</span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">1</span> <span class="kw">by</span> <span class="dv">0.5</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative baseline hazard: CyA'</span>);</span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=red;</span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=rl c=blue;</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.11" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.11">Figure 2.11</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.11-r_5d185cc3c5fd86e59193584435cc7b56">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive Aalen models - available with timereg</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timereg)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>nonparmod <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          5.96               0.000
tment                                1.60               0.714

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.107                       0.565
tment                               0.136                       0.648
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          7.62                       0.444
tment                                4.54                       0.730

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>cumhazdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">eventtimes =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">1</span>],</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">basecumhaz =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">2</span>], </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>], </span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat_ll =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>]</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(nonparmod<span class="sc">$</span>var.cum[,<span class="dv">3</span>]),</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat_ul =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>]</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(nonparmod<span class="sc">$</span>var.cum[,<span class="dv">3</span>]))</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend lines to last observed time</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>cumhazdata[<span class="fu">nrow</span>(cumhazdata)<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">max</span>(pbc3<span class="sc">$</span>days), <span class="fu">tail</span>(cumhazdata, <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Left figure</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">11.</span>left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> basecumhaz), </span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard"</span>) <span class="sc">+</span> </span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">11.</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.11-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Right figure</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">11.</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat), </span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat_ll), </span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span>  </span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat_ul), </span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative treatment effect"</span>) <span class="sc">+</span> </span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">11.</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.11-r-2.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">

</div>
</div>
</div>
</section>
<section id="in-text-p.-55-simple-aalen-model" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-55-simple-aalen-model">In-text, p.&nbsp;55: simple Aalen model</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-25-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-simple-aalen-r_4ae4bfa08ad1ff05b04865381e600bde">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive model treatment only</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values not exactly as in book because seed changes</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>nonparmod0 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3) </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          5.96               0.000
tment                                1.60               0.738

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.107                       0.563
tment                               0.136                       0.608
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          7.62                       0.426
tment                                4.54                       0.721

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant effect of treatment per year</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>nonparmod01 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment), <span class="at">data =</span> pbc3) </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          6.62                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                        0.0914                         0.4
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                        0.0136                        0.28

Parametric terms :     
                Coef.    SE Robust SE     z P-val lower2.5% upper97.5%
const(tment) -0.00587 0.021     0.021 -0.28 0.779    -0.047     0.0353
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment), 
    data = pbc3)</code></pre>
</div>
</div>
</div>
<div id="tabset-25-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">

</div>
</div>
</div>
</section>
<section id="figure-2.12" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.12">Figure 2.12</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-26-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-1" role="tab" aria-controls="tabset-26-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-2" role="tab" aria-controls="tabset-26-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-26-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-26-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.12-r_960c712aa5b6123cdb6fc9eb6b5ce054">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Aalen model fit</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timereg)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>nonparmod2 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>cumhazdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">eventtimes =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">1</span>],</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">basecumhaz =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">2</span>], </span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">3</span>], </span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhazalb =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">4</span>], </span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhazbili=</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">5</span>])</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend lines to last observed time</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>cumhazdata[<span class="fu">nrow</span>(cumhazdata)<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">max</span>(pbc3<span class="sc">$</span>days), <span class="fu">tail</span>(cumhazdata, <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure treatment</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.1</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat), </span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative treatment effect"</span>) <span class="sc">+</span> </span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure albumin</span></span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.2</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhazalb), </span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb143-28"><a href="#cb143-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative albumin effect"</span>) <span class="sc">+</span> </span>
<span id="cb143-29"><a href="#cb143-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb143-30"><a href="#cb143-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb143-31"><a href="#cb143-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb143-32"><a href="#cb143-32" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb143-33"><a href="#cb143-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-34"><a href="#cb143-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure bilirubin</span></span>
<span id="cb143-35"><a href="#cb143-35" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.3</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhazbili), </span>
<span id="cb143-36"><a href="#cb143-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb143-37"><a href="#cb143-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb143-38"><a href="#cb143-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb143-39"><a href="#cb143-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative bilirubin effect"</span>) <span class="sc">+</span> </span>
<span id="cb143-40"><a href="#cb143-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)),</span>
<span id="cb143-41"><a href="#cb143-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb143-42"><a href="#cb143-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb143-43"><a href="#cb143-43" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb143-44"><a href="#cb143-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-45"><a href="#cb143-45" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.12-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.12-r-2.png" class="img-fluid" style="width:90.0%"></p>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.12-r-3.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-26-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-26-2-tab">

</div>
</div>
</div>
</section>
<section id="table-2.10" class="level3">
<h3 class="anchored" data-anchor-id="table-2.10">Table 2.10</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-27-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-1" role="tab" aria-controls="tabset-27-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-2" role="tab" aria-controls="tabset-27-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-27-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-27-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.10-r_13f1d9a7f11233c1c38f48bb0ab8e7ea">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive model with treatment, albumin, bilirubin</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10, first two columns</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values not exactly as in book because seed changes</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>nonparmod1 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.62               0.003
tment                                2.66               0.120
alb                                  3.82               0.002
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.30300                       0.931
tment                             0.12100                       0.666
alb                               0.00666                       0.966
bili                              0.00300                       0.201
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      14.20000                       0.992
tment                             3.29000                       0.769
alb                               0.00826                       0.993
bili                              0.00203                       0.344

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant effects per year</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10, last two columns</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>nonparmod2 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> </span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(bili), <span class="at">data =</span> pbc3) </span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          4.03                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.119                       0.194
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                        0.0263                       0.123

Parametric terms :     
                Coef.       SE Robust SE     z    P-val lower2.5% upper97.5%
const(tment) -0.04130 0.021600  0.020100 -2.05 4.02e-02  -0.08360    0.00104
const(alb)   -0.00842 0.002290  0.002230 -3.77 1.63e-04  -0.01290   -0.00393
const(bili)   0.00230 0.000483  0.000384  5.98 2.17e-09   0.00135    0.00325
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    const(alb) + const(bili), data = pbc3)</code></pre>
</div>
</div>
</div>
<div id="tabset-27-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-2-tab">

</div>
</div>
</div>
</section>
<section id="in-text-p.-57-aalen-models" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-57-aalen-models">In-text, p.&nbsp;57: Aalen models</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-28-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-1" role="tab" aria-controls="tabset-28-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-2" role="tab" aria-controls="tabset-28-2" aria-selected="false">SAS-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-28-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-28-1-tab">
<div class="cell" data-hash="Ch2_cache/html/aalen-models-r_fa29edc84716c23caa0e515d19e38009">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant effect of treatment, adjusted for albumin and bilirubin</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>nonparmod3 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> </span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">const</span>(tment) <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.60               0.005
alb                                  3.80               0.001
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.28500                       0.950
alb                               0.00954                       0.805
bili                              0.00315                       0.130
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      3.16e-02                       0.996
alb                              5.26e-05                       0.913
bili                             6.52e-06                       0.257

Parametric terms :     
               Coef.     SE Robust SE     z P-val lower2.5% upper97.5%
const(tment) -0.0401 0.0216    0.0204 -1.97 0.049   -0.0824    0.00224
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    alb + bili, data = pbc3)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic effect for albumin; p-values not exactly as in book because seed changes</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>nonparmod44 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((alb<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod44)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
              Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                            3.23               0.018
I(alb/10)                              3.00               0.045
I(bili/100)                            4.88               0.000
I((alb/10)^2)                          2.77               0.080

Test for time invariant effects 
                    Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                           9.420                       0.241
I(alb/10)                             4.950                       0.240
I(bili/100)                           0.365                       0.064
I((alb/10)^2)                         0.635                       0.249
                      Cramer von Mises test p-value H_0:constant effect
(Intercept)                         83.6000                       0.347
I(alb/10)                           24.4000                       0.341
I(bili/100)                          0.0949                       0.173
I((alb/10)^2)                        0.4160                       0.336

Parametric terms :     
               Coef.     SE Robust SE     z  P-val lower2.5% upper97.5%
const(tment) -0.0421 0.0215    0.0201 -2.09 0.0366   -0.0842   3.92e-05
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    I(alb/10) + I(bili/100) + I((alb/10)^2), data = pbc3)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic effect for bilirubin; p-values not exactly as in book as seed changes</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>nonparmod43 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((bili<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod43)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
                Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                              3.82               0.005
I(alb/10)                                4.02               0.003
I(bili/100)                              3.85               0.005
I((bili/100)^2)                          3.01               0.041

Test for time invariant effects 
                      Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                             0.440                       0.687
I(alb/10)                               0.117                       0.625
I(bili/100)                             0.612                       0.402
I((bili/100)^2)                         0.515                       0.152
                        Cramer von Mises test p-value H_0:constant effect
(Intercept)                            0.1320                       0.776
I(alb/10)                              0.0124                       0.626
I(bili/100)                            0.4640                       0.293
I((bili/100)^2)                        0.2880                       0.148

Parametric terms :     
               Coef.     SE Robust SE     z  P-val lower2.5% upper97.5%
const(tment) -0.0395 0.0213    0.0208 -1.89 0.0582   -0.0812    0.00225
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    I(alb/10) + I(bili/100) + I((bili/100)^2), data = pbc3)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactions</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>nonparmod51 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">+</span> <span class="fu">const</span>(bili) <span class="sc">+</span> <span class="fu">const</span>(tment <span class="sc">*</span> bili),<span class="at">data =</span> pbc3) </span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod51)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          4.03                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.123                        0.15
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                        0.0287                         0.1

Parametric terms :     
                       Coef.       SE Robust SE       z    P-val lower2.5%
const(tment)        -0.00194 0.029400  0.022800 -0.0851 9.32e-01  -0.05960
const(alb)          -0.00859 0.002260  0.002200 -3.9000 9.69e-05  -0.01300
const(bili)          0.00299 0.000869  0.000437  6.8400 7.77e-12   0.00129
const(tment * bili) -0.00116 0.001020  0.000658 -1.7600 7.92e-02  -0.00316
                    upper97.5%
const(tment)          0.055700
const(alb)           -0.004160
const(bili)           0.004690
const(tment * bili)   0.000839
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    const(alb) + const(bili) + const(tment * bili), data = pbc3)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>nonparmod52 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(bili) </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(tment <span class="sc">*</span> alb), <span class="at">data =</span> pbc3) </span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod52)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.06               0.003

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                          0.12                       0.198
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                        0.0265                       0.126

Parametric terms :     
                      Coef.       SE Robust SE       z    P-val lower2.5%
const(tment)        0.01010 0.199000  0.176000  0.0576 9.54e-01  -0.38000
const(bili)         0.00230 0.000482  0.000385  5.9600 2.45e-09   0.00136
const(alb)         -0.00771 0.003150  0.002780 -2.7700 5.54e-03  -0.01390
const(tment * alb) -0.00132 0.004790  0.004300 -0.3060 7.59e-01  -0.01070
                   upper97.5%
const(tment)          0.40000
const(bili)           0.00324
const(alb)           -0.00154
const(tment * alb)    0.00807
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    const(bili) + const(alb) + const(tment * alb), data = pbc3)</code></pre>
</div>
</div>
</div>
<div id="tabset-28-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-2-tab">

</div>
</div>
</div>
</section>
<section id="in-text-p.-58-additive-poisson-model" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-58-additive-poisson-model">In-text, p.&nbsp;58: additive Poisson model</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-29-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-1" role="tab" aria-controls="tabset-29-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-2" role="tab" aria-controls="tabset-29-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-29-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-29-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-additive-pois-r_c9668566393a9de5dea8d5ee1e41c8ff">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive hazards model with piecewise constant baseline hazards</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with only treatment as covariate</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co"># update data set</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>pbc3add <span class="ot">&lt;-</span> pbc3mult</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time1 <span class="ot">&lt;-</span>  <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time2 <span class="ot">&lt;-</span>  <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time3 <span class="ot">&lt;-</span>  <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">3</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>tment0 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (tment <span class="sc">==</span> <span class="dv">0</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>tment1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (tment <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>albny <span class="ot">&lt;-</span>  <span class="fu">with</span>(pbc3add, ((alb<span class="dv">-35</span>)<span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>biliny <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, ((bili<span class="dv">-50</span>)<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text</span></span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>additive_pcw <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">0</span>),</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(additive_pcw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ time1 + time2 + time3 + tment1 - 1, family = poisson(link = "identity"), 
    data = pbc3add, start = c(0.1, 0.1, 0.1, 0))

Coefficients:
        Estimate Std. Error z value Pr(&gt;|z|)    
time1   0.091109   0.016429   5.546 2.93e-08 ***
time2   0.131729   0.024143   5.456 4.87e-08 ***
time3   0.093734   0.046162   2.031   0.0423 *  
tment1 -0.007261   0.020758  -0.350   0.7265    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance:    Inf  on 623  degrees of freedom
Residual deviance: 459.54  on 619  degrees of freedom
AIC: 647.54

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</div>
<div id="tabset-29-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-29-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-additive-pois-sas_bff69f26a4e876fa8a496e81c3a5c5a0">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Only constant effect per year possible;</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="co">* Create new variables;</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3add; </span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3mult;</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>    time1=(interv=<span class="dv">1</span>)*risktime/<span class="dv">365.25</span>; </span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>    time2=(interv=<span class="dv">2</span>)*risktime/<span class="dv">365.25</span>; </span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>    time3=(interv=<span class="dv">3</span>)*risktime/<span class="dv">365.25</span>;</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>    tment0=(tment=<span class="dv">0</span>)*risktime/<span class="dv">365.25</span>; </span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>    tment1=(tment=<span class="dv">1</span>)*risktime/<span class="dv">365.25</span>;</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a><span class="co">* link=id;</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a><span class="co">* Constant effect of treatment per year;</span></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3add;</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail=time1 time2 time3 tment1/dist=poi <span class="kw">link</span>=id noint;</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.11" class="level3">
<h3 class="anchored" data-anchor-id="table-2.11">Table 2.11</h3>
<p>Questionable fit.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-30-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-1" role="tab" aria-controls="tabset-30-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-2" role="tab" aria-controls="tabset-30-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-30-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-30-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.11-r_575c7558373104fc1b9fc028083ffa89">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.11 </span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.11 - questionable fit</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>additive_pcw2<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">+</span> albny <span class="sc">+</span> biliny <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.35</span>, <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="sc">-</span><span class="fl">0.8</span>, <span class="dv">2</span>),</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(additive_pcw2<span class="fl">.11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ time1 + time2 + time3 + tment1 + albny + 
    biliny - 1, family = poisson(link = "identity"), data = pbc3add, 
    start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2))

Coefficients:
       Estimate Std. Error z value Pr(&gt;|z|)    
time1   0.18451    0.02129   8.666  &lt; 2e-16 ***
time2   0.24074    0.02584   9.316  &lt; 2e-16 ***
time3   0.22943    0.05441   4.217 2.48e-05 ***
tment1 -0.02243    0.01732  -1.295 0.195235    
albny  -0.43637    0.12842  -3.398 0.000679 ***
biliny  2.22490    0.40809   5.452 4.98e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance:    Inf  on 611  degrees of freedom
Residual deviance: 368.29  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 556.29

Number of Fisher Scoring iterations: 25</code></pre>
</div>
</div>
</div>
<div id="tabset-30-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.11-sas_e864951aa5e24d40b762fa87b9188757">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Only constant effect per year possible;</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co">* Create new variables;</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3add; </span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3mult;</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>    time1=(interv=<span class="dv">1</span>)*risktime/<span class="dv">365.25</span>; </span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>    time2=(interv=<span class="dv">2</span>)*risktime/<span class="dv">365.25</span>; </span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>    time3=(interv=<span class="dv">3</span>)*risktime/<span class="dv">365.25</span>;</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>    tment0=(tment=<span class="dv">0</span>)*risktime/<span class="dv">365.25</span>; </span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>    tment1=(tment=<span class="dv">1</span>)*risktime/<span class="dv">365.25</span>;</span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>    albny=(alb<span class="dv">-35</span>)*risktime/<span class="dv">365.25</span>;</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>    biliny=(bili<span class="dv">-50</span>)*risktime/<span class="dv">365.25</span>;</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a><span class="co">* link=id;</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a><span class="co">* Constant effects per year;</span></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=pbc3add;</span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail=time1 time2 time3 tment1 albny biliny/dist=poi <span class="kw">link</span>=id noint;</span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.13" class="level3">
<h3 class="anchored" data-anchor-id="table-2.13">Table 2.13</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-31-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-1" role="tab" aria-controls="tabset-31-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-31-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-2" role="tab" aria-controls="tabset-31-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-31-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-31-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.13-r_082832bbb7420faf529a47471eb46867">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Death without transplantation</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> sex <span class="sc">+</span> age,</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status == 2) ~ tment + alb + log2bili + 
    sex + age, data = pbc3, method = "breslow")

             coef exp(coef) se(coef)      z        p
tment    -0.42049   0.65672  0.26822 -1.568   0.1169
alb      -0.06992   0.93247  0.02906 -2.406   0.0161
log2bili  0.69178   1.99726  0.09303  7.436 1.04e-13
sex       0.48557   1.62510  0.31943  1.520   0.1285
age       0.07335   1.07611  0.01621  4.524 6.06e-06

Likelihood ratio test=98.71  on 5 df, p=&lt; 2.2e-16
n= 343, number of events= 60 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transplantation</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> sex <span class="sc">+</span> age,</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status == 1) ~ tment + alb + log2bili + 
    sex + age, data = pbc3, method = "breslow")

             coef exp(coef) se(coef)      z        p
tment    -0.67305   0.51015  0.41318 -1.629   0.1033
alb      -0.09400   0.91029  0.03871 -2.428   0.0152
log2bili  0.83213   2.29820  0.14655  5.678 1.36e-08
sex       0.20378   1.22602  0.56329  0.362   0.7175
age      -0.04805   0.95309  0.02138 -2.247   0.0246

Likelihood ratio test=64.95  on 5 df, p=1.15e-12
n= 343, number of events= 28 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Failure of medical treatment</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> sex <span class="sc">+</span> age,</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    sex + age, data = pbc3, method = "breslow")

             coef exp(coef) se(coef)      z       p
tment    -0.50964   0.60071  0.22339 -2.281 0.02252
alb      -0.07136   0.93112  0.02293 -3.112 0.00186
log2bili  0.73778   2.09128  0.07768  9.497 &lt; 2e-16
sex       0.58536   1.79563  0.26738  2.189 0.02858
age       0.03077   1.03125  0.01199  2.566 0.01029

Likelihood ratio test=134.3  on 5 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
</div>
</div>
<div id="tabset-31-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-31-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.13-sas_14608eafafc7a44968c17324d50eb336">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span> <span class="dv">1</span>)=tment alb log2bili sex age / rl;</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span> <span class="dv">2</span>)=tment alb log2bili sex age / rl;</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili sex age / rl;</span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="guinea-bissau-childhood-vaccination-study" class="level2">
<h2 class="anchored" data-anchor-id="guinea-bissau-childhood-vaccination-study">Guinea-Bissau childhood vaccination study</h2>
<section id="read-data-1" class="level3">
<h3 class="anchored" data-anchor-id="read-data-1">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-32-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-1" role="tab" aria-controls="tabset-32-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-32-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-2" role="tab" aria-controls="tabset-32-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-32-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-32-1-tab">
<div class="cell" data-hash="Ch2_cache/html/read-bissau_7ab5ef8b7348fbdbbad4ea60131ba4eb">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>bissau <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/bissau.csv"</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>agem <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(bissau<span class="sc">$</span>age<span class="sc">/</span><span class="fl">30.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-32-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-32-2-tab">
<div class="cell" data-hash="Ch2_cache/html/read-bissau-sas_238af0b32bb9e2ec0867902ec11dd93e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=bissau</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/bissau.csv"</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> bissau; </span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> bissau; </span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>    agem = <span class="fu">int</span>(age/<span class="dv">30.4</span>); * Age <span class="kw">in</span> months; </span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-58-cox-model-unadjusted-for-age" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-58-cox-model-unadjusted-for-age">In-text, p.&nbsp;58: Cox model unadjusted for age</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-33-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-1" role="tab" aria-controls="tabset-33-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-33-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-2" role="tab" aria-controls="tabset-33-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-33-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-33-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-cox-unadjusted-r_f2b0fe1b2b78bdbe9270e31776f3df45">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>coxfit0 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fuptime, dead) <span class="sc">~</span> bcg, </span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> bissau, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>coxfit0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fuptime, dead) ~ bcg, data = bissau, method = "breslow")

       coef exp(coef) se(coef)      z      p
bcg -0.2821    0.7542   0.1353 -2.085 0.0371

Likelihood ratio test=4.28  on 1 df, p=0.03851
n= 5274, number of events= 222 </code></pre>
</div>
</div>
</div>
<div id="tabset-33-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-33-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-cox-unadjusted-sas_a17049019e5e9029aad881eae7674cd6">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>bissau;</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>    model fuptime<span class="sc">*</span><span class="fu">dead</span>(<span class="dv">0</span>)<span class="ot">=</span>bcg <span class="sc">/</span> rl;</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.12" class="level3">
<h3 class="anchored" data-anchor-id="table-2.12">Table 2.12</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-34-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-1" role="tab" aria-controls="tabset-34-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-34-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-2" role="tab" aria-controls="tabset-34-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-34-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-34-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.12-r_be7af7f47ecfbe6efcbf4d5750dee03e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model in column 1</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>coxfit1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fuptime, dead) <span class="sc">~</span> bcg <span class="sc">+</span> agem, </span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> bissau, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>coxfit1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fuptime, dead) ~ bcg + agem, data = bissau, 
    method = "breslow")

         coef exp(coef) se(coef)      z      p
bcg  -0.35346   0.70225  0.14423 -2.451 0.0143
agem  0.05472   1.05624  0.03844  1.424 0.1546

Likelihood ratio test=6.29  on 2 df, p=0.04301
n= 5274, number of events= 222 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make age the time variable instead</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>agein <span class="ot">&lt;-</span> bissau<span class="sc">$</span>age<span class="sc">/</span>(<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>ageout <span class="ot">&lt;-</span> bissau<span class="sc">$</span>agein <span class="sc">+</span> bissau<span class="sc">$</span>fuptime<span class="sc">/</span>(<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model in column 2</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="co"># option timefix=F aligns to SAS calculation</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="co"># see vignette 'Roundoff error and tied times' for survival package</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>coxfit2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(agein, ageout, dead) <span class="sc">~</span> bcg, </span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> bissau, <span class="at">method =</span> <span class="st">"breslow"</span>,<span class="at">timefix=</span>F)</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>coxfit2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(agein, ageout, dead) ~ bcg, data = bissau, 
    method = "breslow", timefix = F)

       coef exp(coef) se(coef)      z      p
bcg -0.3558    0.7006   0.1407 -2.529 0.0114

Likelihood ratio test=6.28  on 1 df, p=0.01218
n= 5274, number of events= 222 </code></pre>
</div>
</div>
</div>
<div id="tabset-34-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-34-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.12-sas_7796b9042c3a10bc80dbba528a3db99e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>bissau;</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>    model fuptime<span class="sc">*</span><span class="fu">dead</span>(<span class="dv">0</span>)<span class="ot">=</span>bcg agem <span class="sc">/</span> rl;</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Make age the time variable instead;</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>data bissau; </span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>    set bissau;</span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>    agein<span class="ot">=</span>age<span class="sc">/</span>(<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>);</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>    ageout<span class="ot">=</span>agein<span class="sc">+</span>fuptime<span class="sc">/</span>(<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>);</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Cox model fit <span class="sc">-</span> column <span class="dv">2</span>; </span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>bissau;</span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>    model ageout<span class="sc">*</span><span class="fu">dead</span>(<span class="dv">0</span>)<span class="ot">=</span>bcg <span class="sc">/</span> entry<span class="ot">=</span>agein rl;</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.13" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.13">Figure 2.13</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-35-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-1" role="tab" aria-controls="tabset-35-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-35-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-2" role="tab" aria-controls="tabset-35-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-35-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-35-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.13_522065a56f3f1f847787250366064fe8">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General plotting style </span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>)) </span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard for covariate pattern</span></span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>covdata<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="at">bcg=</span><span class="dv">0</span>, <span class="at">agem=</span><span class="dv">3</span>)))</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxfit1, covdata)</span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.13</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> (<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>), <span class="at">y =</span> hazard), <span class="at">data =</span> coxcumhaz) <span class="sc">+</span> </span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Follow-up time (months)"</span>) <span class="sc">+</span> </span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.13-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-35-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-35-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.13--sas_7a980bc45b9cdf777de7197fda50d5dd">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Cox model fit and get cumulative baseline hazard ; </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>bissau;</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>    model fuptime<span class="sc">*</span><span class="fu">dead</span>(<span class="dv">0</span>)<span class="ot">=</span>bcg agem<span class="sc">/</span>rl;</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>    baseline out<span class="ot">=</span>hazfuptime covariates<span class="ot">=</span>cov1 cumhaz<span class="ot">=</span>basefup;</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>data hazfuptime_months; </span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>    set hazfuptime; </span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    fuptime_m <span class="ot">=</span> fuptime <span class="sc">/</span> (<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>); </span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>proc gplot data<span class="ot">=</span>hazfuptime_months;</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>    plot basefup<span class="sc">*</span>fuptime_m<span class="sc">/</span>haxis<span class="ot">=</span>axis1 vaxis<span class="ot">=</span>axis2;</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>    axis1 order<span class="ot">=</span><span class="dv">0</span> to <span class="dv">7</span> by <span class="dv">1</span> minor<span class="ot">=</span>none</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    label<span class="ot">=</span>(<span class="st">'Follow-up time (months)'</span>);</span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>    axis2 order<span class="ot">=</span><span class="dv">0</span> to <span class="fl">0.06</span> by <span class="fl">0.01</span> minor<span class="ot">=</span>none</span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>    label<span class="ot">=</span>(<span class="at">a=</span><span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>    symbol1 v<span class="ot">=</span>none i<span class="ot">=</span>stepjl c<span class="ot">=</span>blue;</span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>quit;</span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> or using proc sgplot;</span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>ods graphics on;</span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>proc sgplot data<span class="ot">=</span>hazfuptime_months;</span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a>  step x<span class="ot">=</span>fuptime_m y<span class="ot">=</span>basefup <span class="sc">/</span> justify<span class="ot">=</span>left;</span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a>    xaxis grid values<span class="ot">=</span>(<span class="dv">0</span> to <span class="dv">7</span> by <span class="dv">1</span>);</span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a>    yaxis grid values<span class="ot">=</span>(<span class="dv">0</span> to <span class="fl">0.06</span> by <span class="fl">0.01</span>);</span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a>    label fuptime_m<span class="ot">=</span><span class="st">"Follow-up time (months)"</span>;</span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a>    label basefup<span class="ot">=</span><span class="st">"Cumulative hazard"</span>;</span>
<span id="cb184-27"><a href="#cb184-27" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.14" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.14">Figure 2.14</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-36-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-1" role="tab" aria-controls="tabset-36-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-36-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-2" role="tab" aria-controls="tabset-36-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-36-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-36-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.14_28f0e8f79510f9589b514d78dd7ec67d">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxfit2, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.14</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> hazard), <span class="at">data =</span> coxcumhaz) <span class="sc">+</span> </span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age (months)"</span>) <span class="sc">+</span> </span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.1</span>)), </span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.15</span>, <span class="at">by =</span> <span class="fl">0.05</span>), </span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"0.05"</span>, <span class="st">"0.10"</span>, <span class="st">"0.15"</span>)) <span class="sc">+</span></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.14-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-36-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-36-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.14--sas_b8c7f170697cd22a904e1421da307095">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>data cov2;</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>input bcg;</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>datalines;</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Cox model fit and get cumulative baseline hazard ; </span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>bissau;</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>    model ageout<span class="sc">*</span><span class="fu">dead</span>(<span class="dv">0</span>)<span class="ot">=</span>bcg <span class="sc">/</span> entry<span class="ot">=</span>agein rl;</span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>    baseline out<span class="ot">=</span>hazage covariates<span class="ot">=</span>cov2 cumhaz<span class="ot">=</span>baseage;</span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a>proc gplot data<span class="ot">=</span>hazage;</span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a>    plot baseage<span class="sc">*</span>ageout<span class="sc">/</span>haxis<span class="ot">=</span>axis1 vaxis<span class="ot">=</span>axis2;</span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a>    axis1 order<span class="ot">=</span><span class="dv">0</span> to <span class="dv">15</span> by <span class="dv">5</span> minor<span class="ot">=</span>none</span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a>        label<span class="ot">=</span>(<span class="st">'Age (months)'</span>);</span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a>    axis2 order<span class="ot">=</span><span class="dv">0</span> to <span class="fl">0.15</span> by <span class="fl">0.05</span> minor<span class="ot">=</span>none </span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a>        label<span class="ot">=</span>(<span class="at">a=</span><span class="dv">90</span> <span class="st">'Cumulative baseline hazard'</span>);</span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a>    symbol1  v<span class="ot">=</span>none i<span class="ot">=</span>stepjl c<span class="ot">=</span>blue;</span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a>quit;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="recurrent-episodes-in-affective-disorders" class="level2">
<h2 class="anchored" data-anchor-id="recurrent-episodes-in-affective-disorders">Recurrent episodes in affective disorders</h2>
<section id="read-data-2" class="level3">
<h3 class="anchored" data-anchor-id="read-data-2">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-37-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-1" role="tab" aria-controls="tabset-37-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-37-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-2" role="tab" aria-controls="tabset-37-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-37-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-37-1-tab">
<div class="cell" data-hash="Ch2_cache/html/read-affective-r_c1542e87eefc1cbb772a83de94ae1e7a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>affective <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/affective.csv"</span>)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>affective<span class="sc">$</span>wait <span class="ot">&lt;-</span> <span class="fu">with</span>(affective, stop <span class="sc">-</span> start)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-37-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-37-2-tab">
<div class="cell" data-hash="Ch2_cache/html/read-affective-sas_c71610ceb5159eb62b3e4d3d612414fe">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>proc import out<span class="ot">=</span>affective</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>    datafile<span class="ot">=</span><span class="st">"data/affective.csv"</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    dbms<span class="ot">=</span>csv replace;</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>data affective; </span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>    set affective; </span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>    wait <span class="ot">=</span> stop <span class="sc">-</span> start; </span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>run; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.14" class="level3">
<h3 class="anchored" data-anchor-id="table-2.14">Table 2.14</h3>
<p>NB: Small differences in estimates between R and SAS (SAS output used for table in book).</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-38-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-1" role="tab" aria-controls="tabset-38-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-38-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-2" role="tab" aria-controls="tabset-38-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-38-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-38-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.14-r_4d83cab31d41f07328fe0967cc67f62a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model for 1., 2., 3., 4. episode 'Markov': Column 1</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    episode == 1 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.3552    1.4264   0.2500 1.421 0.155

Likelihood ratio test=1.89  on 1 df, p=0.1692
n= 116, number of events= 99 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    episode == 2 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.1890    1.2080   0.2604 0.726 0.468

Likelihood ratio test=0.51  on 1 df, p=0.4751
n= 91, number of events= 82 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    episode == 3 &amp; state == 0), method = "breslow")

       coef exp(coef) se(coef)      z     p
bip -0.1175    0.8891   0.3005 -0.391 0.696

Likelihood ratio test=0.16  on 1 df, p=0.6936
n= 74, number of events= 62 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    episode == 4 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z       p
bip 1.1500    3.1581   0.3536 3.252 0.00114

Likelihood ratio test=9.93  on 1 df, p=0.001623
n= 56, number of events= 47 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model for 1., 2., 3., 4. episode 'Gap time': Column 2</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    episode == 1 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.3991    1.4905   0.2487 1.605 0.109

Likelihood ratio test=2.39  on 1 df, p=0.1222
n= 116, number of events= 99 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    episode == 2 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)    z     p
bip 0.2165    1.2418   0.2579 0.84 0.401

Likelihood ratio test=0.68  on 1 df, p=0.41
n= 91, number of events= 82 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    episode == 3 &amp; state == 0), method = "breslow")

       coef exp(coef) se(coef)      z     p
bip -0.1114    0.8946   0.2867 -0.389 0.698

Likelihood ratio test=0.15  on 1 df, p=0.6953
n= 74, number of events= 62 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    episode == 4 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.5964    1.8155   0.3183 1.874 0.061

Likelihood ratio test=3.31  on 1 df, p=0.06905
n= 56, number of events= 47 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AG cox model, total time</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    state == 0), method = "breslow")

       coef exp(coef) se(coef)     z        p
bip 0.36593   1.44186  0.09448 3.873 0.000107

Likelihood ratio test=14.24  on 1 df, p=0.0001612
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AG cox model, gap time</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    state == 0), method = "breslow")

       coef exp(coef) se(coef)     z     p
bip 0.12555   1.13377  0.09445 1.329 0.184

Likelihood ratio test=1.74  on 1 df, p=0.1875
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP cox model, total time</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="fu">strata</span>(episode) <span class="sc">+</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ strata(episode) + 
    bip, data = subset(affective, state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.2418    1.2736   0.1121 2.157 0.031

Likelihood ratio test=4.54  on 1 df, p=0.03312
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP cox model, gap time</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="fu">strata</span>(episode) <span class="sc">+</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>, </span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ strata(episode) + bip, 
    data = subset(affective, state == 0), method = "breslow")

       coef exp(coef) se(coef)     z     p
bip 0.02781   1.02820  0.10040 0.277 0.782

Likelihood ratio test=0.08  on 1 df, p=0.7821
n= 626, number of events= 542 </code></pre>
</div>
</div>
</div>
<div id="tabset-38-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-38-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.14-sas_3f8910ca99dac7e5e7df3d12db7c862e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>proc sort data<span class="ot">=</span>affective out<span class="ot">=</span>state0;</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>  where state<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  by state episode;</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Cox model <span class="cf">for</span> <span class="fl">1.</span>, <span class="fl">2.</span>, <span class="fl">3.</span>, <span class="fl">4.</span> episode <span class="st">'Markov'</span><span class="sc">:</span> Column <span class="dv">1</span>; </span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>state0;</span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>  where episode<span class="sc">&lt;=</span><span class="dv">4</span>;</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>    model stop<span class="sc">*</span><span class="fu">status</span> (<span class="dv">2</span> <span class="dv">3</span>)<span class="ot">=</span> bip <span class="sc">/</span> entry<span class="ot">=</span>start;</span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>    by episode;</span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> AG model, no past; </span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>state0;</span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>    model stop<span class="sc">*</span><span class="fu">status</span> (<span class="dv">2</span> <span class="dv">3</span>)<span class="ot">=</span> bip <span class="sc">/</span> entry<span class="ot">=</span>start;</span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> PWP model; </span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>state0; </span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a>    model stop<span class="sc">*</span><span class="fu">status</span> (<span class="dv">2</span> <span class="dv">3</span>)<span class="ot">=</span> bip <span class="sc">/</span> entry<span class="ot">=</span>start;</span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a>    strata episode;</span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a>run; </span>
<span id="cb213-23"><a href="#cb213-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-24"><a href="#cb213-24" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Cox model <span class="cf">for</span> <span class="fl">1.</span>, <span class="fl">2.</span>, <span class="fl">3.</span>, <span class="fl">4.</span> episode <span class="st">'Gap time'</span><span class="sc">:</span> Column <span class="dv">2</span>; </span>
<span id="cb213-25"><a href="#cb213-25" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>state0;</span>
<span id="cb213-26"><a href="#cb213-26" aria-hidden="true" tabindex="-1"></a>  where episode<span class="sc">&lt;=</span><span class="dv">4</span>;</span>
<span id="cb213-27"><a href="#cb213-27" aria-hidden="true" tabindex="-1"></a>    model wait<span class="sc">*</span><span class="fu">status</span> (<span class="dv">2</span> <span class="dv">3</span>)<span class="ot">=</span> bip;</span>
<span id="cb213-28"><a href="#cb213-28" aria-hidden="true" tabindex="-1"></a>    by episode;</span>
<span id="cb213-29"><a href="#cb213-29" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb213-30"><a href="#cb213-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-31"><a href="#cb213-31" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> AG gap time model; </span>
<span id="cb213-32"><a href="#cb213-32" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>state0;</span>
<span id="cb213-33"><a href="#cb213-33" aria-hidden="true" tabindex="-1"></a>    model wait<span class="sc">*</span><span class="fu">status</span> (<span class="dv">2</span> <span class="dv">3</span>)<span class="ot">=</span> bip;</span>
<span id="cb213-34"><a href="#cb213-34" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb213-35"><a href="#cb213-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-36"><a href="#cb213-36" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> PWP gap time model; </span>
<span id="cb213-37"><a href="#cb213-37" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>state0;</span>
<span id="cb213-38"><a href="#cb213-38" aria-hidden="true" tabindex="-1"></a>    model wait<span class="sc">*</span><span class="fu">status</span> (<span class="dv">2</span> <span class="dv">3</span>)<span class="ot">=</span> bip;</span>
<span id="cb213-39"><a href="#cb213-39" aria-hidden="true" tabindex="-1"></a>    strata episode;</span>
<span id="cb213-40"><a href="#cb213-40" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="leader-cardiovascular-trial-in-type-2-diabetes" class="level2">
<h2 class="anchored" data-anchor-id="leader-cardiovascular-trial-in-type-2-diabetes">LEADER cardiovascular trial in type 2 diabetes</h2>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-71_66be19f5adbc6aac9ffc5196ad141c82">

</div>
<section id="read-data-3" class="level3">
<h3 class="anchored" data-anchor-id="read-data-3">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-39-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-1" role="tab" aria-controls="tabset-39-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-39-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-2" role="tab" aria-controls="tabset-39-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-39-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-39-1-tab">
<p>Assume that the LEADER data set is loaded in data set <code>leader</code>.</p>
<div class="cell" data-hash="Ch2_cache/html/read-leader-r_a1841d70643968efcfbc0a6f3d7abfbb">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One data set per recurrent endpoint type</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>leader_mi <span class="ot">&lt;-</span> <span class="fu">subset</span>(leader, type <span class="sc">==</span> <span class="st">"recurrent_mi"</span>)</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>leader_3p <span class="ot">&lt;-</span> <span class="fu">subset</span>(leader, type <span class="sc">==</span> <span class="st">"recurrent_comb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-39-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-39-2-tab">
<div class="cell" data-hash="Ch2_cache/html/read-leader-sas_cee6e8841b8a2ffdafd588fe4ac22fd2">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> leader_mi; </span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> leader; </span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> type = <span class="st">"recurrent_mi"</span>; </span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.15" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.15">Figure 2.15</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-40-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-1" role="tab" aria-controls="tabset-40-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-40-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-2" role="tab" aria-controls="tabset-40-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-40-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-40-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.15-r_185ff6814d046b9ac6245a8cc12b80e7">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>),</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Nelson-Aalen estimate of the cumulative hazard of MI</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat, <span class="at">data =</span> leader_mi,</span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">id =</span> id, <span class="at">ctype =</span> <span class="dv">1</span>)</span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit<span class="sc">$</span>cumhaz, <span class="at">time =</span> fit<span class="sc">$</span>time,</span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">treat =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Placebo"</span>, fit<span class="sc">$</span>strata[[<span class="dv">1</span>]]),</span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Liraglutide"</span>, fit<span class="sc">$</span>strata[[<span class="dv">2</span>]])))</span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.15</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">*</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="fl">365.25</span> <span class="sc">/</span> <span class="dv">12</span>), <span class="at">y =</span> cumhaz), <span class="at">data =</span> plotdata) <span class="sc">+</span></span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> treat), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span></span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span></span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (months)"</span>) <span class="sc">+</span></span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)),</span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">65</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="at">by =</span> <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb216-28"><a href="#cb216-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)),</span>
<span id="cb216-29"><a href="#cb216-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.12</span>, <span class="at">by =</span> <span class="fl">0.02</span>)) <span class="sc">+</span></span>
<span id="cb216-30"><a href="#cb216-30" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb216-31"><a href="#cb216-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-32"><a href="#cb216-32" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.15-r-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
</div>
<div id="tabset-40-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-40-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.15-sas_786ecdaf38c62006f91082f026e50aff">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Nelson-Aalen estimates;</span> </span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=leader_mi noprint;</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">0</span> <span class="dv">2</span>)=/entry=start;</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>    id id;</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>    strata treat;</span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>  baseline out=na_<span class="kw">data</span> cumhaz=naa;</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> na_est;</span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> na_<span class="kw">data</span>; </span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span> = <span class="kw">stop</span>/(<span class="dv">365.25</span>/<span class="dv">12</span>);</span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sgplot<span class="kw"> data</span>=na_est;</span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a>    step <span class="kw">x</span>=<span class="fu">time</span> y=naa / <span class="kw">group</span>=treat justify=<span class="fu">left</span>;</span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a>    xaxis grid values=(<span class="dv">0</span> <span class="kw">to</span> <span class="dv">60</span> <span class="kw">by</span> <span class="dv">12</span>);</span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a>    yaxis grid values=(<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.12</span> <span class="kw">by</span> <span class="dv">0.02</span>);</span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="fu">time</span>=<span class="st">"Time since randomisation (months)"</span>;</span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> cumevent=<span class="st">"Cumulative hazard"</span>; </span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.15" class="level3">
<h3 class="anchored" data-anchor-id="table-2.15">Table 2.15</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-41-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-1" role="tab" aria-controls="tabset-41-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-41-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-2" role="tab" aria-controls="tabset-41-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-41-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-41-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.15-r_179fee243ea187e901ff09113b342f40">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model first event</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat,</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">subset</span>(leader_mi, eventno <span class="sc">==</span> <span class="dv">1</span>), <span class="at">method =</span> <span class="st">"breslow"</span>,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ treat, data = subset(leader_mi, 
    eventno == 1), method = "breslow")

          coef exp(coef) se(coef)      z      p
treat -0.15949   0.85258  0.07984 -1.998 0.0458

Likelihood ratio test=4  on 1 df, p=0.04545
n= 9340, number of events= 631 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AG Cox type</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat, <span class="at">data =</span> leader_mi,</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ treat, data = leader_mi, 
    method = "breslow")

          coef exp(coef) se(coef)      z      p
treat -0.16418   0.84859  0.07184 -2.285 0.0223

Likelihood ratio test=5.24  on 1 df, p=0.02208
n= 10120, number of events= 780 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AG model, piece-wise constant hazards</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating cuts -&gt; 5</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>alltimes <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(leader_mi<span class="sc">$</span>stop),<span class="at">length=</span><span class="dv">99</span>)</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>FunctionIntervalM <span class="ot">&lt;-</span> <span class="cf">function</span>(a,b) {</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(a), <span class="at">to =</span> <span class="fu">max</span>(a), <span class="at">by =</span> (<span class="fu">max</span>(a)<span class="sc">-</span><span class="fu">min</span>(a))<span class="sc">/</span>b)</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>cuts <span class="ot">&lt;-</span> <span class="fu">FunctionIntervalM</span>(<span class="at">a =</span> alltimes, <span class="at">b =</span> <span class="dv">5</span>)</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>cut_data <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> .,</span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>                      leader_mi,</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">episode =</span> <span class="st">"timegroup"</span>)</span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, event) <span class="sc">~</span> treat <span class="sc">+</span> <span class="fu">strata</span>(timegroup), <span class="at">data =</span> cut_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, event) ~ treat + strata(timegroup), 
    data = cut_data)

          coef exp(coef) se(coef)      z      p
treat -0.16418   0.84859  0.07184 -2.285 0.0223

Likelihood ratio test=5.24  on 1 df, p=0.02207
n= 39070, number of events= 780 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP 2nd event</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat,</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">subset =</span> (eventno <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> leader_mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ treat, data = leader_mi, 
    subset = (eventno == 2), method = "breslow")

          coef exp(coef) se(coef)      z     p
treat -0.04662   0.95445  0.19686 -0.237 0.813

Likelihood ratio test=0.06  on 1 df, p=0.8126
n= 631, number of events= 105 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP 3rd event</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat,</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">subset =</span> (eventno <span class="sc">==</span> <span class="dv">3</span>),</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> leader_mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ treat, data = leader_mi, 
    subset = (eventno == 3), method = "breslow")

          coef exp(coef) se(coef)      z     p
treat -0.02328   0.97699  0.39979 -0.058 0.954

Likelihood ratio test=0  on 1 df, p=0.9536
n= 105, number of events= 27 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP 4th event</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat,</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">subset =</span> (eventno <span class="sc">==</span> <span class="dv">4</span>),</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> leader_mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ treat, data = leader_mi, 
    subset = (eventno == 4), method = "breslow")

        coef exp(coef) se(coef)     z     p
treat 0.6288    1.8753   0.7370 0.853 0.394

Likelihood ratio test=0.75  on 1 df, p=0.3852
n= 27, number of events= 9 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP 5th event</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat,</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">subset =</span> (eventno <span class="sc">==</span> <span class="dv">5</span>),</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> leader_mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ treat, data = leader_mi, 
    subset = (eventno == 5), method = "breslow")

         coef exp(coef) se(coef)      z     p
treat -0.4287    0.6514   1.2299 -0.349 0.727

Likelihood ratio test=0.13  on 1 df, p=0.7221
n= 9, number of events= 3 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP all</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat <span class="sc">+</span> <span class="fu">strata</span>(eventno),</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> leader_mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ treat + strata(eventno), 
    data = leader_mi, method = "breslow")

          coef exp(coef) se(coef)      z      p
treat -0.13020   0.87792  0.07222 -1.803 0.0714

Likelihood ratio test=3.26  on 1 df, p=0.07103
n= 10120, number of events= 780 </code></pre>
</div>
</div>
</div>
<div id="tabset-41-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-41-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.15-sas_d22308210098b9a16184744dcdc5d4d7">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span>=leader_mi;</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> eventno;</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a><span class="co">* AG Cox type;</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=leader_mi;</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">0</span> <span class="dv">2</span>)= treat / entry=start; </span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="co">* Cox model first event and PWP models 2nd, ..., 5th event;</span></span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=leader_mi;</span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> eventno&lt;=<span class="dv">5</span>;</span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">0</span> <span class="dv">2</span>)= treat / entry=start; </span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> eventno;</span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a><span class="co">* PWP model all events;</span></span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=leader_mi;</span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">0</span> <span class="dv">2</span>)= treat / entry=start; </span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a>    strata eventno;</span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise-2.1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.1">Exercise 2.1</h3>
<p><em>Consider the data from the Copenhagen Holter study (Example 1.1.8)</em>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-42-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-1" role="tab" aria-controls="tabset-42-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-42-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-2" role="tab" aria-controls="tabset-42-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-42-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-42-1-tab">
<p>The data should be loaded as <code>chs_data</code>:</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-78_2048f2bcb9da76edf26f1c46172a1c83">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/cphholter.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that the time variables, <code>timeafib</code>, <code>timestroke</code> and <code>timedeath</code>, are measured in days. We will first convert them to years for easier interpretations.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-79_bbc6bec190267ff4e5e4bcb66408a2bd">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>timeafib   <span class="ot">&lt;-</span> chs_data<span class="sc">$</span>timeafib<span class="sc">/</span><span class="fl">365.25</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>timestroke <span class="ot">&lt;-</span> chs_data<span class="sc">$</span>timestroke<span class="sc">/</span><span class="fl">365.25</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>timedeath  <span class="ot">&lt;-</span> chs_data<span class="sc">$</span>timedeath<span class="sc">/</span><span class="fl">365.25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Load the relevant packages:</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-80_0cc306600f647230c9f8ccc80796e769">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co">#Data manipulations and plots</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co">#Core survival analysis routines</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="section" class="level4">
<h4 class="anchored" data-anchor-id="section">1.</h4>
<p><em>Estimate non-parametrically the cumulative hazards of death for subjects with or without ESVEA</em>.</p>
<p>The cumulative hazard can be estimated non-parametrically using the Nelson-Aalen estimator. It is implemented in the <strong>survfit</strong> function from the survival package. The formula argument must have a <strong>Surv</strong> object on the left side of ~. Since the event of interest is death the time variable of the <strong>Surv</strong> object is <strong>timedeath</strong> and the status indicator is <strong>death</strong>. The covariate(s), <strong>esvea</strong> in this analysis, should be on the right side of the ~. The cumulative hazard is then stored as the object cumhaz, and can be plotted against time.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-81_62900eafcf6d188bd58375be90abd0d0">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimating the cumulative hazards for subjects with or without ESVEA non-parametrically.</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>naafit211 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timedeath, death) <span class="sc">~</span> esvea, <span class="at">data =</span> chs_data)</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>naadata211 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> naafit211<span class="sc">$</span>time,</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaz =</span> naafit211<span class="sc">$</span>cumhaz, </span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">esvea =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(naafit211<span class="sc">$</span>strata)[<span class="dv">1</span>], naafit211<span class="sc">$</span>strata[<span class="dv">1</span>]),</span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">rep</span>(<span class="fu">names</span>(naafit211<span class="sc">$</span>strata)[<span class="dv">2</span>], naafit211<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a>(fig211 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> naadata211) <span class="sc">+</span> <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> esvea), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_discrete</span>(<span class="st">"ESVEA"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)) <span class="sc">+</span> </span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
</section>
<section id="section-1" class="level4">
<h4 class="anchored" data-anchor-id="section-1">2.</h4>
<p><em>Make a non-parametric test for comparison of the two</em>.</p>
<p>The Nelson-Aalen estimate of the cumulative hazards for subjects with or without ESVEA can be compared with a logrank test which is implemented as the function <strong>survdiff</strong> from the survival package.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-82_95ee9c34a6bb552c0426d9e18d734a86">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logrank test</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timedeath, death) <span class="sc">~</span> esvea, <span class="at">data =</span> chs_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(timedeath, death) ~ esvea, data = chs_data)

          N Observed Expected (O-E)^2/E (O-E)^2/V
esvea=0 579      206    228.4       2.2      17.7
esvea=1  99       55     32.6      15.4      17.7

 Chisq= 17.7  on 1 degrees of freedom, p= 3e-05 </code></pre>
</div>
</div>
<p>We get a chi-square statistic of 17.7 on 1 degree of freedom and a corresponding p-value of <span class="math inline">\(3 \cdot 10^{-5}\)</span>.</p>
</section>
<section id="section-2" class="level4">
<h4 class="anchored" data-anchor-id="section-2">3.</h4>
<p><em>Make a similar analysis based on a model where the hazard is assumed constant within 5-year intervals</em>.</p>
<p>To estimate the cumulative hazard under the assumption that the hazard is constant within 5-year intervals we must first split each record into sub-records with cut times at 5 and 10 years. This can be done using the <strong>survSplit</strong> function from the survival package. Duration of each sub-record is then stored as the column <strong>duration</strong>.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-83_7036e1d37822e4ee68dfb63839a4f50f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Splitting each record into subrecords</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>data_pch <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timedeath, death) <span class="sc">~</span> esvea, </span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> chs_data, </span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">cut =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>), <span class="co">#Cut points</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">episode =</span> <span class="st">"interval"</span>)</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding column with name interval</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>data_pch<span class="sc">$</span>duration <span class="ot">&lt;-</span> data_pch<span class="sc">$</span>timedeath <span class="sc">-</span> data_pch<span class="sc">$</span>tstart <span class="co">#Duration of each subrecord</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can then estimate the hazard within each of the intervals <span class="math inline">\([0,5), [5,10), [10,15.19)\)</span> using an occurrence/exposure rate.</p>
<p>For subjects without ESVEA we get the following estimates:</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-84_2daf07327c1652b16a74be96c6732f9f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>int1esvea0 <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_pch, interval <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> esvea <span class="sc">==</span> <span class="dv">0</span>) <span class="co">#All subrecords in the interval [0,5) with ESVEA = 0</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>int2esvea0 <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_pch, interval <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> esvea <span class="sc">==</span> <span class="dv">0</span>) <span class="co">#All subrecords in the interval [5,10) with ESVEA = 0</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>int3esvea0 <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_pch, interval <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> esvea <span class="sc">==</span> <span class="dv">0</span>) <span class="co">#All subrecords in the interval [10,15.19) with ESVEA = 0</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>haz1esvea0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(int1esvea0<span class="sc">$</span>death)<span class="sc">/</span><span class="fu">sum</span>(int1esvea0<span class="sc">$</span>duration) <span class="co">#Hazard estimate for the interval [0,5)</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>haz2esvea0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(int2esvea0<span class="sc">$</span>death)<span class="sc">/</span><span class="fu">sum</span>(int2esvea0<span class="sc">$</span>duration) <span class="co">#Hazard estimate for the interval [5,10) </span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>haz3esvea0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(int3esvea0<span class="sc">$</span>death)<span class="sc">/</span><span class="fu">sum</span>(int3esvea0<span class="sc">$</span>duration) <span class="co">#Hazard estimate for the interval [10,15.19)</span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Table with hazard estimates for subjects without ESVEA</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">c</span>(<span class="st">"0-5 years"</span>,<span class="st">"5-10 years"</span>,<span class="st">"10+ years"</span>), <span class="fu">c</span>(haz1esvea0,haz2esvea0,haz3esvea0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]         [,2]                
[1,] "0-5 years"  "0.0157326574030543"
[2,] "5-10 years" "0.0296926508258624"
[3,] "10+ years"  "0.0454654436742393"</code></pre>
</div>
</div>
<p>And for the group with ESVEA we get</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-85_f11937f4d0b45165c84ace666e98ef02">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>int1esvea1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_pch, interval <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> esvea <span class="sc">==</span> <span class="dv">1</span>) <span class="co">#All subrecords in the interval [0,5) with ESVEA = 1</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>int2esvea1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_pch, interval <span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> esvea <span class="sc">==</span> <span class="dv">1</span>) <span class="co">#All subrecords in the interval [5,10) with ESVEA = 1</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>int3esvea1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_pch, interval <span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> esvea <span class="sc">==</span> <span class="dv">1</span>) <span class="co">#All subrecords in the interval [10,15,19) with ESVEA = 1</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>haz1esvea1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(int1esvea1<span class="sc">$</span>death)<span class="sc">/</span><span class="fu">sum</span>(int1esvea1<span class="sc">$</span>duration) <span class="co">#Hazard estimate for the interval [0,5)</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>haz2esvea1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(int2esvea1<span class="sc">$</span>death)<span class="sc">/</span><span class="fu">sum</span>(int2esvea1) <span class="co">#Hazard estimate for the interval [5,10)</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>haz3esvea1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(int3esvea1<span class="sc">$</span>death)<span class="sc">/</span><span class="fu">sum</span>(int3esvea1<span class="sc">$</span>duration) <span class="co">#Hazard estimate for the interval [10,15)</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Table with estimates for subjects with ESVEA</span></span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">c</span>(<span class="st">"0-5 years"</span>,<span class="st">"5-10 years"</span>,<span class="st">"10+ years"</span>), <span class="fu">c</span>(haz1esvea1,haz2esvea1,haz3esvea1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]         [,2]                 
[1,] "0-5 years"  "0.0386657394025027" 
[2,] "5-10 years" "0.00940130241177833"
[3,] "10+ years"  "0.0813048849711176" </code></pre>
</div>
</div>
<p>Alternatively, all estimates can be obtained at once through a Poisson regression using the <strong>glm</strong> function with <strong>death</strong> as the dependent variable, the categorical variable of the different combinations of interval and ESVEA status, <strong>int_esvea</strong>, as the covariate and the logarithm of <strong>duration</strong> as an offset. Furthermore, we must include -1 as a covariate to avoid estimating an intercept.</p>
<p>We get the hazards by taking the exponential of the coefficients estimated from this Poisson model.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-86_626f742cb4c25cf250e36d64ad401f6c">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a categorical covariate indicating the interval and ESVEA status for each subrecord</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>data_pch<span class="sc">$</span>int_esvea <span class="ot">&lt;-</span> data_pch<span class="sc">$</span>interval <span class="sc">+</span> (data_pch<span class="sc">$</span>esvea<span class="sc">*</span><span class="dv">3</span>)</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Poisson regression </span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>poisson213 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> <span class="fu">factor</span>(int_esvea) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>poisson_est <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">exp</span>(<span class="fu">coefficients</span>(poisson213)))</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Table with estimates</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">c</span>(<span class="st">"0-5 years, ESVEA = 0"</span>,<span class="st">"5-10 years, ESVEA = 0"</span>,<span class="st">"10+ years, ESVEA = 0"</span>, <span class="st">"0-5 years, ESVEA = 1"</span>,<span class="st">"5-10 years, ESVEA = 1"</span>,<span class="st">"10+ years, ESVEA = 1"</span>), poisson_est)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                             poisson_est         
[1,] "0-5 years, ESVEA = 0"  "0.0157326574052703"
[2,] "5-10 years, ESVEA = 0" "0.0296926510588424"
[3,] "10+ years, ESVEA = 0"  "0.0454654437768701"
[4,] "0-5 years, ESVEA = 1"  "0.0386657394029923"
[5,] "5-10 years, ESVEA = 1" "0.0460542296617026"
[6,] "10+ years, ESVEA = 1"  "0.0813048849874842"</code></pre>
</div>
</div>
<p>The cumulative hazards for subjects with or without ESVEA under the piece-wise constant hazard assumption can be compared using a likelihood ratio test (LRT). This is done by fitting a model under the null hypothesis (i.e only considering the intervals <span class="math inline">\([0,5), [5,10)\)</span> and <span class="math inline">\([10,15.19)\)</span> but not whether subjects have ESVEA or not) and then comparing the two models using <strong>anova</strong> with the argument test = LRT.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-87_00cc4f055619b07a56b37b0899cb20fc">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Null model</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>poisson_null213 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> <span class="fu">factor</span>(interval) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Likelihood ratio test (LRT)</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(poisson_null213,poisson213, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: death ~ factor(interval) - 1 + offset(log(duration))
Model 2: death ~ factor(int_esvea) - 1 + offset(log(duration))
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)   
1      1816     1444.7                        
2      1813     1428.5  3    16.22 0.001022 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 16.22 with 3 degrees of freedom and a corresponding p-value of 0.001.</p>
<p>The piece-wise constant cumulative hazards are plotted together with the Nelson-Aalen cumulative hazards below</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-88_5ac9f56acbc42d29bb612506fdcb98fd">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Data frame with time and cumulative hazard under poisson assumption for subjects without ESVEA</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>poisson_esvea0 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="fl">15.19</span>), </span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">cumhaz =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">1</span>], <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">2</span>], <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">5.19</span><span class="sc">*</span>poisson_est[<span class="dv">3</span>])))</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Data frame with time and cumulative hazard under poisson assumption for subjects with ESVEA</span></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a>poisson_esvea1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="fl">15.19</span>), </span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">cumhaz =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">4</span>], <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">4</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">5</span>], <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">4</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">5</span>] <span class="sc">+</span> <span class="fl">5.19</span><span class="sc">*</span>poisson_est[<span class="dv">6</span>])))</span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot of Nelson-Aalen together with Poisson cumulative hazard</span></span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a>fig211 <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> poisson_esvea0, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_line</span>(<span class="at">data =</span> poisson_esvea1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid" width="1122"></p>
</div>
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_line(data =poisson_esvea1, aes(x = x, y = y), color ="#00BFC4", linewidth = 0.8)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</div>
<div id="tabset-42-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-42-2-tab">
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-89_2db49fe79c0383e6909c6dbfcf998df0">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We first load the data;</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out = chs_<span class="kw">data</span></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>    datafile = <span class="st">'C:/HRfinal/holter/cphholter.csv'</span></span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>    dbms= csv <span class="kw">replace</span>;</span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>    getnames=yes;</span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a><span class="co">* We will convert the time variables ('timeafib', 'timestroke', and 'timedeath') from days to years;</span></span>
<span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-11"><a href="#cb252-11" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb252-12"><a href="#cb252-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb252-13"><a href="#cb252-13" aria-hidden="true" tabindex="-1"></a>    timeafib = timeafib/<span class="dv">365.25</span>;</span>
<span id="cb252-14"><a href="#cb252-14" aria-hidden="true" tabindex="-1"></a>    timestroke = timestroke/<span class="dv">365.25</span>;</span>
<span id="cb252-15"><a href="#cb252-15" aria-hidden="true" tabindex="-1"></a>    timedeath = timedeath/<span class="dv">365.25</span>;</span>
<span id="cb252-16"><a href="#cb252-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-17"><a href="#cb252-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-18"><a href="#cb252-18" aria-hidden="true" tabindex="-1"></a><span class="co">*----------------------------------------------------------------------------------------------------------------------------------;</span></span>
<span id="cb252-19"><a href="#cb252-19" aria-hidden="true" tabindex="-1"></a><span class="co">*---------------------------------------- EXERCISE 2.1 ----------------------------------------------------------------------------;</span></span>
<span id="cb252-20"><a href="#cb252-20" aria-hidden="true" tabindex="-1"></a><span class="co">*----------------------------------------------------------------------------------------------------------------------------------;</span></span>
<span id="cb252-21"><a href="#cb252-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-22"><a href="#cb252-22" aria-hidden="true" tabindex="-1"></a><span class="co">*------------------------------------------- 2.1.1 --------------------------------------------------------------------------------;</span></span>
<span id="cb252-23"><a href="#cb252-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-24"><a href="#cb252-24" aria-hidden="true" tabindex="-1"></a><span class="co">* We will estimate the cumulative hazards of death for subjects with or without ESVEA non-parametrically with the Nelson-Aalen </span></span>
<span id="cb252-25"><a href="#cb252-25" aria-hidden="true" tabindex="-1"></a><span class="co">  estimator. This can be done with the 'phreg' procedure. Since the event of interest is death the time variable used in the model </span></span>
<span id="cb252-26"><a href="#cb252-26" aria-hidden="true" tabindex="-1"></a><span class="co">  statement is 'timedeath' and the censoring variable is 'death'. Furthermore, 'esvea' is specified in the strata statement to </span></span>
<span id="cb252-27"><a href="#cb252-27" aria-hidden="true" tabindex="-1"></a><span class="co">  obtain different estimates of the hazards for subjects with or without ESVEA. The cumulative hazard are the stored in the</span></span>
<span id="cb252-28"><a href="#cb252-28" aria-hidden="true" tabindex="-1"></a><span class="co">  'hazdata' file created with the baseline statement;</span></span>
<span id="cb252-29"><a href="#cb252-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-30"><a href="#cb252-30" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=chs_<span class="kw">data</span> noprint; </span>
<span id="cb252-31"><a href="#cb252-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> timedeath*death(<span class="dv">0</span>)=;</span>
<span id="cb252-32"><a href="#cb252-32" aria-hidden="true" tabindex="-1"></a>    strata esvea;</span>
<span id="cb252-33"><a href="#cb252-33" aria-hidden="true" tabindex="-1"></a>    baseline out=hazdata cumhaz=naa;</span>
<span id="cb252-34"><a href="#cb252-34" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-35"><a href="#cb252-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-36"><a href="#cb252-36" aria-hidden="true" tabindex="-1"></a><span class="co">* The estimates are then plotted using the gplot procedure;</span></span>
<span id="cb252-37"><a href="#cb252-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-38"><a href="#cb252-38" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"2.1.1: Nelson-Aalen estimates for subjects with or without ESVEA"</span>;</span>
<span id="cb252-39"><a href="#cb252-39" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=hazdata;</span>
<span id="cb252-40"><a href="#cb252-40" aria-hidden="true" tabindex="-1"></a>    plot naa*timedeath=esvea /haxis=axis1 vaxis=axis2;</span>
<span id="cb252-41"><a href="#cb252-41" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">15.19</span> <span class="kw">by</span> <span class="dv">1</span> <span class="kw">label</span>=(<span class="st">'Time (Years)'</span>);</span>
<span id="cb252-42"><a href="#cb252-42" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">1</span> <span class="kw">by</span> <span class="dv">0.2</span> <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb252-43"><a href="#cb252-43" aria-hidden="true" tabindex="-1"></a>    symbol1 i=stepjl c=red;</span>
<span id="cb252-44"><a href="#cb252-44" aria-hidden="true" tabindex="-1"></a>    symbol2 i=stepjl c=blue;</span>
<span id="cb252-45"><a href="#cb252-45" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-46"><a href="#cb252-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-47"><a href="#cb252-47" aria-hidden="true" tabindex="-1"></a><span class="co">*------------------------------------------- 2.1.2 --------------------------------------------------------------------------------;</span></span>
<span id="cb252-48"><a href="#cb252-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-49"><a href="#cb252-49" aria-hidden="true" tabindex="-1"></a><span class="co">* The hazards can be compared with a log rank test which is implemented in the lifetest procedure. The relevant time variable </span></span>
<span id="cb252-50"><a href="#cb252-50" aria-hidden="true" tabindex="-1"></a><span class="co">  'timedeath' and censoring variable 'death' are specified in the time statement and 'esvea' is used in the strata statement.;</span></span>
<span id="cb252-51"><a href="#cb252-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-52"><a href="#cb252-52" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"2.1.2: Log rank test comparing the hazards for the subjects with or without ESVEA"</span>;</span>
<span id="cb252-53"><a href="#cb252-53" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> lifetest<span class="kw"> data</span>=chs_<span class="kw">data</span> notable plots=none; </span>
<span id="cb252-54"><a href="#cb252-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span> timedeath*death(<span class="dv">0</span>);</span>
<span id="cb252-55"><a href="#cb252-55" aria-hidden="true" tabindex="-1"></a>    strata esvea;</span>
<span id="cb252-56"><a href="#cb252-56" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb252-57"><a href="#cb252-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-58"><a href="#cb252-58" aria-hidden="true" tabindex="-1"></a><span class="co">* We get a Chi-square statistic of 17.66 on 1 degree of freedom with a corresponding p-value &lt;0.0001;</span></span>
<span id="cb252-59"><a href="#cb252-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-60"><a href="#cb252-60" aria-hidden="true" tabindex="-1"></a><span class="co">*------------------------------------------- 2.1.3 --------------------------------------------------------------------------------;</span></span>
<span id="cb252-61"><a href="#cb252-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-62"><a href="#cb252-62" aria-hidden="true" tabindex="-1"></a><span class="co">* To estimate the cumulative hazard under the assumption that the hazard is constant within 5-year intervals we must first split </span></span>
<span id="cb252-63"><a href="#cb252-63" aria-hidden="true" tabindex="-1"></a><span class="co">  each record into subrecords with cut times at 5 and 10 years. We will create a new data set 'chs_pch213' where 'cens' indicates if the</span></span>
<span id="cb252-64"><a href="#cb252-64" aria-hidden="true" tabindex="-1"></a><span class="co">  subject died during each 5-year interval, 'risktime' is the time at risk during each 5-year interval, logrisk is the logarithm of</span></span>
<span id="cb252-65"><a href="#cb252-65" aria-hidden="true" tabindex="-1"></a><span class="co">  the risk time and 'interval' is a categorical variable with 6 levels corresponding to the different combinations of interval and </span></span>
<span id="cb252-66"><a href="#cb252-66" aria-hidden="true" tabindex="-1"></a><span class="co">  ESVEA status;</span></span>
<span id="cb252-67"><a href="#cb252-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-68"><a href="#cb252-68" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_pch213; </span>
<span id="cb252-69"><a href="#cb252-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb252-70"><a href="#cb252-70" aria-hidden="true" tabindex="-1"></a>    cens=(timedeath&lt;=<span class="dv">5</span>)*(death = <span class="dv">1</span>);</span>
<span id="cb252-71"><a href="#cb252-71" aria-hidden="true" tabindex="-1"></a>    risktime=<span class="fu">min</span>(<span class="dv">5</span>,timedeath);</span>
<span id="cb252-72"><a href="#cb252-72" aria-hidden="true" tabindex="-1"></a>    logrisk = <span class="fu">log</span>(risktime);</span>
<span id="cb252-73"><a href="#cb252-73" aria-hidden="true" tabindex="-1"></a>    interval=<span class="dv">1</span>;</span>
<span id="cb252-74"><a href="#cb252-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> esvea = <span class="dv">1</span> <span class="kw">then do</span>; interval =<span class="dv">4</span><span class="kw">; end</span>; <span class="kw">output</span>;</span>
<span id="cb252-75"><a href="#cb252-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> timedeath&gt;<span class="dv">5</span> <span class="kw">then do</span>;</span>
<span id="cb252-76"><a href="#cb252-76" aria-hidden="true" tabindex="-1"></a>    cens=(timedeath&lt;=<span class="dv">10</span>)*(death = <span class="dv">1</span>);</span>
<span id="cb252-77"><a href="#cb252-77" aria-hidden="true" tabindex="-1"></a>    risktime=<span class="fu">min</span>(<span class="dv">5</span>,timedeath<span class="dv">-5</span>);</span>
<span id="cb252-78"><a href="#cb252-78" aria-hidden="true" tabindex="-1"></a>    logrisk = <span class="fu">log</span>(risktime);</span>
<span id="cb252-79"><a href="#cb252-79" aria-hidden="true" tabindex="-1"></a>    interval=<span class="dv">2</span>;</span>
<span id="cb252-80"><a href="#cb252-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> esvea = <span class="dv">1</span> <span class="kw">then do</span>; interval = <span class="dv">5</span><span class="kw">; end</span>; <span class="kw">output; end</span>;</span>
<span id="cb252-81"><a href="#cb252-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> timedeath&gt;<span class="dv">10</span> <span class="kw">then do</span>;</span>
<span id="cb252-82"><a href="#cb252-82" aria-hidden="true" tabindex="-1"></a>    cens= (death = <span class="dv">1</span>); </span>
<span id="cb252-83"><a href="#cb252-83" aria-hidden="true" tabindex="-1"></a>    risktime=timedeath<span class="dv">-10</span>;</span>
<span id="cb252-84"><a href="#cb252-84" aria-hidden="true" tabindex="-1"></a>    logrisk = <span class="fu">log</span>(risktime);</span>
<span id="cb252-85"><a href="#cb252-85" aria-hidden="true" tabindex="-1"></a>    interval=<span class="dv">3</span>;</span>
<span id="cb252-86"><a href="#cb252-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> esvea = <span class="dv">1</span> <span class="kw">then do</span>; interval = <span class="dv">6</span><span class="kw">; end</span>; <span class="kw">output; end</span>;</span>
<span id="cb252-87"><a href="#cb252-87" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-88"><a href="#cb252-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-89"><a href="#cb252-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-90"><a href="#cb252-90" aria-hidden="true" tabindex="-1"></a><span class="co">* We can then estimate the hazard within each of the intervals [0,5), [5,10), [10,15.19). </span></span>
<span id="cb252-91"><a href="#cb252-91" aria-hidden="true" tabindex="-1"></a><span class="co">  This can be done with the sql procedure;</span></span>
<span id="cb252-92"><a href="#cb252-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-93"><a href="#cb252-93" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"2.1.3: Estimate of the hazards for subjects with or without ESVEA under the piece-wise constant hazards assumption"</span>;</span>
<span id="cb252-94"><a href="#cb252-94" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb252-95"><a href="#cb252-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> interval,</span>
<span id="cb252-96"><a href="#cb252-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(cens) <span class="kw">as</span> sum_death, </span>
<span id="cb252-97"><a href="#cb252-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(risktime) <span class="kw">as</span> sum_risktime,</span>
<span id="cb252-98"><a href="#cb252-98" aria-hidden="true" tabindex="-1"></a>    calculated sum_death / calculated sum_risktime <span class="kw">as</span> hazard</span>
<span id="cb252-99"><a href="#cb252-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> chs_pch213</span>
<span id="cb252-100"><a href="#cb252-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">group</span> <span class="kw">by</span> interval;</span>
<span id="cb252-101"><a href="#cb252-101" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb252-102"><a href="#cb252-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-103"><a href="#cb252-103" aria-hidden="true" tabindex="-1"></a><span class="co">* Alternatively, all estimates can be obtained at once through a Poisson regression using the genmod procedure. Since 'interval' is </span></span>
<span id="cb252-104"><a href="#cb252-104" aria-hidden="true" tabindex="-1"></a><span class="co">  a categorical variable it must be included in the class statement. 'cens' is included in the model statement as the dependent</span></span>
<span id="cb252-105"><a href="#cb252-105" aria-hidden="true" tabindex="-1"></a><span class="co">  variable whilst interval is included as the only explanatory variable. Furthermore the probability distribution is specified through </span></span>
<span id="cb252-106"><a href="#cb252-106" aria-hidden="true" tabindex="-1"></a><span class="co">  'dist = poi' and the logarithm of the offset is included as well as the argument 'noint' which is added to obtain a model without an </span></span>
<span id="cb252-107"><a href="#cb252-107" aria-hidden="true" tabindex="-1"></a><span class="co">  intercept. The estimates for the hazard for each of interval and status of ESVEA are then given using the estimate statement. These </span></span>
<span id="cb252-108"><a href="#cb252-108" aria-hidden="true" tabindex="-1"></a><span class="co">  estimates corresponds to the exponential of the estimates from the table of the maximum likelihood parameter estimation;</span></span>
<span id="cb252-109"><a href="#cb252-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-110"><a href="#cb252-110" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=chs_pch213;</span>
<span id="cb252-111"><a href="#cb252-111" aria-hidden="true" tabindex="-1"></a>    class interval;</span>
<span id="cb252-112"><a href="#cb252-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> cens=interval / dist=poi offset=logrisk noint;</span>
<span id="cb252-113"><a href="#cb252-113" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'0-5 years, ESVEA = 0'</span> interval <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span>;</span>
<span id="cb252-114"><a href="#cb252-114" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'5-10 years, ESVEA = 0'</span> interval <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span>;</span>
<span id="cb252-115"><a href="#cb252-115" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'10+ years, ESVEA = 0'</span> interval <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span>;</span>
<span id="cb252-116"><a href="#cb252-116" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'0-5 years, ESVEA = 1'</span> interval <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>;</span>
<span id="cb252-117"><a href="#cb252-117" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'5-10 years, ESVEA = 1'</span> interval <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>;</span>
<span id="cb252-118"><a href="#cb252-118" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'10+ years, ESVEA = 1'</span> interval <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>;</span>
<span id="cb252-119"><a href="#cb252-119" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-120"><a href="#cb252-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-121"><a href="#cb252-121" aria-hidden="true" tabindex="-1"></a><span class="co">* To investigate if the hazards differ between the two groups we must fit a Poisson model where we do not stratify by ESVEA </span></span>
<span id="cb252-122"><a href="#cb252-122" aria-hidden="true" tabindex="-1"></a><span class="co">  and then compare the two Poisson models using a likelihood ratio test (LRT). Thus, we repeat the procedure and first create</span></span>
<span id="cb252-123"><a href="#cb252-123" aria-hidden="true" tabindex="-1"></a><span class="co">  a new data set 'chs_pch_null213' where no distinction is made between subjects with or without ESVEA;</span></span>
<span id="cb252-124"><a href="#cb252-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-125"><a href="#cb252-125" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_pch_null213;</span>
<span id="cb252-126"><a href="#cb252-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> chs_pch213;</span>
<span id="cb252-127"><a href="#cb252-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> interval <span class="kw">in</span> (<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>) <span class="kw">then</span> interval = interval - <span class="dv">3</span>;</span>
<span id="cb252-128"><a href="#cb252-128" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-129"><a href="#cb252-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-130"><a href="#cb252-130" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, the Poisson model is fitted;</span></span>
<span id="cb252-131"><a href="#cb252-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-132"><a href="#cb252-132" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"2.1.3: Estimate of the hazard under the piece-wise constant hazards assumption with no distinction between subjects with or </span></span>
<span id="cb252-133"><a href="#cb252-133" aria-hidden="true" tabindex="-1"></a>       without ESVEA<span class="st">";</span></span>
<span id="cb252-134"><a href="#cb252-134" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=chs_pch_null213;</span>
<span id="cb252-135"><a href="#cb252-135" aria-hidden="true" tabindex="-1"></a>    class interval;</span>
<span id="cb252-136"><a href="#cb252-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> cens=interval/dist=poi offset=logrisk noint;</span>
<span id="cb252-137"><a href="#cb252-137" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'0-5 years'</span> interval <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>;</span>
<span id="cb252-138"><a href="#cb252-138" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'5-10 years'</span> interval <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>;</span>
<span id="cb252-139"><a href="#cb252-139" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'10+ years'</span> interval <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>;</span>
<span id="cb252-140"><a href="#cb252-140" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-141"><a href="#cb252-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-142"><a href="#cb252-142" aria-hidden="true" tabindex="-1"></a><span class="co">* Lastly, the two models are compared with a likelihood ratio test. This is done by comparing the max log likelihoods for the two models </span></span>
<span id="cb252-143"><a href="#cb252-143" aria-hidden="true" tabindex="-1"></a><span class="co">  and then calculating the p-value using the Chi-square distribution with 3 degrees of freedom. The likelihood scores are found in the 'Criteria For</span></span>
<span id="cb252-144"><a href="#cb252-144" aria-hidden="true" tabindex="-1"></a><span class="co">  Accessing Goodness Of Fit' table;</span></span>
<span id="cb252-145"><a href="#cb252-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-146"><a href="#cb252-146" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"2.1.3: Likelihood ratio test comparing the two piece-wise constant hazards models"</span>;</span>
<span id="cb252-147"><a href="#cb252-147" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb252-148"><a href="#cb252-148" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">1444.6862-1428.4662</span>;</span>
<span id="cb252-149"><a href="#cb252-149" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb252-150"><a href="#cb252-150" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb252-151"><a href="#cb252-151" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb252-152"><a href="#cb252-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-153"><a href="#cb252-153" aria-hidden="true" tabindex="-1"></a><span class="co">* We get a Chi-square statistics of 16.22 on 3 degrees of freedom with a corresponding p-value of 0.001</span></span>
<span id="cb252-154"><a href="#cb252-154" aria-hidden="true" tabindex="-1"></a><span class="co">  We conclude once more that the hazards seem different for the subjects with or without ESVEA also under this model.;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-2.2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.2">Exercise 2.2</h3>
<p><em>Consider the data from the Copenhagen Holter study</em>.</p>
<section id="section-3" class="level4">
<h4 class="anchored" data-anchor-id="section-3">1.</h4>
<p><em>Make a version of the data set enabling an analysis of the composite endpoint of stroke or death without stroke (stroke-free survival, i.e.&nbsp;define the relevant Time and Status variables), see Section 1.2.4</em>.</p>
<p>To estimate the cumulative hazards for the composite end-point of stroke or death we must first create a suitable time variable, <strong>timestrokeordeath</strong> and status indicator, <strong>strokeordeath</strong>.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-90_3eecf7f42641faf730e96fffb86c7663">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>timestrokeordeath <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(chs_data<span class="sc">$</span>stroke <span class="sc">==</span> <span class="dv">1</span>, chs_data<span class="sc">$</span>timestroke, chs_data<span class="sc">$</span>timedeath) </span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>strokeordeath <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(chs_data<span class="sc">$</span>stroke <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, chs_data<span class="sc">$</span>death) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-4" class="level4">
<h4 class="anchored" data-anchor-id="section-4">2.</h4>
<p><em>Estimate non-parametrically the cumulative hazards of stroke-free survival for subjects with or without ESVEA</em>.</p>
<p>We repeat the procedure from exercise 2.1.1 to obtain the Nelson-Aalen estimate of the cumulative hazards.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-91_1ce138565afb92b4b9c454389d6a7a6f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimating the cumulative hazards for subjects with or without ESVEA non-parametrically</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>naafit222 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea, <span class="at">data =</span> chs_data)</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>naadata222 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> naafit222<span class="sc">$</span>time,</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cumhaz =</span> naafit222<span class="sc">$</span>cumhaz, </span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">esvea =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(naafit222<span class="sc">$</span>strata)[<span class="dv">1</span>], naafit222<span class="sc">$</span>strata[<span class="dv">1</span>]),</span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="fu">names</span>(naafit222<span class="sc">$</span>strata)[<span class="dv">2</span>], naafit222<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a>(fig222 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> naadata222) <span class="sc">+</span> <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> esvea), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_linetype_discrete</span>(<span class="st">"ESVEA"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)) <span class="sc">+</span> </span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
</section>
<section id="section-5" class="level4">
<h4 class="anchored" data-anchor-id="section-5">3.</h4>
<p><em>Make a non-parametric test for comparison of the two</em>.</p>
<p>The hazards are compared using a logrank test</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-92_404be11f4118e4c87449a09366525370">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logrank test</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea, <span class="at">data =</span> chs_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea, 
    data = chs_data)

          N Observed Expected (O-E)^2/E (O-E)^2/V
esvea=0 579      230    253.4      2.17      18.6
esvea=1  99       57     33.6     16.37      18.6

 Chisq= 18.6  on 1 degrees of freedom, p= 2e-05 </code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 18.6 on 1 degree of freedom and a corresponding p-value of <span class="math inline">\(2 \cdot 10^{-5}\)</span>.</p>
</section>
<section id="section-6" class="level4">
<h4 class="anchored" data-anchor-id="section-6">4.</h4>
<p><em>Make a similar analysis based on a model where the hazard is assumed constant within 5-year intervals</em>.</p>
<p>We fit a Poisson model where the hazards are assumed constant within (approximate) 5-year intervals.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-93_6b4961cea28624179eb6af928a1b998f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Splitting records in 5-year intervals</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>data_pch <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea, </span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> chs_data, </span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">cut =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>), </span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">episode =</span> <span class="st">"interval"</span>)</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>data_pch<span class="sc">$</span>duration <span class="ot">&lt;-</span> data_pch<span class="sc">$</span>timestrokeordeath <span class="sc">-</span> data_pch<span class="sc">$</span>tstart</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>data_pch<span class="sc">$</span>int_esvea <span class="ot">&lt;-</span> data_pch<span class="sc">$</span>interval <span class="sc">+</span> (data_pch<span class="sc">$</span>esvea<span class="sc">*</span><span class="dv">3</span>)</span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Poisson regression</span></span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a>poisson224 <span class="ot">&lt;-</span> <span class="fu">glm</span>(strokeordeath <span class="sc">~</span> <span class="fu">factor</span>(int_esvea) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>poisson_est <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">exp</span>(<span class="fu">coefficients</span>(poisson224)))</span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Table with estimate of the coefficients</span></span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">c</span>(<span class="st">"0-5 years, ESVEA = 0"</span>,<span class="st">"5-10 years, ESVEA = 0"</span>,<span class="st">"10+ years, ESVEA = 0"</span>, <span class="st">"0-5 years, ESVEA = 1"</span>,<span class="st">"5-10 years, ESVEA = 1"</span>,<span class="st">"10+ years, ESVEA = 1"</span>), poisson_est)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                             poisson_est         
[1,] "0-5 years, ESVEA = 0"  "0.0187322517434922"
[2,] "5-10 years, ESVEA = 0" "0.0355788210802352"
[3,] "10+ years, ESVEA = 0"  "0.0503486257754533"
[4,] "0-5 years, ESVEA = 1"  "0.0582424237782578"
[5,] "5-10 years, ESVEA = 1" "0.0631007474577195"
[6,] "10+ years, ESVEA = 1"  "0.0520302535222435"</code></pre>
</div>
</div>
<p>The hazards are then compared using a likelihood ratio test</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-94_7d0cc72dedfe52e8bbe17225198595f4">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Null model</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>poisson_null224 <span class="ot">&lt;-</span>  <span class="fu">glm</span>(strokeordeath <span class="sc">~</span> <span class="fu">factor</span>(interval) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(poisson_null224, poisson224, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: strokeordeath ~ factor(interval) - 1 + offset(log(duration))
Model 2: strokeordeath ~ factor(int_esvea) - 1 + offset(log(duration))
  Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
1      1769     1558.5                          
2      1766     1534.8  3   23.721 2.857e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 23.72 on 3 degrees of freedom and a corresponding p-value of <span class="math inline">\(2.86 \cdot 10^{-5}\)</span>.</p>
<p>The Poisson model is plotted together with the Nelson-Aalen estimates below</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-95_3c51284682ed036686dc631f1b2fb14c">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Data frame with time and cumulative hazard under poisson assumption for subjects without ESVEA</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>poisson_esvea0 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="fl">15.19</span>), </span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">cumhaz =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">1</span>], <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">2</span>], <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">3</span>])))</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Data frame with time and cumulative hazard under poisson assumption for subjects with ESVEA</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>poisson_esvea1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="fl">15.19</span>), </span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cumhaz =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">4</span>], <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">4</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">5</span>], <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">4</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">5</span>] <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>poisson_est[<span class="dv">6</span>])))</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot of Nelson-Aalen together with Poisson cumulative hazard</span></span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a>fig222 <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> poisson_esvea0, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_line</span>(<span class="at">data =</span> poisson_esvea1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
</section>
</section>
<section id="exercise-2.3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.3">Exercise 2.3</h3>
<p><em>Consider the data from the Copenhagen Holter study and the composite end-point stroke-free survival</em>.</p>
<section id="section-7" class="level4">
<h4 class="anchored" data-anchor-id="section-7">1.</h4>
<p><em>Fit a Cox model and estimate the hazard ratio between subjects with or without ESVEA</em>.</p>
<p>The Cox proportional hazards model is implemented as <em>coxph</em> in the <strong>survival</strong> package. The formula argument consists of a Surv object to the left of ~ and the covariates to the right. We include the argument <strong>ties = breslow</strong> to obtain the Breslow estimate of the cumulative hazard.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-96_af96b591ebb5153b8b45761b2ad953ed">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>cox231 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea, <span class="at">data =</span> chs_data, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox231)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea, 
    data = chs_data, ties = "breslow")

  n= 678, number of events= 287 

        coef exp(coef) se(coef)     z Pr(&gt;|z|)    
esvea 0.6285    1.8747   0.1482 4.241 2.23e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
esvea     1.875     0.5334     1.402     2.507

Concordance= 0.546  (se = 0.012 )
Likelihood ratio test= 15.79  on 1 df,   p=7e-05
Wald test            = 17.98  on 1 df,   p=2e-05
Score (logrank) test = 18.58  on 1 df,   p=2e-05</code></pre>
</div>
</div>
<p>We get a hazard ratio of 1.875, i.e.&nbsp;the hazard is increased by a factor 1.875 for patients with ESVEA compared to those without. We get a Wald test of 4.241 with a corresponding p-value of <span class="math inline">\(2.22\cdot 10^{-5}\)</span>.</p>
</section>
<section id="section-8" class="level4">
<h4 class="anchored" data-anchor-id="section-8">2.</h4>
<p><em>Fit a Poisson model where the hazard is assumed constant within 5-year intervals and estimate the hazard ratio between subjects with or without ESVEA</em>.</p>
<p>The piece-wise constant model is fitted using <strong>glm</strong> as described in exercise 2.1.3.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-97_eedc37700e74fa3717c8338d72247711">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson regression</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>poisson232 <span class="ot">&lt;-</span> <span class="fu">glm</span>(strokeordeath <span class="sc">~</span> <span class="fu">factor</span>(interval) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> esvea <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poisson232)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = strokeordeath ~ factor(interval) - 1 + esvea + 
    offset(log(duration)), family = poisson(), data = data_pch)

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
factor(interval)1  -3.8338     0.1183 -32.419  &lt; 2e-16 ***
factor(interval)2  -3.3452     0.1014 -32.998  &lt; 2e-16 ***
factor(interval)3  -3.0708     0.1020 -30.117  &lt; 2e-16 ***
esvea               0.6209     0.1482   4.191 2.78e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 15090  on 1772  degrees of freedom
Residual deviance:  1543  on 1768  degrees of freedom
AIC: 2125

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>We get a coefficient of 0.6209 for the ESVEA variable. This corresponds to a hazard ratio of <span class="math inline">\(\exp(0.6209) = 1.8606\)</span>. The Wald test is 4.188 with a corresponding p-value of <span class="math inline">\(2.82 \cdot 10^{-5}\)</span>.</p>
</section>
<section id="section-9" class="level4">
<h4 class="anchored" data-anchor-id="section-9">3.</h4>
<p><em>Compare the results from the two models</em>.</p>
<p>The hazard ratio between subjects with or without ESVEA found using the Cox model is 1.87 while it was 1.86 assuming the Poisson model. Thus, the estimates are nearly identical.</p>
</section>
</section>
<section id="exercise-2.4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.4">Exercise 2.4</h3>
<p><em>Consider the data from the Copenhagen Holter study and the composite end-point stroke-free survival</em>.</p>
<section id="section-10" class="level4">
<h4 class="anchored" data-anchor-id="section-10">1.</h4>
<p><em>Fit a Cox model and estimate the hazard ratio between subjects with or without ESVEA, now also adjusting for sex, age, and systolic blood pressure (sysBP)</em>.</p>
<p>We fit the Cox model as described in exercise 2.3.1. This time we also include <strong>sex</strong>, <strong>age</strong> and <strong>sbp</strong> as covariates.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-98_ce28c0b2c9532d4348d0a50ae30667c6">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model </span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>cox241 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp , <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> chs_data)</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox241)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea + 
    sex + age + sbp, data = chs_data, ties = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

          coef exp(coef) se(coef)     z Pr(&gt;|z|)    
esvea 0.318284  1.374767 0.152587 2.086   0.0370 *  
sex   0.577585  1.781731 0.126946 4.550 5.37e-06 ***
age   0.076658  1.079673 0.009362 8.189 2.64e-16 ***
sbp   0.005152  1.005165 0.002438 2.113   0.0346 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
esvea     1.375     0.7274     1.019     1.854
sex       1.782     0.5613     1.389     2.285
age       1.080     0.9262     1.060     1.100
sbp       1.005     0.9949     1.000     1.010

Concordance= 0.672  (se = 0.016 )
Likelihood ratio test= 99.45  on 4 df,   p=&lt;2e-16
Wald test            = 104.1  on 4 df,   p=&lt;2e-16
Score (logrank) test = 110  on 4 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>We get a hazard ratio of 1.375 for ESVEA. The Wald test is 2.086 with a corresponding p-value of 0.0370.</p>
</section>
<section id="section-11" class="level4">
<h4 class="anchored" data-anchor-id="section-11">2.</h4>
<p><em>Fit a Poisson model where the hazard is assumed constant within 5-year intervals and estimate the hazard ratio between subjects with or without ESVEA, now also adjusting for sex, age, and sysBP</em>.</p>
<p>To obtain estimates under the piece-wise constant hazard assumption we add <strong>sex</strong>, <strong>age</strong> and <strong>sbp</strong> on the right hand side of ~ both in the <strong>survSplit</strong> and the <strong>glm</strong> functions.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-99_65502cfbab1638307158928561c82078">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Splitting data in 5-year intervals</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>data_pch <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> age <span class="sc">+</span> sex <span class="sc">+</span> sbp,  </span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> chs_data, </span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">cut =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>), </span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">episode =</span> <span class="st">"interval"</span>)</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>data_pch<span class="sc">$</span>duration <span class="ot">&lt;-</span> data_pch<span class="sc">$</span>timestrokeordeath <span class="sc">-</span> data_pch<span class="sc">$</span>tstart</span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Poisson regression</span></span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a>poisson242 <span class="ot">&lt;-</span> <span class="fu">glm</span>(strokeordeath <span class="sc">~</span> <span class="fu">factor</span>(interval) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poisson242)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = strokeordeath ~ factor(interval) - 1 + esvea + 
    sex + age + sbp + offset(log(duration)), family = poisson(), 
    data = data_pch)

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)    
factor(interval)1 -9.984329   0.701540 -14.232  &lt; 2e-16 ***
factor(interval)2 -9.403023   0.691466 -13.599  &lt; 2e-16 ***
factor(interval)3 -9.077211   0.685584 -13.240  &lt; 2e-16 ***
esvea              0.311068   0.152551   2.039   0.0414 *  
sex                0.578858   0.126880   4.562 5.06e-06 ***
age                0.076159   0.009360   8.137 4.06e-16 ***
sbp                0.005061   0.002438   2.076   0.0379 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 15060.9  on 1767  degrees of freedom
Residual deviance:  1449.7  on 1760  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 2033.7

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>We get a coefficient of 0.3111 for ESVEA and a hazard ratio of <span class="math inline">\(\exp(0.3111) = 1.3649\)</span>. The Wald test is 2.039 and the corresponding p-value is 0.0414.</p>
</section>
<section id="section-12" class="level4">
<h4 class="anchored" data-anchor-id="section-12">3.</h4>
<p><em>Compare the results from the two models</em>.</p>
<p>Again, the hazard ratios estimated using either the Cox model or the Poisson model are comparable with a factor 1.36-1.37 increase of the hazard for subjects with ESVEA. We notice that this is smaller than the hazard ratio estimated without adjusting for sex, age, and systolic blood pressure.</p>
</section>
</section>
<section id="exercise-2.5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.5">Exercise 2.5</h3>
<section id="section-13" class="level4">
<h4 class="anchored" data-anchor-id="section-13">1.</h4>
<p><em>Check the Cox model from the previous exercise by examining proportional hazards between subjects with or without ESVEA and between men and women</em>.</p>
<p>To check the assumption of proportional hazards for subjects with or without ESVEA under the Cox model we fit a stratified Cox model. This can be done by adding <strong>strata(esvea)</strong> instead of <strong>esvea</strong> as a covariate in the <em>coxph</em> function. The baseline hazard can then be extracted using the function <em>basehaz</em> from the <strong>survival</strong> package. The argument <strong>centered = FALSE</strong> is added. Otherwise, the predicted cumulative hazard at the mean values of the covariates is returned.</p>
<p>The hazards are plotted against each other. If the proportional hazards assumption holds then the curve should be close to a straight line through (0,0) with a slope equal to the estimated hazard ratio of ESVEA.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-100_c9de59cb4331602192eefc0dc1b6c540">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model with separate hazards for subjects with or without ESVEA</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>cox251_esvea <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> <span class="fu">strata</span>(esvea) <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span>chs_data)</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox251_esvea)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ strata(esvea) + 
    sex + age + sbp, data = chs_data, ties = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

        coef exp(coef) se(coef)     z Pr(&gt;|z|)    
sex 0.572119  1.772018 0.127078 4.502 6.73e-06 ***
age 0.075990  1.078952 0.009378 8.103 5.35e-16 ***
sbp 0.005321  1.005335 0.002441 2.180   0.0292 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

    exp(coef) exp(-coef) lower .95 upper .95
sex     1.772     0.5643     1.381     2.273
age     1.079     0.9268     1.059     1.099
sbp     1.005     0.9947     1.001     1.010

Concordance= 0.662  (se = 0.018 )
Likelihood ratio test= 83.24  on 3 df,   p=&lt;2e-16
Wald test            = 86.63  on 3 df,   p=&lt;2e-16
Score (logrank) test = 90.38  on 3 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-101_a634733f169d33de43550972be10a2b5">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cumulative hazard for subjects without ESVEA</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>esvea0_haz <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="fu">subset</span>(<span class="fu">basehaz</span>(cox251_esvea, <span class="at">centered =</span> <span class="cn">FALSE</span>), strata <span class="sc">==</span> <span class="st">"esvea=0"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(esvea0_haz) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"haz0"</span>, <span class="st">"time"</span>)</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Cumulative hazard for subjects with ESVEA</span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>esvea1_haz <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="fu">subset</span>(<span class="fu">basehaz</span>(cox251_esvea, <span class="at">centered =</span> <span class="cn">FALSE</span>), strata <span class="sc">==</span> <span class="st">"esvea=1"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(esvea1_haz) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"haz1"</span>, <span class="st">"time"</span>)</span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Data frame with time column and both hazards</span></span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>ph_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(esvea0_haz, esvea1_haz, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a>ph_data <span class="ot">&lt;-</span> ph_data <span class="sc">%&gt;%</span> <span class="fu">fill</span>(haz0,haz1)</span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the hazards against each other</span></span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ph_data) <span class="sc">+</span> <span class="fu">geom_step</span>(<span class="fu">aes</span>(haz0, haz1)) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="fl">1.374825</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Cumulative hazard for subjects with ESVEA = 0"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Cumulative hazard for subjects with ESVEA = 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
<p>The cumulative hazard deviates a bit from the straight line. This suggests that the assumption of proportional hazards for subjects with or without ESVEA may not be reasonable.</p>
<p>We repeat the procedure but this time examining the proportional hazards assumption of sex.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-102_36a897e1af7ccc92ddcdbb8143d8578f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model with separate hazards for male and female subjects</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>cox251_sex <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> <span class="fu">strata</span>(sex) <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span>chs_data)</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox251_sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea + 
    strata(sex) + age + sbp, data = chs_data, ties = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

          coef exp(coef) se(coef)     z Pr(&gt;|z|)    
esvea 0.322685  1.380830 0.152751 2.112   0.0346 *  
age   0.076270  1.079253 0.009363 8.146 3.77e-16 ***
sbp   0.005173  1.005187 0.002436 2.124   0.0337 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
esvea     1.381     0.7242     1.024     1.863
age       1.079     0.9266     1.060     1.099
sbp       1.005     0.9948     1.000     1.010

Concordance= 0.669  (se = 0.016 )
Likelihood ratio test= 94.47  on 3 df,   p=&lt;2e-16
Wald test            = 95.6  on 3 df,   p=&lt;2e-16
Score (logrank) test = 102.1  on 3 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-103_0c6f784dd7ba72ee4bf4f938ed479d97">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cumulative hazard for females</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>sex0_haz <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="fu">subset</span>(<span class="fu">basehaz</span>(cox251_sex, <span class="at">centered =</span> <span class="cn">FALSE</span>), strata <span class="sc">==</span> <span class="st">"sex=0"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sex0_haz) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"haz0"</span>, <span class="st">"time"</span>)</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Cumulative hazard for males</span></span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>sex1_haz <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="fu">subset</span>(<span class="fu">basehaz</span>(cox251_sex, <span class="at">centered =</span> <span class="cn">FALSE</span>), strata <span class="sc">==</span> <span class="st">"sex=1"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sex1_haz) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"haz1"</span>, <span class="st">"time"</span>)</span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Data frame with time column and both hazards</span></span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a>ph_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(sex0_haz, sex1_haz, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a>ph_data <span class="ot">&lt;-</span> ph_data <span class="sc">%&gt;%</span> <span class="fu">fill</span>(haz0,haz1)</span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the hazards against each other</span></span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ph_data) <span class="sc">+</span> <span class="fu">geom_step</span>(<span class="fu">aes</span>(haz0, haz1)) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="fl">1.781584</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Cumulative hazard for subjects with sex = 0"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Cumulative hazard for subjects with sex = 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
<p>The curve coincides nicely with the straight line. Thus, the proportional hazard assumption seems reasonable for sex.</p>
</section>
<section id="section-14" class="level4">
<h4 class="anchored" data-anchor-id="section-14">2.</h4>
<p><em>Check for linearity on the log(hazard)-scale for age and sysBP</em>.</p>
<p>We can check the linearity assumptions on the log(hazards)-scale for age and systolic blood pressure by including non-linear effects.</p>
<p>The linearity assumption of systolic blood pressure can be investigated by including a linear spline. We select 135 as a knot since this value is typically the cut-point for medication for hypertension.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-104_c3c937b4c8cfd41fa9c0f8776e9abeeb">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding covariate (systolisk - 135)*I(systolisk &gt; 135)</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>hypertension <span class="ot">&lt;-</span> (chs_data<span class="sc">$</span>sbp <span class="sc">-</span> <span class="dv">135</span>)<span class="sc">*</span>(chs_data<span class="sc">$</span>sbp <span class="sc">&gt;</span> <span class="dv">135</span>)</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model with non-linear effect of systolic blood pleasure (linear spline)</span></span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>cox252_sbp <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp <span class="sc">+</span> hypertension, <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> chs_data)</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox252_sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea + 
    sex + age + sbp + hypertension, data = chs_data, ties = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

                  coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
esvea         0.322940  1.381183  0.152659  2.115   0.0344 *  
sex           0.577846  1.782195  0.126886  4.554 5.26e-06 ***
age           0.076676  1.079692  0.009369  8.184 2.75e-16 ***
sbp           0.016525  1.016662  0.015020  1.100   0.2713    
hypertension -0.012579  0.987500  0.016299 -0.772   0.4403    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

             exp(coef) exp(-coef) lower .95 upper .95
esvea           1.3812     0.7240    1.0240     1.863
sex             1.7822     0.5611    1.3898     2.285
age             1.0797     0.9262    1.0600     1.100
sbp             1.0167     0.9836    0.9872     1.047
hypertension    0.9875     1.0127    0.9565     1.020

Concordance= 0.671  (se = 0.016 )
Likelihood ratio test= 100.1  on 5 df,   p=&lt;2e-16
Wald test            = 103.9  on 5 df,   p=&lt;2e-16
Score (logrank) test = 110.1  on 5 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>We compare this non-linear model with the linear model from exercise 2.4.1 using a likelihood ratio test.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-105_625ecc962786585a3a2827824264bcb4">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(cox241,cox252_sbp, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(timestrokeordeath, strokeordeath)
 Model 1: ~ esvea + sex + age + sbp
 Model 2: ~ esvea + sex + age + sbp + hypertension
   loglik  Chisq Df Pr(&gt;|Chi|)
1 -1729.0                     
2 -1728.7 0.6254  1      0.429</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 0.6254 on 1 degree of freedom with a corresponding p-value of 0.429 when comparing the two Cox models. Including a linear spline to our model does not seem to describe data better than the model from exercise 2.4.1.</p>
<p>We will test the linearity assumption of age by adding a quadratic term to the Cox model.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-106_dfe91333a416ca52ecf7b6f74b27ce75">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model with non-linear assumption of age (quadratic term)</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>cox252_age <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> sbp, <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span>chs_data)</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox252_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea + 
    sex + age + I(age^2) + sbp, data = chs_data, ties = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

               coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    
esvea     0.3172738  1.3733785  0.1526657  2.078   0.0377 *  
sex       0.5820931  1.7897808  0.1293139  4.501 6.75e-06 ***
age       0.1117230  1.1182031  0.1955347  0.571   0.5677    
I(age^2) -0.0002659  0.9997341  0.0014809 -0.180   0.8575    
sbp       0.0051368  1.0051500  0.0024407  2.105   0.0353 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
esvea       1.3734     0.7281    1.0182     1.852
sex         1.7898     0.5587    1.3891     2.306
age         1.1182     0.8943    0.7622     1.640
I(age^2)    0.9997     1.0003    0.9968     1.003
sbp         1.0052     0.9949    1.0004     1.010

Concordance= 0.672  (se = 0.016 )
Likelihood ratio test= 99.48  on 5 df,   p=&lt;2e-16
Wald test            = 103.6  on 5 df,   p=&lt;2e-16
Score (logrank) test = 111.5  on 5 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>Then we compare this model to the Cox model from 2.4.1 using a likelihood ratio test.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-107_21f7db985c7a82c38ee5fcfbe684cbda">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(cox241, cox252_age, <span class="at">test =</span><span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(timestrokeordeath, strokeordeath)
 Model 1: ~ esvea + sex + age + sbp
 Model 2: ~ esvea + sex + age + I(age^2) + sbp
  loglik  Chisq Df Pr(&gt;|Chi|)
1  -1729                     
2  -1729 0.0323  1     0.8574</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 0.323 on 1 degrees of freedom and a corresponding p-value of 0.8574 when comparing the Cox models. Thus, we do not find evidence against the linearity assumption of age.</p>
</section>
<section id="section-15" class="level4">
<h4 class="anchored" data-anchor-id="section-15">3.</h4>
<p><em>Do the same for the Poisson model</em>.</p>
<p>To investigate the assumption of proportional hazards for subjects with or without ESVEA for the Poisson model we will include an interaction term between time and ESVEA. This model can then be compared with the model from exercise 2.4.1 using a likelihood ratio test.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-108_1040d4553c8c48b30a79ae99a5ddfd24">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Poisson model with interaction term of time and esvea</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>poisson253_esvea <span class="ot">&lt;-</span> <span class="fu">glm</span>(strokeordeath <span class="sc">~</span> <span class="fu">factor</span>(interval) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> esvea<span class="sc">:</span><span class="fu">factor</span>(interval) <span class="sc">+</span> age <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poisson253_esvea)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = strokeordeath ~ factor(interval) - 1 + esvea + 
    sex + esvea:factor(interval) + age + sbp + offset(log(duration)), 
    family = poisson(), data = data_pch)

Coefficients:
                          Estimate Std. Error z value Pr(&gt;|z|)    
factor(interval)1       -10.080740   0.704932 -14.300  &lt; 2e-16 ***
factor(interval)2        -9.369197   0.693746 -13.505  &lt; 2e-16 ***
factor(interval)3        -8.973328   0.687025 -13.061  &lt; 2e-16 ***
esvea                    -0.230225   0.320302  -0.719   0.4723    
sex                       0.571910   0.127003   4.503  6.7e-06 ***
age                       0.075444   0.009374   8.048  8.4e-16 ***
sbp                       0.005196   0.002438   2.131   0.0331 *  
factor(interval)1:esvea   0.992907   0.401923   2.470   0.0135 *  
factor(interval)2:esvea   0.523021   0.404268   1.294   0.1958    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 15060.9  on 1767  degrees of freedom
Residual deviance:  1443.1  on 1758  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 2031.1

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-109_589892a25debc9773a7aa96e9629c540">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(poisson242, poisson253_esvea, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: strokeordeath ~ factor(interval) - 1 + esvea + sex + age + sbp + 
    offset(log(duration))
Model 2: strokeordeath ~ factor(interval) - 1 + esvea + sex + esvea:factor(interval) + 
    age + sbp + offset(log(duration))
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
1      1760     1449.7                       
2      1758     1443.1  2   6.5411  0.03798 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 6.5411 on 2 degrees of freedom and a corresponding p-value of 0.03798. This suggests that the proportional hazard assumption is questionable for ESVEA.</p>
<p>We will now repeat the procedure to investigate the proportional hazards assumption for sex for the Poisson model.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-110_605a77a9d0b0f906b7f5dfbd469a2f18">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Poisson model with interaction term of time and sex</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>poisson253_sex <span class="ot">&lt;-</span> <span class="fu">glm</span>(strokeordeath <span class="sc">~</span> <span class="fu">factor</span>(interval) <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> sex<span class="sc">:</span><span class="fu">factor</span>(interval) <span class="sc">+</span> age <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poisson253_sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = strokeordeath ~ factor(interval) - 1 + esvea + 
    sex + sex:factor(interval) + age + sbp + offset(log(duration)), 
    family = poisson(), data = data_pch)

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
factor(interval)1     -9.991770   0.713147 -14.011  &lt; 2e-16 ***
factor(interval)2     -9.480863   0.700359 -13.537  &lt; 2e-16 ***
factor(interval)3     -8.986670   0.692599 -12.975  &lt; 2e-16 ***
esvea                  0.309414   0.152608   2.028   0.0426 *  
sex                    0.437336   0.202502   2.160   0.0308 *  
age                    0.076069   0.009362   8.125 4.47e-16 ***
sbp                    0.005064   0.002436   2.079   0.0377 *  
factor(interval)1:sex  0.161900   0.313850   0.516   0.6060    
factor(interval)2:sex  0.271022   0.286341   0.947   0.3439    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 15060.9  on 1767  degrees of freedom
Residual deviance:  1448.8  on 1758  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 2036.8

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-111_c7478d118d4b9084c790443de64616ce">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(poisson242, poisson253_sex, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: strokeordeath ~ factor(interval) - 1 + esvea + sex + age + sbp + 
    offset(log(duration))
Model 2: strokeordeath ~ factor(interval) - 1 + esvea + sex + sex:factor(interval) + 
    age + sbp + offset(log(duration))
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1      1760     1449.7                     
2      1758     1448.8  2  0.90827    0.635</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 0.9083 with a corresponding p-value of 0.635. We conclude that we do not have evidence against the proportional hazards assumption for sex.</p>
<p>We will also check the linearity assumption of sbp by inclusion the indicator of hypertension in the Poisson model</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-112_c2085b15bd961a77404784cd71f12be4">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Splitting data in 5-year intervals</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>data_pch <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> age <span class="sc">+</span> sex <span class="sc">+</span> sbp <span class="sc">+</span> hypertension,  </span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> chs_data, </span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">cut =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>), </span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">episode =</span> <span class="st">"interval"</span>)</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>data_pch<span class="sc">$</span>duration <span class="ot">&lt;-</span> data_pch<span class="sc">$</span>timestrokeordeath <span class="sc">-</span> data_pch<span class="sc">$</span>tstart</span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Poisson model with non-linear effect of systolic blood pleasure (linear spline)</span></span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a>poisson253_sbp <span class="ot">&lt;-</span> <span class="fu">glm</span>(strokeordeath <span class="sc">~</span> <span class="fu">factor</span>(interval) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp <span class="sc">+</span> hypertension <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb292-10"><a href="#cb292-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poisson253_sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = strokeordeath ~ factor(interval) - 1 + esvea + 
    sex + age + sbp + hypertension + offset(log(duration)), family = poisson(), 
    data = data_pch)

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
factor(interval)1 -11.457462   2.063531  -5.552 2.82e-08 ***
factor(interval)2 -10.875624   2.059459  -5.281 1.29e-07 ***
factor(interval)3 -10.548863   2.056350  -5.130 2.90e-07 ***
esvea               0.315588   0.152617   2.068   0.0387 *  
sex                 0.579222   0.126819   4.567 4.94e-06 ***
age                 0.076174   0.009367   8.132 4.22e-16 ***
sbp                 0.016310   0.015004   1.087   0.2770    
hypertension       -0.012441   0.016280  -0.764   0.4448    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 15060.9  on 1767  degrees of freedom
Residual deviance:  1449.1  on 1759  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 2035.1

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-113_1f555c702b772213d1dc8069e542060d">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(poisson242, poisson253_sbp ,<span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: strokeordeath ~ factor(interval) - 1 + esvea + sex + age + sbp + 
    offset(log(duration))
Model 2: strokeordeath ~ factor(interval) - 1 + esvea + sex + age + sbp + 
    hypertension + offset(log(duration))
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1      1760     1449.7                     
2      1759     1449.1  1  0.61294   0.4337</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 0.613 on 1 degree of freedom with a corresponding p-value of 0.4337 when comparing the Poisson models.</p>
<p>We will test the linearity assumption of age by adding a quadratic term to the Poisson model.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-114_5d91805228c447c7c51814eeb809e294">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Poisson model with non-linear assumption of age (quadratic term)</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>poisson253_age <span class="ot">&lt;-</span> <span class="fu">glm</span>(strokeordeath <span class="sc">~</span> <span class="fu">factor</span>(interval) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(duration)), <span class="at">family =</span> <span class="fu">poisson</span>(), <span class="at">data =</span> data_pch)</span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poisson253_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = strokeordeath ~ factor(interval) - 1 + esvea + 
    sex + age + I(age^2) + sbp + offset(log(duration)), family = poisson(), 
    data = data_pch)

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
factor(interval)1 -1.123e+01  6.412e+00  -1.751   0.0799 .  
factor(interval)2 -1.065e+01  6.411e+00  -1.661   0.0968 .  
factor(interval)3 -1.032e+01  6.411e+00  -1.610   0.1074    
esvea              3.100e-01  1.526e-01   2.031   0.0423 *  
sex                5.837e-01  1.292e-01   4.518 6.26e-06 ***
age                1.143e-01  1.956e-01   0.584   0.5589    
I(age^2)          -2.891e-04  1.481e-03  -0.195   0.8452    
sbp                5.045e-03  2.440e-03   2.067   0.0387 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 15060.9  on 1767  degrees of freedom
Residual deviance:  1449.6  on 1759  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 2035.6

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-115_57d06506cb58724681d03ebc3cf5a293">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(poisson242, poisson253_age,<span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: strokeordeath ~ factor(interval) - 1 + esvea + sex + age + sbp + 
    offset(log(duration))
Model 2: strokeordeath ~ factor(interval) - 1 + esvea + sex + age + I(age^2) + 
    sbp + offset(log(duration))
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1      1760     1449.7                     
2      1759     1449.6  1 0.038156   0.8451</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 0.03816 on 1 degree of freedom and a corresponding p-value of 0.8451 when comparing the Poisson models. Thus, there is not evidence against the linearity assumption of age.</p>
</section>
</section>
<section id="exercise-2.6" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.6">Exercise 2.6</h3>
<p><em>Consider the data from the Copenhagen Holter study and focus now on the mortality rate after stroke</em>.</p>
<section id="section-16" class="level4">
<h4 class="anchored" data-anchor-id="section-16">1.</h4>
<p><em>Estimate non-parametrically the cumulative hazards for subjects with or without ESVEA using the time variable time since recruitment</em>.</p>
<p>We first make a subset the data which only includes subjects experiencing a stroke during the study. Furthermore, we will add 0.5 day to the time of death for observations where time of stroke and time of death are the same.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-116_b9decf4b7e4f133b3e6b5d724225c79d">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subset of data. Only subjects with strokes during the period of the study</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>stroke_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(chs_data, stroke <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding 0.5 day to timedeath for subjects with ties</span></span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>stroke_data<span class="sc">$</span>timedeath <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(stroke_data<span class="sc">$</span>timestroke <span class="sc">==</span> stroke_data<span class="sc">$</span>timedeath, stroke_data<span class="sc">$</span>timedeath <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">/</span><span class="fl">365.25</span>, stroke_data<span class="sc">$</span>timedeath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Once again we use the <strong>survfit</strong> function from the survival package to obtain the Nelson-Aalen estimates. Since the time variable is time since recruitment we need to take delayed entry into account. Thus, both the entry time and exit time of the stroke state, <strong>timestroke</strong> and <strong>timedeath</strong>, are included in the <strong>Surv</strong> object.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-117_9ce5e068ad36fb59814b7fde5b4815a0">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>naafit261 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timestroke, timedeath, death) <span class="sc">~</span> esvea, <span class="at">data =</span> stroke_data)</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>naadata261 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> naafit261<span class="sc">$</span>time,</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cumhaz =</span> naafit261<span class="sc">$</span>cumhaz, </span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">esvea =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(naafit261<span class="sc">$</span>strata)[<span class="dv">1</span>], naafit261<span class="sc">$</span>strata[<span class="dv">1</span>]),</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="fu">names</span>(naafit261<span class="sc">$</span>strata)[<span class="dv">2</span>], naafit261<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a>(fig261 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> esvea), <span class="at">data =</span> naadata261) <span class="sc">+</span> </span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_linetype_discrete</span>(<span class="st">"ESVEA"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)) <span class="sc">+</span> </span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-117-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
</section>
<section id="section-17" class="level4">
<h4 class="anchored" data-anchor-id="section-17">2.</h4>
<p><em>Assume proportional hazards and estimate the hazard ratio between subjects with or without ESVEA</em>.</p>
<p>Similarly, we fit the Cox model where both time of entry and exit are included in the <strong>Surv</strong> object.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-118_3de03130a558d297918cd4ab3f604736">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model with time since recruitment as baseline</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>cox262 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestroke, timedeath, death) <span class="sc">~</span> esvea, <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span>stroke_data)</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox262)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestroke, timedeath, death) ~ esvea, data = stroke_data, 
    ties = "breslow")

  n= 73, number of events= 47 

        coef exp(coef) se(coef)     z Pr(&gt;|z|)
esvea 0.2624    1.3001   0.3075 0.853    0.393

      exp(coef) exp(-coef) lower .95 upper .95
esvea       1.3     0.7692    0.7116     2.375

Concordance= 0.549  (se = 0.036 )
Likelihood ratio test= 0.72  on 1 df,   p=0.4
Wald test            = 0.73  on 1 df,   p=0.4
Score (logrank) test = 0.73  on 1 df,   p=0.4</code></pre>
</div>
</div>
<p>We get a hazard ratio of 1.300 for ESVEA with a Wald test of 0.853 and a corresponding p-value of 0.393. This suggests that having ESVEA does not significantly increase the rate of death after stroke when the time variable is time since recruitment.</p>
</section>
<section id="section-18" class="level4">
<h4 class="anchored" data-anchor-id="section-18">3.</h4>
<p><em>Repeat these two questions using now the time variable time since stroke and compare the results</em>.</p>
<p>In the model where the time variable is time since stroke, a new variable <strong>timesincestroke</strong> is added to the data set and used as time variable in the <strong>Surv</strong> object in the formula for the Cox model.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-119_78a7c2cb0f291acbfc804241621d02a7">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding time since stroke as new column to the data set</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>stroke_data<span class="sc">$</span>timesincestroke <span class="ot">&lt;-</span> stroke_data<span class="sc">$</span>timedeath <span class="sc">-</span> stroke_data<span class="sc">$</span>timestroke</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The cumulative hazards are then estimated non-parametrically using <strong>survfit</strong>.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-120_5f366e73850a1f943b729eda3384e136">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>naafit263 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timesincestroke, death) <span class="sc">~</span> esvea, <span class="at">data =</span> stroke_data)</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>naadata263 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> naafit263<span class="sc">$</span>time,</span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cumhaz =</span> naafit263<span class="sc">$</span>cumhaz, </span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">esvea =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(naafit263<span class="sc">$</span>strata)[<span class="dv">1</span>], naafit263<span class="sc">$</span>strata[<span class="dv">1</span>]),</span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="fu">names</span>(naafit263<span class="sc">$</span>strata)[<span class="dv">2</span>], naafit263<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>(fig263 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> esvea), <span class="at">data =</span> naadata263) <span class="sc">+</span> </span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_linetype_discrete</span>(<span class="st">"ESVEA"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)) <span class="sc">+</span> </span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Time since stroke (years)"</span>) <span class="sc">+</span> </span>
<span id="cb305-12"><a href="#cb305-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-120-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
<p>The hazard ratio is estimated assuming proportional hazards using the Cox model</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-121_366b4d58494c3415a195506b3bc9a55c">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>cox263 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timesincestroke, death) <span class="sc">~</span> esvea, <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span>stroke_data)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox263)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timesincestroke, death) ~ esvea, data = stroke_data, 
    ties = "breslow")

  n= 73, number of events= 47 

        coef exp(coef) se(coef)     z Pr(&gt;|z|)
esvea 0.1532    1.1655   0.3103 0.494    0.622

      exp(coef) exp(-coef) lower .95 upper .95
esvea     1.166      0.858    0.6345     2.141

Concordance= 0.507  (se = 0.038 )
Likelihood ratio test= 0.24  on 1 df,   p=0.6
Wald test            = 0.24  on 1 df,   p=0.6
Score (logrank) test = 0.24  on 1 df,   p=0.6</code></pre>
</div>
</div>
<p>We get a hazard ratio of 1.1654 and a Wald test of 0.493 with a corresponding p-value of 0.622. This suggests that ESVEA does not change the hazard significantly when the time variable is time since stroke as well.</p>
</section>
</section>
<section id="exercise-2.7" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.7">Exercise 2.7</h3>
<section id="section-19" class="level4">
<h4 class="anchored" data-anchor-id="section-19">1.</h4>
<p><em>Consider the data from the Copenhagen Holter study and fit Cox models for the cause-specific hazards for the outcomes stroke and death without stroke including ESVEA, sex, age, and sysBP</em>.</p>
<p>We fit a Cox model to the cause-specific hazard for the outcome stroke</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-122_c52d46340225c005ee9b9b5e9645fa26">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>cox27_stroke <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, stroke) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span>chs_data)</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox27_stroke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, stroke) ~ esvea + sex + 
    age + sbp, data = chs_data, ties = "breslow")

  n= 675, number of events= 72 
   (3 observations deleted due to missingness)

          coef exp(coef) se(coef)     z Pr(&gt;|z|)    
esvea 0.702407  2.018606 0.269968 2.602  0.00927 ** 
sex   0.491881  1.635389 0.248634 1.978  0.04789 *  
age   0.078980  1.082183 0.019054 4.145  3.4e-05 ***
sbp   0.011340  1.011404 0.004651 2.438  0.01477 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
esvea     2.019     0.4954     1.189     3.426
sex       1.635     0.6115     1.005     2.662
age       1.082     0.9241     1.043     1.123
sbp       1.011     0.9887     1.002     1.021

Concordance= 0.728  (se = 0.028 )
Likelihood ratio test= 41.22  on 4 df,   p=2e-08
Wald test            = 43.26  on 4 df,   p=9e-09
Score (logrank) test = 47.2  on 4 df,   p=1e-09</code></pre>
</div>
</div>
<p>We get a hazard ratio of 2.02 and a Wald test of 2.602 with a corresponding p-value of 0.009.</p>
<p>To fit a Cox model for the outcome death without stroke we must first add the variable death without stroke to our data set. Afterwards, the model can be fitted using <strong>coxph</strong>.</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-123_c496b64db96c1d4a62c4f0e14a2951ed">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>death_wo_stroke <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(chs_data<span class="sc">$</span>stroke <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, chs_data<span class="sc">$</span>death)</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>cox27_death <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, death_wo_stroke) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">ties =</span> <span class="st">"breslow"</span>, <span class="at">data =</span>chs_data)</span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox27_death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, death_wo_stroke) ~ esvea + 
    sex + age + sbp, data = chs_data, ties = "breslow")

  n= 675, number of events= 213 
   (3 observations deleted due to missingness)

          coef exp(coef) se(coef)     z Pr(&gt;|z|)    
esvea 0.160081  1.173605 0.186795 0.857    0.391    
sex   0.605281  1.831766 0.147665 4.099 4.15e-05 ***
age   0.076073  1.079041 0.010759 7.071 1.54e-12 ***
sbp   0.002956  1.002960 0.002867 1.031    0.303    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
esvea     1.174     0.8521    0.8138     1.692
sex       1.832     0.5459    1.3714     2.447
age       1.079     0.9267    1.0565     1.102
sbp       1.003     0.9970    0.9973     1.009

Concordance= 0.657  (se = 0.019 )
Likelihood ratio test= 64.37  on 4 df,   p=3e-13
Wald test            = 67.44  on 4 df,   p=8e-14
Score (logrank) test = 70.93  on 4 df,   p=1e-14</code></pre>
</div>
</div>
<p>We get a hazard ratio of 1.17 and a Wald test of 0.857 with a corresponding p-value of 0.391.</p>
</section>
<section id="section-20" class="level4">
<h4 class="anchored" data-anchor-id="section-20">2.</h4>
<p><em>Compare with the results from Exercise 4 in Chapter 2 (first question)</em>.</p>
<p>It is seen that (male) sex and age are both significantly associated with increased cause-specific hazards whereas ESVEA and SysBP are only associated with the rate of stroke. The coefficients for the composite end-point are between those for the cause-specific hazards.</p>
<p>Please note that the Cox model for the composite end-point and those for the separate cause-specific hazards are mathematically incompatible.</p>
</section>
</section>
<section id="exercise-2.8" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.8">Exercise 2.8</h3>
<p><em>Consider the data on repeated episodes in affective disorder, Example 1.1.5</em>.</p>
<p>The data should be loaded as <strong>affective_data</strong></p>
<p>Load the relevant packages:</p>
<div class="cell" data-hash="Ch2_cache/html/packages_1deef7a00f41c0e88d05c8eb82d12530">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co">#Data manipulations and plots</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co">#Core survival analysis routines</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mets)</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="section-21" class="level4">
<h4 class="anchored" data-anchor-id="section-21">1.</h4>
<p><em>Estimate non-parametrically the cumulative event intensities for unipolar and bipolar patients</em>.</p>
<p>We estimate the cumulative event intensities non-parametrically using the <strong>survfit</strong> function from the <em>survival</em> package. We must include the <strong>id = id</strong> argument since we have multiple lines from the same subject. Furthermore, we include <strong>start</strong> in the <strong>surv</strong> object of the formula argument to account for delayed entry and restrict attention to records with state=0 (out of hospital).</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-124_bbfc38c9155cb92e2abdf7c684964abb">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimating the cumulative event intensities for unipolar and bipolar patients non-parametrically</span></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>naafit281 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip,</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> <span class="fu">subset</span>(affective_data, state<span class="sc">==</span><span class="dv">0</span>), <span class="at">id =</span> id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then plot the result</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-125_37cde4f3f667a7bc67c5a8b31bf17ed7">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting data in data frame</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>naadata281 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> naafit281<span class="sc">$</span>cumhaz,</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">time =</span> naafit281<span class="sc">$</span>time,</span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">disorder =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Unipolar"</span>, naafit281<span class="sc">$</span>strata[[<span class="dv">1</span>]]),</span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Bipolar"</span>, naafit281<span class="sc">$</span>strata[[<span class="dv">2</span>]])))</span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-7"><a href="#cb314-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the result</span></span>
<span id="cb314-8"><a href="#cb314-8" aria-hidden="true" tabindex="-1"></a>fig281 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> naadata281) <span class="sc">+</span> <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">x =</span> time<span class="sc">/</span><span class="dv">12</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> disorder), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb314-9"><a href="#cb314-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative event intensity"</span>) <span class="sc">+</span></span>
<span id="cb314-10"><a href="#cb314-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since first admission (years)"</span>) <span class="sc">+</span></span>
<span id="cb314-11"><a href="#cb314-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span>
<span id="cb314-12"><a href="#cb314-12" aria-hidden="true" tabindex="-1"></a>fig281</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-125-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
<p>The cumulative event intensity is at all times higher for bipolar patients compared to unipolar patients.</p>
</section>
<section id="section-22" class="level4">
<h4 class="anchored" data-anchor-id="section-22">2.</h4>
<p><em>Fit an AG-type model and estimate, thereby, the ratio between intensities for unipolar and bipolar patients, adjusting for year of diagnosis</em>.</p>
<p>We can fit a very simple version of a AG model (like the one described in Section 2.4.1) using the <strong>coxph</strong> function from the survival package. We take delayed entry into account in the <strong>Surv</strong> object of the formula argument and adjust for disease type (unipolar vs bipolar) and year of diagnosis. Furthermore, we restrict the data set to the rows where patients are out of hospital (state = 0).</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-126_36ab1c8a5091306ab196ecc200c4f684">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting an AG-type model</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>agfit282 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip <span class="sc">+</span> year, </span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective_data, state <span class="sc">==</span> <span class="dv">0</span>), </span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(agfit282)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip + year, 
    data = subset(affective_data, state == 0), method = "breslow")

  n= 626, number of events= 542 

         coef exp(coef) se(coef)      z Pr(&gt;|z|)    
bip   0.35001   1.41908  0.09457  3.701 0.000215 ***
year -0.11814   0.88857  0.03404 -3.471 0.000519 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     exp(coef) exp(-coef) lower .95 upper .95
bip     1.4191     0.7047    1.1790    1.7081
year    0.8886     1.1254    0.8312    0.9499

Concordance= 0.567  (se = 0.021 )
Likelihood ratio test= 26.48  on 2 df,   p=2e-06
Wald test            = 26.87  on 2 df,   p=1e-06
Score (logrank) test = 27.1  on 2 df,   p=1e-06</code></pre>
</div>
</div>
<p>Thus, we estimate hazard ratio of <span class="math inline">\(\exp(0.35) = 1.4291\)</span> of admission to hospital for being diagnosed with bipolar disorder compared to those diagnosed with unipolar disorder.</p>
</section>
<section id="section-23" class="level4">
<h4 class="anchored" data-anchor-id="section-23">3.</h4>
<p><em>Fit a PWP model and estimate, thereby, the ratio between intensities for unipolar and bipolar patients, adjusting for year of diagnosis</em>.</p>
<p>We can fit a PWP model using the <strong>coxph</strong> function by adding <strong>strata(episode)</strong> in the formula argument. We must still restrict the data to time periods where the patients are out of hospital (state = 0).</p>
<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-127_c871a12b412360cbe909ce474e4e04bd">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting a PWP model</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>pwpfit283 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="fu">strata</span>(episode) <span class="sc">+</span> bip <span class="sc">+</span> year, </span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> <span class="fu">subset</span>(affective_data, state <span class="sc">==</span> <span class="dv">0</span>), </span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pwpfit283)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ strata(episode) + 
    bip + year, data = subset(affective_data, state == 0), method = "breslow")

  n= 626, number of events= 542 

         coef exp(coef) se(coef)      z Pr(&gt;|z|)  
bip   0.24213   1.27396  0.11199  2.162   0.0306 *
year -0.03514   0.96547  0.03940 -0.892   0.3724  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     exp(coef) exp(-coef) lower .95 upper .95
bip     1.2740      0.785    1.0229     1.587
year    0.9655      1.036    0.8937     1.043

Concordance= 0.54  (se = 0.021 )
Likelihood ratio test= 5.34  on 2 df,   p=0.07
Wald test            = 5.45  on 2 df,   p=0.07
Score (logrank) test = 5.47  on 2 df,   p=0.06</code></pre>
</div>
</div>
<p>We get an estimate of the hazard ratio of readmission for patients diagnosed with bipolar disorder of <span class="math inline">\(\exp(0.2421) = 1.274\)</span> compared to patients diagnosed with unipolar disorder.</p>
</section>
<section id="section-24" class="level4">
<h4 class="anchored" data-anchor-id="section-24">4.</h4>
<p><em>Compare the results from the two models</em>.</p>
<p>We get a smaller coefficient of <em>bip</em> with the PWP model than with the AG model. This is because, by taking the number of previous episodes into account (via stratification), some of the discrepancy between bipolar and unipolar patients disappears since the occurrence of repeated episodes is itself affected by the initial diagnosis.</p>
<!-- {{< include R/CHS_chapter2.Rmd >}} -->


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch3.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</div>   
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a>, R v4.3.1, and SAS 15.1</div>
  </div>
</footer>



</body></html>