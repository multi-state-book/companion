<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models for Multi-State Survival Data - 2&nbsp; Intuition for intensity models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch3.html" rel="next">
<link href="./Ch1.html" rel="prev">
<link href="./corvos.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./MSBfrontbirds.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Models for Multi-State Survival Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/multi-state-book/companion" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pbc3-trial" id="toc-pbc3-trial" class="nav-link active" data-scroll-target="#pbc3-trial">PBC3 trial</a>
  <ul>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">Read data</a></li>
  <li><a href="#figure-2.1" id="toc-figure-2.1" class="nav-link" data-scroll-target="#figure-2.1">Figure 2.1</a></li>
  <li><a href="#in-text-nelson-aalen-estimates-at-2-years" id="toc-in-text-nelson-aalen-estimates-at-2-years" class="nav-link" data-scroll-target="#in-text-nelson-aalen-estimates-at-2-years">In-text: Nelson-Aalen estimates at 2 years</a></li>
  <li><a href="#table-2.1" id="toc-table-2.1" class="nav-link" data-scroll-target="#table-2.1">Table 2.1</a></li>
  <li><a href="#figure-2.2" id="toc-figure-2.2" class="nav-link" data-scroll-target="#figure-2.2">Figure 2.2</a></li>
  <li><a href="#in-text-lrt-test-piece-wise-exponential-model" id="toc-in-text-lrt-test-piece-wise-exponential-model" class="nav-link" data-scroll-target="#in-text-lrt-test-piece-wise-exponential-model">In-text: LRT test piece-wise exponential model</a></li>
  <li><a href="#in-text-logrank-test-and-p-value" id="toc-in-text-logrank-test-and-p-value" class="nav-link" data-scroll-target="#in-text-logrank-test-and-p-value">In-text: Logrank test and p-value</a></li>
  <li><a href="#figure-2.3" id="toc-figure-2.3" class="nav-link" data-scroll-target="#figure-2.3">Figure 2.3</a></li>
  <li><a href="#in-text-cox-model-with-treatment-only" id="toc-in-text-cox-model-with-treatment-only" class="nav-link" data-scroll-target="#in-text-cox-model-with-treatment-only">In-text: Cox model with treatment only</a></li>
  <li><a href="#figure-2.5" id="toc-figure-2.5" class="nav-link" data-scroll-target="#figure-2.5">Figure 2.5</a></li>
  <li><a href="#table-2.3" id="toc-table-2.3" class="nav-link" data-scroll-target="#table-2.3">Table 2.3</a></li>
  <li><a href="#table-2.4" id="toc-table-2.4" class="nav-link" data-scroll-target="#table-2.4">Table 2.4</a></li>
  <li><a href="#in-text-poisson-model-with-treatment-only-and-time" id="toc-in-text-poisson-model-with-treatment-only-and-time" class="nav-link" data-scroll-target="#in-text-poisson-model-with-treatment-only-and-time">In-text: Poisson model with treatment only (and time)</a></li>
  <li><a href="#table-2.5" id="toc-table-2.5" class="nav-link" data-scroll-target="#table-2.5">Table 2.5</a></li>
  <li><a href="#table-2.6" id="toc-table-2.6" class="nav-link" data-scroll-target="#table-2.6">Table 2.6</a></li>
  <li><a href="#figure-2.6" id="toc-figure-2.6" class="nav-link" data-scroll-target="#figure-2.6">Figure 2.6</a></li>
  <li><a href="#figure-2.7" id="toc-figure-2.7" class="nav-link" data-scroll-target="#figure-2.7">Figure 2.7</a></li>
  <li><a href="#figure-2.8" id="toc-figure-2.8" class="nav-link" data-scroll-target="#figure-2.8">Figure 2.8</a></li>
  <li><a href="#table-2.7" id="toc-table-2.7" class="nav-link" data-scroll-target="#table-2.7">Table 2.7</a></li>
  <li><a href="#table-2.8" id="toc-table-2.8" class="nav-link" data-scroll-target="#table-2.8">Table 2.8</a></li>
  <li><a href="#table-2.9" id="toc-table-2.9" class="nav-link" data-scroll-target="#table-2.9">Table 2.9</a></li>
  <li><a href="#in-text-stratified-cox-model" id="toc-in-text-stratified-cox-model" class="nav-link" data-scroll-target="#in-text-stratified-cox-model">In-text: stratified Cox model</a></li>
  <li><a href="#figure-2.10" id="toc-figure-2.10" class="nav-link" data-scroll-target="#figure-2.10">Figure 2.10</a></li>
  <li><a href="#figure-2.11" id="toc-figure-2.11" class="nav-link" data-scroll-target="#figure-2.11">Figure 2.11</a></li>
  <li><a href="#figure-2.12" id="toc-figure-2.12" class="nav-link" data-scroll-target="#figure-2.12">Figure 2.12</a></li>
  <li><a href="#table-2.10" id="toc-table-2.10" class="nav-link" data-scroll-target="#table-2.10">Table 2.10</a></li>
  <li><a href="#table-2.11" id="toc-table-2.11" class="nav-link" data-scroll-target="#table-2.11">Table 2.11</a></li>
  <li><a href="#table-2.13" id="toc-table-2.13" class="nav-link" data-scroll-target="#table-2.13">Table 2.13</a></li>
  </ul></li>
  <li><a href="#guinea-bissau-study" id="toc-guinea-bissau-study" class="nav-link" data-scroll-target="#guinea-bissau-study">Guinea-Bissau study</a>
  <ul>
  <li><a href="#read-data-1" id="toc-read-data-1" class="nav-link" data-scroll-target="#read-data-1">Read data</a></li>
  <li><a href="#table-2.12" id="toc-table-2.12" class="nav-link" data-scroll-target="#table-2.12">Table 2.12</a></li>
  <li><a href="#figure-2.13" id="toc-figure-2.13" class="nav-link" data-scroll-target="#figure-2.13">Figure 2.13</a></li>
  <li><a href="#figure-2.14" id="toc-figure-2.14" class="nav-link" data-scroll-target="#figure-2.14">Figure 2.14</a></li>
  </ul></li>
  <li><a href="#recurrent-episodes-in-affective-disorders" id="toc-recurrent-episodes-in-affective-disorders" class="nav-link" data-scroll-target="#recurrent-episodes-in-affective-disorders">Recurrent episodes in affective disorders</a>
  <ul>
  <li><a href="#read-data-2" id="toc-read-data-2" class="nav-link" data-scroll-target="#read-data-2">Read data</a></li>
  <li><a href="#table-2.14" id="toc-table-2.14" class="nav-link" data-scroll-target="#table-2.14">Table 2.14</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#exercise-2.1" id="toc-exercise-2.1" class="nav-link" data-scroll-target="#exercise-2.1">Exercise 2.1</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="pbc3-trial" class="level2">
<h2 class="anchored" data-anchor-id="pbc3-trial">PBC3 trial</h2>
<section id="read-data" class="level3">
<h3 class="anchored" data-anchor-id="read-data">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="Ch2_cache/html/read-pbc3_7c5e7a0ce7561c276bfae76569ad2280">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pbc3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">read.csv</span>(<span class="st">"data/pbc3.csv"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>fail <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pbc3<span class="sc">$</span>status <span class="sc">!=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="co"># event/failure indicator</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pbc3<span class="sc">$</span>tment <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add transformations of covariates </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>albnorm <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (alb<span class="dv">-35</span>)<span class="sc">*</span>(alb<span class="sc">&gt;</span><span class="dv">35</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb10 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, alb<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, alb10<span class="sc">*</span>alb10)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilihigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-17.1</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilitoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-34.2</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilimuchtoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-51.3</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili100 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, bili<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, bili100<span class="sc">*</span>bili100)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fu">log2</span>(bili))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, log2bili<span class="sc">*</span>log2bili)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilihigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">17.1</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilitoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">34.2</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilimuchtoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">51.3</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="Ch2_cache/html/read-pbc3-sas_1a41079d202ee419605cd9fa944d1890">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>proc import out<span class="ot">=</span>pbc3</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    datafile<span class="ot">=</span><span class="st">"data/pbc3.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    dbms<span class="ot">=</span>csv replace;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>data pbc3; </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    set pbc3;</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    albnorm<span class="ot">=</span>(alb<span class="dv">-35</span>)<span class="sc">*</span>(alb<span class="sc">&gt;</span><span class="dv">35</span>);</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    alb10<span class="ot">=</span>alb<span class="sc">/</span><span class="dv">10</span>;</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    alb2<span class="ot">=</span>alb<span class="sc">*</span>alb;</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    bilihigh<span class="ot">=</span>(bili<span class="fl">-17.1</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>);</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    bilitoohigh<span class="ot">=</span>(bili<span class="fl">-34.2</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>);</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    bilimuchtoohigh<span class="ot">=</span>(bili<span class="fl">-51.3</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>);</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    bili100<span class="ot">=</span>bili<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    bili2<span class="ot">=</span>bili<span class="sc">*</span>bili;</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    log2bili<span class="ot">=</span><span class="fu">log2</span>(bili);</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    logbilihigh<span class="ot">=</span>(log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">17.1</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>);</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    logbilitoohigh<span class="ot">=</span>(log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">34.2</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>);</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    logbilimuchtoohigh<span class="ot">=</span>(log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">51.3</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>);</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    log2bili2<span class="ot">=</span>log2bili<span class="sc">*</span>log2bili;</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.1" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.1">Figure 2.1</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.1-r_360efa6da07898736d74158924396e3c">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General plotting style </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Nelson Aalen estimate by treatment</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>nafit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>nadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> nafit<span class="sc">$</span>cumhaz, <span class="at">time =</span> nafit<span class="sc">$</span>time, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">1</span>], nafit<span class="sc">$</span>strata[<span class="dv">1</span>]), </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">2</span>], nafit<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.1</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> nadata) <span class="sc">+</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)) <span class="sc">+</span> </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>))  <span class="sc">+</span> </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  theme_general </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.1-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.1-sas_2971f8c0c71777b300aaf356d764f8e2">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3; </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    strata tment;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    baseline out<span class="ot">=</span>hazdat cumhaz<span class="ot">=</span>naa stdcumhaz<span class="ot">=</span>sdnaa;</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>data hazdat; </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    set hazdat; </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    daysyears <span class="ot">=</span> days<span class="sc">/</span><span class="fl">365.25</span>; </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>run; </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>proc gplot data<span class="ot">=</span>hazdat;</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    plot naa<span class="sc">*</span>daysyears<span class="ot">=</span>tment<span class="sc">/</span>haxis<span class="ot">=</span>axis1 vaxis<span class="ot">=</span>axis2;</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    axis1 order<span class="ot">=</span><span class="dv">0</span> to <span class="dv">6</span> by <span class="dv">1</span> minor<span class="ot">=</span>none</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    label<span class="ot">=</span>(<span class="st">'Years'</span>);</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    axis2 order<span class="ot">=</span><span class="dv">0</span> to <span class="fl">0.7</span> by <span class="fl">0.1</span> minor<span class="ot">=</span>none</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    label<span class="ot">=</span>(<span class="at">a=</span><span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    symbol1  v<span class="ot">=</span>none i<span class="ot">=</span>stepjl c<span class="ot">=</span>red;</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    symbol2  v<span class="ot">=</span>none i<span class="ot">=</span>stepjl c<span class="ot">=</span>blue;</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-nelson-aalen-estimates-at-2-years" class="level3">
<h3 class="anchored" data-anchor-id="in-text-nelson-aalen-estimates-at-2-years">In-text: Nelson-Aalen estimates at 2 years</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-Naa2-r_8957e34bc1b500f04af5b85fb869b3b5">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">subset</span>(nadata, nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span><span class="sc">*</span><span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=0"</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     cumhaz time   tment
60 0.183065  724 tment=0</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">subset</span>(nadata, nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span><span class="sc">*</span><span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=1"</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       cumhaz time   tment
209 0.1668539  725 tment=1</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-Naa2-sas_3ba7d701a4b5d9e867348f269518e9d4">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>proc print data<span class="ot">=</span>hazdat;</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    where <span class="fl">1.5</span><span class="sc">&lt;</span>daysyears<span class="sc">&lt;=</span><span class="dv">2</span>; </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.1" class="level3">
<h3 class="anchored" data-anchor-id="table-2.1">Table 2.1</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.1-r_e93318fa26c35aaac27a16a5204129f5">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data for Table 2.1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cuts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>) <span class="sc">*</span> <span class="fl">365.25</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data ready using survSplit from survival package</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>pbc3mult <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">survSplit</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> ., pbc3,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">episode =</span> <span class="st">"timegroup"</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>risktime <span class="ot">&lt;-</span> pbc3mult<span class="sc">$</span>days <span class="sc">-</span> cuts[pbc3mult<span class="sc">$</span>timegroup] </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>pcwdata <span class="ot">&lt;-</span> pbc3mult <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tment, timegroup) <span class="sc">%&gt;%</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fail =</span> <span class="fu">sum</span>(fail), <span class="at">risktime =</span> <span class="fu">sum</span>(days <span class="sc">-</span> cuts[timegroup]))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>risktimeyrs <span class="ot">&lt;-</span> pcwdata<span class="sc">$</span>risktime<span class="sc">/</span><span class="fl">365.25</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>hazard <span class="ot">&lt;-</span> <span class="dv">36525</span><span class="sc">*</span>pcwdata<span class="sc">$</span>fail<span class="sc">/</span>pcwdata<span class="sc">$</span>risktime</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>SD <span class="ot">&lt;-</span> <span class="dv">36525</span><span class="sc">*</span><span class="fu">sqrt</span>(pcwdata<span class="sc">$</span>fail)<span class="sc">/</span>pcwdata<span class="sc">$</span>risktime</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(pcwdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  tment timegroup fail risktime risktimeyrs    hazard       SD
1     0         1   27 104856.0   287.08008  9.405041 1.810001
2     0         2   17  49673.0   135.99726 12.500252 3.031756
3     0         3    2   8642.0    23.66051  8.452904 5.977106
4     1         1   24 107931.5   295.50034  8.121818 1.657859
5     1         2   18  50284.5   137.67146 13.074605 3.081714
6     1         3    2   7599.0    20.80493  9.613107 6.797493</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.1-sas_532ea14a2121c9e86b1bce7686b92f7e">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">*</span> prepare <span class="cf">for</span> poisson model <span class="sc">*</span><span class="er">/</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data pbc3mult; </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    set pbc3;</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    fail<span class="ot">=</span>(days<span class="sc">&lt;=</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>)<span class="sc">*</span>(status ne <span class="dv">0</span>);</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    risktime<span class="ot">=</span><span class="fu">min</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>, days);</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    logrisk<span class="ot">=</span><span class="fu">log</span>(risktime); interv<span class="ot">=</span><span class="dv">1</span>; output;  </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> days<span class="sc">&gt;</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> then do;</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    fail<span class="ot">=</span>(days<span class="sc">&lt;=</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>)<span class="sc">*</span>(status ne <span class="dv">0</span>);</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    risktime<span class="ot">=</span><span class="fu">min</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> ,days<span class="dv">-2</span> <span class="sc">*</span> <span class="fl">365.25</span>);</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    logrisk<span class="ot">=</span><span class="fu">log</span>(risktime); interv<span class="ot">=</span><span class="dv">2</span>; output; end;</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> days<span class="sc">&gt;</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>  then do;</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    fail<span class="ot">=</span>status ne <span class="dv">0</span>; </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    risktime<span class="ot">=</span>days<span class="dv">-4</span> <span class="sc">*</span> <span class="fl">365.25</span>;</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    logrisk<span class="ot">=</span><span class="fu">log</span>(risktime); interv<span class="ot">=</span><span class="dv">3</span>; output; end;</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>proc means sum  data<span class="ot">=</span>pbc3mult;</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    class tment interv;</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    var fail risktime;</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    where tment<span class="ot">=</span><span class="dv">1</span>;</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    class interv;</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span>interv<span class="sc">/</span>dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk;</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'0-2 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span><span class="sc">/</span>exp;</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'2-4 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span><span class="sc">/</span>exp;</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'4-6 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span><span class="sc">/</span>exp;</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    where tment<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    class interv;</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span>interv<span class="sc">/</span>dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk;</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'0-2 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span><span class="sc">/</span>exp;</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'2-4 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span><span class="sc">/</span>exp;</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'4-6 years'</span> intercept <span class="dv">1</span>  interv <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span><span class="sc">/</span>exp;</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.2">Figure 2.2</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.2_cdfa8e9228fb317f206323bf02d03908">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rates + cuts from Table 2.1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>rateCyA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">8.1</span>,<span class="fl">13.1</span>,<span class="fl">9.6</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ratePbo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.4</span>,<span class="fl">12.5</span>,<span class="fl">8.5</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>pcwtime <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rates =</span> <span class="fu">c</span>(rateCyA, ratePbo),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"CyA"</span>, <span class="fu">length</span>(rateCyA)), </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Placebo"</span>, <span class="fu">length</span>(ratePbo))),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times_s =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">4</span>], <span class="dv">2</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.2</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rates, <span class="at">linetype =</span> tment), <span class="at">data =</span> plotdata) <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> times_s, <span class="at">y =</span> rates, <span class="at">xend =</span> times, <span class="at">yend =</span> rates),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>))  <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimated hazard function (per 100 years)"</span>) <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">1</span>))  <span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">14</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.2-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="in-text-lrt-test-piece-wise-exponential-model" class="level3">
<h3 class="anchored" data-anchor-id="in-text-lrt-test-piece-wise-exponential-model">In-text: LRT test piece-wise exponential model</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-lrt-pcw-sas_8c699fe1a7e47350d449274e3c205101">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ods output modelfit<span class="ot">=</span>full;</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    class interv tment;</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span>interv<span class="sc">|</span>tment <span class="sc">/</span>dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk;</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>data full;</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  set full;</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>     where Criterion<span class="ot">=</span><span class="st">"Deviance"</span>;</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>     full_like<span class="ot">=</span>value;</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>     full_df<span class="ot">=</span>df;</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>     keep full_like full_df;</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>proc print;run;</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>ods output modelfit<span class="ot">=</span>reduced;</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    class interv tment;</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span>interv <span class="sc">/</span>dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk;</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>data reduced;</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  set reduced;</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>     where Criterion<span class="ot">=</span><span class="st">"Deviance"</span>;</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>     reduced_like<span class="ot">=</span>value;</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>     reduced_df<span class="ot">=</span>df;</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>     keep reduced_like reduced_df;</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>data lrt_pval;</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a> merge full reduced;</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  lrt <span class="ot">=</span> reduced_like <span class="sc">-</span> full_like;</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    df  <span class="ot">=</span> reduced_df <span class="sc">-</span> full_df;</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  p_value <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">probchi</span>(lrt,df);</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>proc print data<span class="ot">=</span>lrt_pval;</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  title <span class="st">"LR test statistic and p-value"</span>;</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-logrank-test-and-p-value" class="level3">
<h3 class="anchored" data-anchor-id="in-text-logrank-test-and-p-value">In-text: Logrank test and p-value</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-logrank-r_1200ddbd1adf582f7b5cfe917d161e5a">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>lr<span class="ot">&lt;-</span><span class="fu">survdiff</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(lr<span class="sc">$</span>chisq,lr<span class="sc">$</span>pvalue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07708002 0.78129419</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-logrank-sas_915b158c87a70e963a26ef60baeaa488">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>proc lifetest data<span class="ot">=</span>pbc3 notable; </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    time days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>);</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    strata tment;</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.3" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.3">Figure 2.3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.3-r_751567ad599182622ec131bb16a04c3c">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NA data from figure 2.1 model fit</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tment1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(nadata, tment <span class="sc">==</span> <span class="st">"tment=1"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated hazard per time group</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>hazard_timegroup <span class="ot">&lt;-</span> pcwdata<span class="sc">$</span>fail <span class="sc">/</span> pcwdata<span class="sc">$</span>risktime</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a numeric version of the treatment to the NA estimates</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>tmentnum <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=1"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add piecewise constant hazard to data</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Between time 0 and 2</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="ot">&lt;-</span> nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">*</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Between time 2 and 4</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span><span class="sc">*</span> <span class="fl">365.25</span> ] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  (nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>) <span class="sc">*</span> </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">5</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># After time 4</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">5</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  (nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>) <span class="sc">*</span> </span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">3</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">6</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Reformat for plot</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>piecepdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> <span class="fu">c</span>(nadata<span class="sc">$</span>cumhaz, nadata<span class="sc">$</span>pwch), </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">time =</span> <span class="fu">rep</span>(nadata<span class="sc">$</span>time, <span class="dv">2</span>),</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tmentnum =</span> <span class="fu">rep</span>(nadata<span class="sc">$</span>tmentnum, <span class="dv">2</span>),</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Nelson-Aalen"</span>, <span class="fu">length</span>(nadata<span class="sc">$</span>time)), </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Piece-wise exponential"</span>, <span class="fu">length</span>(nadata<span class="sc">$</span>time))))</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Only for treatment 1</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>piecepdata1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(piecepdata, tmentnum <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.3</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> type), </span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(piecepdata1, type <span class="sc">==</span> <span class="st">"Nelson-Aalen"</span>)) <span class="sc">+</span> </span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> type), <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">subset</span>(piecepdata1, type <span class="sc">==</span> <span class="st">"Piece-wise exponential"</span>)) <span class="sc">+</span> </span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">linetype =</span> <span class="st">"Type"</span>) <span class="sc">+</span> </span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>))  <span class="sc">+</span> </span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  theme_general<span class="sc">+</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.3-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.3-sas_630690887820790495d5b62f7cc8d250">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data hazdat; </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    set hazdat;</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> days<span class="sc">&lt;=</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> then </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        pwch<span class="ot">=</span>days<span class="sc">*</span>(<span class="fl">27.0000000</span><span class="sc">/</span><span class="dv">104856</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>tment)<span class="sc">+</span><span class="fl">24.0000000</span><span class="sc">/</span><span class="fl">107931.5</span><span class="sc">*</span>tment);</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&lt;</span>days<span class="sc">&lt;=</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span> then</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        pwch<span class="ot">=</span><span class="dv">2</span><span class="sc">*</span> <span class="fl">365.25</span><span class="sc">*</span>(<span class="fl">27.0000000</span><span class="sc">/</span><span class="dv">104856</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>tment)<span class="sc">+</span><span class="fl">24.0000000</span><span class="sc">/</span><span class="fl">107931.5</span><span class="sc">*</span>tment)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="sc">+</span>(days<span class="dv">-2</span><span class="sc">*</span> <span class="fl">365.25</span>)<span class="sc">*</span>(<span class="fl">17.0000000</span><span class="sc">/</span><span class="dv">49673</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>tment)<span class="sc">+</span><span class="fl">18.0000000</span><span class="sc">/</span><span class="dv">50284</span><span class="sc">*</span>tment);</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&lt;</span>days then</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        pwch<span class="ot">=</span><span class="dv">2</span><span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span>(<span class="fl">27.0000000</span><span class="sc">/</span><span class="dv">104856</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>tment)<span class="sc">+</span><span class="fl">24.0000000</span><span class="sc">/</span><span class="fl">107931.5</span><span class="sc">*</span>tment)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="sc">+</span>(<span class="dv">2</span><span class="sc">*</span> <span class="fl">365.25</span>)<span class="sc">*</span>(<span class="fl">17.0000000</span><span class="sc">/</span><span class="dv">49673</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>tment)<span class="sc">+</span><span class="fl">18.0000000</span><span class="sc">/</span><span class="dv">50284</span><span class="sc">*</span>tment)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="sc">+</span>(days<span class="dv">-4</span><span class="sc">*</span> <span class="fl">365.25</span>)<span class="sc">*</span>(<span class="fl">2.0000000</span><span class="sc">/</span><span class="dv">8642</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>tment)<span class="sc">+</span><span class="fl">2.0000000</span><span class="sc">/</span><span class="dv">7599</span><span class="sc">*</span>tment);</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    daysyears <span class="ot">=</span> days<span class="sc">/</span><span class="fl">365.25</span>; </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>run; </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>proc gplot data<span class="ot">=</span>hazdat; where tment<span class="ot">=</span><span class="dv">1</span>;</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span> (naa pwch)<span class="sc">*</span>daysyears<span class="sc">/</span>overlay haxis<span class="ot">=</span>axis1 vaxis<span class="ot">=</span>axis2;</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    axis1 order<span class="ot">=</span><span class="dv">0</span> to <span class="dv">6</span> by <span class="dv">1</span> minor<span class="ot">=</span>none label<span class="ot">=</span>(<span class="st">'Years'</span>);</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    axis2 order<span class="ot">=</span><span class="dv">0</span> to <span class="fl">0.7</span> by <span class="fl">0.1</span> minor<span class="ot">=</span>none</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>      label<span class="ot">=</span>(<span class="at">a=</span><span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    symbol1  v<span class="ot">=</span>none i<span class="ot">=</span>stepjl r<span class="ot">=</span><span class="dv">1</span> c<span class="ot">=</span>red;</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    symbol2 v<span class="ot">=</span>none i<span class="ot">=</span>join r<span class="ot">=</span><span class="dv">1</span> c<span class="ot">=</span>blue;</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-cox-model-with-treatment-only" class="level3">
<h3 class="anchored" data-anchor-id="in-text-cox-model-with-treatment-only">In-text: Cox model with treatment only</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-cox-r_49b5bf7baa1381473aab9d91bf8b8e29">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a Cox model using the pbc3 data with treatment as a covariate</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>coxfit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment, data = pbc3, 
    method = "breslow")

          coef exp(coef) se(coef)      z     p
tment -0.05854   0.94314  0.21092 -0.278 0.781

Likelihood ratio test=0.08  on 1 df, p=0.7813
n= 349, number of events= 90 </code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-cox-sas_862a605ae735994298683525997798b1">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment<span class="sc">/</span>rl;</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.5" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.5">Figure 2.5</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.5-r_16a3aeb8cec919a3577478e6a6d7cd24">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxfit, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot (Breslow estimate)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>coxdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> coxcumhaz<span class="sc">$</span>hazard, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> coxcumhaz<span class="sc">$</span>time, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tment =</span> <span class="fu">rep</span>(<span class="st">"0"</span>, <span class="fu">nrow</span>(coxcumhaz)), </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Breslow estimate"</span>, <span class="fu">nrow</span>(coxcumhaz)))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> coxdata) <span class="sc">+</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard"</span>) <span class="sc">+</span> </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>)) <span class="sc">+</span> </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  theme_general<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.5-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-hash="Ch2_cache/html/figure-2.5-sas_eefed0823928383b5468cd62c47aa9ea">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data cov;</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    tment<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment<span class="sc">/</span>rl;</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    baseline out<span class="ot">=</span>breslow cumhaz<span class="ot">=</span>breslow covariates<span class="ot">=</span>cov;</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>data breslow; </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    set breslow; </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    daysyears <span class="ot">=</span> days<span class="sc">/</span><span class="fl">365.25</span>; </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>run; </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>proc gplot data<span class="ot">=</span>breslow;</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    plot breslow<span class="sc">*</span>daysyears<span class="ot">=</span>tment<span class="sc">/</span>haxis<span class="ot">=</span>axis1 vaxis<span class="ot">=</span>axis2;</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    axis1 order<span class="ot">=</span><span class="dv">0</span> to <span class="dv">6</span> by <span class="dv">1</span> minor<span class="ot">=</span>none label<span class="ot">=</span>(<span class="st">'Years'</span>);</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    axis2 order<span class="ot">=</span><span class="dv">0</span> to <span class="fl">0.7</span> by <span class="fl">0.1</span> minor<span class="ot">=</span>none label<span class="ot">=</span>(<span class="at">a=</span><span class="dv">90</span> <span class="st">'Cumulative baseline hazard'</span>);</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    symbol1  v<span class="ot">=</span>none i<span class="ot">=</span>stepjl c<span class="ot">=</span>blue;</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.3" class="level3">
<h3 class="anchored" data-anchor-id="table-2.3">Table 2.3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.3-r_0f48d152ab7a2f02efae28eaec43977b">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Average covariate values of albumin and bilirubin per treatment </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>tabledata <span class="ot">&lt;-</span> pbc3 <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tment, tment_char) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(id <span class="sc">!=</span> <span class="dv">0</span>),  </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">average_albumin =</span> <span class="fu">mean</span>(alb, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># </span><span class="al">NOTE</span><span class="co">: Removes missing observations from mean computation</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">average_bilirubin =</span> <span class="fu">mean</span>(bili, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(tabledata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  tment tment_char   n average_albumin average_bilirubin
1     0    Placebo 173        39.26101          42.33674
2     1        CyA 176        37.50731          48.55540</code></pre>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.3-sas_05dc43f40f5ca16c6dd150a02cf67066">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>proc means data<span class="ot">=</span>pbc3 mean;</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  class tment;</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    var alb bili;</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.4" class="level3">
<h3 class="anchored" data-anchor-id="table-2.4">Table 2.4</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.4-r_4e76897f2f03e0a0d6a41302c6a9edc6">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model with treatment, albumin and bilirubin as covariates </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> pbc3)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>coxfit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)

            coef  exp(coef)   se(coef)      z        p
tment -0.4965639  0.6086184  0.2256162 -2.201   0.0277
alb   -0.1156596  0.8907784  0.0212810 -5.435 5.48e-08
bili   0.0089494  1.0089895  0.0009801  9.131  &lt; 2e-16

Likelihood ratio test=99.06  on 3 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.4-sas_fabf0e8577de83f199a4ed57d944e9ef">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb bili <span class="sc">/</span> rl;</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-poisson-model-with-treatment-only-and-time" class="level3">
<h3 class="anchored" data-anchor-id="in-text-poisson-model-with-treatment-only-and-time">In-text: Poisson model with treatment only (and time)</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-poission-r_7ea7a8e0768910279cec879c0b0ec731">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom) <span class="co"># For using tidy() function to get exp(beta)</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>poism <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> timegroup<span class="dv">-1</span> <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">offset</span>(<span class="fu">log</span>(risktime<span class="sc">/</span><span class="fl">365.25</span>)), <span class="at">data =</span> pbc3mult,<span class="at">family =</span> poisson)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poism, <span class="at">exponentiate =</span> T, <span class="at">conf.int =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4  7
  term       estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 tment        0.942      0.211    -0.284 7.76e- 1   0.622      1.43 
2 timegroup1   0.0902     0.174   -13.8   2.51e-43   0.0631     0.125
3 timegroup2   0.132      0.198   -10.2   1.29e-24   0.0876     0.191
4 timegroup3   0.0925     0.509    -4.68  2.91e- 6   0.0283     0.220</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell" data-hash="Ch2_cache/html/in-text-poission-sas_2a178a339eef811147809ecf034ec4de">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    class interv tment;</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    model fail <span class="ot">=</span> interv tment <span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk;</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'CyA  vs placebo'</span> tment <span class="sc">-</span><span class="dv">1</span> <span class="dv">1</span> <span class="sc">/</span> exp;</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.5" class="level3">
<h3 class="anchored" data-anchor-id="table-2.5">Table 2.5</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.5-r_a809f1c1b4d51e401fc20db0fc0af17b">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model with treatment, albumin and bilirubin as covariates</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>poismod_t25 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili<span class="sc">+</span> timegroup<span class="dv">-1</span> <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">offset</span>(<span class="fu">log</span>(risktime<span class="sc">/</span><span class="fl">365.25</span>)),<span class="at">data=</span>pbc3mult,<span class="at">family=</span>poisson)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t25)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  5
  term       estimate std.error statistic  p.value
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 tment      -0.475    0.224        -2.12 3.39e- 2
2 alb        -0.112    0.0213       -5.28 1.30e- 7
3 bili        0.00846  0.000939      9.01 2.12e-19
4 timegroup1  1.29     0.806         1.60 1.10e- 1
5 timegroup2  2.15     0.833         2.58 9.99e- 3
6 timegroup3  1.61     1.01          1.59 1.12e- 1</code></pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.5-sas_5f995f13ea201a8318e3a91e3402bef0">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> tment interv alb  bili <span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk ;</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-2.6" class="level3">
<h3 class="anchored" data-anchor-id="table-2.6">Table 2.6</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.6-r_ec562be7415170777f8dd8c9d5e167ad">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.6 Cox models </span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Models for LR tests</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>base_coxmod <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>base_coxmod_log <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Cox 1</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> albnorm <span class="sc">+</span> bili,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + albnorm + 
    bili, data = pbc3, method = "breslow", eps = 1e-08)

              coef  exp(coef)   se(coef)      z      p
tment   -0.4750722  0.6218402  0.2261462 -2.101 0.0357
alb     -0.0854244  0.9181225  0.0453150 -1.885 0.0594
albnorm -0.0557001  0.9458228  0.0726447 -0.767 0.4432
bili     0.0089810  1.0090214  0.0009843  9.124 &lt;2e-16

Likelihood ratio test=99.66  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l1, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + albnorm + bili
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -413.12                     
2   3 -413.42 -1 0.6001     0.4386</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Cox 1</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">*</span>alb) <span class="sc">+</span> bili,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + I(alb * 
    alb) + bili, data = pbc3, method = "breslow", eps = 1e-08)

                   coef  exp(coef)   se(coef)      z      p
tment        -0.4983093  0.6075570  0.2274284 -2.191 0.0284
alb          -0.1295361  0.8785029  0.2130539 -0.608 0.5432
I(alb * alb)  0.0001944  1.0001945  0.0029754  0.065 0.9479
bili          0.0089499  1.0089901  0.0009801  9.132 &lt;2e-16

Likelihood ratio test=99.07  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_q1, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + I(alb * alb) + bili
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -413.41                     
2   3 -413.42 -1 0.0042      0.948</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Cox 2</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                         bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili + 
    bilihigh + bilitoohigh + bilimuchtoohigh, data = pbc3, method = "breslow", 
    eps = 1e-08)

                     coef exp(coef)  se(coef)      z        p
tment           -0.598494  0.549639  0.229637 -2.606  0.00915
alb             -0.090970  0.913045  0.021894 -4.155 3.25e-05
bili             0.062425  1.064414  0.062296  1.002  0.31631
bilihigh        -0.014631  0.985476  0.085327 -0.171  0.86386
bilitoohigh     -0.002584  0.997419  0.052961 -0.049  0.96109
bilimuchtoohigh -0.040017  0.960773  0.026486 -1.511  0.13082

Likelihood ratio test=123.5  on 6 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l2, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + 
    bilimuchtoohigh
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   6 -401.22                         
2   3 -413.42 -3 24.396  2.064e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Cox 2</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment<span class="sc">+</span>alb<span class="sc">+</span>bili <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">*</span>bili),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili + 
    I(bili * bili), data = pbc3, method = "breslow", eps = 1e-08)

                     coef  exp(coef)   se(coef)      z        p
tment          -5.210e-01  5.939e-01  2.233e-01 -2.333 0.019640
alb            -1.019e-01  9.031e-01  2.168e-02 -4.703 2.56e-06
bili            1.998e-02  1.020e+00  3.263e-03  6.122 9.21e-10
I(bili * bili) -3.051e-05  1.000e+00  9.098e-06 -3.354 0.000798

Likelihood ratio test=111.4  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_q2, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili + I(bili * bili)
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   4 -407.24                         
2   3 -413.42 -1 12.351  0.0004408 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Cox 3</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                         logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    logbilihigh + logbilitoohigh + logbilimuchtoohigh, data = pbc3, 
    method = "breslow", eps = 1e-08)

                       coef exp(coef) se(coef)      z        p
tment              -0.58019   0.55979  0.22957 -2.527   0.0115
alb                -0.08852   0.91528  0.02182 -4.056 4.99e-05
log2bili            0.20135   1.22306  0.46511  0.433   0.6651
logbilihigh         0.93567   2.54893  0.91503  1.023   0.3065
logbilitoohigh     -0.38647   0.67945  1.29333 -0.299   0.7651
logbilimuchtoohigh -0.18140   0.83410  0.98801 -0.184   0.8543

Likelihood ratio test=121.6  on 6 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l3, base_coxmod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + 
    logbilitoohigh + logbilimuchtoohigh
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -402.13                     
2   3 -402.94 -3 1.6144     0.6561</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Cox 3</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili <span class="sc">+</span> log2bili2,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    log2bili2, data = pbc3, method = "breslow", eps = 1e-08)

              coef exp(coef) se(coef)      z        p
tment     -0.57408   0.56323  0.22454 -2.557   0.0106
alb       -0.09150   0.91256  0.02192 -4.175 2.98e-05
log2bili   0.58231   1.79017  0.49992  1.165   0.2441
log2bili2  0.00715   1.00717  0.04277  0.167   0.8672

Likelihood ratio test=120  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_q3, base_coxmod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + log2bili + log2bili2
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -402.93                     
2   3 -402.94 -1 0.0277     0.8677</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.6 Poisson models </span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data ready for Poisson models using survSplit from survival package</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>pbc3mult <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">survSplit</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> ., pbc3,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">episode =</span> <span class="st">"timegroup"</span>))</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>risktime <span class="ot">&lt;-</span> pbc3mult<span class="sc">$</span>days <span class="sc">-</span> cuts[pbc3mult<span class="sc">$</span>timegroup] </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Models for LR test</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>base_poismod <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>base_poismod_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data=</span>pbc3mult,<span class="at">family=</span>poisson)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Poisson 1</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>poismod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> albnorm <span class="sc">+</span> bili <span class="sc">+</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data=</span>pbc3mult, <span class="at">family=</span>poisson)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t26_l1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7  5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept) -5.12     1.63        -3.14  1.66e- 3
2 timegroup1  -0.311    0.604       -0.514 6.07e- 1
3 timegroup2   0.543    0.602        0.902 3.67e- 1
4 tment       -0.458    0.225       -2.04  4.17e- 2
5 alb         -0.0864   0.0452      -1.91  5.57e- 2
6 albnorm     -0.0474   0.0720      -0.658 5.11e- 1
7 bili         0.00848  0.000942     9.00  2.24e-19</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l1, base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + albnorm + bili + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -263.14                     
2   6 -263.36 -1 0.4404     0.5069</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Poisson 1</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">*</span>alb) <span class="sc">+</span> bili <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t26_q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7  5
  term          estimate std.error statistic  p.value
  &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -3.83      3.81        -1.00  3.16e- 1
2 timegroup1   -0.323     0.605       -0.534 5.94e- 1
3 timegroup2    0.536     0.602        0.890 3.73e- 1
4 tment        -0.479     0.226       -2.12  3.41e- 2
5 alb          -0.139     0.210       -0.660 5.09e- 1
6 I(alb * alb)  0.000371  0.00293      0.126 8.99e- 1
7 bili          0.00846   0.000939     9.01  2.05e-19</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q1, base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + I(alb * alb) + bili + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -263.36                     
2   6 -263.36 -1 0.0158     0.8999</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Poisson 2</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_l2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                        bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t26_l2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9  5
  term            estimate std.error statistic    p.value
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 (Intercept)     -6.45       1.37     -4.72   0.00000240
2 timegroup1      -0.427      0.605    -0.707  0.480     
3 timegroup2       0.425      0.604     0.705  0.481     
4 tment           -0.569      0.227    -2.51   0.0121    
5 alb             -0.0865     0.0219   -3.95   0.0000770 
6 bili             0.0617     0.0623    0.989  0.322     
7 bilihigh        -0.0168     0.0852   -0.197  0.844     
8 bilitoohigh      0.00265    0.0526    0.0504 0.960     
9 bilimuchtoohigh -0.0428     0.0262   -1.63   0.102     </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l2, base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + bili + bilihigh + bilitoohigh + 
    bilimuchtoohigh + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   9 -251.09                         
2   6 -263.36 -3 24.545  1.922e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Poisson 2</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">*</span>bili) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t26_q2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7  5
  term             estimate  std.error statistic  p.value
  &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)    -5.16      1.05          -4.90  9.47e- 7
2 timegroup1     -0.382     0.605         -0.631 5.28e- 1
3 timegroup2      0.455     0.603          0.755 4.50e- 1
4 tment          -0.499     0.222         -2.25  2.45e- 2
5 alb            -0.0977    0.0216        -4.52  6.24e- 6
6 bili            0.0200    0.00327        6.12  9.49e-10
7 I(bili * bili) -0.0000315 0.00000907    -3.48  5.10e- 4</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q2, base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + bili + I(bili * bili) + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   7 -256.69                         
2   6 -263.36 -1 13.345  0.0002591 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines Poisson 3</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                        log2bili <span class="sc">+</span> logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh <span class="sc">+</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t26_l3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9  5
  term               estimate std.error statistic  p.value
  &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)         -6.52      2.00      -3.27  0.00109 
2 timegroup1          -0.407     0.604     -0.674 0.501   
3 timegroup2           0.418     0.604      0.693 0.488   
4 tment               -0.556     0.227     -2.45  0.0144  
5 alb                 -0.0844    0.0218    -3.87  0.000109
6 log2bili             0.198     0.465      0.425 0.671   
7 logbilihigh          0.882     0.912      0.967 0.334   
8 logbilitoohigh      -0.234     1.28      -0.183 0.855   
9 logbilimuchtoohigh  -0.314     0.971     -0.323 0.746   </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l3, base_poismod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + log2bili + logbilihigh + logbilitoohigh + 
    logbilimuchtoohigh + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   9 -251.77                     
2   6 -252.62 -3 1.7135     0.6339</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic Poisson 3</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili2 <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t26_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7  5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept) -7.86       1.85     -4.25   0.0000218
2 timegroup1  -0.406      0.605    -0.672  0.502    
3 timegroup2   0.439      0.603     0.728  0.467    
4 tment       -0.545      0.223    -2.45   0.0143   
5 alb         -0.0871     0.0219   -3.98   0.0000692
6 log2bili     0.628      0.497     1.26   0.207    
7 log2bili2    0.00164    0.0424    0.0387 0.969    </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q3, base_poismod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + log2bili + log2bili2 + offset(log(risktime))
Model 2: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -252.62                     
2   6 -252.62 -1 0.0015     0.9691</code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell" data-hash="Ch2_cache/html/table-2.6-sas_8228bafa6f7800b18c9733d1fd9b4b16">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="sc">**</span> Cox models <span class="sc">**</span>;</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Base models <span class="cf">for</span> LR tests; </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>);</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb bili<span class="sc">/</span>rl ties<span class="ot">=</span>breslow CONVERGELIKE<span class="ot">=</span><span class="fl">1E-8</span> <span class="fu">type3</span>(lr);</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>);</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb log2bili<span class="sc">/</span>rl ties<span class="ot">=</span>breslow CONVERGELIKE<span class="ot">=</span><span class="fl">1E-8</span> <span class="fu">type3</span>(lr);</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Splines Cox <span class="dv">1</span>; </span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT can here be read of type3 test result; </span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>);</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb albnorm bili<span class="sc">/</span>rl ties<span class="ot">=</span>breslow CONVERGELIKE<span class="ot">=</span><span class="fl">1E-8</span> <span class="fu">type3</span>(lr);</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Quadratic Cox <span class="dv">1</span>; </span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT can here be read of type3 test result; </span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>  alb2<span class="ot">=</span>alb<span class="sc">*</span>alb;</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>);</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb10 alb2 bili100<span class="sc">/</span>rl <span class="fu">type3</span>(LR);</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Splines Cox <span class="dv">2</span>;</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>);</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb bili bilihigh bilitoohigh </span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>                             bilimuchtoohigh<span class="sc">/</span>rl <span class="fu">type3</span>(lr) ties<span class="ot">=</span>breslow CONVERGELIKE<span class="ot">=</span><span class="fl">1E-8</span>;</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT; </span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>data p;</span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>    chi2<span class="ot">=</span><span class="fl">826.830-802.434</span>;</span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>    p<span class="ot">=</span><span class="dv">1</span><span class="sc">-</span><span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>proc print;</span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Quadratic Cox <span class="dv">2</span>; </span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT can here be read of type3 test result; </span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>  bili2<span class="ot">=</span>bili<span class="sc">*</span>bili;</span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>);</span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb10 bili bili2 <span class="sc">/</span> rl <span class="fu">type3</span>(LR);</span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Splines Cox <span class="dv">3</span>;</span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>);</span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb log2bili logbilihigh </span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a>                             logbilitoohigh logbilimuchtoohigh<span class="sc">/</span>rl ties<span class="ot">=</span>breslow CONVERGELIKE<span class="ot">=</span><span class="fl">1E-8</span>;</span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>linbili<span class="sc">:</span> test  logbilihigh<span class="ot">=</span>logbilitoohigh<span class="ot">=</span>logbilimuchtoohigh<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT; </span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a>data p;</span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>    chi2<span class="ot">=</span><span class="fl">805.881-804.267</span>;</span>
<span id="cb85-59"><a href="#cb85-59" aria-hidden="true" tabindex="-1"></a>    p<span class="ot">=</span><span class="dv">1</span><span class="sc">-</span><span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb85-60"><a href="#cb85-60" aria-hidden="true" tabindex="-1"></a>proc print;</span>
<span id="cb85-61"><a href="#cb85-61" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-62"><a href="#cb85-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-63"><a href="#cb85-63" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Quadratic Cox <span class="dv">3</span>; </span>
<span id="cb85-64"><a href="#cb85-64" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT can here be read of type3 test result; </span>
<span id="cb85-65"><a href="#cb85-65" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb85-66"><a href="#cb85-66" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>);</span>
<span id="cb85-67"><a href="#cb85-67" aria-hidden="true" tabindex="-1"></a>    model days<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment alb10 log2bili log2bili2<span class="sc">/</span>rl <span class="fu">type3</span>(LR);</span>
<span id="cb85-68"><a href="#cb85-68" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-69"><a href="#cb85-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-70"><a href="#cb85-70" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Split data into timegroups <span class="cf">for</span> Poisson models; </span>
<span id="cb85-71"><a href="#cb85-71" aria-hidden="true" tabindex="-1"></a>data pbc3mult; </span>
<span id="cb85-72"><a href="#cb85-72" aria-hidden="true" tabindex="-1"></a>    set pbc3;</span>
<span id="cb85-73"><a href="#cb85-73" aria-hidden="true" tabindex="-1"></a>    fail<span class="ot">=</span>(days<span class="sc">&lt;=</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>)<span class="sc">*</span>(status ne <span class="dv">0</span>);</span>
<span id="cb85-74"><a href="#cb85-74" aria-hidden="true" tabindex="-1"></a>    risktime<span class="ot">=</span><span class="fu">min</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>,days);</span>
<span id="cb85-75"><a href="#cb85-75" aria-hidden="true" tabindex="-1"></a>    logrisk<span class="ot">=</span><span class="fu">log</span>(risktime); interv<span class="ot">=</span><span class="dv">1</span>; output;  </span>
<span id="cb85-76"><a href="#cb85-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> days<span class="sc">&gt;</span><span class="dv">2</span><span class="sc">*</span> <span class="fl">365.25</span> then do;</span>
<span id="cb85-77"><a href="#cb85-77" aria-hidden="true" tabindex="-1"></a>    fail<span class="ot">=</span>(days<span class="sc">&lt;=</span><span class="dv">4</span><span class="sc">*</span> <span class="fl">365.25</span>)<span class="sc">*</span>(status ne <span class="dv">0</span>);</span>
<span id="cb85-78"><a href="#cb85-78" aria-hidden="true" tabindex="-1"></a>    risktime<span class="ot">=</span><span class="fu">min</span>(<span class="dv">2</span><span class="sc">*</span> <span class="fl">365.25</span>,days<span class="dv">-2</span><span class="sc">*</span> <span class="fl">365.25</span>);</span>
<span id="cb85-79"><a href="#cb85-79" aria-hidden="true" tabindex="-1"></a>    logrisk<span class="ot">=</span><span class="fu">log</span>(risktime); interv<span class="ot">=</span><span class="dv">2</span>; output; end;</span>
<span id="cb85-80"><a href="#cb85-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> days<span class="sc">&gt;</span><span class="dv">4</span><span class="sc">*</span> <span class="fl">365.25</span> then do;</span>
<span id="cb85-81"><a href="#cb85-81" aria-hidden="true" tabindex="-1"></a>    fail<span class="ot">=</span>status ne <span class="dv">0</span>; </span>
<span id="cb85-82"><a href="#cb85-82" aria-hidden="true" tabindex="-1"></a>    risktime<span class="ot">=</span>days<span class="dv">-4</span><span class="sc">*</span> <span class="fl">365.25</span>;</span>
<span id="cb85-83"><a href="#cb85-83" aria-hidden="true" tabindex="-1"></a>    logrisk<span class="ot">=</span><span class="fu">log</span>(risktime); interv<span class="ot">=</span><span class="dv">3</span>; output; end;</span>
<span id="cb85-84"><a href="#cb85-84" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-85"><a href="#cb85-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-86"><a href="#cb85-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-87"><a href="#cb85-87" aria-hidden="true" tabindex="-1"></a><span class="sc">**</span> Possion models <span class="sc">**</span>;</span>
<span id="cb85-88"><a href="#cb85-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-89"><a href="#cb85-89" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Models to compare with <span class="cf">for</span> the LR tests; </span>
<span id="cb85-90"><a href="#cb85-90" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb85-91"><a href="#cb85-91" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb85-92"><a href="#cb85-92" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> interv tment alb bili<span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk type3;</span>
<span id="cb85-93"><a href="#cb85-93" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-94"><a href="#cb85-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-95"><a href="#cb85-95" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb85-96"><a href="#cb85-96" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb85-97"><a href="#cb85-97" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> interv tment alb log2bili<span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk type3;</span>
<span id="cb85-98"><a href="#cb85-98" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-99"><a href="#cb85-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-100"><a href="#cb85-100" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Splines Poisson <span class="dv">1</span>; </span>
<span id="cb85-101"><a href="#cb85-101" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT can here be read of type3 test result; </span>
<span id="cb85-102"><a href="#cb85-102" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb85-103"><a href="#cb85-103" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb85-104"><a href="#cb85-104" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> interv tment alb albnorm bili<span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk type3;</span>
<span id="cb85-105"><a href="#cb85-105" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-106"><a href="#cb85-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-107"><a href="#cb85-107" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Quadratic Poisson <span class="dv">1</span>;</span>
<span id="cb85-108"><a href="#cb85-108" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT can here be read of type3 test result; </span>
<span id="cb85-109"><a href="#cb85-109" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb85-110"><a href="#cb85-110" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb85-111"><a href="#cb85-111" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> interv tment alb10 alb2 bili100<span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk type3;</span>
<span id="cb85-112"><a href="#cb85-112" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-113"><a href="#cb85-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-114"><a href="#cb85-114" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Splines Poisson <span class="dv">2</span>; </span>
<span id="cb85-115"><a href="#cb85-115" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb85-116"><a href="#cb85-116" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb85-117"><a href="#cb85-117" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> interv tment alb bili bilihigh bilitoohigh  </span>
<span id="cb85-118"><a href="#cb85-118" aria-hidden="true" tabindex="-1"></a>                 bilimuchtoohigh<span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk type3;</span>
<span id="cb85-119"><a href="#cb85-119" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-120"><a href="#cb85-120" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT; </span>
<span id="cb85-121"><a href="#cb85-121" aria-hidden="true" tabindex="-1"></a>data p;</span>
<span id="cb85-122"><a href="#cb85-122" aria-hidden="true" tabindex="-1"></a>    chi2<span class="ot">=</span><span class="fl">350.7253-326.1805</span>;</span>
<span id="cb85-123"><a href="#cb85-123" aria-hidden="true" tabindex="-1"></a>    p<span class="ot">=</span><span class="dv">1</span><span class="sc">-</span><span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb85-124"><a href="#cb85-124" aria-hidden="true" tabindex="-1"></a>proc print;</span>
<span id="cb85-125"><a href="#cb85-125" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-126"><a href="#cb85-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-127"><a href="#cb85-127" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Quadratic Poisson <span class="dv">2</span>;</span>
<span id="cb85-128"><a href="#cb85-128" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT can here be read of type3 test result; </span>
<span id="cb85-129"><a href="#cb85-129" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb85-130"><a href="#cb85-130" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb85-131"><a href="#cb85-131" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> interv tment alb10 bili100 bili2<span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk type3;</span>
<span id="cb85-132"><a href="#cb85-132" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-133"><a href="#cb85-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-134"><a href="#cb85-134" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Splines Poisson <span class="dv">3</span>;</span>
<span id="cb85-135"><a href="#cb85-135" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb85-136"><a href="#cb85-136" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb85-137"><a href="#cb85-137" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> interv tment alb log2bili logbilihigh logbilitoohigh </span>
<span id="cb85-138"><a href="#cb85-138" aria-hidden="true" tabindex="-1"></a>                 logbilimuchtoohigh <span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk type3;</span>
<span id="cb85-139"><a href="#cb85-139" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-140"><a href="#cb85-140" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT; </span>
<span id="cb85-141"><a href="#cb85-141" aria-hidden="true" tabindex="-1"></a>data p;</span>
<span id="cb85-142"><a href="#cb85-142" aria-hidden="true" tabindex="-1"></a>    chi2<span class="ot">=</span><span class="fl">329.2509-327.5375</span>;</span>
<span id="cb85-143"><a href="#cb85-143" aria-hidden="true" tabindex="-1"></a>    p<span class="ot">=</span><span class="dv">1</span><span class="sc">-</span><span class="fu">probchi</span>(chi2,<span class="dv">3</span>);</span>
<span id="cb85-144"><a href="#cb85-144" aria-hidden="true" tabindex="-1"></a>proc print;</span>
<span id="cb85-145"><a href="#cb85-145" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb85-146"><a href="#cb85-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-147"><a href="#cb85-147" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> Quadratic Poisson <span class="dv">3</span>;</span>
<span id="cb85-148"><a href="#cb85-148" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> LRT can here be read of type3 test result; </span>
<span id="cb85-149"><a href="#cb85-149" aria-hidden="true" tabindex="-1"></a>proc genmod data<span class="ot">=</span>pbc3mult;</span>
<span id="cb85-150"><a href="#cb85-150" aria-hidden="true" tabindex="-1"></a>    class <span class="fu">tment</span> (<span class="at">ref=</span><span class="st">'0'</span>) interv;</span>
<span id="cb85-151"><a href="#cb85-151" aria-hidden="true" tabindex="-1"></a>    model fail<span class="ot">=</span> interv tment alb10 log2bili log2bili2<span class="sc">/</span> dist<span class="ot">=</span>poi offset<span class="ot">=</span>logrisk type3;</span>
<span id="cb85-152"><a href="#cb85-152" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-2.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.6">Figure 2.6</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.6_427cf2c5f44c5f25db118a5d743a1045">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The below linear predictors include estimates from the following models</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>tment_char)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>base_poismod <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                      tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>poismod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>                        tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> albnorm,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>                        tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>                        bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,<span class="at">family =</span> poisson)</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataset with linear predictor information</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>lin2 <span class="ot">&lt;-</span> pbc3</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">1.6076-0.1123</span><span class="sc">*</span>alb)</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">0.7828-0.0864</span><span class="sc">*</span>alb<span class="fl">-0.0474</span><span class="sc">*</span>albnorm)</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">1.6076+0.0085</span><span class="sc">*</span>bili<span class="fl">-38.7</span><span class="sc">*</span><span class="fl">0.1123</span>)</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp4 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">0.5534+0.0617</span><span class="sc">*</span>bili<span class="fl">-0.0168</span><span class="sc">*</span>bilihigh<span class="sc">+</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>                   <span class="fl">0.0027</span><span class="sc">*</span>bilitoohigh<span class="fl">-0.0428</span><span class="sc">*</span>bilimuchtoohigh<span class="fl">-0.0865</span><span class="sc">*</span><span class="fl">38.7</span>)</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>lin2row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(lin2)),</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(lin2))), </span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>lp1, lin2<span class="sc">$</span>lp2), <span class="at">alb =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>alb, lin2<span class="sc">$</span>alb))</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alb, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> lin2row) <span class="sc">+</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Albumin"</span>) <span class="sc">+</span> </span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.6-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="figure-2.7" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.7">Figure 2.7</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.7_5eeb3a7f3682f2c1537d4f8cfe177b15">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bilirubin and the two last linear predictors</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>lin2row2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(lin2)),</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(lin2))), </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>lp3, lin2<span class="sc">$</span>lp4),</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bili =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>bili, lin2<span class="sc">$</span>bili))</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> lin2row2) <span class="sc">+</span> </span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span> </span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.7-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="figure-2.8" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.8">Figure 2.8</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.8_68bc95690b89b4ec761ea06aee98c898">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The below linear predictors include estimates from the following models</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>base_poismod2_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                           tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                        tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                        logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataset with linear predictor information</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>log2 <span class="ot">&lt;-</span> pbc3</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>log2<span class="sc">$</span>lp3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">2.0162+0.6469</span><span class="sc">*</span>log2bili<span class="fl">-38.7</span><span class="sc">*</span><span class="fl">0.087</span>)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>log2<span class="sc">$</span>lp4 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">0.6194+0.198</span><span class="sc">*</span>log2bili</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">+</span><span class="fl">0.8815</span><span class="sc">*</span>logbilihigh<span class="fl">-0.2336</span><span class="sc">*</span>logbilitoohigh</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span><span class="fl">0.3139</span><span class="sc">*</span>logbilimuchtoohigh<span class="fl">-0.0844</span><span class="sc">*</span><span class="fl">38.7</span>)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>log2row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(log2)),</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(log2))), </span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(log2<span class="sc">$</span>lp3, log2<span class="sc">$</span>lp4),</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">log2bili =</span> <span class="fu">c</span>(log2<span class="sc">$</span>log2bili, log2<span class="sc">$</span>log2bili)</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> log2row) <span class="sc">+</span> </span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(log[<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.8-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="table-2.7" class="level3">
<h3 class="anchored" data-anchor-id="table-2.7">Table 2.7</h3>
<div class="cell" data-hash="Ch2_cache/html/table-2.7_d3494393697633912771ed05667fefe0">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>coxmod_t27 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>coxmod_t27</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, 
    data = pbc3, method = "breslow", eps = 1e-08)

             coef exp(coef) se(coef)      z        p
tment    -0.57406   0.56323  0.22447 -2.557   0.0105
alb      -0.09093   0.91308  0.02164 -4.201 2.65e-05
log2bili  0.66500   1.94449  0.07443  8.935  &lt; 2e-16

Likelihood ratio test=120  on 3 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>poismod_t27 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> timegroup <span class="sc">+</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t27) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -7.48      0.976     -7.66  1.81e-14
2 tment        -0.545     0.223     -2.45  1.43e- 2
3 alb          -0.0870    0.0216    -4.02  5.73e- 5
4 log2bili      0.647     0.0733     8.83  1.04e-18
5 timegroup3   -0.439     0.603     -0.727 4.67e- 1
6 timegroup1   -0.844     0.229     -3.69  2.23e- 4</code></pre>
</div>
</div>
</section>
<section id="table-2.8" class="level3">
<h3 class="anchored" data-anchor-id="table-2.8">Table 2.8</h3>
<div class="cell" data-hash="Ch2_cache/html/table-2.8_fadca5fe4fa2e2afe3c5dacef6ebf0f6">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox models</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Model for LR comparison</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>coxmod_t28_base <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 1</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb0 <span class="ot">&lt;-</span> (pbc3<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">0</span>)<span class="sc">*</span>pbc3<span class="sc">$</span>alb</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb1 <span class="ot">&lt;-</span> (pbc3<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3<span class="sc">$</span>alb</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>coxmod_t28_1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb0 <span class="sc">+</span> alb1 <span class="sc">+</span> log2bili,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>coxmod_t28_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb0 + alb1 + 
    log2bili, data = pbc3, method = "breslow", eps = 1e-08)

              coef exp(coef)  se(coef)      z        p
tment    -0.009736  0.990312  1.559670 -0.006 0.995020
alb0     -0.081319  0.921900  0.034031 -2.390 0.016869
alb1     -0.097043  0.907517  0.027344 -3.549 0.000387
log2bili  0.664413  1.943350  0.074494  8.919  &lt; 2e-16

Likelihood ratio test=120.2  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t28_1, coxmod_t28_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb0 + alb1 + log2bili
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -402.87                     
2   3 -402.94 -1 0.1338     0.7145</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 2</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili0 <span class="ot">&lt;-</span> (pbc3<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">0</span>)<span class="sc">*</span>pbc3<span class="sc">$</span>log2bili</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili1 <span class="ot">&lt;-</span> (pbc3<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3<span class="sc">$</span>log2bili</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>coxmod_t28_2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili0 <span class="sc">+</span> bili1,</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>coxmod_t28_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili0 + 
    bili1, data = pbc3, method = "breslow", eps = 1e-08)

          coef exp(coef) se(coef)      z        p
tment  0.19880   1.21994  0.85653  0.232    0.816
alb   -0.09331   0.91091  0.02191 -4.260 2.05e-05
bili0  0.72558   2.06593  0.09865  7.355 1.91e-13
bili1  0.59345   1.81022  0.10604  5.596 2.19e-08

Likelihood ratio test=120.9  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t28_2, coxmod_t28_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili0 + bili1
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -402.51                     
2   3 -402.94 -1 0.8644     0.3525</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson models</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Model for LR comparison - no interaction</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>poismod_t28_base <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> timegroup <span class="sc">+</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili<span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data=</span>pbc3mult, <span class="at">family=</span>poisson)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 1</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb0 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">0</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>poismod_t28_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb0 <span class="sc">+</span> alb1 <span class="sc">+</span> log2bili <span class="sc">+</span> timegroup <span class="sc">+</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t28_1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7  5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -7.87      1.36     -5.78   7.54e- 9
2 tment         0.0920    1.55      0.0593 9.53e- 1
3 alb0         -0.0763    0.0336   -2.27   2.32e- 2
4 alb1         -0.0941    0.0275   -3.41   6.39e- 4
5 log2bili      0.646     0.0733    8.81   1.23e-18
6 timegroup3   -0.431     0.604    -0.714  4.75e- 1
7 timegroup1   -0.844     0.229    -3.69   2.20e- 4</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t28_base, poismod_t28_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))
Model 2: fail ~ tment + alb0 + alb1 + log2bili + timegroup + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   7 -252.54  1 0.1723      0.678</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 2</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili0 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">0</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>tment<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>poismod_t28_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili0 <span class="sc">+</span> bili1 <span class="sc">+</span> timegroup <span class="sc">+</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">offset</span>(<span class="fu">log</span>(risktime)), <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t28_2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7  5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -7.72      1.02      -7.59  3.10e-14
2 tment         0.181     0.848      0.213 8.31e- 1
3 alb          -0.0891    0.0218    -4.08  4.54e- 5
4 bili0         0.704     0.0972     7.24  4.42e-13
5 bili1         0.580     0.105      5.54  3.08e- 8
6 timegroup3   -0.417     0.604     -0.691 4.90e- 1
7 timegroup1   -0.857     0.229     -3.74  1.86e- 4</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t28_base, poismod_t28_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ timegroup + tment + alb + log2bili + offset(log(risktime))
Model 2: fail ~ tment + alb + bili0 + bili1 + timegroup + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   7 -252.24  1 0.7787     0.3775</code></pre>
</div>
</div>
</section>
<section id="table-2.9" class="level3">
<h3 class="anchored" data-anchor-id="table-2.9">Table 2.9</h3>
<div class="cell" data-hash="Ch2_cache/html/table-2.9_0918e4145e96437acf1c1b8d8a15d341">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>tment</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment2 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>tment</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment3 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">3</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>tment</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb2 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>alb3 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">3</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>alb</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili1 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili2 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">2</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>bili3 <span class="ot">&lt;-</span> (pbc3mult<span class="sc">$</span>timegroup<span class="sc">==</span><span class="dv">3</span>)<span class="sc">*</span>pbc3mult<span class="sc">$</span>log2bili</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>poismod_t29_base <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail<span class="sc">~</span>tment<span class="sc">+</span>alb<span class="sc">+</span>log2bili<span class="sc">+</span>timegroup<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(risktime)),</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>poismod_t29_tment <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment1 <span class="sc">+</span> tment2 <span class="sc">+</span> tment3 <span class="sc">+</span> alb <span class="sc">+</span> log2bili<span class="sc">+</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>                       timegroup <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)),</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t29_tment) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8  5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -7.55      0.983     -7.68  1.62e-14
2 tment1       -0.562     0.291     -1.93  5.35e- 2
3 tment2       -0.462     0.345     -1.34  1.80e- 1
4 tment3       -1.27      1.23      -1.03  3.03e- 1
5 alb          -0.0864    0.0217    -3.99  6.65e- 5
6 log2bili      0.649     0.0737     8.81  1.30e-18
7 timegroup3   -0.0954    0.750     -0.127 8.99e- 1
8 timegroup1   -0.794     0.319     -2.49  1.29e- 2</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, poismod_t29_tment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))
Model 2: fail ~ tment1 + tment2 + tment3 + alb + log2bili + timegroup + 
    offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   8 -252.41  2 0.4312     0.8061</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Albumin</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_alb <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb1 <span class="sc">+</span> alb2 <span class="sc">+</span> alb3 <span class="sc">+</span> log2bili<span class="sc">+</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                       timegroup <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)),</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t29_alb) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8  5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -8.75      1.42    -6.18    6.41e-10
2 tment        -0.561     0.223   -2.52    1.18e- 2
3 alb1         -0.110     0.0279  -3.95    7.79e- 5
4 alb2         -0.0523    0.0347  -1.51    1.32e- 1
5 alb3         -0.0654    0.153   -0.427   6.70e- 1
6 log2bili      0.646     0.0736   8.78    1.68e-18
7 timegroup3    0.0143    6.09     0.00235 9.98e- 1
8 timegroup1    1.24      1.60     0.776   4.38e- 1</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, poismod_t29_alb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))
Model 2: fail ~ tment + alb1 + alb2 + alb3 + log2bili + timegroup + offset(log(risktime))
  #Df  LogLik Df Chisq Pr(&gt;Chisq)
1   6 -252.62                    
2   8 -251.72  2 1.803      0.406</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bilirubin</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_bili <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili1 <span class="sc">+</span> bili2 <span class="sc">+</span> bili3 <span class="sc">+</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>                       timegroup <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)),</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poismod_t29_bili) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8  5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -7.06      1.10      -6.40  1.55e-10
2 tment        -0.515     0.224     -2.30  2.15e- 2
3 alb          -0.0857    0.0217    -3.94  8.10e- 5
4 bili1         0.710     0.0926     7.67  1.69e-14
5 bili2         0.557     0.121      4.60  4.18e- 6
6 bili3         0.305     0.482      0.633 5.26e- 1
7 timegroup3    0.696     2.32       0.300 7.64e- 1
8 timegroup1   -1.72      0.888     -1.94  5.21e- 2</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, poismod_t29_bili)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ tment + alb + log2bili + timegroup + offset(log(risktime))
Model 2: fail ~ tment + alb + bili1 + bili2 + bili3 + timegroup + offset(log(risktime))
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   8 -251.84  2 1.5777     0.4544</code></pre>
</div>
</div>
</section>
<section id="in-text-stratified-cox-model" class="level3">
<h3 class="anchored" data-anchor-id="in-text-stratified-cox-model">In-text: stratified Cox model</h3>
<div class="cell" data-hash="Ch2_cache/html/in-text-stratified-cox_d18ea612b436b77f9eb53f7cffe05eed">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>coxmod_f29 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(tment) <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>coxmod_f29</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ strata(tment) + alb + 
    log2bili, data = pbc3, method = "breslow", eps = 1e-08)

             coef exp(coef) se(coef)      z        p
alb      -0.09002   0.91391  0.02168 -4.153 3.28e-05
log2bili  0.66328   1.94114  0.07531  8.807  &lt; 2e-16

Likelihood ratio test=119.3  on 2 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
</div>
</section>
<section id="figure-2.10" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.10">Figure 2.10</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.10_74e2659262866a65fe51a14a62c49b08">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting cumulative baseline hazards per treatment</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>cumhaz_treat <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxmod_f29, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>cumhaz_treat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cumhaz_treat)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Per treatment</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>hazard_t0 <span class="ot">&lt;-</span> cumhaz_treat[cumhaz_treat<span class="sc">$</span>strata <span class="sc">==</span> <span class="st">"tment=0"</span>,]</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>hazard_t0[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"tment=0"</span>)</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>hazard_t0<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hazard_t0<span class="sc">$</span>time)</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>hazard_t0<span class="sc">$</span>hazard <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hazard_t0<span class="sc">$</span>hazard)</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>hazard_t1 <span class="ot">&lt;-</span> cumhaz_treat[cumhaz_treat<span class="sc">$</span>strata <span class="sc">==</span> <span class="st">"tment=1"</span>,]</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Match times</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>alltimes <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(cumhaz_treat<span class="sc">$</span>time))</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>hazard_t0_allt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alltimes),<span class="cf">function</span>(k) </span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(hazard_t0<span class="sc">$</span>hazard[hazard_t0<span class="sc">$</span>time <span class="sc">&lt;=</span> alltimes[k]], <span class="dv">1</span>)))</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>hazard_t1_allt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alltimes), <span class="cf">function</span>(k)</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(hazard_t1<span class="sc">$</span>hazard[hazard_t1<span class="sc">$</span>time <span class="sc">&lt;=</span> alltimes[k]], <span class="dv">1</span>))) </span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>hazards <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(hazard_t0_allt, hazard_t1_allt)</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficient</span></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>coxmod_f29_t <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Make plot</span></span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hazard_t0_allt, <span class="at">y =</span> hazard_t1_allt), <span class="at">data =</span> hazards) <span class="sc">+</span> </span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(coxmod_f29_t)[[<span class="st">"tment"</span>]]), </span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cumulative baseline hazard: placebo"</span>) <span class="sc">+</span></span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard: CyA"</span>) <span class="sc">+</span> </span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.10-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="figure-2.11" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.11">Figure 2.11</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.11_83398db6aa6513d887c9589c5529da3f">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive Aalen models - available with timereg</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timereg)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>nonparmod <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          5.96               0.000
tment                                1.60               0.731

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.107                       0.592
tment                               0.136                       0.613
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          7.62                       0.449
tment                                4.54                       0.722

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>cumhazdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">eventtimes =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">1</span>],</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">basecumhaz =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">2</span>], </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>], </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat_ll =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>]</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(nonparmod<span class="sc">$</span>var.cum[,<span class="dv">3</span>]),</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat_ul =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>]</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(nonparmod<span class="sc">$</span>var.cum[,<span class="dv">3</span>]))</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend lines to last observed time</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>cumhazdata[<span class="fu">nrow</span>(cumhazdata)<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">max</span>(pbc3<span class="sc">$</span>days), <span class="fu">tail</span>(cumhazdata, <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Left figure</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">11.</span>left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> basecumhaz), </span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard"</span>) <span class="sc">+</span> </span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">11.</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.11-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Right figure</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">11.</span>right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat), </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat_ll), </span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span>  </span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat_ul), </span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative treatment effect"</span>) <span class="sc">+</span> </span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">11.</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.11-2.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="figure-2.12" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.12">Figure 2.12</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.12_3f2d52cbc9e5cab58de8cce8a63af60d">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Aalen model fit</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timereg)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>nonparmod2 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>cumhazdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">eventtimes =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">1</span>],</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">basecumhaz =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">2</span>], </span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">3</span>], </span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhazalb =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">4</span>], </span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhazbili=</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">5</span>])</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend lines to last observed time</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>cumhazdata[<span class="fu">nrow</span>(cumhazdata)<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">max</span>(pbc3<span class="sc">$</span>days), <span class="fu">tail</span>(cumhazdata, <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure treatment</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.1</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat), </span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative treatment effect"</span>) <span class="sc">+</span> </span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure albumin</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.2</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhazalb), </span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative albumin effect"</span>) <span class="sc">+</span> </span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure bilirubin</span></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.3</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhazbili), </span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative bilirubin effect"</span>) <span class="sc">+</span> </span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)),</span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.12-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.12-2.png" class="img-fluid" style="width:90.0%"></p>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>fig2.<span class="fl">12.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.12-3.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="table-2.10" class="level3">
<h3 class="anchored" data-anchor-id="table-2.10">Table 2.10</h3>
<div class="cell" data-hash="Ch2_cache/html/table-2.10_610e643ee3d1537d1902588ae3b5a4e1">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10 and in-text results</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive model treatment only</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values not exactly as in book because seed changes</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>nonparmod0 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3) </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          5.96               0.000
tment                                1.60               0.719

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.107                       0.575
tment                               0.136                       0.624
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          7.62                       0.431
tment                                4.54                       0.728

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant effect of treatment per year</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>nonparmod01 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment), <span class="at">data =</span> pbc3) </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          6.62                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                        0.0914                        0.41
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                        0.0136                       0.286

Parametric terms :     
                Coef.    SE Robust SE     z P-val lower2.5% upper97.5%
const(tment) -0.00587 0.021     0.021 -0.28 0.779    -0.047     0.0353
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment), 
    data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive model with treatment, albumin, bilirubin</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10, first two columns</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values not exactly as in book because seed changes</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>nonparmod1 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.62               0.008
tment                                2.66               0.120
alb                                  3.82               0.003
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.30300                       0.924
tment                             0.12100                       0.700
alb                               0.00666                       0.962
bili                              0.00301                       0.174
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      14.20000                       0.987
tment                             3.29000                       0.808
alb                               0.00826                       0.989
bili                              0.00203                       0.318

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10, last columns</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>nonparmod2 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(bili), <span class="at">data =</span> pbc3) </span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          4.03                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.119                       0.177
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                        0.0263                       0.106

Parametric terms :     
                Coef.       SE Robust SE     z    P-val lower2.5% upper97.5%
const(tment) -0.04130 0.021600  0.020100 -2.05 4.02e-02  -0.08360    0.00104
const(alb)   -0.00842 0.002290  0.002230 -3.77 1.63e-04  -0.01290   -0.00393
const(bili)   0.00230 0.000483  0.000384  5.98 2.17e-09   0.00135    0.00325
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    const(alb) + const(bili), data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant effect of treatment, adjusted for albumin and bilirubin</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>nonparmod3 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">const</span>(tment) <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.60               0.008
alb                                  3.80               0.004
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.28500                       0.951
alb                               0.00954                       0.813
bili                              0.00315                       0.149
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      3.16e-02                       0.997
alb                              5.26e-05                       0.907
bili                             6.52e-06                       0.270

Parametric terms :     
               Coef.     SE Robust SE     z P-val lower2.5% upper97.5%
const(tment) -0.0401 0.0216    0.0204 -1.97 0.049   -0.0824    0.00224
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    alb + bili, data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic effect for albumin; p-values not exactly as in book because seed changes</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>nonparmod44 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((alb<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod44)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
              Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                            3.23               0.019
I(alb/10)                              3.00               0.039
I(bili/100)                            4.88               0.000
I((alb/10)^2)                          2.77               0.080

Test for time invariant effects 
                    Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                           9.420                       0.240
I(alb/10)                             4.950                       0.246
I(bili/100)                           0.365                       0.074
I((alb/10)^2)                         0.635                       0.247
                      Cramer von Mises test p-value H_0:constant effect
(Intercept)                         83.6000                       0.341
I(alb/10)                           24.4000                       0.336
I(bili/100)                          0.0949                       0.180
I((alb/10)^2)                        0.4160                       0.332

Parametric terms :     
               Coef.     SE Robust SE     z  P-val lower2.5% upper97.5%
const(tment) -0.0421 0.0215    0.0201 -2.09 0.0366   -0.0842   3.92e-05
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    I(alb/10) + I(bili/100) + I((alb/10)^2), data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic effect for bilirubin; p-values not exactly as in book as seed changes</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>nonparmod43 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((bili<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod43)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
                Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                              3.82               0.004
I(alb/10)                                4.02               0.003
I(bili/100)                              3.85               0.001
I((bili/100)^2)                          3.01               0.053

Test for time invariant effects 
                      Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                             0.440                       0.668
I(alb/10)                               0.117                       0.609
I(bili/100)                             0.612                       0.408
I((bili/100)^2)                         0.515                       0.150
                        Cramer von Mises test p-value H_0:constant effect
(Intercept)                            0.1320                       0.750
I(alb/10)                              0.0124                       0.616
I(bili/100)                            0.4640                       0.309
I((bili/100)^2)                        0.2880                       0.156

Parametric terms :     
               Coef.     SE Robust SE     z  P-val lower2.5% upper97.5%
const(tment) -0.0395 0.0213    0.0208 -1.89 0.0582   -0.0812    0.00225
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    I(alb/10) + I(bili/100) + I((bili/100)^2), data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactions</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>nonparmod51 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb)</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">+</span> <span class="fu">const</span>(bili) <span class="sc">+</span> <span class="fu">const</span>(tment <span class="sc">*</span> bili),<span class="at">data =</span> pbc3) </span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod51)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          4.03                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.123                       0.189
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                        0.0287                       0.115

Parametric terms :     
                       Coef.       SE Robust SE       z    P-val lower2.5%
const(tment)        -0.00194 0.029400  0.022800 -0.0851 9.32e-01  -0.05960
const(alb)          -0.00859 0.002260  0.002200 -3.9000 9.69e-05  -0.01300
const(bili)          0.00299 0.000869  0.000437  6.8400 7.77e-12   0.00129
const(tment * bili) -0.00116 0.001020  0.000658 -1.7600 7.92e-02  -0.00316
                    upper97.5%
const(tment)          0.055700
const(alb)           -0.004160
const(bili)           0.004690
const(tment * bili)   0.000839
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    const(alb) + const(bili) + const(tment * bili), data = pbc3)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>nonparmod52 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days<span class="sc">/</span><span class="fl">365.25</span>, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(bili) </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(tment <span class="sc">*</span> alb), <span class="at">data =</span> pbc3) </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod52)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.06               0.007

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                          0.12                       0.192
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                        0.0265                       0.118

Parametric terms :     
                      Coef.       SE Robust SE       z    P-val lower2.5%
const(tment)        0.01010 0.199000  0.176000  0.0576 9.54e-01  -0.38000
const(bili)         0.00230 0.000482  0.000385  5.9600 2.45e-09   0.00136
const(alb)         -0.00771 0.003150  0.002780 -2.7700 5.54e-03  -0.01390
const(tment * alb) -0.00132 0.004790  0.004300 -0.3060 7.59e-01  -0.01070
                   upper97.5%
const(tment)          0.40000
const(bili)           0.00324
const(alb)           -0.00154
const(tment * alb)    0.00807
   
  Call: 
aalen(formula = Surv(days/365.25, status != 0) ~ const(tment) + 
    const(bili) + const(alb) + const(tment * alb), data = pbc3)</code></pre>
</div>
</div>
</section>
<section id="table-2.11" class="level3">
<h3 class="anchored" data-anchor-id="table-2.11">Table 2.11</h3>
<div class="cell" data-hash="Ch2_cache/html/table-2.11_82e9738cbe3c624d2f5fcd23bc8f6137">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.11 and in-text results</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive hazards model with piecewise constant baseline hazards</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with only treatment as covariate</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co"># update data set</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>pbc3add <span class="ot">&lt;-</span> pbc3mult</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time1 <span class="ot">&lt;-</span>  <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time2 <span class="ot">&lt;-</span>  <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time3 <span class="ot">&lt;-</span>  <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">3</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>tment0 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (tment <span class="sc">==</span> <span class="dv">0</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>tment1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (tment <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>albny <span class="ot">&lt;-</span>  <span class="fu">with</span>(pbc3add, ((alb<span class="dv">-35</span>)<span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>biliny <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, ((bili<span class="dv">-50</span>)<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">*</span>risktime<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text</span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>additive_pcw <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">0</span>),</span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(additive_pcw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4  5
  term   estimate std.error statistic      p.value
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
1 time1   0.0911     0.0164     5.55  0.0000000293
2 time2   0.132      0.0241     5.46  0.0000000487
3 time3   0.0937     0.0462     2.03  0.0423      
4 tment1 -0.00726    0.0208    -0.350 0.726       </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.11 - questionable fit</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>additive_pcw2<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">+</span> albny <span class="sc">+</span> biliny <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.35</span>, <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="sc">-</span><span class="fl">0.8</span>, <span class="dv">2</span>),</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(additive_pcw2<span class="fl">.11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  5
  term   estimate std.error statistic  p.value
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 time1    0.185     0.0213      8.67 4.46e-18
2 time2    0.241     0.0258      9.32 1.21e-20
3 time3    0.229     0.0544      4.22 2.48e- 5
4 tment1  -0.0224    0.0173     -1.30 1.95e- 1
5 albny   -0.436     0.128      -3.40 6.79e- 4
6 biliny   2.22      0.408       5.45 4.98e- 8</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>additive_pcw2<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">+</span> albny <span class="sc">+</span> biliny <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.35</span>, <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="sc">-</span><span class="fl">0.8</span>, <span class="fl">2.1</span>),</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(additive_pcw2<span class="fl">.11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  5
  term   estimate std.error statistic  p.value
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 time1    0.186     0.0214      8.68 4.08e-18
2 time2    0.242     0.0259      9.32 1.14e-20
3 time3    0.231     0.0548      4.22 2.45e- 5
4 tment1  -0.0223    0.0174     -1.28 2.00e- 1
5 albny   -0.436     0.129      -3.37 7.63e- 4
6 biliny   2.25      0.411       5.48 4.21e- 8</code></pre>
</div>
</div>
</section>
<section id="table-2.13" class="level3">
<h3 class="anchored" data-anchor-id="table-2.13">Table 2.13</h3>
<div class="cell" data-hash="Ch2_cache/html/table-2.13_c6ebd6e723ec020fe26805b43842542f">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Death without transplantation</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> sex <span class="sc">+</span> age,</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status == 2) ~ tment + alb + log2bili + 
    sex + age, data = pbc3, method = "breslow")

             coef exp(coef) se(coef)      z        p
tment    -0.42049   0.65672  0.26822 -1.568   0.1169
alb      -0.06992   0.93247  0.02906 -2.406   0.0161
log2bili  0.69178   1.99726  0.09303  7.436 1.04e-13
sex       0.48557   1.62510  0.31943  1.520   0.1285
age       0.07335   1.07611  0.01621  4.524 6.06e-06

Likelihood ratio test=98.71  on 5 df, p=&lt; 2.2e-16
n= 343, number of events= 60 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transplantation</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> sex <span class="sc">+</span> age,</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status == 1) ~ tment + alb + log2bili + 
    sex + age, data = pbc3, method = "breslow")

             coef exp(coef) se(coef)      z        p
tment    -0.67305   0.51015  0.41318 -1.629   0.1033
alb      -0.09400   0.91029  0.03871 -2.428   0.0152
log2bili  0.83213   2.29820  0.14655  5.678 1.36e-08
sex       0.20378   1.22602  0.56329  0.362   0.7175
age      -0.04805   0.95309  0.02138 -2.247   0.0246

Likelihood ratio test=64.95  on 5 df, p=1.15e-12
n= 343, number of events= 28 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Failure of medical treatment</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> sex <span class="sc">+</span> age,</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"breslow"</span>, <span class="at">data =</span> pbc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    sex + age, data = pbc3, method = "breslow")

             coef exp(coef) se(coef)      z       p
tment    -0.50964   0.60071  0.22339 -2.281 0.02252
alb      -0.07136   0.93112  0.02293 -3.112 0.00186
log2bili  0.73778   2.09128  0.07768  9.497 &lt; 2e-16
sex       0.58536   1.79563  0.26738  2.189 0.02858
age       0.03077   1.03125  0.01199  2.566 0.01029

Likelihood ratio test=134.3  on 5 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
</div>
</section>
</section>
<section id="guinea-bissau-study" class="level2">
<h2 class="anchored" data-anchor-id="guinea-bissau-study">Guinea-Bissau study</h2>
<section id="read-data-1" class="level3">
<h3 class="anchored" data-anchor-id="read-data-1">Read data</h3>
<div class="cell" data-hash="Ch2_cache/html/read-bissau_0bbcbfc2f50c93936bebef06620e80e2">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>bissau <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">read.csv</span>(<span class="st">"data/bissau.csv"</span>))</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>agem <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(bissau<span class="sc">$</span>age<span class="sc">/</span><span class="fl">30.44</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="table-2.12" class="level3">
<h3 class="anchored" data-anchor-id="table-2.12">Table 2.12</h3>
<div class="cell" data-hash="Ch2_cache/html/table-2.12_7d7d0b9bb91a5a4746e81447759667de">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model in column 1</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>coxfit0 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fuptime, dead) <span class="sc">~</span> bcg, </span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> bissau, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>coxfit0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fuptime, dead) ~ bcg, data = bissau, method = "breslow")

       coef exp(coef) se(coef)      z      p
bcg -0.2821    0.7542   0.1353 -2.085 0.0371

Likelihood ratio test=4.28  on 1 df, p=0.03851
n= 5274, number of events= 222 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model in column 1</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>coxfit1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fuptime, dead) <span class="sc">~</span> bcg <span class="sc">+</span> agem, </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> bissau, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>coxfit1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fuptime, dead) ~ bcg + agem, data = bissau, 
    method = "breslow")

         coef exp(coef) se(coef)      z      p
bcg  -0.35203   0.70326  0.14424 -2.441 0.0147
agem  0.05376   1.05523  0.03856  1.394 0.1633

Likelihood ratio test=6.21  on 2 df, p=0.04481
n= 5274, number of events= 222 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make age the time variable instead</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>agein <span class="ot">&lt;-</span> bissau<span class="sc">$</span>age<span class="sc">/</span>(<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>ageout <span class="ot">&lt;-</span> bissau<span class="sc">$</span>agein <span class="sc">+</span> bissau<span class="sc">$</span>fuptime<span class="sc">/</span>(<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model in column 2</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="co"># option timefix=F aligns to SAS calculation</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="co"># see vignette 'Roundoff error and tied times' for survival package</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>coxfit2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(agein, ageout, dead) <span class="sc">~</span> bcg, </span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> bissau, <span class="at">method =</span> <span class="st">"breslow"</span>,<span class="at">timefix=</span>F)</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>coxfit2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(agein, ageout, dead) ~ bcg, data = bissau, 
    method = "breslow", timefix = F)

       coef exp(coef) se(coef)      z      p
bcg -0.3558    0.7006   0.1407 -2.529 0.0114

Likelihood ratio test=6.28  on 1 df, p=0.01218
n= 5274, number of events= 222 </code></pre>
</div>
</div>
</section>
<section id="figure-2.13" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.13">Figure 2.13</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.13_8478225521d5252a76a48a0a95fe67be">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General plotting style </span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>)) </span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxfit1, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>coxdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> coxcumhaz<span class="sc">$</span>hazard, </span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> coxcumhaz<span class="sc">$</span>time, </span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bcg =</span> <span class="fu">rep</span>(<span class="st">"1"</span>, <span class="fu">nrow</span>(coxcumhaz)), </span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Breslow estimate"</span>, <span class="fu">nrow</span>(coxcumhaz)))</span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.13</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> (<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>), <span class="at">y =</span> cumhaz), <span class="at">data =</span> coxdata) <span class="sc">+</span> </span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb168-24"><a href="#cb168-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Follow-up time (months)"</span>) <span class="sc">+</span> </span>
<span id="cb168-25"><a href="#cb168-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb168-26"><a href="#cb168-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb168-27"><a href="#cb168-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb168-28"><a href="#cb168-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb168-29"><a href="#cb168-29" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb168-30"><a href="#cb168-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-31"><a href="#cb168-31" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.13-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
<section id="figure-2.14" class="level3">
<h3 class="anchored" data-anchor-id="figure-2.14">Figure 2.14</h3>
<div class="cell" data-hash="Ch2_cache/html/figure-2.14_3c3a95fb93215c8a3aa7bddefd90aa4c">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxfit2, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>coxdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> coxcumhaz<span class="sc">$</span>hazard, </span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> coxcumhaz<span class="sc">$</span>time, </span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bcg =</span> <span class="fu">rep</span>(<span class="st">"1"</span>, <span class="fu">nrow</span>(coxcumhaz)), </span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Breslow estimate"</span>, <span class="fu">nrow</span>(coxcumhaz)))</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.14</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">data =</span> coxdata) <span class="sc">+</span> </span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age (months)"</span>) <span class="sc">+</span> </span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.1</span>)), </span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.15</span>, <span class="at">by =</span> <span class="fl">0.05</span>), </span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"0.05"</span>, <span class="st">"0.10"</span>, <span class="st">"0.15"</span>)) <span class="sc">+</span></span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/figure-2.14-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</section>
</section>
<section id="recurrent-episodes-in-affective-disorders" class="level2">
<h2 class="anchored" data-anchor-id="recurrent-episodes-in-affective-disorders">Recurrent episodes in affective disorders</h2>
<section id="read-data-2" class="level3">
<h3 class="anchored" data-anchor-id="read-data-2">Read data</h3>
<div class="cell" data-hash="Ch2_cache/html/read-affective_c4c57dae340b8ebfa52979c1abb6e2a0">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>affective <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">read.csv</span>(<span class="st">"data/affective.csv"</span>))</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>affective<span class="sc">$</span>wait <span class="ot">&lt;-</span> <span class="fu">with</span>(affective, stop <span class="sc">-</span> start)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="table-2.14" class="level3">
<h3 class="anchored" data-anchor-id="table-2.14">Table 2.14</h3>
<div class="cell" data-hash="Ch2_cache/html/table-2.14_ec3f8976090995d4585731c70f6a8035">
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model for 1., 2., 3., 4. episode 'Markov': Column 1</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    episode == 1 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.3552    1.4264   0.2500 1.421 0.155

Likelihood ratio test=1.89  on 1 df, p=0.1692
n= 116, number of events= 99 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    episode == 2 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.1890    1.2080   0.2604 0.726 0.468

Likelihood ratio test=0.51  on 1 df, p=0.4751
n= 91, number of events= 82 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    episode == 3 &amp; state == 0), method = "breslow")

       coef exp(coef) se(coef)      z     p
bip -0.1175    0.8891   0.3005 -0.391 0.696

Likelihood ratio test=0.16  on 1 df, p=0.6936
n= 74, number of events= 62 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    episode == 4 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z       p
bip 1.1500    3.1581   0.3536 3.252 0.00114

Likelihood ratio test=9.93  on 1 df, p=0.001623
n= 56, number of events= 47 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model for 1., 2., 3., 4. episode 'Gap time': Column 2</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    episode == 1 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.3991    1.4905   0.2487 1.605 0.109

Likelihood ratio test=2.39  on 1 df, p=0.1222
n= 116, number of events= 99 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    episode == 2 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)    z     p
bip 0.2165    1.2418   0.2579 0.84 0.401

Likelihood ratio test=0.68  on 1 df, p=0.41
n= 91, number of events= 82 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    episode == 3 &amp; state == 0), method = "breslow")

       coef exp(coef) se(coef)      z     p
bip -0.1114    0.8946   0.2867 -0.389 0.698

Likelihood ratio test=0.15  on 1 df, p=0.6953
n= 74, number of events= 62 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">subset</span>(affective, episode <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    episode == 4 &amp; state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.5964    1.8155   0.3183 1.874 0.061

Likelihood ratio test=3.31  on 1 df, p=0.06905
n= 56, number of events= 47 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AG cox model, total time</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    state == 0), method = "breslow")

       coef exp(coef) se(coef)     z        p
bip 0.36593   1.44186  0.09448 3.873 0.000107

Likelihood ratio test=14.24  on 1 df, p=0.0001612
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AG cox model, gap time</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ bip, data = subset(affective, 
    state == 0), method = "breslow")

       coef exp(coef) se(coef)     z     p
bip 0.12555   1.13377  0.09445 1.329 0.184

Likelihood ratio test=1.74  on 1 df, p=0.1875
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP cox model, total time</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="fu">strata</span>(episode) <span class="sc">+</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ strata(episode) + 
    bip, data = subset(affective, state == 0), method = "breslow")

      coef exp(coef) se(coef)     z     p
bip 0.2418    1.2736   0.1121 2.157 0.031

Likelihood ratio test=4.54  on 1 df, p=0.03312
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code hide/show</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PWP cox model, gap time</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="fu">strata</span>(episode) <span class="sc">+</span> bip, <span class="at">method =</span> <span class="st">"breslow"</span>, </span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, status == 1) ~ strata(episode) + bip, 
    data = subset(affective, state == 0), method = "breslow")

       coef exp(coef) se(coef)     z     p
bip 0.02781   1.02820  0.10040 0.277 0.782

Likelihood ratio test=0.08  on 1 df, p=0.7821
n= 626, number of events= 542 </code></pre>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise-2.1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.1">Exercise 2.1</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch3.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</div>   
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>