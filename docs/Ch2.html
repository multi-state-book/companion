<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values - 2&nbsp; Intuition for intensity models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch3.html" rel="next">
<link href="./Ch1.html" rel="prev">
<link href="./corvos.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pbc3-trial" id="toc-pbc3-trial" class="nav-link active" data-scroll-target="#pbc3-trial">PBC3 trial</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-2.1" id="toc-exercise-2.1" class="nav-link" data-scroll-target="#exercise-2.1">Exercise 2.1</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="pbc3-trial" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="pbc3-trial">PBC3 trial</h2>
<div class="cell" data-file="R/chapter2_pbc3.r" data-hash="Ch2_cache/html/pbc3_3d0e2c23055104d7c273bc8d66399ff2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#------- Chapter 2, R code, PBC3 data  ----------------------------#</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timereg)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data and create a data frame</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pbc3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">read.csv</span>(<span class="st">"data/pbc3.csv"</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pbc3<span class="sc">$</span>tment <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># The main event of interest is "failure of medical treatment" </span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e., either death or liver transplant</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- General plotting style ---------------------------------# </span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.1 --------------------------------------#</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Nelson Aalen estimate by treatment</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>nafit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>nadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> nafit<span class="sc">$</span>cumhaz, </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cumhaz_se =</span> nafit<span class="sc">$</span>std.err, </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">time =</span> nafit<span class="sc">$</span>time, </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">1</span>], nafit<span class="sc">$</span>strata[<span class="dv">1</span>]), </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">2</span>], nafit<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.1</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment), <span class="at">data =</span> nadata) <span class="sc">+</span> </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)) <span class="sc">+</span> </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>))  <span class="sc">+</span> </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span> </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>,<span class="at">legend.box=</span><span class="st">"vertical"</span>,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimates after two years</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">subset</span>(nadata, nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span><span class="sc">*</span><span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=0"</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     cumhaz  cumhaz_se time   tment
60 0.183065 0.03560398  724 tment=0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">subset</span>(nadata, nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span><span class="sc">*</span><span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=1"</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       cumhaz  cumhaz_se time   tment
209 0.1668539 0.03449431  725 tment=1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log rank test for treatment </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">survdiff</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3), <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(days, status != 0) ~ tment, data = pbc3)

          N Observed Expected (O-E)^2/E (O-E)^2/V
tment=0 173       46    44.68   0.03878   0.07708
tment=1 176       44    45.32   0.03824   0.07708

 Chisq= 0.1  on 1 degrees of freedom, p= 0.78 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.1 ---------------------------------------#</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>cuts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>) <span class="sc">*</span> <span class="fl">365.25</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># event/failure indicator</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>fail <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pbc3<span class="sc">$</span>status <span class="sc">!=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data ready using survSplit</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>pbc3mult <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> ., pbc3,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">episode =</span> <span class="st">"timegroup"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>risktime <span class="ot">&lt;-</span> pbc3mult<span class="sc">$</span>days <span class="sc">-</span> cuts[pbc3mult<span class="sc">$</span>timegroup] </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Data for Table 2.1</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>pcwdata <span class="ot">&lt;-</span> pbc3mult <span class="sc">%&gt;%</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tment, timegroup) <span class="sc">%&gt;%</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fail =</span> <span class="fu">sum</span>(fail), <span class="at">risktime =</span> <span class="fu">sum</span>(days <span class="sc">-</span> cuts[timegroup]))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>risktimeyrs <span class="ot">&lt;-</span> pcwdata<span class="sc">$</span>risktime<span class="sc">/</span><span class="fl">365.25</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>hazard <span class="ot">&lt;-</span> <span class="dv">36525</span><span class="sc">*</span>pcwdata<span class="sc">$</span>fail<span class="sc">/</span>pcwdata<span class="sc">$</span>risktime</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>SD <span class="ot">&lt;-</span> <span class="dv">36525</span><span class="sc">*</span><span class="fu">sqrt</span>(pcwdata<span class="sc">$</span>fail)<span class="sc">/</span>pcwdata<span class="sc">$</span>risktime</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(pcwdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tment timegroup fail risktime risktimeyrs    hazard       SD
1     0         1   27 104856.0   287.08008  9.405041 1.810001
2     0         2   17  49673.0   135.99726 12.500252 3.031756
3     0         3    2   8642.0    23.66051  8.452904 5.977106
4     1         1   24 107931.5   295.50034  8.121818 1.657859
5     1         2   18  50284.5   137.67146 13.074605 3.081714
6     1         3    2   7599.0    20.80493  9.613107 6.797493</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT test using piece-wise exponential model</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>poisfull <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime<span class="sc">/</span><span class="dv">36525</span>)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> tment <span class="sc">+</span> timegroup <span class="sc">+</span> tment<span class="sc">:</span>timegroup, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>poisreduced <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime<span class="sc">/</span><span class="dv">36525</span>)) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> timegroup, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> pbc3mult, <span class="at">family =</span> poisson)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(poisreduced,poisfull,<span class="at">test=</span><span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: fail ~ offset(log(risktime/36525)) + -1 + timegroup
Model 2: fail ~ offset(log(risktime/36525)) + -1 + tment + timegroup + 
    tment:timegroup
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1       620     459.66                     
2       617     459.35  3  0.30813   0.9585</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.2 --------------------------------------#</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rates + cuts from Table 2.1</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>rateCyA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">8.1</span>,<span class="fl">13.1</span>,<span class="fl">9.6</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>ratePbo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.4</span>,<span class="fl">12.5</span>,<span class="fl">8.5</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>pcwtime <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rates =</span> <span class="fu">c</span>(rateCyA, ratePbo),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"CyA"</span>, <span class="fu">length</span>(rateCyA)), </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Placebo"</span>, <span class="fu">length</span>(ratePbo))),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times_s =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">4</span>], <span class="dv">2</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.2</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rates, <span class="at">linetype =</span> tment), <span class="at">data =</span> plotdata) <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> times_s, <span class="at">y =</span> rates, <span class="at">xend =</span> times, <span class="at">yend =</span> rates), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>))  <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimated hazard function (per 100 years)"</span>) <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">1</span>))  <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">14</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  theme_general<span class="sc">+</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-2.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.3 --------------------------------------#</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># NA data from figure 2.1 model fit</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>tment1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(nadata, tment <span class="sc">==</span> <span class="st">"tment=1"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated hazard per time group</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>pcwdata<span class="sc">$</span>hazard_timegroup <span class="ot">&lt;-</span> pcwdata<span class="sc">$</span>fail <span class="sc">/</span> pcwdata<span class="sc">$</span>risktime</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a numeric version of the treatment to the NA estimates</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>tmentnum <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=1"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add piecewise constant hazard to data</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Between time 0 and 2</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="ot">&lt;-</span> nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">*</span> </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                                 (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                                  pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Between time 2 and 4</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span><span class="sc">*</span> <span class="fl">365.25</span> ] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  (nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>) <span class="sc">*</span> </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">5</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># After time 4</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">5</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  (nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>) <span class="sc">*</span> </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  (pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">3</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>     pcwdata<span class="sc">$</span>hazard_timegroup[<span class="dv">6</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Reformat for plot</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>piecepdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> <span class="fu">c</span>(nadata<span class="sc">$</span>cumhaz, nadata<span class="sc">$</span>pwch), </span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                         <span class="at">time =</span> <span class="fu">rep</span>(nadata<span class="sc">$</span>time, <span class="dv">2</span>),</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tmentnum =</span> <span class="fu">rep</span>(nadata<span class="sc">$</span>tmentnum, <span class="dv">2</span>),</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Nelson-Aalen"</span>, <span class="fu">length</span>(nadata<span class="sc">$</span>time)), </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Piece-wise exponential"</span>, <span class="fu">length</span>(nadata<span class="sc">$</span>time))))</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Only for treatment 1</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>piecepdata1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(piecepdata, tmentnum <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.3</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> type), </span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(piecepdata1, type <span class="sc">==</span> <span class="st">"Nelson-Aalen"</span>)) <span class="sc">+</span> </span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> type), <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">subset</span>(piecepdata1, type <span class="sc">==</span> <span class="st">"Piece-wise exponential"</span>)) <span class="sc">+</span> </span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">linetype =</span> <span class="st">"Type"</span>) <span class="sc">+</span> </span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>))  <span class="sc">+</span> </span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  theme_general<span class="sc">+</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-3.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.5 --------------------------------------#</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a Cox model using the pbc3 data with treatment as a covariate</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of fit</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment, data = pbc3, 
    method = "breslow")

  n= 349, number of events= 90 

          coef exp(coef) se(coef)      z Pr(&gt;|z|)
tment -0.05854   0.94314  0.21092 -0.278    0.781

      exp(coef) exp(-coef) lower .95 upper .95
tment    0.9431       1.06    0.6238     1.426

Concordance= 0.517  (se = 0.029 )
Likelihood ratio test= 0.08  on 1 df,   p=0.8
Wald test            = 0.08  on 1 df,   p=0.8
Score (logrank) test = 0.08  on 1 df,   p=0.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxfit, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>coxdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> coxcumhaz<span class="sc">$</span>hazard, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> coxcumhaz<span class="sc">$</span>time, </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tment =</span> <span class="fu">rep</span>(<span class="st">"0"</span>, <span class="fu">nrow</span>(coxcumhaz)), </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Breslow estimate"</span>, <span class="fu">nrow</span>(coxcumhaz)))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.5</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment), <span class="at">data =</span> coxdata) <span class="sc">+</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard"</span>) <span class="sc">+</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>)) <span class="sc">+</span> </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  theme_general<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-4.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.3 ---------------------------------------#</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average covariate values of albumin and bilirubin per treatment group</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>pcwdata <span class="ot">&lt;-</span> pbc3 <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tment, tment_char) <span class="sc">%&gt;%</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(id <span class="sc">!=</span> <span class="dv">0</span>),  </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">average_albumin =</span> <span class="fu">mean</span>(alb, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># </span><span class="al">NOTE</span><span class="co">: Removes missing observations from mean computation</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">average_bilirubin =</span> <span class="fu">mean</span>(bili, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>pcwdata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pcwdata)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>pcwdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tment tment_char   n average_albumin average_bilirubin
1     0    Placebo 173        39.26101          42.33674
2     1        CyA 176        37.50731          48.55540</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.4 ---------------------------------------#</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model with treatment, albumin and bilirubin as covariates </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> pbc3)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

            coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    
tment -0.4965639  0.6086184  0.2256162 -2.201   0.0277 *  
alb   -0.1156596  0.8907784  0.0212810 -5.435 5.48e-08 ***
bili   0.0089494  1.0089895  0.0009801  9.131  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
tment    0.6086     1.6431    0.3911    0.9471
alb      0.8908     1.1226    0.8544    0.9287
bili     1.0090     0.9911    1.0071    1.0109

Concordance= 0.806  (se = 0.021 )
Likelihood ratio test= 99.06  on 3 df,   p=&lt;2e-16
Wald test            = 121  on 3 df,   p=&lt;2e-16
Score (logrank) test = 172.3  on 3 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.5 ---------------------------------------#</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model with treatment, albumin and bilirubin as covariates</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>tment_char)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>poismod_t25 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pbc3mult,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> poisson)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t25)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili, family = poisson, data = pbc3mult)

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -4.7682896  0.9749615  -4.891  1.0e-06 ***
as.factor(timegroup)1 -0.3196440  0.6042836  -0.529   0.5968    
as.factor(timegroup)2  0.5381074  0.6022200   0.894   0.3716    
tment_charPlacebo      0.4753406  0.2240970   2.121   0.0339 *  
alb                   -0.1123359  0.0212829  -5.278  1.3e-07 ***
bili                   0.0084593  0.0009392   9.007  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.73  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 538.73

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.6 ---------------------------------------#</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add transformations of covariates </span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>albnorm <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (alb<span class="dv">-35</span>)<span class="sc">*</span>(alb<span class="sc">&gt;</span><span class="dv">35</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb10 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, alb<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, alb10<span class="sc">*</span>alb10)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilihigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-17.1</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>))</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilitoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-34.2</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>))</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilimuchtoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-51.3</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili100 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, bili<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, bili100<span class="sc">*</span>bili100)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fu">log2</span>(bili))</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilihigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">17.1</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>))</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilitoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">34.2</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>))</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilimuchtoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">51.3</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>))</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, log2bili<span class="sc">*</span>log2bili)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data ready using survSplit</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>pbc3mult <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> ., </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>                      pbc3,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">episode =</span> <span class="st">"timegroup"</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk time</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>risktime <span class="ot">&lt;-</span> pbc3mult<span class="sc">$</span>days <span class="sc">-</span> cuts[pbc3mult<span class="sc">$</span>timegroup] </span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Poisson models ##</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co"># For comparison, LR test</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>base_poismod <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> pbc3mult,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> poisson)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>base_poismod_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult,</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Linear effects </span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 1</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>poismod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> albnorm,</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pbc3mult,</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> poisson)</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili + albnorm, family = poisson, data = pbc3mult)

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -5.1177409  1.6273358  -3.145  0.00166 ** 
as.factor(timegroup)1 -0.3106216  0.6042733  -0.514  0.60722    
as.factor(timegroup)2  0.5433694  0.6022062   0.902  0.36690    
tment_charCyA         -0.4576984  0.2247281  -2.037  0.04168 *  
alb                   -0.0864388  0.0451742  -1.913  0.05569 .  
bili                   0.0084777  0.0009419   9.001  &lt; 2e-16 ***
albnorm               -0.0473832  0.0720301  -0.658  0.51065    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.28  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 540.28

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(lmtest)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l1, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>       base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + bili + albnorm
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -263.14                     
2   6 -263.36 -1 0.4404     0.5069</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Small error in table, test statistic = 0.44 (not 0.43)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 2</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>poismod_t26_l2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                       bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh, 
    family = poisson, data = pbc3mult)

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.453990   1.368380  -4.717  2.4e-06 ***
as.factor(timegroup)1 -0.427435   0.604700  -0.707   0.4797    
as.factor(timegroup)2  0.425435   0.603554   0.705   0.4809    
tment_charCyA         -0.569111   0.226892  -2.508   0.0121 *  
alb                   -0.086487   0.021876  -3.954  7.7e-05 ***
bili                   0.061654   0.062308   0.989   0.3224    
bilihigh              -0.016757   0.085194  -0.197   0.8441    
bilitoohigh            0.002652   0.052566   0.050   0.9598    
bilimuchtoohigh       -0.042801   0.026193  -1.634   0.1022    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 326.18  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.18

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l2, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>       base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   9 -251.09                         
2   6 -263.36 -3 24.545  1.922e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 3</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                       log2bili <span class="sc">+</span> logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + logbilihigh + logbilitoohigh + 
    logbilimuchtoohigh, family = poisson, data = pbc3mult)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.52003    1.99572  -3.267 0.001087 ** 
as.factor(timegroup)1 -0.40679    0.60392  -0.674 0.500579    
as.factor(timegroup)2  0.41834    0.60355   0.693 0.488223    
tment_charCyA         -0.55563    0.22703  -2.447 0.014390 *  
alb                   -0.08440    0.02181  -3.870 0.000109 ***
log2bili               0.19800    0.46549   0.425 0.670583    
logbilihigh            0.88154    0.91202   0.967 0.333756    
logbilitoohigh        -0.23363    1.27745  -0.183 0.854884    
logbilimuchtoohigh    -0.31390    0.97076  -0.323 0.746425    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.54  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 521.54

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l3, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>       base_poismod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   9 -251.77                     
2   6 -252.62 -3 1.7135     0.6339</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Quadratic effects</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For comparison, LR test</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>base_poismod2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> bili100,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>base_poismod2_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> log2bili,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> pbc3mult,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> poisson)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 1</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>poismod_t26_q1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> alb2 <span class="sc">+</span> bili100,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb10 + alb2 + bili100, family = poisson, data = pbc3mult)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -3.82798    3.81418  -1.004   0.3156    
as.factor(timegroup)1 -0.32278    0.60484  -0.534   0.5936    
as.factor(timegroup)2  0.53621    0.60243   0.890   0.3734    
tment_charCyA         -0.47868    0.22585  -2.119   0.0341 *  
alb10                 -1.38772    2.10146  -0.660   0.5090    
alb2                   0.03705    0.29295   0.126   0.8993    
bili100                0.84614    0.09391   9.010   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.71  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 540.71

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q1, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>       base_poismod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + alb2 + bili100
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + bili100
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -263.36                     
2   6 -263.36 -1 0.0158     0.8999</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 2</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> bili2 <span class="sc">+</span> bili100,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb10 + bili2 + bili100, family = poisson, data = pbc3mult)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -5.16310    1.05317  -4.902 9.47e-07 ***
as.factor(timegroup)1 -0.38186    0.60472  -0.631  0.52774    
as.factor(timegroup)2  0.45545    0.60332   0.755  0.45030    
tment_charCyA         -0.49873    0.22169  -2.250  0.02447 *  
alb10                 -0.97736    0.21632  -4.518 6.24e-06 ***
bili2                 -0.31517    0.09069  -3.475  0.00051 ***
bili100                1.99829    0.32664   6.118 9.49e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 337.38  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 527.38

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q2, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>       base_poismod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + bili2 + bili100
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + bili100
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   7 -256.69                         
2   6 -263.36 -1 13.345  0.0002591 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 3</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili2,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb10 + log2bili + log2bili2, family = poisson, 
    data = pbc3mult)

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -7.860086   1.851557  -4.245 2.18e-05 ***
as.factor(timegroup)1 -0.406020   0.604625  -0.672   0.5019    
as.factor(timegroup)2  0.439074   0.603467   0.728   0.4669    
tment_charCyA         -0.545495   0.222667  -2.450   0.0143 *  
alb10                 -0.871058   0.218920  -3.979 6.92e-05 ***
log2bili               0.627828   0.497489   1.262   0.2070    
log2bili2              0.001641   0.042356   0.039   0.9691    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.25  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.25

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q3, </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>       base_poismod2_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + log2bili + log2bili2
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -252.62                     
2   6 -252.62 -1 0.0015     0.9691</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Cox models ##</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Models for LR tests</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>base_coxmod <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>base_coxmod_log <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Linear effects </span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 1</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> albnorm, <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> pbc3)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_l1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili + 
    albnorm, data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

              coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    
tment   -0.4750722  0.6218402  0.2261462 -2.101   0.0357 *  
alb     -0.0854244  0.9181225  0.0453150 -1.885   0.0594 .  
bili     0.0089810  1.0090214  0.0009843  9.124   &lt;2e-16 ***
albnorm -0.0557001  0.9458228  0.0726447 -0.767   0.4432    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
tment      0.6218     1.6081    0.3992    0.9687
alb        0.9181     1.0892    0.8401    1.0034
bili       1.0090     0.9911    1.0071    1.0110
albnorm    0.9458     1.0573    0.8203    1.0905

Concordance= 0.806  (se = 0.021 )
Likelihood ratio test= 99.66  on 4 df,   p=&lt;2e-16
Wald test            = 118.5  on 4 df,   p=&lt;2e-16
Score (logrank) test = 175.5  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l1, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili + albnorm
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -413.12                     
2   3 -413.42 -1 0.6001     0.4386</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or alternatively anova(coxmod_t26_l1)</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 2</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_l2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili + 
    bilihigh + bilitoohigh + bilimuchtoohigh, data = pbc3, method = "breslow", 
    eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

                     coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
tment           -0.598494  0.549639  0.229637 -2.606  0.00915 ** 
alb             -0.090970  0.913045  0.021894 -4.155 3.25e-05 ***
bili             0.062425  1.064414  0.062296  1.002  0.31631    
bilihigh        -0.014631  0.985476  0.085327 -0.171  0.86386    
bilitoohigh     -0.002584  0.997419  0.052961 -0.049  0.96109    
bilimuchtoohigh -0.040017  0.960773  0.026486 -1.511  0.13082    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

                exp(coef) exp(-coef) lower .95 upper .95
tment              0.5496     1.8194    0.3504    0.8621
alb                0.9130     1.0952    0.8747    0.9531
bili               1.0644     0.9395    0.9421    1.2026
bilihigh           0.9855     1.0147    0.8337    1.1649
bilitoohigh        0.9974     1.0026    0.8991    1.1065
bilimuchtoohigh    0.9608     1.0408    0.9122    1.0120

Concordance= 0.825  (se = 0.021 )
Likelihood ratio test= 123.5  on 6 df,   p=&lt;2e-16
Wald test            = 110.8  on 6 df,   p=&lt;2e-16
Score (logrank) test = 173.9  on 6 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l2, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + 
    bilimuchtoohigh
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   6 -401.22                         
2   3 -413.42 -3 24.396  2.064e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 3</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_l3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    logbilihigh + logbilitoohigh + logbilimuchtoohigh, data = pbc3, 
    method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

                       coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment              -0.58019   0.55979  0.22957 -2.527   0.0115 *  
alb                -0.08852   0.91528  0.02182 -4.056 4.99e-05 ***
log2bili            0.20135   1.22306  0.46511  0.433   0.6651    
logbilihigh         0.93567   2.54893  0.91503  1.023   0.3065    
logbilitoohigh     -0.38647   0.67945  1.29333 -0.299   0.7651    
logbilimuchtoohigh -0.18140   0.83410  0.98801 -0.184   0.8543    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

                   exp(coef) exp(-coef) lower .95 upper .95
tment                 0.5598     1.7864   0.35696    0.8779
alb                   0.9153     1.0926   0.87696    0.9553
log2bili              1.2231     0.8176   0.49152    3.0433
logbilihigh           2.5489     0.3923   0.42412   15.3191
logbilitoohigh        0.6794     1.4718   0.05386    8.5712
logbilimuchtoohigh    0.8341     1.1989   0.12029    5.7838

Concordance= 0.823  (se = 0.021 )
Likelihood ratio test= 121.6  on 6 df,   p=&lt;2e-16
Wald test            = 108.5  on 6 df,   p=&lt;2e-16
Score (logrank) test = 164.3  on 6 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l3, base_coxmod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + 
    logbilitoohigh + logbilimuchtoohigh
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -402.13                     
2   3 -402.94 -3 1.6144     0.6561</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Quadratic effects </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 1</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb10 <span class="sc">+</span> bili100 <span class="sc">+</span> alb2,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb10 + bili100 + 
    alb2, data = pbc3)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

            coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment   -0.49840   0.60750  0.22743 -2.191   0.0284 *  
alb10   -1.29704   0.27334  2.13031 -0.609   0.5426    
bili100  0.89502   2.44739  0.09800  9.133   &lt;2e-16 ***
alb2     0.01971   1.01991  0.29751  0.066   0.9472    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
tment      0.6075     1.6461  0.389011    0.9487
alb10      0.2733     3.6584  0.004201   17.7838
bili100    2.4474     0.4086  2.019676    2.9657
alb2       1.0199     0.9805  0.569276    1.8273

Concordance= 0.806  (se = 0.021 )
Likelihood ratio test= 99.06  on 4 df,   p=&lt;2e-16
Wald test            = 121.2  on 4 df,   p=&lt;2e-16
Score (logrank) test = 178.8  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 2</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb10 <span class="sc">+</span> bili100 <span class="sc">+</span> bili2,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_q2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb10 + bili100 + 
    bili2, data = pbc3)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

            coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment   -0.52111   0.59386  0.22330 -2.334 0.019613 *  
alb10   -1.01919   0.36089  0.21675 -4.702 2.57e-06 ***
bili100  1.99811   7.37511  0.32629  6.124 9.14e-10 ***
bili2   -0.30520   0.73698  0.09098 -3.355 0.000795 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
tment      0.5939     1.6839    0.3834    0.9199
alb10      0.3609     2.7709    0.2360    0.5519
bili100    7.3751     0.1356    3.8907   13.9800
bili2      0.7370     1.3569    0.6166    0.8808

Concordance= 0.815  (se = 0.021 )
Likelihood ratio test= 111.4  on 4 df,   p=&lt;2e-16
Wald test            = 121.6  on 4 df,   p=&lt;2e-16
Score (logrank) test = 172.5  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 3</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb10 <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili2,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb10 + log2bili + 
    log2bili2, data = pbc3)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

               coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
tment     -0.574344  0.563074  0.224533 -2.558   0.0105 *  
alb10     -0.914495  0.400719  0.219173 -4.172 3.01e-05 ***
log2bili   0.583636  1.792545  0.500009  1.167   0.2431    
log2bili2  0.007044  1.007069  0.042774  0.165   0.8692    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

          exp(coef) exp(-coef) lower .95 upper .95
tment        0.5631     1.7760    0.3626    0.8744
alb10        0.4007     2.4955    0.2608    0.6157
log2bili     1.7925     0.5579    0.6728    4.7762
log2bili2    1.0071     0.9930    0.9261    1.0951

Concordance= 0.819  (se = 0.022 )
Likelihood ratio test= 120.1  on 4 df,   p=&lt;2e-16
Wald test            = 111.9  on 4 df,   p=&lt;2e-16
Score (logrank) test = 169.6  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.6 --------------------------------------#</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The below linear predictors include estimates from the following models, </span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>tment_char)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>base_poismod <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult,</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili, family = poisson, data = pbc3mult)

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -4.2301822  0.7855195  -5.385 7.24e-08 ***
as.factor(timegroup)3 -0.5381074  0.6022200  -0.894 0.371568    
as.factor(timegroup)1 -0.8577514  0.2361480  -3.632 0.000281 ***
tment_charPlacebo      0.4753406  0.2240970   2.121 0.033910 *  
alb                   -0.1123359  0.0212829  -5.278 1.30e-07 ***
bili                   0.0084593  0.0009392   9.007  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.73  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 538.73

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>poismod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> albnorm,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili + albnorm, family = poisson, data = pbc3mult)

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -5.0320699  1.4715432  -3.420 0.000627 ***
as.factor(timegroup)3 -0.5433694  0.6022062  -0.902 0.366899    
as.factor(timegroup)1 -0.8539910  0.2362103  -3.615 0.000300 ***
tment_charPlacebo      0.4576984  0.2247281   2.037 0.041683 *  
alb                   -0.0864388  0.0451742  -1.913 0.055690 .  
bili                   0.0084777  0.0009419   9.001  &lt; 2e-16 ***
albnorm               -0.0473832  0.0720301  -0.658 0.510651    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.28  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 540.28

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                        bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh, 
    family = poisson, data = pbc3mult)

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.597666   1.204436  -5.478 4.31e-08 ***
as.factor(timegroup)3 -0.425435   0.603554  -0.705  0.48088    
as.factor(timegroup)1 -0.852870   0.231526  -3.684  0.00023 ***
tment_charPlacebo      0.569111   0.226892   2.508  0.01213 *  
alb                   -0.086487   0.021876  -3.954 7.70e-05 ***
bili                   0.061654   0.062308   0.989  0.32242    
bilihigh              -0.016757   0.085194  -0.197  0.84406    
bilitoohigh            0.002652   0.052566   0.050  0.95977    
bilimuchtoohigh       -0.042801   0.026193  -1.634  0.10224    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 326.18  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.18

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataset with linear predictor information</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>lin2 <span class="ot">&lt;-</span> pbc3</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">1.6076-0.1123</span><span class="sc">*</span>alb)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">0.7828-0.0864</span><span class="sc">*</span>alb<span class="fl">-0.0474</span><span class="sc">*</span>albnorm)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">1.6076+0.0085</span><span class="sc">*</span>bili<span class="fl">-38.7</span><span class="sc">*</span><span class="fl">0.1123</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp4 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">0.5534+0.0617</span><span class="sc">*</span>bili<span class="fl">-0.0168</span><span class="sc">*</span>bilihigh<span class="fl">+0.0027</span><span class="sc">*</span>bilitoohigh</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span><span class="fl">0.0428</span><span class="sc">*</span>bilimuchtoohigh<span class="fl">-0.0865</span><span class="sc">*</span><span class="fl">38.7</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>lin2row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(lin2)),</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(lin2))), </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>lp1, lin2<span class="sc">$</span>lp2),</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">alb =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>alb, lin2<span class="sc">$</span>alb))</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alb, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> lin2row) <span class="sc">+</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Albumin"</span>) <span class="sc">+</span> </span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-5.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.7 --------------------------------------#</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bilirubin and the two last linear predictors</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>lin2row2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(lin2)),</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(lin2))), </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>lp3, lin2<span class="sc">$</span>lp4),</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bili =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>bili, lin2<span class="sc">$</span>bili))</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> lin2row2) <span class="sc">+</span> </span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span> </span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(), </span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-6.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.8 --------------------------------------#</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The below linear predictors include estimates from the following models, </span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>base_poismod2_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> log2bili,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> pbc3mult,</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">family =</span> poisson)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(base_poismod2_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb10 + log2bili, family = poisson, data = pbc3mult)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -8.02328    0.95100  -8.437  &lt; 2e-16 ***
as.factor(timegroup)3 -0.43894    0.60346  -0.727 0.466999    
as.factor(timegroup)1 -0.84401    0.22867  -3.691 0.000223 ***
tment_charPlacebo      0.54549    0.22265   2.450 0.014288 *  
alb10                 -0.86972    0.21615  -4.024 5.73e-05 ***
log2bili               0.64689    0.07326   8.830  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.25  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 517.25

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                        log2bili <span class="sc">+</span> logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> pbc3mult,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> poisson)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + logbilihigh + logbilitoohigh + 
    logbilimuchtoohigh, family = poisson, data = pbc3mult)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.65731    1.88624  -3.529 0.000416 ***
as.factor(timegroup)3 -0.41834    0.60355  -0.693 0.488223    
as.factor(timegroup)1 -0.82513    0.22932  -3.598 0.000320 ***
tment_charPlacebo      0.55563    0.22703   2.447 0.014390 *  
alb                   -0.08440    0.02181  -3.870 0.000109 ***
log2bili               0.19800    0.46549   0.425 0.670583    
logbilihigh            0.88154    0.91202   0.967 0.333756    
logbilitoohigh        -0.23363    1.27745  -0.183 0.854884    
logbilimuchtoohigh    -0.31390    0.97076  -0.323 0.746425    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.54  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 521.54

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataset with linear predictor information</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>log2 <span class="ot">&lt;-</span> pbc3</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>log2<span class="sc">$</span>lp3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">2.0162+0.6469</span><span class="sc">*</span>log2bili<span class="fl">-38.7</span><span class="sc">*</span><span class="fl">0.087</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>log2<span class="sc">$</span>lp4 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">0.6194+0.198</span><span class="sc">*</span>log2bili<span class="fl">+0.8815</span><span class="sc">*</span>logbilihigh<span class="fl">-0.2336</span><span class="sc">*</span>logbilitoohigh</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span><span class="fl">0.3139</span><span class="sc">*</span>logbilimuchtoohigh<span class="fl">-0.0844</span><span class="sc">*</span><span class="fl">38.7</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>log2row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(log2)),</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(log2))), </span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(log2<span class="sc">$</span>lp3, log2<span class="sc">$</span>lp4),</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">log2bili =</span> <span class="fu">c</span>(log2<span class="sc">$</span>log2bili, log2<span class="sc">$</span>log2bili))</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Make plot</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> log2row) <span class="sc">+</span> </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(log[<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title=</span><span class="fu">element_blank</span>(), </span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"line"</span>))</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-7.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.7 ---------------------------------------#</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>coxmod_t27 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t27)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, 
    data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

             coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment    -0.57406   0.56323  0.22447 -2.557   0.0105 *  
alb      -0.09093   0.91308  0.02164 -4.201 2.65e-05 ***
log2bili  0.66500   1.94449  0.07443  8.935  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
tment       0.5632     1.7755    0.3628    0.8745
alb         0.9131     1.0952    0.8752    0.9526
log2bili    1.9445     0.5143    1.6805    2.2499

Concordance= 0.819  (se = 0.022 )
Likelihood ratio test= 120  on 3 df,   p=&lt;2e-16
Wald test            = 110.4  on 3 df,   p=&lt;2e-16
Score (logrank) test = 133.7  on 3 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>poismod_t27 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pbc3mult,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> poisson)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t27) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili, family = poisson, data = pbc3mult)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -8.02328    0.95100  -8.437  &lt; 2e-16 ***
as.factor(timegroup)3 -0.43894    0.60346  -0.727 0.466999    
as.factor(timegroup)1 -0.84401    0.22867  -3.691 0.000223 ***
tment_charPlacebo      0.54549    0.22265   2.450 0.014288 *  
alb                   -0.08697    0.02162  -4.024 5.73e-05 ***
log2bili               0.64689    0.07326   8.830  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.25  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 517.25

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.8 ---------------------------------------#</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Cox models</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Model for LR comparison</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>coxmod_t28_base <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 1</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>coxmod_t28_1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment<span class="sc">*</span>alb,</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t28_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    tment * alb, data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

               coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
tment     -0.009736  0.990312  1.559670 -0.006   0.9950    
alb       -0.081319  0.921900  0.034031 -2.390   0.0169 *  
log2bili   0.664413  1.943350  0.074494  8.919   &lt;2e-16 ***
tment:alb -0.015725  0.984398  0.042980 -0.366   0.7145    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

          exp(coef) exp(-coef) lower .95 upper .95
tment        0.9903     1.0098   0.04658   21.0555
alb          0.9219     1.0847   0.86242    0.9855
log2bili     1.9434     0.5146   1.67935    2.2489
tment:alb    0.9844     1.0158   0.90487    1.0709

Concordance= 0.819  (se = 0.022 )
Likelihood ratio test= 120.2  on 4 df,   p=&lt;2e-16
Wald test            = 111.2  on 4 df,   p=&lt;2e-16
Score (logrank) test = 134.3  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(coxmod_t28_1, </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>      coxmod_t28_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(days, status != 0)
 Model 1: ~ tment + alb + log2bili + tment * alb
 Model 2: ~ tment + alb + log2bili
   loglik  Chisq Df Pr(&gt;|Chi|)
1 -402.87                     
2 -402.94 0.1338  1     0.7145</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 2</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>coxmod_t28_2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment<span class="sc">*</span>log2bili,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t28_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    tment * log2bili, data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

                   coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment           0.19880   1.21994  0.85653  0.232    0.816    
alb            -0.09331   0.91091  0.02191 -4.260 2.05e-05 ***
log2bili        0.72558   2.06593  0.09865  7.355 1.91e-13 ***
tment:log2bili -0.13213   0.87623  0.14180 -0.932    0.351    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

               exp(coef) exp(-coef) lower .95 upper .95
tment             1.2199     0.8197    0.2276    6.5375
alb               0.9109     1.0978    0.8726    0.9509
log2bili          2.0659     0.4840    1.7027    2.5066
tment:log2bili    0.8762     1.1413    0.6636    1.1570

Concordance= 0.821  (se = 0.022 )
Likelihood ratio test= 120.9  on 4 df,   p=&lt;2e-16
Wald test            = 112.9  on 4 df,   p=&lt;2e-16
Score (logrank) test = 136.9  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(coxmod_t28_2, </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>      coxmod_t28_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(days, status != 0)
 Model 1: ~ tment + alb + log2bili + tment * log2bili
 Model 2: ~ tment + alb + log2bili
   loglik  Chisq Df Pr(&gt;|Chi|)
1 -402.51                     
2 -402.94 0.8644  1     0.3525</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Poisson models</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Model for LR comparison - no interaction</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>poismod_t28_base <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 1</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>poismod_t28_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>alb,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * alb, family = poisson, 
    data = pbc3mult)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -7.77706    1.11741  -6.960 3.41e-12 ***
as.factor(timegroup)3 -0.43125    0.60379  -0.714 0.475080    
as.factor(timegroup)1 -0.84426    0.22851  -3.695 0.000220 ***
tment_charPlacebo     -0.09200    1.55226  -0.059 0.952738    
alb                   -0.09406    0.02755  -3.414 0.000639 ***
log2bili               0.64624    0.07334   8.812  &lt; 2e-16 ***
tment_charPlacebo:alb  0.01778    0.04281   0.415 0.677959    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.08  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.08

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"CyA"</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>poismod_t28_11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>alb,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_11) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * alb, family = poisson, 
    data = pbc3mult)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -7.86906    1.36181  -5.778 7.54e-09 ***
as.factor(timegroup)3 -0.43125    0.60379  -0.714  0.47508    
as.factor(timegroup)1 -0.84426    0.22851  -3.695  0.00022 ***
tment_charCyA          0.09200    1.55226   0.059  0.95274    
alb                   -0.07628    0.03359  -2.271  0.02316 *  
log2bili               0.64624    0.07334   8.812  &lt; 2e-16 ***
tment_charCyA:alb     -0.01778    0.04281  -0.415  0.67796    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.08  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.08

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t28_base, </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>       poismod_t28_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili + tment_char * alb
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   7 -252.54  1 0.1723      0.678</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 2</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>poismod_t28_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>log2bili,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * log2bili, family = poisson, 
    data = pbc3mult)

Coefficients:
                           Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                -7.53457    1.09655  -6.871 6.37e-12 ***
as.factor(timegroup)3      -0.41713    0.60400  -0.691 0.489808    
as.factor(timegroup)1      -0.85694    0.22932  -3.737 0.000186 ***
tment_charPlacebo          -0.18058    0.84828  -0.213 0.831422    
alb                        -0.08909    0.02185  -4.078 4.54e-05 ***
log2bili                    0.57982    0.10472   5.537 3.08e-08 ***
tment_charPlacebo:log2bili  0.12386    0.14006   0.884 0.376511    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.47  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 518.47

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"CyA"</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>poismod_t28_21 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>log2bili,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_21) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * log2bili, family = poisson, 
    data = pbc3mult)

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)            -7.71515    1.01592  -7.594 3.10e-14 ***
as.factor(timegroup)3  -0.41713    0.60400  -0.691 0.489808    
as.factor(timegroup)1  -0.85694    0.22932  -3.737 0.000186 ***
tment_charCyA           0.18058    0.84828   0.213 0.831422    
alb                    -0.08909    0.02185  -4.078 4.54e-05 ***
log2bili                0.70368    0.09717   7.242 4.42e-13 ***
tment_charCyA:log2bili -0.12386    0.14006  -0.884 0.376511    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.47  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 518.47

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t28_base, </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>       poismod_t28_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili + tment_char * log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   7 -252.24  1 0.7787     0.3775</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.9 ---------------------------------------#</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1; </span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"1"</span>)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>poismod_t29_11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> timegroup <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>timegroup,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_11) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + 
    alb + log2bili + tment_char * timegroup, family = poisson, 
    data = pbc3mult)

Coefficients:
                             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -8.01250    0.97312  -8.234  &lt; 2e-16 ***
timegroup1                   -0.89421    0.31710  -2.820   0.0048 ** 
timegroup3                   -0.89971    1.02908  -0.874   0.3820    
tment_charPlacebo             0.46193    0.34460   1.340   0.1801    
alb                          -0.08640    0.02166  -3.988 6.65e-05 ***
log2bili                      0.64871    0.07367   8.806  &lt; 2e-16 ***
timegroup1:tment_charPlacebo  0.09973    0.44250   0.225   0.8217    
timegroup3:tment_charPlacebo  0.80434    1.27283   0.632   0.5274    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.82  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.82

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"2"</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_12 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>timegroup,</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_12) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * timegroup, family = poisson, 
    data = pbc3mult)

Coefficients: (2 not defined because of singularities)
                              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -8.912206   1.410958  -6.316 2.68e-10 ***
as.factor(timegroup)2         0.899710   1.029079   0.874    0.382    
as.factor(timegroup)1         0.005499   1.026826   0.005    0.996    
tment_charPlacebo             1.266273   1.229390   1.030    0.303    
alb                          -0.086405   0.021665  -3.988 6.65e-05 ***
log2bili                      0.648711   0.073669   8.806  &lt; 2e-16 ***
timegroup2                          NA         NA      NA       NA    
timegroup1                          NA         NA      NA       NA    
tment_charPlacebo:timegroup2 -0.804338   1.272830  -0.632    0.527    
tment_charPlacebo:timegroup1 -0.704610   1.262063  -0.558    0.577    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.82  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.82

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_13 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>timegroup,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_13) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * timegroup, family = poisson, 
    data = pbc3mult)

Coefficients: (2 not defined because of singularities)
                              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -8.906706   0.949577  -9.380  &lt; 2e-16 ***
as.factor(timegroup)3        -0.005499   1.026826  -0.005   0.9957    
as.factor(timegroup)2         0.894211   0.317101   2.820   0.0048 ** 
tment_charPlacebo             0.561662   0.290915   1.931   0.0535 .  
alb                          -0.086405   0.021665  -3.988 6.65e-05 ***
log2bili                      0.648711   0.073669   8.806  &lt; 2e-16 ***
timegroup3                          NA         NA      NA       NA    
timegroup2                          NA         NA      NA       NA    
tment_charPlacebo:timegroup3  0.704610   1.262063   0.558   0.5766    
tment_charPlacebo:timegroup2 -0.099728   0.442503  -0.225   0.8217    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.82  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.82

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2; </span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"1"</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>poismod_t29_21 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> timegroup <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> alb<span class="sc">*</span>timegroup,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_21) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + 
    alb + log2bili + alb * timegroup, family = poisson, data = pbc3mult)

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       -9.30795    1.40949  -6.604 4.01e-11 ***
timegroup1         1.24042    1.59864   0.776   0.4378    
timegroup3         0.01433    6.09060   0.002   0.9981    
tment_charPlacebo  0.56130    0.22300   2.517   0.0118 *  
alb               -0.05231    0.03472  -1.507   0.1319    
log2bili           0.64608    0.07361   8.777  &lt; 2e-16 ***
timegroup1:alb    -0.05795    0.04376  -1.324   0.1854    
timegroup3:alb    -0.01311    0.15739  -0.083   0.9336    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.45  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.45

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"2"</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_22 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> alb<span class="sc">*</span>timegroup,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_22) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + alb * timegroup, family = poisson, 
    data = pbc3mult)

Coefficients: (2 not defined because of singularities)
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -9.29362    5.94435  -1.563   0.1179    
as.factor(timegroup)2 -0.01433    6.09060  -0.002   0.9981    
as.factor(timegroup)1  1.22609    6.02995   0.203   0.8389    
tment_charPlacebo      0.56130    0.22300   2.517   0.0118 *  
alb                   -0.06542    0.15336  -0.427   0.6697    
log2bili               0.64608    0.07361   8.777   &lt;2e-16 ***
timegroup2                  NA         NA      NA       NA    
timegroup1                  NA         NA      NA       NA    
alb:timegroup2         0.01311    0.15739   0.083   0.9336    
alb:timegroup1        -0.04484    0.15605  -0.287   0.7739    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.45  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.45

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_23 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> alb<span class="sc">*</span>timegroup,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_23) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + alb * timegroup, family = poisson, 
    data = pbc3mult)

Coefficients: (2 not defined because of singularities)
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -8.06752    1.11184  -7.256 3.99e-13 ***
as.factor(timegroup)3 -1.22609    6.02995  -0.203   0.8389    
as.factor(timegroup)2 -1.24042    1.59864  -0.776   0.4378    
tment_charPlacebo      0.56130    0.22300   2.517   0.0118 *  
alb                   -0.11026    0.02791  -3.951 7.79e-05 ***
log2bili               0.64608    0.07361   8.777  &lt; 2e-16 ***
timegroup3                  NA         NA      NA       NA    
timegroup2                  NA         NA      NA       NA    
alb:timegroup3         0.04484    0.15605   0.287   0.7739    
alb:timegroup2         0.05795    0.04376   1.324   0.1854    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.45  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.45

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 3; </span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"1"</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>poismod_t29_31 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> timegroup <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili<span class="sc">*</span>timegroup,</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_31) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + 
    alb + log2bili + log2bili * timegroup, family = poisson, 
    data = pbc3mult)

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)         -7.57166    1.08557  -6.975 3.06e-12 ***
timegroup1          -1.72397    0.88760  -1.942   0.0521 .  
timegroup3           0.69600    2.32124   0.300   0.7643    
tment_charPlacebo    0.51454    0.22373   2.300   0.0215 *  
alb                 -0.08570    0.02174  -3.942 8.10e-05 ***
log2bili             0.55747    0.12113   4.602 4.18e-06 ***
timegroup1:log2bili  0.15296    0.15024   1.018   0.3086    
timegroup3:log2bili -0.25235    0.49539  -0.509   0.6105    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.67  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.67

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"2"</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_32 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili<span class="sc">*</span>timegroup,</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_32) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + log2bili * timegroup, family = poisson, 
    data = pbc3mult)

Coefficients: (2 not defined because of singularities)
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.87566    2.36338  -2.909  0.00362 ** 
as.factor(timegroup)2 -0.69600    2.32124  -0.300  0.76430    
as.factor(timegroup)1 -2.41998    2.30859  -1.048  0.29452    
tment_charPlacebo      0.51454    0.22373   2.300  0.02146 *  
alb                   -0.08570    0.02174  -3.942  8.1e-05 ***
log2bili               0.30512    0.48171   0.633  0.52646    
timegroup2                  NA         NA      NA       NA    
timegroup1                  NA         NA      NA       NA    
log2bili:timegroup2    0.25235    0.49539   0.509  0.61047    
log2bili:timegroup1    0.40532    0.49015   0.827  0.40828    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.67  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.67

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_33 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili<span class="sc">*</span>timegroup,</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_33) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + log2bili * timegroup, family = poisson, 
    data = pbc3mult)

Coefficients: (2 not defined because of singularities)
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -9.29563    1.02069  -9.107  &lt; 2e-16 ***
as.factor(timegroup)3  2.41998    2.30859   1.048   0.2945    
as.factor(timegroup)2  1.72397    0.88760   1.942   0.0521 .  
tment_charPlacebo      0.51454    0.22373   2.300   0.0215 *  
alb                   -0.08570    0.02174  -3.942 8.10e-05 ***
log2bili               0.71044    0.09260   7.672 1.69e-14 ***
timegroup3                  NA         NA      NA       NA    
timegroup2                  NA         NA      NA       NA    
log2bili:timegroup3   -0.40532    0.49015  -0.827   0.4083    
log2bili:timegroup2   -0.15296    0.15024  -1.018   0.3086    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.67  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.67

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="do">## LR tests </span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Base model; no interaction</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>poismod_t29_base <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, </span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>       poismod_t29_11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + 
    log2bili + tment_char * timegroup
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   8 -252.41  2 0.4312     0.8061</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>       poismod_t29_21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + 
    log2bili + alb * timegroup
  #Df  LogLik Df Chisq Pr(&gt;Chisq)
1   6 -252.62                    
2   8 -251.72  2 1.803      0.406</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 3</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>       poismod_t29_31)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + 
    log2bili + log2bili * timegroup
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   8 -251.84  2 1.5777     0.4544</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.10 --------------------------------------#</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>coxmod_f29 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(tment) <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_f29)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ strata(tment) + alb + 
    log2bili, data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

             coef exp(coef) se(coef)      z Pr(&gt;|z|)    
alb      -0.09002   0.91391  0.02168 -4.153 3.28e-05 ***
log2bili  0.66328   1.94114  0.07531  8.807  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
alb         0.9139     1.0942    0.8759    0.9536
log2bili    1.9411     0.5152    1.6748    2.2499

Concordance= 0.818  (se = 0.022 )
Likelihood ratio test= 119.3  on 2 df,   p=&lt;2e-16
Wald test            = 109.1  on 2 df,   p=&lt;2e-16
Score (logrank) test = 133.5  on 2 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting cumulative baseline hazards per treatment</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>cumhaz_treat <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxmod_f29, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>cumhaz_treat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cumhaz_treat)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Per treatment</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>hazard_t0 <span class="ot">&lt;-</span> cumhaz_treat[cumhaz_treat<span class="sc">$</span>strata <span class="sc">==</span> <span class="st">"tment=0"</span>,]</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>hazard_t0[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"tment=0"</span>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>hazard_t0<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hazard_t0<span class="sc">$</span>time)</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>hazard_t0<span class="sc">$</span>hazard <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hazard_t0<span class="sc">$</span>hazard)</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>hazard_t1 <span class="ot">&lt;-</span> cumhaz_treat[cumhaz_treat<span class="sc">$</span>strata <span class="sc">==</span> <span class="st">"tment=1"</span>,]</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Match times</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>alltimes <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(cumhaz_treat<span class="sc">$</span>time))</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>hazard_t0_allt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alltimes), <span class="cf">function</span>(k) <span class="fu">tail</span>(hazard_t0<span class="sc">$</span>hazard[hazard_t0<span class="sc">$</span>time <span class="sc">&lt;=</span> alltimes[k]], <span class="dv">1</span>)))</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>hazard_t1_allt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alltimes), <span class="cf">function</span>(k) <span class="fu">tail</span>(hazard_t1<span class="sc">$</span>hazard[hazard_t1<span class="sc">$</span>time <span class="sc">&lt;=</span> alltimes[k]], <span class="dv">1</span>))) </span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>hazards <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(hazard_t0_allt, </span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>                      hazard_t1_allt)</span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficient</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>coxmod_f29_t <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_f29_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, 
    data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

             coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment    -0.57406   0.56323  0.22447 -2.557   0.0105 *  
alb      -0.09093   0.91308  0.02164 -4.201 2.65e-05 ***
log2bili  0.66500   1.94449  0.07443  8.935  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
tment       0.5632     1.7755    0.3628    0.8745
alb         0.9131     1.0952    0.8752    0.9526
log2bili    1.9445     0.5143    1.6805    2.2499

Concordance= 0.819  (se = 0.022 )
Likelihood ratio test= 120  on 3 df,   p=&lt;2e-16
Wald test            = 110.4  on 3 df,   p=&lt;2e-16
Score (logrank) test = 133.7  on 3 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make plot</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hazard_t0_allt, <span class="at">y =</span> hazard_t1_allt), <span class="at">data =</span> hazards) <span class="sc">+</span> </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(coxmod_f29_t)[[<span class="st">"tment"</span>]]), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cumulative baseline hazard: placebo"</span>) <span class="sc">+</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard: CyA"</span>) <span class="sc">+</span> </span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>fig2<span class="fl">.10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-8.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.11 -------------------------------------#</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive Aalen models - available with timereg</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timereg)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>nonparmod <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>cumhazdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">eventtimes =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">1</span>],</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">basecumhaz =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">2</span>], </span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>], </span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat_ll =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>]<span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(nonparmod<span class="sc">$</span>var.cum[,<span class="dv">3</span>]),</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat_ul =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>]<span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(nonparmod<span class="sc">$</span>var.cum[,<span class="dv">3</span>])</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>cumhazdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   eventtimes  basecumhaz   cumhaztreat cumhaztreat_ll cumhaztreat_ul
1      0.0000 0.000000000  0.000000e+00     0.00000000    0.000000000
2     24.0000 0.005780347 -5.780347e-03    -0.01710983    0.005549133
3     35.0000 0.005780347  3.360667e-05    -0.01603534    0.016102555
4     98.0000 0.011628300 -5.814347e-03    -0.02555234    0.013923644
5    107.0000 0.011628300  6.800639e-05    -0.02279059    0.022926606
6    114.0000 0.017510653 -5.814347e-03    -0.03141597    0.019787273
7    117.0000 0.023427813 -1.173151e-02    -0.03983752    0.016374508
8    133.0000 0.029415837 -1.771953e-02    -0.04817760    0.012738541
9    146.0000 0.029415837 -1.176715e-02    -0.04438318    0.020848877
10   156.0000 0.029415837 -5.779125e-03    -0.04044252    0.028884274
11   169.0000 0.035476443 -1.183973e-02    -0.04848201    0.024802551
12   193.0000 0.041574004 -1.793729e-02    -0.05647933    0.020604743
13   195.0000 0.041574004 -1.187669e-02    -0.05220774    0.028454370
14   199.0000 0.047746843 -1.804953e-02    -0.06015623    0.024057175
15   213.0000 0.053996843 -2.429953e-02    -0.06815197    0.019552917
16   221.0000 0.053996843 -1.820196e-02    -0.06365379    0.027249860
17   235.0000 0.053996843 -1.206700e-02    -0.05908250    0.034948512
18   249.0000 0.060286151 -1.835630e-02    -0.06696097    0.030248366
19   254.0000 0.066615265 -2.468542e-02    -0.07484815    0.025477313
20   261.0000 0.072984692 -3.105484e-02    -0.08274770    0.020638015
21   264.0000 0.072984692 -2.476554e-02    -0.07790787    0.028376799
22   280.0000 0.072984692 -1.843642e-02    -0.07300742    0.036134571
23   286.0000 0.072984692 -1.206700e-02    -0.06804776    0.043913765
24   339.0000 0.079520640 -1.860294e-02    -0.07603075    0.038824866
25   347.0000 0.079520640 -1.210944e-02    -0.07093066    0.046711791
26   351.0000 0.086099587 -1.868838e-02    -0.07890641    0.041529645
27   362.0000 0.086099587 -1.206587e-02    -0.07366696    0.049535227
28   366.0000 0.092948902 -1.891518e-02    -0.08196212    0.044131755
29   367.0000 0.092948902 -1.215843e-02    -0.07658125    0.052264395
30   368.0000 0.099845454 -1.905498e-02    -0.08488062    0.046770668
31   371.0000 0.106789898 -2.599942e-02    -0.09321756    0.041218715
32   378.0000 0.106789898 -1.919670e-02    -0.08772447    0.049331072
33   379.0000 0.113782905 -2.618971e-02    -0.09607474    0.043695328
34   396.0000 0.120977150 -3.338395e-02    -0.10467735    0.037909445
35   413.0000 0.128223527 -4.063033e-02    -0.11332470    0.032064037
36   425.0000 0.135522797 -4.792960e-02    -0.12201839    0.026159190
37   429.0000 0.142875738 -5.528254e-02    -0.13076001    0.020194924
38   430.0000 0.150283145 -6.268995e-02    -0.13955109    0.014171194
39   461.0000 0.150283145 -5.554709e-02    -0.13367286    0.022578674
40   472.0000 0.150283145 -4.830071e-02    -0.12770699    0.031105567
41   487.0000 0.157916733 -5.593430e-02    -0.13673785    0.024869249
42   489.0000 0.165609041 -6.362661e-02    -0.14582471    0.018571489
43   562.0000 0.165609041 -5.616392e-02    -0.13965328    0.027325434
44   592.0000 0.173805762 -6.436064e-02    -0.14938167    0.020660384
45   612.0000 0.173805762 -5.654814e-02    -0.14293708    0.029840790
46   625.0000 0.173805762 -4.867413e-02    -0.13643077    0.039082510
47   639.0000 0.173805762 -4.067413e-02    -0.12982058    0.048472324
48   639.4515 0.173805762 -3.260961e-02    -0.12314653    0.057927308
49   669.0000 0.173805762 -2.420625e-02    -0.11622915    0.067816650
50   679.0000 0.173805762 -1.565924e-02    -0.10919452    0.077876036
51   691.0000 0.173805762 -6.887313e-03    -0.10198961    0.088214985
52   714.0000 0.183065022 -1.614657e-02    -0.11296497    0.080671826
53   743.0000 0.183065022 -7.137563e-03    -0.10555298    0.091277858
54   766.0000 0.183065022  2.477822e-03    -0.09772583    0.102681477
55   786.0000 0.192868943 -7.326100e-03    -0.10935558    0.094703382
56   791.0000 0.202868943 -1.732610e-02    -0.12122112    0.086568920
57   821.0000 0.213621631 -2.807879e-02    -0.13408984    0.077932259
58   865.0000 0.224491196 -3.894835e-02    -0.14707891    0.069182204
59   916.0000 0.224491196 -2.795934e-02    -0.13821415    0.082295466
60   928.0000 0.235985449 -3.945360e-02    -0.15198655    0.073079363
61   931.0000 0.235985449 -2.808996e-02    -0.14280587    0.086625956
62   945.0000 0.247750155 -3.985466e-02    -0.15686514    0.077155807
63   962.0000 0.247750155 -2.780647e-02    -0.14717604    0.091563093
64   978.0000 0.247750155 -1.530647e-02    -0.13716435    0.106551409
65   985.0000 0.260250155 -2.780647e-02    -0.15210286    0.096489920
66   995.0000 0.272908383 -4.046470e-02    -0.16721301    0.086283615
67  1043.0000 0.272908383 -2.747769e-02    -0.15675672    0.101801350
68  1046.0000 0.286066278 -4.063558e-02    -0.17246185    0.091190691
69  1066.0000 0.286066278 -2.712207e-02    -0.16158284    0.107338708
70  1105.0000 0.299764908 -4.082070e-02    -0.17793593    0.096294531
71  1127.0000 0.314257662 -5.531345e-02    -0.19534015    0.084713243
72  1134.0000 0.314257662 -4.082070e-02    -0.18369954    0.102058148
73  1166.0000 0.314257662 -2.519570e-02    -0.17131981    0.120928411
74  1168.0000 0.314257662 -9.322682e-03    -0.15872200    0.140076636
75  1169.0000 0.314257662  6.806350e-03    -0.14590099    0.159513691
76  1171.0000 0.314257662  2.319979e-02    -0.13285130    0.179250883
77  1198.0000 0.330651104  6.806350e-03    -0.15251833    0.166131029
78  1238.0000 0.330651104  2.435021e-02    -0.13864288    0.187343301
79  1249.0000 0.330651104  4.253203e-02    -0.12431131    0.209375363
80  1265.0000 0.350651104  2.253203e-02    -0.14885449    0.193918545
81  1290.0000 0.350651104  4.427116e-02    -0.13233246    0.220874780
82  1324.0000 0.375651104  1.927116e-02    -0.16400415    0.202546468
83  1325.0000 0.401292130 -6.369867e-03    -0.19641077    0.183671039
84  1325.0038 0.427607919 -3.268566e-02    -0.22960171    0.164230401
85  1391.0000 0.427607919 -5.658630e-03    -0.20957545    0.198258191
86  1423.0000 0.457910950 -3.596166e-02    -0.24835213    0.176428805
87  1433.0000 0.457910950 -6.549895e-03    -0.22662464    0.213524849
88  1547.0000 0.457910950  3.511677e-02    -0.19962210    0.269855642
89  1647.0000 0.507910950 -1.488323e-02    -0.26925763    0.239491176
90  1703.0000 0.507910950  5.654534e-02    -0.23381019    0.346900879
91  1859.0000 0.650768092 -8.631180e-02    -0.48968054    0.317056936</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend lines to last observed time</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>cumhazdata[<span class="fu">nrow</span>(cumhazdata)<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">max</span>(pbc3<span class="sc">$</span>days), <span class="fu">tail</span>(cumhazdata, <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure LHS</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>cumhazplot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> basecumhaz), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard"</span>) <span class="sc">+</span> </span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>cumhazplot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-9.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure RHS</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>cumhazplot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat_ll), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span>  </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat_ul), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative treatment effect"</span>) <span class="sc">+</span> </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>cumhazplot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-10.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.12 -------------------------------------#</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Aalen model fit</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>nonparmod2 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>cumhazdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">eventtimes =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">1</span>],</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">basecumhaz =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">2</span>], </span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">3</span>], </span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhazalb =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">4</span>], </span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhazbili=</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">5</span>]</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend lines to last observed time</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>cumhazdata[<span class="fu">nrow</span>(cumhazdata)<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">max</span>(pbc3<span class="sc">$</span>days), <span class="fu">tail</span>(cumhazdata, <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure treatment</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>cumhazplot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative treatment effect"</span>) <span class="sc">+</span> </span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-27"><a href="#cb135-27" aria-hidden="true" tabindex="-1"></a>cumhazplot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-11.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure albumin</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>cumhazplot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhazalb), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative albumin effect"</span>) <span class="sc">+</span> </span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>cumhazplot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-12.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure bilirubin</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>cumhazplot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhazbili), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative bilirubin effect"</span>) <span class="sc">+</span> </span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)),</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>cumhazplot3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/pbc3-13.png" class="img-fluid" style="width:90.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.10 --------------------------------------#</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Only treatment -- #</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="co"># In text p-values prior to Table 2.10</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>nonparmod0 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3) </span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          5.96               0.000
tment                                1.60               0.738

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.107                       0.573
tment                               0.136                       0.639
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          7.62                       0.417
tment                                4.54                       0.733

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hypothesis of a time-constant hazard difference for treatment</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant effect of treatment</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>nonparmod01 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment), <span class="at">data =</span> pbc3) </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          6.62                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                        0.0914                       0.407
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          4.97                       0.299

Parametric terms :     
                 Coef.       SE Robust SE     z P-val lower2.5% upper97.5%
const(tment) -1.61e-05 5.75e-05  5.74e-05 -0.28 0.779 -0.000129   9.66e-05
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Treatment, albumin, bilirubin -- #</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10, first two columns</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>nonparmod1 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.62               0.015
tment                                2.66               0.135
alb                                  3.82               0.012
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.30300                       0.914
tment                             0.12100                       0.684
alb                               0.00666                       0.959
bili                              0.00301                       0.219
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      14.20000                       0.993
tment                             3.29000                       0.806
alb                               0.00826                       0.994
bili                              0.00203                       0.361

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10, last columns</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>nonparmod2 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(bili), <span class="at">data =</span> pbc3) </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          4.03               0.001

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.119                       0.156
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                           9.6                       0.099

Parametric terms :     
                 Coef.       SE Robust SE     z    P-val lower2.5% upper97.5%
const(tment) -1.13e-04 5.90e-05  5.51e-05 -2.05 4.01e-02 -2.29e-04   2.64e-06
const(alb)   -2.30e-05 6.28e-06  6.11e-06 -3.77 1.63e-04 -3.53e-05  -1.07e-05
const(bili)   6.30e-06 1.32e-06  1.05e-06  5.98 2.17e-09  3.71e-06   8.89e-06
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + 
    const(bili), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>nonparmod3 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.60               0.011
alb                                  3.80               0.006
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.28500                       0.946
alb                               0.00954                       0.801
bili                              0.00315                       0.160
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      11.50000                       0.993
alb                               0.01920                       0.883
bili                              0.00238                       0.300

Parametric terms :     
                Coef.       SE Robust SE     z P-val lower2.5% upper97.5%
const(tment) -0.00011 5.92e-05  5.58e-05 -1.97 0.049 -0.000226   6.03e-06
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + alb + 
    bili, data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Quadratic effects -- #</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>nonparmod41 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((bili<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod41)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
                Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                              3.94               0.001
tment                                    2.59               0.144
I(alb/10)                                4.04               0.000
I(bili/100)                              3.82               0.004
I((bili/100)^2)                          3.02               0.056

Test for time invariant effects 
                      Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                            0.3080                       0.926
tment                                  0.1230                       0.662
I(alb/10)                              0.0912                       0.833
I(bili/100)                            0.6370                       0.469
I((bili/100)^2)                        0.5160                       0.193
                        Cramer von Mises test p-value H_0:constant effect
(Intercept)                             24.00                       0.948
tment                                    3.94                       0.758
I(alb/10)                                2.38                       0.842
I(bili/100)                            188.00                       0.356
I((bili/100)^2)                        101.00                       0.208

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + I(alb/10) + 
    I(bili/100) + I((bili/100)^2), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>nonparmod42 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((alb<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod42)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
              Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                            3.25               0.015
tment                                  2.74               0.091
I(alb/10)                              3.02               0.041
I(bili/100)                            4.86               0.000
I((alb/10)^2)                          2.79               0.069

Test for time invariant effects 
                    Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                           9.260                       0.217
tment                                 0.096                       0.813
I(alb/10)                             4.880                       0.222
I(bili/100)                           0.371                       0.051
I((alb/10)^2)                         0.626                       0.224
                      Cramer von Mises test p-value H_0:constant effect
(Intercept)                        28500.00                       0.315
tment                                  1.78                       0.920
I(alb/10)                           8370.00                       0.309
I(bili/100)                           32.00                       0.161
I((alb/10)^2)                        144.00                       0.305

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + I(alb/10) + 
    I(bili/100) + I((alb/10)^2), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>nonparmod43 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((bili<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod43)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
                Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                              3.82               0.005
I(alb/10)                                4.02               0.002
I(bili/100)                              3.85               0.005
I((bili/100)^2)                          3.01               0.055

Test for time invariant effects 
                      Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                             0.440                       0.685
I(alb/10)                               0.117                       0.626
I(bili/100)                             0.612                       0.455
I((bili/100)^2)                         0.515                       0.170
                        Cramer von Mises test p-value H_0:constant effect
(Intercept)                             48.20                       0.768
I(alb/10)                                4.51                       0.628
I(bili/100)                            169.00                       0.343
I((bili/100)^2)                        105.00                       0.182

Parametric terms :     
                 Coef.       SE Robust SE     z  P-val lower2.5% upper97.5%
const(tment) -0.000108 5.83e-05   5.7e-05 -1.89 0.0582 -0.000222   6.27e-06
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + I(alb/10) + 
    I(bili/100) + I((bili/100)^2), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>nonparmod44 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((alb<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod44)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
              Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                            3.23               0.025
I(alb/10)                              3.00               0.048
I(bili/100)                            4.88               0.000
I((alb/10)^2)                          2.77               0.090

Test for time invariant effects 
                    Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                           9.420                       0.232
I(alb/10)                             4.950                       0.232
I(bili/100)                           0.366                       0.079
I((alb/10)^2)                         0.635                       0.239
                      Cramer von Mises test p-value H_0:constant effect
(Intercept)                         30500.0                       0.350
I(alb/10)                            8910.0                       0.341
I(bili/100)                            34.6                       0.191
I((alb/10)^2)                         152.0                       0.338

Parametric terms :     
                 Coef.       SE Robust SE     z  P-val lower2.5% upper97.5%
const(tment) -0.000115 5.89e-05  5.51e-05 -2.09 0.0366  -0.00023   4.42e-07
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + I(alb/10) + 
    I(bili/100) + I((alb/10)^2), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Interactions -- #</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>nonparmod51 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(bili) <span class="sc">+</span> <span class="fu">const</span>(tment <span class="sc">*</span> bili), <span class="at">data =</span> pbc3) </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod51)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          4.03                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.123                       0.172
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          10.5                         0.1

Parametric terms :     
                        Coef.       SE Robust SE       z    P-val lower2.5%
const(tment)        -5.30e-06 8.06e-05  6.23e-05 -0.0851 9.32e-01 -1.63e-04
const(alb)          -2.35e-05 6.20e-06  6.04e-06 -3.9000 9.69e-05 -3.57e-05
const(bili)          8.18e-06 2.38e-06  1.20e-06  6.8400 7.77e-12  3.52e-06
const(tment * bili) -3.16e-06 2.79e-06  1.80e-06 -1.7600 7.92e-02 -8.63e-06
                    upper97.5%
const(tment)          1.53e-04
const(alb)           -1.13e-05
const(bili)           1.28e-05
const(tment * bili)   2.31e-06
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + 
    const(bili) + const(tment * bili), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>nonparmod52 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(bili) <span class="sc">+</span> <span class="fu">const</span>(tment <span class="sc">*</span> alb), <span class="at">data =</span> pbc3) </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod52)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.06               0.008

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                          0.12                       0.184
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          9.68                       0.105

Parametric terms :     
                       Coef.       SE Robust SE       z    P-val lower2.5%
const(tment)        2.77e-05 5.45e-04  4.81e-04  0.0576 9.54e-01 -1.04e-03
const(alb)         -2.11e-05 8.63e-06  7.61e-06 -2.7700 5.54e-03 -3.80e-05
const(bili)         6.29e-06 1.32e-06  1.05e-06  5.9600 2.45e-09  3.70e-06
const(tment * alb) -3.60e-06 1.31e-05  1.18e-05 -0.3060 7.59e-01 -2.93e-05
                   upper97.5%
const(tment)         1.10e-03
const(alb)          -4.19e-06
const(bili)          8.88e-06
const(tment * alb)   2.21e-05
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + 
    const(bili) + const(tment * alb), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.11 --------------------------------------#</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="co"># -- In-text -- #</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive hazards model with piecewise constant baseline hazards</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with only treatment as covariate</span></span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pbc3mult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id unit status tment sex age  bili   alb stage tment_char albnorm alb10
1  1    5      1     1   0  58 52.04 36.00     4        CyA    1.00 3.600
2  1    5      1     1   0  58 52.04 36.00     4        CyA    1.00 3.600
3  2    4      0     1   1  54 14.82 38.00     2        CyA    3.00 3.800
4  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271
5  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271
6  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271
      alb2 bilihigh bilitoohigh bilimuchtoohigh bili100      bili2 log2bili
1 12.96000    34.94       17.84            0.74  0.5204 0.27081616 5.701549
2 12.96000    34.94       17.84            0.74  0.5204 0.27081616 5.701549
3 14.44000     0.00        0.00            0.00  0.1482 0.02196324 3.889474
4 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355
5 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355
6 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355
  logbilihigh logbilitoohigh logbilimuchtoohigh log2bili2 tstart   days fail
1    1.605625      0.6056246         0.02066214 32.507662    0.0  730.5    0
2    1.605625      0.6056246         0.02066214 32.507662  730.5 1168.0    1
3    0.000000      0.0000000         0.00000000 15.128004    0.0  405.0    0
4    0.000000      0.0000000         0.00000000  7.881242    0.0  730.5    0
5    0.000000      0.0000000         0.00000000  7.881242  730.5 1461.0    0
6    0.000000      0.0000000         0.00000000  7.881242 1461.0 1735.0    0
  timegroup risktime
1         1    730.5
2         2    437.5
3         1    405.0
4         1    730.5
5         2    730.5
6         3    274.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update data set</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>pbc3add <span class="ot">&lt;-</span> pbc3mult</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span>risktime)</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">*</span>risktime)</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">3</span>)<span class="sc">*</span>risktime)</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>tment0 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (tment <span class="sc">==</span> <span class="dv">0</span>)<span class="sc">*</span>risktime)</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>tment1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (tment <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span>risktime)</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>albny <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (alb<span class="dv">-35</span>)<span class="sc">/</span><span class="dv">100</span><span class="sc">*</span>risktime)</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>biliny <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (bili<span class="dv">-50</span>)<span class="sc">/</span><span class="dv">1000</span><span class="sc">*</span>risktime)</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>piece_aalen1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">0</span>),</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(piece_aalen1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ time1 + time2 + time3 + tment1 - 1, family = poisson(link = "identity"), 
    data = pbc3add, start = c(0.1, 0.1, 0.1, 0))

Coefficients:
         Estimate Std. Error z value Pr(&gt;|z|)    
time1   2.494e-04  4.498e-05   5.546 2.93e-08 ***
time2   3.607e-04  6.610e-05   5.456 4.87e-08 ***
time3   2.566e-04  1.264e-04   2.031   0.0423 *  
tment1 -1.988e-05  5.683e-05  -0.350   0.7265    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance:    Inf  on 623  degrees of freedom
Residual deviance: 459.54  on 619  degrees of freedom
AIC: 647.54

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.11 - questionable fit</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>piece_aalen2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">+</span> albny <span class="sc">+</span> biliny <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.35</span>, <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="sc">-</span><span class="fl">0.8</span>, <span class="dv">2</span>),</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(piece_aalen2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ time1 + time2 + time3 + tment1 + albny + 
    biliny - 1, family = poisson(link = "identity"), data = pbc3add, 
    start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2))

Coefficients:
         Estimate Std. Error z value Pr(&gt;|z|)    
time1   7.925e-04  7.346e-05  10.788  &lt; 2e-16 ***
time2   1.029e-03  8.866e-05  11.608  &lt; 2e-16 ***
time3   9.910e-04  1.890e-04   5.244 1.57e-07 ***
tment1 -1.023e-04  6.006e-05  -1.704   0.0883 .  
albny  -1.902e-03  4.274e-04  -4.451 8.56e-06 ***
biliny  9.328e-03  1.360e-03   6.860 6.89e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance:    Inf  on 611  degrees of freedom
Residual deviance: 432.31  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 620.31

Number of Fisher Scoring iterations: 25</code></pre>
</div>
</div>
</section>
<section id="exercises" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise-2.1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="exercise-2.1">Exercise 2.1</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch3.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</div>   
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>