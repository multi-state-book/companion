<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values - 2&nbsp; Intuition for intensity models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch3.html" rel="next">
<link href="./Ch1.html" rel="prev">
<link href="./corvos.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction with data sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#fig2-2" id="toc-fig2-2" class="nav-link active" data-scroll-target="#fig2-2">Figure 2.2</a></li>
  <li><a href="#fig2-3" id="toc-fig2-3" class="nav-link" data-scroll-target="#fig2-3">Figure 2.3</a></li>
  <li><a href="#cox-models" id="toc-cox-models" class="nav-link" data-scroll-target="#cox-models">Cox model</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="toc-section-number">2.1</span>  Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-hash="Ch2_cache/html/unnamed-chunk-1_1f18510ac8ac5c30d1f813a3ad907d05">
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: survival</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidyverse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──
✔ dplyr     1.1.0     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.1     ✔ tibble    3.1.8
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
Loading required package: timereg</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'timereg' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gridExtra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'gridExtra' was built under R version
4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'

The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
</div>
<p>Argue (intuitively) how the martingale property <span class="math inline">\(E(M(t)\mid {\cal H}_{s})=M(s)\)</span> follows from <span class="math inline">\(E(dM(t)\mid {\cal H}_{t-})=0\)</span></p>
<!-- ## Hazard models for homogeneous groups {#homogeneous-groups} -->
<section id="fig2-2" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fig2-2">Figure 2.2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pbc3<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/pbc3.rds"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'survival' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidyverse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.0     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.1     ✔ tibble    3.1.8
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>nafit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(followup, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>nadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> nafit<span class="sc">$</span>cumhaz, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cumhaz_se =</span> nafit<span class="sc">$</span>std.err, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">time =</span> nafit<span class="sc">$</span>time, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">1</span>], nafit<span class="sc">$</span>strata[<span class="dv">1</span>]), </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">2</span>], nafit<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.2</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment), <span class="at">data =</span> nadata) <span class="sc">+</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)) <span class="sc">+</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), ) <span class="sc">+</span> </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>          theme_general</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- ### Piece-wise constant hazards -->
</section>
<section id="fig2-3" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fig2-3">Figure 2.3</h2>
<div class="cell" data-file="R/2/pcwplot.r">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rateCyA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">8.1</span>,<span class="fl">13.1</span>,<span class="fl">9.6</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ratePbo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.4</span>,<span class="fl">12.5</span>,<span class="fl">8.5</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>pcwtime <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rates =</span> <span class="fu">c</span>(rateCyA, ratePbo),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"CyA"</span>, <span class="fu">length</span>(rateCyA)), <span class="fu">rep</span>(<span class="st">"Placebo"</span>, <span class="fu">length</span>(ratePbo))),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times_s =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">4</span>], <span class="dv">2</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.3</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rates, <span class="at">linetype =</span> tment),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> plotdata) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> times_s, <span class="at">y =</span> rates, <span class="at">xend =</span> times, <span class="at">yend =</span> rates), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>))  <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimated hazard function (per 100 years)"</span>) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">14</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  theme_general</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cox-models" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="cox-models">Cox model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>libname h <span class="st">"data"</span>;</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>data pbc3;</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  set h.pbc3;</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  event<span class="ot">=</span>status ne <span class="dv">0</span>; <span class="sc">*</span> Binary variable <span class="cf">for</span> events <span class="cf">for</span> later use;</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>proc phreg data<span class="ot">=</span>pbc3;</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  class <span class="fu">tment</span>(<span class="at">ref=</span><span class="st">"0"</span>) <span class="sc">/</span> param<span class="ot">=</span>ref;</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  model years<span class="sc">*</span><span class="fu">status</span>(<span class="dv">0</span>)<span class="ot">=</span>tment;</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>run;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-file="R/2/chapter2_pbc3.R">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#------- Chapter 2, R code, PBC3 data  ----------------------------#</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages (should be installed if not already)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(haven)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: haven</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(survival)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(timereg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: timereg</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'timereg' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gridExtra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'gridExtra' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read pcb data and create a data frame</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>pbc3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/pbc3.csv"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>pbc3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pbc3)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># See the head of the data</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pbc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id unit days status tment sex age  bili   alb stage
1  1    5 1168      1     1   0  58 52.04 36.00     4
2  2    4  405      0     1   1  54 14.82 38.00     2
3  3    3 1735      0     0   1  54  7.00 42.71     2
4  4    2  241      0     1   0  57 95.50 36.00     4
5  5    3  754      0     1   0  64 12.00 42.23     3
6  6    1 1593      0     0   0  63 11.33 38.16     2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pbc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id           unit            days            status      
 Min.   :  1   Min.   :1.000   Min.   :   1.0   Min.   :0.0000  
 1st Qu.: 88   1st Qu.:2.000   1st Qu.: 509.0   1st Qu.:0.0000  
 Median :175   Median :3.000   Median : 929.0   Median :0.0000  
 Mean   :175   Mean   :3.037   Mean   : 942.7   Mean   :0.4327  
 3rd Qu.:262   3rd Qu.:4.000   3rd Qu.:1290.0   3rd Qu.:1.0000  
 Max.   :349   Max.   :6.000   Max.   :2146.0   Max.   :2.0000  
                                                                
     tment             sex              age             bili        
 Min.   :0.0000   Min.   :0.0000   Min.   :26.00   Min.   :  2.333  
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:47.00   1st Qu.: 11.330  
 Median :1.0000   Median :0.0000   Median :55.00   Median : 19.270  
 Mean   :0.5043   Mean   :0.1461   Mean   :54.09   Mean   : 45.473  
 3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:62.00   3rd Qu.: 42.330  
 Max.   :1.0000   Max.   :1.0000   Max.   :75.00   Max.   :453.100  
                                                                    
      alb            stage      
 Min.   :20.63   Min.   :2.000  
 1st Qu.:35.00   1st Qu.:2.000  
 Median :38.71   Median :3.000  
 Mean   :38.37   Mean   :2.852  
 3rd Qu.:42.00   3rd Qu.:4.000  
 Max.   :58.00   Max.   :4.000  
 NA's   :6       NA's   :58     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that status represents status at exit </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (0: censored, 1: liver transpl, 2 : dead)</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Per example 1.1.1, the main event of interest is "failure of medical treatment" </span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># this is either death or liver transplant (status %in% c(1,2))</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># tment = 0 (placebo), tment = 1 (cyA)</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pbc3, <span class="fu">table</span>(status, tment))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      tment
status   0   1
     0 127 132
     1  15  14
     2  31  30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pbc3<span class="sc">$</span>tment <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- General plotting style ---------------------------------# </span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Empty data example</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pdata &lt;- data.frame()</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># playout &lt;- ggplot(pdata) + </span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#            scale_x_continuous(expand = expansion(mult = c(0, 0))) + </span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">#            scale_y_continuous(expand = expansion(mult = c(0, 0))) </span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># playout</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extra wishes from PKA &amp; HNRV to be added here</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>theme_general</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 97
 $ line                      :List of 6
  ..$ colour       : chr "black"
  ..$ linewidth    : num 0.5
  ..$ linetype     : num 1
  ..$ lineend      : chr "butt"
  ..$ arrow        : logi FALSE
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_line" "element"
 $ rect                      :List of 5
  ..$ fill         : chr "white"
  ..$ colour       : chr "black"
  ..$ linewidth    : num 0.5
  ..$ linetype     : num 1
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ text                      :List of 11
  ..$ family       : chr ""
  ..$ face         : chr "plain"
  ..$ colour       : chr "black"
  ..$ size         : num 20
  ..$ hjust        : num 0.5
  ..$ vjust        : num 0.5
  ..$ angle        : num 0
  ..$ lineheight   : num 0.9
  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : logi FALSE
  ..$ inherit.blank: logi FALSE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ title                     : NULL
 $ aspect.ratio              : NULL
 $ axis.title                : NULL
 $ axis.title.x              :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 1
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 2.75points 0points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.title.x.top          :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 0
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 2.75points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.title.x.bottom       : NULL
 $ axis.title.y              :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 1
  ..$ angle        : num 90
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 2.75points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.title.y.left         : NULL
 $ axis.title.y.right        :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 0
  ..$ angle        : num -90
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 2.75points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text                 :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : chr "grey30"
  ..$ size         : 'rel' num 0.8
  ..$ hjust        : NULL
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.x               :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : num 20
  ..$ hjust        : NULL
  ..$ vjust        : num 1
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 2.2points 0points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi FALSE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.x.top           :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 0
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 2.2points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.x.bottom        : NULL
 $ axis.text.y               :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : num 20
  ..$ hjust        : num 1
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 2.2points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi FALSE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.y.left          : NULL
 $ axis.text.y.right         :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : num 0
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 2.2points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.ticks                :List of 6
  ..$ colour       : chr "grey20"
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ lineend      : NULL
  ..$ arrow        : logi FALSE
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_line" "element"
 $ axis.ticks.x              : NULL
 $ axis.ticks.x.top          : NULL
 $ axis.ticks.x.bottom       : NULL
 $ axis.ticks.y              : NULL
 $ axis.ticks.y.left         : NULL
 $ axis.ticks.y.right        : NULL
 $ axis.ticks.length         : 'simpleUnit' num 2.75points
  ..- attr(*, "unit")= int 8
 $ axis.ticks.length.x       : NULL
 $ axis.ticks.length.x.top   : NULL
 $ axis.ticks.length.x.bottom: NULL
 $ axis.ticks.length.y       : NULL
 $ axis.ticks.length.y.left  : NULL
 $ axis.ticks.length.y.right : NULL
 $ axis.line                 : list()
  ..- attr(*, "class")= chr [1:2] "element_blank" "element"
 $ axis.line.x               : NULL
 $ axis.line.x.top           : NULL
 $ axis.line.x.bottom        : NULL
 $ axis.line.y               : NULL
 $ axis.line.y.left          : NULL
 $ axis.line.y.right         : NULL
 $ legend.background         :List of 5
  ..$ fill         : NULL
  ..$ colour       : logi NA
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ legend.margin             : 'margin' num [1:4] 5.5points 5.5points 5.5points 5.5points
  ..- attr(*, "unit")= int 8
 $ legend.spacing            : 'simpleUnit' num 11points
  ..- attr(*, "unit")= int 8
 $ legend.spacing.x          : NULL
 $ legend.spacing.y          : NULL
 $ legend.key                :List of 5
  ..$ fill         : chr "white"
  ..$ colour       : logi NA
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ legend.key.size           : 'simpleUnit' num 1.2lines
  ..- attr(*, "unit")= int 3
 $ legend.key.height         : NULL
 $ legend.key.width          : NULL
 $ legend.text               :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : 'rel' num 0.8
  ..$ hjust        : NULL
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ legend.text.align         : NULL
 $ legend.title              :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : num 0
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ legend.title.align        : NULL
 $ legend.position           : chr "bottom"
 $ legend.direction          : NULL
 $ legend.justification      : chr "center"
 $ legend.box                : NULL
 $ legend.box.just           : NULL
 $ legend.box.margin         : 'margin' num [1:4] 0cm 0cm 0cm 0cm
  ..- attr(*, "unit")= int 1
 $ legend.box.background     : list()
  ..- attr(*, "class")= chr [1:2] "element_blank" "element"
 $ legend.box.spacing        : 'simpleUnit' num 11points
  ..- attr(*, "unit")= int 8
 $ panel.background          :List of 5
  ..$ fill         : chr "white"
  ..$ colour       : logi NA
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ panel.border              :List of 5
  ..$ fill         : logi NA
  ..$ colour       : chr "grey20"
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ panel.spacing             : 'simpleUnit' num 5.5points
  ..- attr(*, "unit")= int 8
 $ panel.spacing.x           : NULL
 $ panel.spacing.y           : NULL
 $ panel.grid                :List of 6
  ..$ colour       : chr "grey92"
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ lineend      : NULL
  ..$ arrow        : logi FALSE
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_line" "element"
 $ panel.grid.major          : NULL
 $ panel.grid.minor          :List of 6
  ..$ colour       : NULL
  ..$ linewidth    : 'rel' num 0.5
  ..$ linetype     : NULL
  ..$ lineend      : NULL
  ..$ arrow        : logi FALSE
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_line" "element"
 $ panel.grid.major.x        : NULL
 $ panel.grid.major.y        : NULL
 $ panel.grid.minor.x        : NULL
 $ panel.grid.minor.y        : NULL
 $ panel.ontop               : logi FALSE
 $ plot.background           :List of 5
  ..$ fill         : NULL
  ..$ colour       : chr "white"
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ plot.title                :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : 'rel' num 1.2
  ..$ hjust        : num 0
  ..$ vjust        : num 1
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 5.5points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ plot.title.position       : chr "panel"
 $ plot.subtitle             :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : num 0
  ..$ vjust        : num 1
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 5.5points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ plot.caption              :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : 'rel' num 0.8
  ..$ hjust        : num 1
  ..$ vjust        : num 1
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 5.5points 0points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ plot.caption.position     : chr "panel"
 $ plot.tag                  :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : 'rel' num 1.2
  ..$ hjust        : num 0.5
  ..$ vjust        : num 0.5
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ plot.tag.position         : chr "topleft"
 $ plot.margin               : 'margin' num [1:4] 5.5points 5.5points 5.5points 5.5points
  ..- attr(*, "unit")= int 8
 $ strip.background          :List of 5
  ..$ fill         : chr "grey85"
  ..$ colour       : chr "grey20"
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ strip.background.x        : NULL
 $ strip.background.y        : NULL
 $ strip.clip                : chr "inherit"
 $ strip.placement           : chr "inside"
 $ strip.text                :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : chr "grey10"
  ..$ size         : 'rel' num 0.8
  ..$ hjust        : NULL
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 4.4points 4.4points 4.4points 4.4points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ strip.text.x              : NULL
 $ strip.text.x.bottom       : NULL
 $ strip.text.x.top          : NULL
 $ strip.text.y              :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : NULL
  ..$ angle        : num -90
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ strip.text.y.left         :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : NULL
  ..$ angle        : num 90
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ strip.text.y.right        : NULL
 $ strip.switch.pad.grid     : 'simpleUnit' num 2.75points
  ..- attr(*, "unit")= int 8
 $ strip.switch.pad.wrap     : 'simpleUnit' num 2.75points
  ..- attr(*, "unit")= int 8
 - attr(*, "class")= chr [1:2] "theme" "gg"
 - attr(*, "complete")= logi TRUE
 - attr(*, "validate")= logi TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Question: Legend position?</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.1 --------------------------------------#</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a Nelson Aalen estimate of the cumulative hazard using the pbc3 data</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Stratifying on treatment (i.e. doing it per treatment)</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>nafit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of fit</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nafit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(days, status != 0) ~ tment, data = pbc3)

                tment=0 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   24    173       1    0.994 0.00576        0.983        1.000
   98    171       1    0.988 0.00815        0.973        1.000
  114    170       1    0.983 0.00996        0.963        1.000
  117    169       1    0.977 0.01148        0.955        1.000
  133    167       1    0.971 0.01281        0.946        0.996
  169    165       1    0.965 0.01402        0.938        0.993
  193    164       1    0.959 0.01512        0.930        0.989
  199    162       1    0.953 0.01614        0.922        0.985
  213    160       1    0.947 0.01711        0.914        0.981
  249    159       1    0.941 0.01801        0.907        0.977
  254    158       1    0.935 0.01885        0.899        0.973
  261    157       1    0.929 0.01965        0.892        0.969
  339    153       1    0.923 0.02044        0.884        0.964
  351    152       1    0.917 0.02119        0.877        0.960
  366    146       1    0.911 0.02196        0.869        0.955
  368    145       1    0.905 0.02269        0.861        0.950
  371    144       1    0.898 0.02338        0.854        0.945
  379    143       1    0.892 0.02405        0.846        0.941
  396    139       1    0.886 0.02472        0.839        0.936
  413    138       1    0.879 0.02536        0.831        0.930
  425    137       1    0.873 0.02597        0.823        0.925
  429    136       1    0.866 0.02656        0.816        0.920
  430    135       1    0.860 0.02713        0.808        0.915
  487    131       1    0.853 0.02770        0.801        0.910
  489    130       1    0.847 0.02826        0.793        0.904
  592    122       1    0.840 0.02887        0.785        0.898
  714    108       1    0.832 0.02963        0.776        0.892
  786    102       1    0.824 0.03044        0.766        0.886
  791    100       1    0.816 0.03123        0.757        0.879
  821     93       1    0.807 0.03210        0.746        0.872
  865     92       1    0.798 0.03293        0.736        0.865
  928     87       1    0.789 0.03381        0.726        0.858
  945     85       1    0.780 0.03466        0.715        0.851
  985     80       1    0.770 0.03557        0.703        0.843
  995     79       1    0.760 0.03643        0.692        0.835
 1046     76       1    0.750 0.03730        0.681        0.827
 1105     73       1    0.740 0.03818        0.669        0.819
 1127     69       1    0.729 0.03910        0.657        0.810
 1198     61       1    0.717 0.04025        0.643        0.801
 1265     50       1    0.703 0.04192        0.625        0.790
 1324     40       1    0.685 0.04441        0.604        0.778
 1325     39       2    0.650 0.04859        0.562        0.753
 1423     33       1    0.631 0.05096        0.538        0.739
 1647     20       1    0.599 0.05734        0.497        0.723
 1859      7       1    0.513 0.09323        0.360        0.733

                tment=1 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   35    172       1    0.994  0.0058        0.983        1.000
  107    170       1    0.988  0.0082        0.972        1.000
  146    168       1    0.982  0.0100        0.963        1.000
  156    167       1    0.977  0.0116        0.954        1.000
  195    165       1    0.971  0.0129        0.946        0.996
  221    164       1    0.965  0.0141        0.937        0.993
  235    163       1    0.959  0.0152        0.929        0.989
  264    159       1    0.953  0.0163        0.921        0.985
  280    158       1    0.947  0.0173        0.913        0.981
  286    157       1    0.941  0.0182        0.906        0.977
  347    154       1    0.935  0.0191        0.898        0.973
  362    151       1    0.928  0.0199        0.890        0.968
  367    148       1    0.922  0.0207        0.882        0.964
  378    147       1    0.916  0.0215        0.875        0.959
  461    140       1    0.909  0.0224        0.867        0.954
  472    138       1    0.903  0.0231        0.859        0.949
  562    134       1    0.896  0.0239        0.850        0.944
  612    128       1    0.889  0.0247        0.842        0.939
  625    127       1    0.882  0.0255        0.833        0.933
  639    125       2    0.868  0.0270        0.817        0.922
  669    119       1    0.861  0.0277        0.808        0.917
  679    117       1    0.853  0.0285        0.799        0.911
  691    114       1    0.846  0.0292        0.790        0.905
  743    111       1    0.838  0.0299        0.782        0.899
  766    104       1    0.830  0.0307        0.772        0.892
  916     91       1    0.821  0.0317        0.761        0.885
  931     88       1    0.812  0.0326        0.750        0.878
  962     83       1    0.802  0.0337        0.738        0.871
  978     80       1    0.792  0.0347        0.727        0.863
 1043     77       1    0.782  0.0358        0.715        0.855
 1066     74       1    0.771  0.0368        0.702        0.847
 1134     69       1    0.760  0.0379        0.689        0.838
 1166     64       1    0.748  0.0392        0.675        0.829
 1168     63       1    0.736  0.0403        0.661        0.819
 1169     62       1    0.724  0.0414        0.648        0.810
 1171     61       1    0.712  0.0423        0.634        0.800
 1238     57       1    0.700  0.0434        0.620        0.790
 1249     55       1    0.687  0.0444        0.605        0.780
 1290     46       1    0.672  0.0459        0.588        0.768
 1391     37       1    0.654  0.0481        0.566        0.755
 1433     34       1    0.635  0.0504        0.543        0.742
 1547     24       1    0.608  0.0548        0.510        0.726
 1703     14       1    0.565  0.0659        0.449        0.710</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the standard errors produced by survfit are for the cumulative hazard</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>nadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> nafit<span class="sc">$</span>cumhaz, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cumhaz_se =</span> nafit<span class="sc">$</span>std.err, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">time =</span> nafit<span class="sc">$</span>time, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">1</span>], nafit<span class="sc">$</span>strata[<span class="dv">1</span>]), </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="fu">names</span>(nafit<span class="sc">$</span>strata)[<span class="dv">2</span>], nafit<span class="sc">$</span>strata[<span class="dv">2</span>])))</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.1</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>fig21 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment), <span class="at">data =</span> nadata) <span class="sc">+</span> </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>)) <span class="sc">+</span> </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>))  <span class="sc">+</span> </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>          theme_general <span class="sc">+</span> </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.box=</span><span class="st">"vertical"</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>fig21</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3NAatreat.pdf"</span>, <span class="at">plot =</span> fig21, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">21</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimates after two years</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment 0, observation after two years</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">subset</span>(nadata, nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=0"</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] cumhaz    cumhaz_se time      tment    
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment 1, observation after two years</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">subset</span>(nadata, nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=1"</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    cumhaz cumhaz_se time   tment
151      0         0    1 tment=1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log rank test for treatment </span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(days, status != 0) ~ tment, data = pbc3)

          N Observed Expected (O-E)^2/E (O-E)^2/V
tment=0 173       46     44.7    0.0388    0.0771
tment=1 176       44     45.3    0.0382    0.0771

 Chisq= 0.1  on 1 degrees of freedom, p= 0.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.1 ---------------------------------------#</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pbc3, <span class="fu">table</span>(tment, status))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     status
tment   0   1   2
    0 127  15  31
    1 132  14  30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cuts</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>cuts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>) <span class="sc">*</span> <span class="fl">365.25</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># event/failure indicator</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>fail <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pbc3<span class="sc">$</span>status <span class="sc">!=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data ready using survSplit</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>pbc3mult <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> ., </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                      pbc3,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">episode =</span> <span class="st">"timegroup"</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of observations per interval (timegroup)</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pbc3mult, <span class="fu">table</span>(tment, timegroup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     timegroup
tment   1   2   3
    0 173 106  29
    1 176 111  28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk time</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>risktime <span class="ot">&lt;-</span> pbc3mult<span class="sc">$</span>days <span class="sc">-</span> cuts[pbc3mult<span class="sc">$</span>timegroup] </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> pbc3mult <span class="sc">%&gt;%</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tment, timegroup) <span class="sc">%&gt;%</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fail =</span> <span class="fu">sum</span>(fail), </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">risktime =</span> <span class="fu">sum</span>(days <span class="sc">-</span> cuts[timegroup])<span class="co">#,</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">#logrisktime = sum(log(days))</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>            )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'tment'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sumdata)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>sumdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tment timegroup fail risktime
1     0         1   27 104856.0
2     0         2   17  49673.0
3     0         3    2   8642.0
4     1         1   24 107931.5
5     1         2   18  50284.5
6     1         3    2   7599.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model for treatment = 1</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(stats)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>poismod_trt1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">subset</span>(pbc3mult, tment <span class="sc">==</span> <span class="dv">1</span>), </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_trt1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) - 
    1, family = poisson, data = subset(pbc3mult, tment == 1))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.7232  -0.5700  -0.5700  -0.3295   2.9711  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
as.factor(timegroup)1  -8.4112     0.2041  -41.21   &lt;2e-16 ***
as.factor(timegroup)2  -7.9351     0.2357  -33.67   &lt;2e-16 ***
as.factor(timegroup)3  -8.2426     0.7071  -11.66   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 331041.87  on 315  degrees of freedom
Residual deviance:    222.24  on 312  degrees of freedom
AIC: 316.24

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform back to original scale (delta method)</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(poismod_trt1<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>as.factor(timegroup)1 as.factor(timegroup)2 as.factor(timegroup)3 
         0.0002223633          0.0003579632          0.0002631925 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard errors</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(poismod_trt1))) <span class="sc">*</span> <span class="fu">exp</span>(poismod_trt1<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>as.factor(timegroup)1 as.factor(timegroup)2 as.factor(timegroup)3 
         4.538928e-05          8.437217e-05          1.861008e-04 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model for treatment = 0</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>poismod_trt0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">subset</span>(pbc3mult, tment <span class="sc">==</span> <span class="dv">0</span>), </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_trt0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) - 
    1, family = poisson, data = subset(pbc3mult, tment == 0))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.7071  -0.6133  -0.6000  -0.3545   2.8610  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
as.factor(timegroup)1  -8.2645     0.1924  -42.95   &lt;2e-16 ***
as.factor(timegroup)2  -7.9800     0.2425  -32.90   &lt;2e-16 ***
as.factor(timegroup)3  -8.3712     0.7071  -11.84   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 325736.02  on 308  degrees of freedom
Residual deviance:    237.11  on 305  degrees of freedom
AIC: 335.11

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform back to original scale (delta method)</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(poismod_trt0<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>as.factor(timegroup)1 as.factor(timegroup)2 as.factor(timegroup)3 
         0.0002574960          0.0003422382          0.0002314279 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard errors</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(poismod_trt0))) <span class="sc">*</span> <span class="fu">exp</span>(poismod_trt0<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>as.factor(timegroup)1 as.factor(timegroup)2 as.factor(timegroup)3 
         4.955403e-05          8.300432e-05          1.636441e-04 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.3 --------------------------------------#</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rates + cuts from Table 2.1</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>rateCyA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">8.1</span>,<span class="fl">13.1</span>,<span class="fl">9.6</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>ratePbo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.4</span>,<span class="fl">12.5</span>,<span class="fl">8.5</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>pcwtime <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rates =</span> <span class="fu">c</span>(rateCyA, ratePbo),</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tment =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"CyA"</span>, <span class="fu">length</span>(rateCyA)), <span class="fu">rep</span>(<span class="st">"Placebo"</span>, <span class="fu">length</span>(ratePbo))),</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times_s =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">4</span>], <span class="dv">2</span>),</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times =</span> <span class="fu">rep</span>(pcwtime[<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>))</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.3</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>fig23 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> rates, <span class="at">linetype =</span> tment),</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> plotdata) <span class="sc">+</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> times_s, <span class="at">y =</span> rates, <span class="at">xend =</span> times, <span class="at">yend =</span> rates), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"CyA"</span>))  <span class="sc">+</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimated hazard function (per 100 years)"</span>) <span class="sc">+</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">1</span>))  <span class="sc">+</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">14</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">14</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>fig23</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3pwchestimates.pdf"</span>, <span class="at">plot =</span> fig23, </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">21</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.4 --------------------------------------#</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># NA data from figure 2.1 model fit</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>tment1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(nadata, tment <span class="sc">==</span> <span class="st">"tment=1"</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated hazard per time group</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>hazard_timegroup <span class="ot">&lt;-</span> sumdata<span class="sc">$</span>fail <span class="sc">/</span> sumdata<span class="sc">$</span>risktime</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="co"># View data</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sumdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tment timegroup fail risktime hazard_timegroup
1     0         1   27 104856.0     0.0002574960
2     0         2   17  49673.0     0.0003422382
3     0         3    2   8642.0     0.0002314279
4     1         1   24 107931.5     0.0002223633
5     1         2   18  50284.5     0.0003579632
6     1         3    2   7599.0     0.0002631925</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a numeric version of the treatment to the NA estimates</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>tmentnum <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(nadata<span class="sc">$</span>tment <span class="sc">==</span> <span class="st">"tment=1"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       cumhaz   cumhaz_se time   tment tmentnum
1 0.005780347 0.005797126   24 tment=0        0
2 0.005780347 0.005797126   87 tment=0        0
3 0.011628300 0.008246599   98 tment=0        0
4 0.017510653 0.010139685  114 tment=0        0
5 0.023427813 0.011748804  117 tment=0        0
6 0.023427813 0.011748804  130 tment=0        0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add piecewise constant hazard to data</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Between time 0 and 2</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="ot">&lt;-</span> nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">*</span> </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                                 (sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                                  sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Between time 2 and 4</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span><span class="sc">*</span> <span class="fl">365.25</span> ] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  (sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>     sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  (nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span>) <span class="sc">*</span> </span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  (sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>     sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">5</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">&amp;</span> nadata<span class="sc">$</span>time <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co"># After time 4</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>nadata<span class="sc">$</span>pwch[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  (sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>     sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">4</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span> <span class="sc">*</span> <span class="fl">365.25</span> <span class="sc">*</span> </span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  (sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>     sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">5</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>])) <span class="sc">+</span> </span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  (nadata<span class="sc">$</span>time[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>] <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>) <span class="sc">*</span> </span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>  (sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">3</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]) <span class="sc">+</span> </span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>     sumdata<span class="sc">$</span>hazard_timegroup[<span class="dv">6</span>] <span class="sc">*</span> (nadata<span class="sc">$</span>tmentnum[nadata<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fl">365.25</span>]))</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="co"># View the data </span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       cumhaz   cumhaz_se time   tment tmentnum        pwch
1 0.005780347 0.005797126   24 tment=0        0 0.006179904
2 0.005780347 0.005797126   87 tment=0        0 0.022402152
3 0.011628300 0.008246599   98 tment=0        0 0.025234607
4 0.017510653 0.010139685  114 tment=0        0 0.029354543
5 0.023427813 0.011748804  117 tment=0        0 0.030127031
6 0.023427813 0.011748804  130 tment=0        0 0.033474479</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reformat for plot</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>piecepdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> <span class="fu">c</span>(nadata<span class="sc">$</span>cumhaz, nadata<span class="sc">$</span>pwch), </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">time =</span> <span class="fu">rep</span>(nadata<span class="sc">$</span>time, <span class="dv">2</span>),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tmentnum =</span> <span class="fu">rep</span>(nadata<span class="sc">$</span>tmentnum, <span class="dv">2</span>),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Nelson-Aalen"</span>, <span class="fu">length</span>(nadata<span class="sc">$</span>time)), </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Piece-wise exponential"</span>, <span class="fu">length</span>(nadata<span class="sc">$</span>time))))</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Only for treatment 1</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>piecepdata1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(piecepdata, tmentnum <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.4</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>fig24 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> type), </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">subset</span>(piecepdata1, type <span class="sc">==</span> <span class="st">"Nelson-Aalen"</span>)) <span class="sc">+</span> </span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> type), <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">subset</span>(piecepdata1, type <span class="sc">==</span> <span class="st">"Piece-wise exponential"</span>)) <span class="sc">+</span> </span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">linetype =</span> <span class="st">"Type"</span>) <span class="sc">+</span> </span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>))  <span class="sc">+</span> </span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>fig24</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3pwchplac.pdf"</span>, <span class="at">plot =</span> fig24, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">21</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.5 --------------------------------------#</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a Cox model using the pbc3 data with treatment as a covariate</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of fit</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment, data = pbc3, 
    method = "breslow")

  n= 349, number of events= 90 

          coef exp(coef) se(coef)      z Pr(&gt;|z|)
tment -0.05854   0.94314  0.21092 -0.278    0.781

      exp(coef) exp(-coef) lower .95 upper .95
tment    0.9431       1.06    0.6238     1.426

Concordance= 0.517  (se = 0.029 )
Likelihood ratio test= 0.08  on 1 df,   p=0.8
Wald test            = 0.08  on 1 df,   p=0.8
Score (logrank) test = 0.08  on 1 df,   p=0.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxfit, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>coxdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> coxcumhaz<span class="sc">$</span>hazard, </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> coxcumhaz<span class="sc">$</span>time, </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tment =</span> <span class="fu">rep</span>(<span class="st">"0"</span>, <span class="fu">nrow</span>(coxcumhaz)), </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Breslow estimate"</span>, <span class="fu">nrow</span>(coxcumhaz)))</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 2.5</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>fig25 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> tment), <span class="at">data =</span> coxdata) <span class="sc">+</span> </span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard"</span>) <span class="sc">+</span> </span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Treatment"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>)) <span class="sc">+</span> </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>)),</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>fig25</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3breslow.pdf"</span>, <span class="at">plot =</span> fig25, </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">21</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.3 ---------------------------------------#</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average covariate values of albumin and bilirubin per treatment group</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> pbc3 <span class="sc">%&gt;%</span> </span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tment, tment_char) <span class="sc">%&gt;%</span> </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(id <span class="sc">!=</span> <span class="dv">0</span>),  </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">average_albumin =</span> <span class="fu">mean</span>(alb, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># </span><span class="al">NOTE</span><span class="co">: Removes missing observations from mean computation</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">average_bilirubin =</span> <span class="fu">mean</span>(bili, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>            )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'tment'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sumdata)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>sumdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tment tment_char   n average_albumin average_bilirubin
1     0    Placebo 173        39.26101          42.33674
2     1        CyA 176        37.50731          48.55540</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.4 ---------------------------------------#</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model with treatment, albumin and bilirubin as covariates </span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> pbc3)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

            coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    
tment -0.4965639  0.6086184  0.2256162 -2.201   0.0277 *  
alb   -0.1156596  0.8907784  0.0212810 -5.435 5.48e-08 ***
bili   0.0089494  1.0089895  0.0009801  9.131  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
tment    0.6086     1.6431    0.3911    0.9471
alb      0.8908     1.1226    0.8544    0.9287
bili     1.0090     0.9911    1.0071    1.0109

Concordance= 0.806  (se = 0.021 )
Likelihood ratio test= 99.06  on 3 df,   p=&lt;2e-16
Wald test            = 121  on 3 df,   p=&lt;2e-16
Score (logrank) test = 172.3  on 3 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.5 ---------------------------------------#</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model with treatment, albumin and bilirubin as covariates</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>tment_char)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>poismod_t25 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pbc3mult,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> poisson)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t25)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4119  -0.5253  -0.3722  -0.2312   2.8728  

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -4.7682896  0.9749615  -4.891  1.0e-06 ***
as.factor(timegroup)1 -0.3196440  0.6042836  -0.529   0.5968    
as.factor(timegroup)2  0.5381074  0.6022200   0.894   0.3716    
tment_charPlacebo      0.4753406  0.2240970   2.121   0.0339 *  
alb                   -0.1123359  0.0212829  -5.278  1.3e-07 ***
bili                   0.0084593  0.0009392   9.007  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.73  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 538.73

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.6 ---------------------------------------#</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add transformations of covariates </span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>albnorm <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (alb<span class="dv">-35</span>)<span class="sc">*</span>(alb<span class="sc">&gt;</span><span class="dv">35</span>))</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb10 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, alb<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>alb2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, alb10<span class="sc">*</span>alb10)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilihigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-17.1</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>))</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilitoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-34.2</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>))</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bilimuchtoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (bili<span class="fl">-51.3</span>)<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>))</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili100 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, bili<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>bili2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, bili100<span class="sc">*</span>bili100)</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fu">log2</span>(bili))</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilihigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">17.1</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">17.1</span>))</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilitoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">34.2</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">34.2</span>))</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>logbilimuchtoohigh <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, (log2bili<span class="sc">-</span><span class="fu">log2</span>(<span class="fl">51.3</span>))<span class="sc">*</span>(bili<span class="sc">&gt;</span><span class="fl">51.3</span>))</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, log2bili<span class="sc">*</span>log2bili)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data ready using survSplit</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>pbc3mult <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(days, fail) <span class="sc">~</span> ., </span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>                      pbc3,</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">episode =</span> <span class="st">"timegroup"</span>)</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk time</span></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>risktime <span class="ot">&lt;-</span> pbc3mult<span class="sc">$</span>days <span class="sc">-</span> cuts[pbc3mult<span class="sc">$</span>timegroup] </span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Poisson models ##</span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a><span class="co"># For comparison, LR test</span></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>base_poismod <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> pbc3mult,</span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> poisson)</span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>base_poismod_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult,</span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Linear effects </span></span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 1</span></span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a>poismod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> albnorm,</span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pbc3mult,</span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> poisson)</span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili + albnorm, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3941  -0.5301  -0.3640  -0.2200   2.9953  

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -5.1177409  1.6273358  -3.145  0.00166 ** 
as.factor(timegroup)1 -0.3106216  0.6042733  -0.514  0.60722    
as.factor(timegroup)2  0.5433694  0.6022062   0.902  0.36690    
tment_charCyA         -0.4576984  0.2247281  -2.037  0.04168 *  
alb                   -0.0864388  0.0451742  -1.913  0.05569 .  
bili                   0.0084777  0.0009419   9.001  &lt; 2e-16 ***
albnorm               -0.0473832  0.0720301  -0.658  0.51065    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.28  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 540.28

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(lmtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lmtest</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lmtest' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'zoo' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l1, </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>       base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + bili + albnorm
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -263.14                     
2   6 -263.36 -1 0.4404     0.5069</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Small error in table, test statistic = 0.44 (not 0.43)</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 2</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>poismod_t26_l2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>                       bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh, 
    family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8952  -0.4629  -0.2866  -0.1828   2.8580  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.453990   1.368380  -4.717  2.4e-06 ***
as.factor(timegroup)1 -0.427435   0.604700  -0.707   0.4797    
as.factor(timegroup)2  0.425435   0.603554   0.705   0.4809    
tment_charCyA         -0.569111   0.226892  -2.508   0.0121 *  
alb                   -0.086487   0.021876  -3.954  7.7e-05 ***
bili                   0.061654   0.062308   0.989   0.3224    
bilihigh              -0.016757   0.085194  -0.197   0.8441    
bilitoohigh            0.002652   0.052566   0.050   0.9598    
bilimuchtoohigh       -0.042801   0.026193  -1.634   0.1022    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 326.18  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.18

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l2, </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>       base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   9 -251.09                         
2   6 -263.36 -3 24.545  1.922e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 3</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                       log2bili <span class="sc">+</span> logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + logbilihigh + logbilitoohigh + 
    logbilimuchtoohigh, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7543  -0.4596  -0.2891  -0.1818   2.8323  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.52003    1.99572  -3.267 0.001087 ** 
as.factor(timegroup)1 -0.40679    0.60392  -0.674 0.500579    
as.factor(timegroup)2  0.41834    0.60355   0.693 0.488223    
tment_charCyA         -0.55563    0.22703  -2.447 0.014390 *  
alb                   -0.08440    0.02181  -3.870 0.000109 ***
log2bili               0.19800    0.46549   0.425 0.670583    
logbilihigh            0.88154    0.91202   0.967 0.333756    
logbilitoohigh        -0.23363    1.27745  -0.183 0.854884    
logbilimuchtoohigh    -0.31390    0.97076  -0.323 0.746425    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.54  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 521.54

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_l3, </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>       base_poismod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili + logbilihigh + logbilitoohigh + logbilimuchtoohigh
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   9 -251.77                     
2   6 -252.62 -3 1.7135     0.6339</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Quadratic effects</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For comparison, LR test</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>base_poismod2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> bili100,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult,</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>base_poismod2_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> log2bili,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> pbc3mult,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> poisson)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 1</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>poismod_t26_q1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> alb2 <span class="sc">+</span> bili100,</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb10 + alb2 + bili100, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4115  -0.5237  -0.3725  -0.2325   2.8197  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -3.82798    3.81418  -1.004   0.3156    
as.factor(timegroup)1 -0.32278    0.60484  -0.534   0.5936    
as.factor(timegroup)2  0.53621    0.60243   0.890   0.3734    
tment_charCyA         -0.47868    0.22585  -2.119   0.0341 *  
alb10                 -1.38772    2.10146  -0.660   0.5090    
alb2                   0.03705    0.29295   0.126   0.8993    
bili100                0.84614    0.09391   9.010   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.71  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 540.71

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q1, </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>       base_poismod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + alb2 + bili100
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + bili100
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -263.36                     
2   6 -263.36 -1 0.0158     0.8999</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 2</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> bili2 <span class="sc">+</span> bili100,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb10 + bili2 + bili100, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0659  -0.4868  -0.3398  -0.2141   2.8447  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -5.16310    1.05317  -4.902 9.47e-07 ***
as.factor(timegroup)1 -0.38186    0.60472  -0.631  0.52774    
as.factor(timegroup)2  0.45545    0.60332   0.755  0.45030    
tment_charCyA         -0.49873    0.22169  -2.250  0.02447 *  
alb10                 -0.97736    0.21632  -4.518 6.24e-06 ***
bili2                 -0.31517    0.09069  -3.475  0.00051 ***
bili100                1.99829    0.32664   6.118 9.49e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 337.38  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 527.38

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q2, </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>       base_poismod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + bili2 + bili100
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + bili100
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   7 -256.69                         
2   6 -263.36 -1 13.345  0.0002591 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 3</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>poismod_t26_q3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili2,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb10 + log2bili + log2bili2, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8927  -0.4832  -0.2981  -0.1830   2.9953  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -7.860086   1.851557  -4.245 2.18e-05 ***
as.factor(timegroup)1 -0.406020   0.604625  -0.672   0.5019    
as.factor(timegroup)2  0.439074   0.603467   0.728   0.4669    
tment_charCyA         -0.545495   0.222667  -2.450   0.0143 *  
alb10                 -0.871058   0.218920  -3.979 6.92e-05 ***
log2bili               0.627828   0.497489   1.262   0.2070    
log2bili2              0.001641   0.042356   0.039   0.9691    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.25  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.25

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t26_q3, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>       base_poismod2_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + log2bili + log2bili2
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb10 + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   7 -252.62                     
2   6 -252.62 -1 0.0015     0.9691</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Cox models ##</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Models for LR tests</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>base_coxmod <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>base_coxmod_log <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili, <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3)</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Linear effects </span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 1</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> albnorm, <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> pbc3)</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_l1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili + 
    albnorm, data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

              coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    
tment   -0.4750722  0.6218402  0.2261462 -2.101   0.0357 *  
alb     -0.0854244  0.9181225  0.0453150 -1.885   0.0594 .  
bili     0.0089810  1.0090214  0.0009843  9.124   &lt;2e-16 ***
albnorm -0.0557001  0.9458228  0.0726447 -0.767   0.4432    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
tment      0.6218     1.6081    0.3992    0.9687
alb        0.9181     1.0892    0.8401    1.0034
bili       1.0090     0.9911    1.0071    1.0110
albnorm    0.9458     1.0573    0.8203    1.0905

Concordance= 0.806  (se = 0.021 )
Likelihood ratio test= 99.66  on 4 df,   p=&lt;2e-16
Wald test            = 118.5  on 4 df,   p=&lt;2e-16
Score (logrank) test = 175.5  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l1, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili + albnorm
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -413.12                     
2   3 -413.42 -1 0.6001     0.4386</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or alternatively anova(coxmod_t26_l1)</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 2</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_l2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + bili + 
    bilihigh + bilitoohigh + bilimuchtoohigh, data = pbc3, method = "breslow", 
    eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

                     coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
tment           -0.598494  0.549639  0.229637 -2.606  0.00915 ** 
alb             -0.090970  0.913045  0.021894 -4.155 3.25e-05 ***
bili             0.062425  1.064414  0.062296  1.002  0.31631    
bilihigh        -0.014631  0.985476  0.085327 -0.171  0.86386    
bilitoohigh     -0.002584  0.997419  0.052961 -0.049  0.96109    
bilimuchtoohigh -0.040017  0.960773  0.026486 -1.511  0.13082    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

                exp(coef) exp(-coef) lower .95 upper .95
tment              0.5496     1.8194    0.3504    0.8621
alb                0.9130     1.0952    0.8747    0.9531
bili               1.0644     0.9395    0.9421    1.2026
bilihigh           0.9855     1.0147    0.8337    1.1649
bilitoohigh        0.9974     1.0026    0.8991    1.1065
bilimuchtoohigh    0.9608     1.0408    0.9122    1.0120

Concordance= 0.825  (se = 0.021 )
Likelihood ratio test= 123.5  on 6 df,   p=&lt;2e-16
Wald test            = 110.8  on 6 df,   p=&lt;2e-16
Score (logrank) test = 173.9  on 6 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l2, base_coxmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + bili + bilihigh + bilitoohigh + 
    bilimuchtoohigh
Model 2: Surv(days, status != 0) ~ tment + alb + bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   6 -401.22                         
2   3 -413.42 -3 24.396  2.064e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 3</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_l3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    logbilihigh + logbilitoohigh + logbilimuchtoohigh, data = pbc3, 
    method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

                       coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment              -0.58019   0.55979  0.22957 -2.527   0.0115 *  
alb                -0.08852   0.91528  0.02182 -4.056 4.99e-05 ***
log2bili            0.20135   1.22306  0.46511  0.433   0.6651    
logbilihigh         0.93567   2.54893  0.91503  1.023   0.3065    
logbilitoohigh     -0.38647   0.67945  1.29333 -0.299   0.7651    
logbilimuchtoohigh -0.18140   0.83410  0.98801 -0.184   0.8543    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

                   exp(coef) exp(-coef) lower .95 upper .95
tment                 0.5598     1.7864   0.35696    0.8779
alb                   0.9153     1.0926   0.87696    0.9553
log2bili              1.2231     0.8176   0.49152    3.0433
logbilihigh           2.5489     0.3923   0.42412   15.3191
logbilitoohigh        0.6794     1.4718   0.05386    8.5712
logbilimuchtoohigh    0.8341     1.1989   0.12029    5.7838

Concordance= 0.823  (se = 0.021 )
Likelihood ratio test= 121.6  on 6 df,   p=&lt;2e-16
Wald test            = 108.5  on 6 df,   p=&lt;2e-16
Score (logrank) test = 164.3  on 6 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxmod_t26_l3, base_coxmod_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(days, status != 0) ~ tment + alb + log2bili + logbilihigh + 
    logbilitoohigh + logbilimuchtoohigh
Model 2: Surv(days, status != 0) ~ tment + alb + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -402.13                     
2   3 -402.94 -3 1.6144     0.6561</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Quadratic effects </span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 1</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb10 <span class="sc">+</span> bili100 <span class="sc">+</span> alb2,</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb10 + bili100 + 
    alb2, data = pbc3)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

            coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment   -0.49840   0.60750  0.22743 -2.191   0.0284 *  
alb10   -1.29704   0.27334  2.13031 -0.609   0.5426    
bili100  0.89502   2.44739  0.09800  9.133   &lt;2e-16 ***
alb2     0.01971   1.01991  0.29751  0.066   0.9472    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
tment      0.6075     1.6461  0.389011    0.9487
alb10      0.2733     3.6584  0.004201   17.7838
bili100    2.4474     0.4086  2.019676    2.9657
alb2       1.0199     0.9805  0.569276    1.8273

Concordance= 0.806  (se = 0.021 )
Likelihood ratio test= 99.06  on 4 df,   p=&lt;2e-16
Wald test            = 121.2  on 4 df,   p=&lt;2e-16
Score (logrank) test = 178.8  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 2</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb10 <span class="sc">+</span> bili100 <span class="sc">+</span> bili2,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_q2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb10 + bili100 + 
    bili2, data = pbc3)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

            coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment   -0.52111   0.59386  0.22330 -2.334 0.019613 *  
alb10   -1.01919   0.36089  0.21675 -4.702 2.57e-06 ***
bili100  1.99811   7.37511  0.32629  6.124 9.14e-10 ***
bili2   -0.30520   0.73698  0.09098 -3.355 0.000795 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
tment      0.5939     1.6839    0.3834    0.9199
alb10      0.3609     2.7709    0.2360    0.5519
bili100    7.3751     0.1356    3.8907   13.9800
bili2      0.7370     1.3569    0.6166    0.8808

Concordance= 0.815  (se = 0.021 )
Likelihood ratio test= 111.4  on 4 df,   p=&lt;2e-16
Wald test            = 121.6  on 4 df,   p=&lt;2e-16
Score (logrank) test = 172.5  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 3</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>coxmod_t26_q3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb10 <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili2,</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> pbc3)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t26_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb10 + log2bili + 
    log2bili2, data = pbc3)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

               coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
tment     -0.574344  0.563074  0.224533 -2.558   0.0105 *  
alb10     -0.914495  0.400719  0.219173 -4.172 3.01e-05 ***
log2bili   0.583636  1.792545  0.500009  1.167   0.2431    
log2bili2  0.007044  1.007069  0.042774  0.165   0.8692    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

          exp(coef) exp(-coef) lower .95 upper .95
tment        0.5631     1.7760    0.3626    0.8744
alb10        0.4007     2.4955    0.2608    0.6157
log2bili     1.7925     0.5579    0.6728    4.7762
log2bili2    1.0071     0.9930    0.9261    1.0951

Concordance= 0.819  (se = 0.022 )
Likelihood ratio test= 120.1  on 4 df,   p=&lt;2e-16
Wald test            = 111.9  on 4 df,   p=&lt;2e-16
Score (logrank) test = 169.6  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.6 --------------------------------------#</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The below linear predictors include estimates from the following models, </span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>tment_char)</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>base_poismod <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili,</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult,</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(base_poismod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4119  -0.5253  -0.3722  -0.2312   2.8728  

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -4.2301822  0.7855195  -5.385 7.24e-08 ***
as.factor(timegroup)3 -0.5381074  0.6022200  -0.894 0.371568    
as.factor(timegroup)1 -0.8577514  0.2361480  -3.632 0.000281 ***
tment_charPlacebo      0.4753406  0.2240970   2.121 0.033910 *  
alb                   -0.1123359  0.0212829  -5.278 1.30e-07 ***
bili                   0.0084593  0.0009392   9.007  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.73  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 538.73

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>poismod_t26_l1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> bili <span class="sc">+</span> albnorm,</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili + albnorm, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3941  -0.5301  -0.3640  -0.2200   2.9953  

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -5.0320699  1.4715432  -3.420 0.000627 ***
as.factor(timegroup)3 -0.5433694  0.6022062  -0.902 0.366899    
as.factor(timegroup)1 -0.8539910  0.2362103  -3.615 0.000300 ***
tment_charPlacebo      0.4576984  0.2247281   2.037 0.041683 *  
alb                   -0.0864388  0.0451742  -1.913 0.055690 .  
bili                   0.0084777  0.0009419   9.001  &lt; 2e-16 ***
albnorm               -0.0473832  0.0720301  -0.658 0.510651    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 350.28  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 540.28

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>                        bili <span class="sc">+</span> bilihigh <span class="sc">+</span> bilitoohigh <span class="sc">+</span> bilimuchtoohigh,</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + bili + bilihigh + bilitoohigh + bilimuchtoohigh, 
    family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8952  -0.4629  -0.2866  -0.1828   2.8580  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.597666   1.204436  -5.478 4.31e-08 ***
as.factor(timegroup)3 -0.425435   0.603554  -0.705  0.48088    
as.factor(timegroup)1 -0.852870   0.231526  -3.684  0.00023 ***
tment_charPlacebo      0.569111   0.226892   2.508  0.01213 *  
alb                   -0.086487   0.021876  -3.954 7.70e-05 ***
bili                   0.061654   0.062308   0.989  0.32242    
bilihigh              -0.016757   0.085194  -0.197  0.84406    
bilitoohigh            0.002652   0.052566   0.050  0.95977    
bilimuchtoohigh       -0.042801   0.026193  -1.634  0.10224    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 326.18  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.18

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataset with linear predictor information</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>lin2 <span class="ot">&lt;-</span> pbc3</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">1.6076-0.1123</span><span class="sc">*</span>alb)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">0.7828-0.0864</span><span class="sc">*</span>alb<span class="fl">-0.0474</span><span class="sc">*</span>albnorm)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fl">1.6076+0.0085</span><span class="sc">*</span>bili<span class="fl">-38.7</span><span class="sc">*</span><span class="fl">0.1123</span>)</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>lin2<span class="sc">$</span>lp4 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">0.5534+0.0617</span><span class="sc">*</span>bili<span class="fl">-0.0168</span><span class="sc">*</span>bilihigh<span class="fl">+0.0027</span><span class="sc">*</span>bilitoohigh</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span><span class="fl">0.0428</span><span class="sc">*</span>bilimuchtoohigh<span class="fl">-0.0865</span><span class="sc">*</span><span class="fl">38.7</span>)</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>lin2row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(lin2)),</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(lin2))), </span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>lp1, lin2<span class="sc">$</span>lp2),</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">alb =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>alb, lin2<span class="sc">$</span>alb))</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>fig26 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alb, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> lin2row) <span class="sc">+</span> </span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>         <span class="fu">xlab</span>(<span class="st">"Albumin"</span>) <span class="sc">+</span> </span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a>         theme_general</span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-27"><a href="#cb138-27" aria-hidden="true" tabindex="-1"></a>fig26</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 12 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3linalb.pdf"</span>, <span class="at">plot =</span> fig26, </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">21</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 12 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.7 --------------------------------------#</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bilirubin and the two last linear predictors</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>lin2row2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(lin2)),</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(lin2))), </span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>lp3, lin2<span class="sc">$</span>lp4),</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bili =</span> <span class="fu">c</span>(lin2<span class="sc">$</span>bili, lin2<span class="sc">$</span>bili))</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>fig27 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bili, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> lin2row2) <span class="sc">+</span> </span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bilirubin"</span>) <span class="sc">+</span> </span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a>fig27</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3linbili.pdf"</span>, <span class="at">plot =</span> fig27, </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">21</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.8 --------------------------------------#</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The below linear predictors include estimates from the following models, </span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>base_poismod2_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb10 <span class="sc">+</span> log2bili,</span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> pbc3mult,</span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">family =</span> poisson)</span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(base_poismod2_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb10 + log2bili, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8855  -0.4833  -0.2974  -0.1822   3.0017  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -8.02328    0.95100  -8.437  &lt; 2e-16 ***
as.factor(timegroup)3 -0.43894    0.60346  -0.727 0.466999    
as.factor(timegroup)1 -0.84401    0.22867  -3.691 0.000223 ***
tment_charPlacebo      0.54549    0.22265   2.450 0.014288 *  
alb10                 -0.86972    0.21615  -4.024 5.73e-05 ***
log2bili               0.64689    0.07326   8.830  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.25  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 517.25

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>poismod_t26_l3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>                        log2bili <span class="sc">+</span> logbilihigh <span class="sc">+</span> logbilitoohigh <span class="sc">+</span> logbilimuchtoohigh,</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> pbc3mult,</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> poisson)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t26_l3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + logbilihigh + logbilitoohigh + 
    logbilimuchtoohigh, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7543  -0.4596  -0.2891  -0.1818   2.8323  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.65731    1.88624  -3.529 0.000416 ***
as.factor(timegroup)3 -0.41834    0.60355  -0.693 0.488223    
as.factor(timegroup)1 -0.82513    0.22932  -3.598 0.000320 ***
tment_charPlacebo      0.55563    0.22703   2.447 0.014390 *  
alb                   -0.08440    0.02181  -3.870 0.000109 ***
log2bili               0.19800    0.46549   0.425 0.670583    
logbilihigh            0.88154    0.91202   0.967 0.333756    
logbilitoohigh        -0.23363    1.27745  -0.183 0.854884    
logbilimuchtoohigh    -0.31390    0.97076  -0.323 0.746425    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.54  on 602  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 521.54

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataset with linear predictor information</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>log2 <span class="ot">&lt;-</span> pbc3</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>log2<span class="sc">$</span>lp3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">2.0162+0.6469</span><span class="sc">*</span>log2bili<span class="fl">-38.7</span><span class="sc">*</span><span class="fl">0.087</span>)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>log2<span class="sc">$</span>lp4 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="sc">-</span><span class="fl">0.6194+0.198</span><span class="sc">*</span>log2bili<span class="fl">+0.8815</span><span class="sc">*</span>logbilihigh<span class="fl">-0.2336</span><span class="sc">*</span>logbilitoohigh</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">-</span><span class="fl">0.3139</span><span class="sc">*</span>logbilimuchtoohigh<span class="fl">-0.0844</span><span class="sc">*</span><span class="fl">38.7</span>)</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>log2row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">effect =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Linear effect"</span>, <span class="fu">nrow</span>(log2)),</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rep</span>(<span class="st">"Effect as linear spline"</span>, <span class="fu">nrow</span>(log2))), </span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lp =</span> <span class="fu">c</span>(log2<span class="sc">$</span>lp3, log2<span class="sc">$</span>lp4),</span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">log2bili =</span> <span class="fu">c</span>(log2<span class="sc">$</span>log2bili, log2<span class="sc">$</span>log2bili))</span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Make plot</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>fig28 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log2bili, <span class="at">y =</span> lp, <span class="at">linetype =</span> effect), <span class="at">data =</span> log2row) <span class="sc">+</span> </span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(log[<span class="dv">2</span>] <span class="sc">*</span> <span class="st">"(bilirubin)"</span>)) <span class="sc">+</span></span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Linear predictor"</span>) <span class="sc">+</span> </span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a>fig28</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-7.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3linlogbili.pdf"</span>, <span class="at">plot =</span> fig28, </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">21</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.7 ---------------------------------------#</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>coxmod_t27 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3)</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t27)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, 
    data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

             coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment    -0.57406   0.56323  0.22447 -2.557   0.0105 *  
alb      -0.09093   0.91308  0.02164 -4.201 2.65e-05 ***
log2bili  0.66500   1.94449  0.07443  8.935  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
tment       0.5632     1.7755    0.3628    0.8745
alb         0.9131     1.0952    0.8752    0.9526
log2bili    1.9445     0.5143    1.6805    2.2499

Concordance= 0.819  (se = 0.022 )
Likelihood ratio test= 120  on 3 df,   p=&lt;2e-16
Wald test            = 110.4  on 3 df,   p=&lt;2e-16
Score (logrank) test = 133.7  on 3 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>poismod_t27 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pbc3mult,</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> poisson)</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t27) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8855  -0.4833  -0.2974  -0.1822   3.0017  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -8.02328    0.95100  -8.437  &lt; 2e-16 ***
as.factor(timegroup)3 -0.43894    0.60346  -0.727 0.466999    
as.factor(timegroup)1 -0.84401    0.22867  -3.691 0.000223 ***
tment_charPlacebo      0.54549    0.22265   2.450 0.014288 *  
alb                   -0.08697    0.02162  -4.024 5.73e-05 ***
log2bili               0.64689    0.07326   8.830  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.25  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 517.25

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.8 ---------------------------------------#</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Cox models</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Model for LR comparison</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>coxmod_t28_base <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 1</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>coxmod_t28_1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment<span class="sc">*</span>alb,</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t28_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    tment * alb, data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

               coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
tment     -0.009736  0.990312  1.559670 -0.006   0.9950    
alb       -0.081319  0.921900  0.034031 -2.390   0.0169 *  
log2bili   0.664413  1.943350  0.074494  8.919   &lt;2e-16 ***
tment:alb -0.015725  0.984398  0.042980 -0.366   0.7145    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

          exp(coef) exp(-coef) lower .95 upper .95
tment        0.9903     1.0098   0.04658   21.0555
alb          0.9219     1.0847   0.86242    0.9855
log2bili     1.9434     0.5146   1.67935    2.2489
tment:alb    0.9844     1.0158   0.90487    1.0709

Concordance= 0.819  (se = 0.022 )
Likelihood ratio test= 120.2  on 4 df,   p=&lt;2e-16
Wald test            = 111.2  on 4 df,   p=&lt;2e-16
Score (logrank) test = 134.3  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(coxmod_t28_1, </span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>      coxmod_t28_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(days, status != 0)
 Model 1: ~ tment + alb + log2bili + tment * alb
 Model 2: ~ tment + alb + log2bili
   loglik  Chisq Df Pr(&gt;|Chi|)
1 -402.87                     
2 -402.94 0.1338  1     0.7145</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model 2</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>coxmod_t28_2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment<span class="sc">*</span>log2bili,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_t28_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili + 
    tment * log2bili, data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

                   coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment           0.19880   1.21994  0.85653  0.232    0.816    
alb            -0.09331   0.91091  0.02191 -4.260 2.05e-05 ***
log2bili        0.72558   2.06593  0.09865  7.355 1.91e-13 ***
tment:log2bili -0.13213   0.87623  0.14180 -0.932    0.351    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

               exp(coef) exp(-coef) lower .95 upper .95
tment             1.2199     0.8197    0.2276    6.5375
alb               0.9109     1.0978    0.8726    0.9509
log2bili          2.0659     0.4840    1.7027    2.5066
tment:log2bili    0.8762     1.1413    0.6636    1.1570

Concordance= 0.821  (se = 0.022 )
Likelihood ratio test= 120.9  on 4 df,   p=&lt;2e-16
Wald test            = 112.9  on 4 df,   p=&lt;2e-16
Score (logrank) test = 136.9  on 4 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(coxmod_t28_2, </span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>      coxmod_t28_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(days, status != 0)
 Model 1: ~ tment + alb + log2bili + tment * log2bili
 Model 2: ~ tment + alb + log2bili
   loglik  Chisq Df Pr(&gt;|Chi|)
1 -402.51                     
2 -402.94 0.8644  1     0.3525</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Poisson models</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Model for LR comparison - no interaction</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>poismod_t28_base <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 1</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>poismod_t28_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>alb,</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3mult,</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> poisson)</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * alb, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9119  -0.4864  -0.3014  -0.1816   2.9760  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -7.77706    1.11741  -6.960 3.41e-12 ***
as.factor(timegroup)3 -0.43125    0.60379  -0.714 0.475080    
as.factor(timegroup)1 -0.84426    0.22851  -3.695 0.000220 ***
tment_charPlacebo     -0.09200    1.55226  -0.059 0.952738    
alb                   -0.09406    0.02755  -3.414 0.000639 ***
log2bili               0.64624    0.07334   8.812  &lt; 2e-16 ***
tment_charPlacebo:alb  0.01778    0.04281   0.415 0.677959    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.08  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.08

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"CyA"</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>poismod_t28_11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>alb,</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_11) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * alb, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9119  -0.4864  -0.3014  -0.1816   2.9760  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -7.86906    1.36181  -5.778 7.54e-09 ***
as.factor(timegroup)3 -0.43125    0.60379  -0.714  0.47508    
as.factor(timegroup)1 -0.84426    0.22851  -3.695  0.00022 ***
tment_charCyA          0.09200    1.55226   0.059  0.95274    
alb                   -0.07628    0.03359  -2.271  0.02316 *  
log2bili               0.64624    0.07334   8.812  &lt; 2e-16 ***
tment_charCyA:alb     -0.01778    0.04281  -0.415  0.67796    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 329.08  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.08

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t28_base, </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>       poismod_t28_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili + tment_char * alb
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   7 -252.54  1 0.1723      0.678</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model 2</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>poismod_t28_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>log2bili,</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * log2bili, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7460  -0.4807  -0.3003  -0.1858   3.0728  

Coefficients:
                           Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                -7.53457    1.09655  -6.871 6.37e-12 ***
as.factor(timegroup)3      -0.41713    0.60400  -0.691 0.489808    
as.factor(timegroup)1      -0.85694    0.22932  -3.737 0.000186 ***
tment_charPlacebo          -0.18058    0.84828  -0.213 0.831422    
alb                        -0.08909    0.02185  -4.078 4.54e-05 ***
log2bili                    0.57982    0.10472   5.537 3.08e-08 ***
tment_charPlacebo:log2bili  0.12386    0.14006   0.884 0.376511    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.47  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 518.47

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"CyA"</span>)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>poismod_t28_21 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>log2bili,</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t28_21) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * log2bili, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7460  -0.4807  -0.3003  -0.1858   3.0728  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)            -7.71515    1.01592  -7.594 3.10e-14 ***
as.factor(timegroup)3  -0.41713    0.60400  -0.691 0.489808    
as.factor(timegroup)1  -0.85694    0.22932  -3.737 0.000186 ***
tment_charCyA           0.18058    0.84828   0.213 0.831422    
alb                    -0.08909    0.02185  -4.078 4.54e-05 ***
log2bili                0.70368    0.09717   7.242 4.42e-13 ***
tment_charCyA:log2bili -0.12386    0.14006  -0.884 0.376511    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.47  on 604  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 518.47

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LR test</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t28_base, </span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>       poismod_t28_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili + tment_char * log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   7 -252.24  1 0.7787     0.3775</code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.9 ---------------------------------------#</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1; </span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>tment_char <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pbc3mult<span class="sc">$</span>tment_char, <span class="at">ref =</span> <span class="st">"Placebo"</span>)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"1"</span>)</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>poismod_t29_11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> timegroup <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>timegroup,</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pbc3mult,</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> poisson)</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_11) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + 
    alb + log2bili + tment_char * timegroup, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8788  -0.4885  -0.3022  -0.1818   3.0164  

Coefficients:
                             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -8.01250    0.97312  -8.234  &lt; 2e-16 ***
timegroup1                   -0.89421    0.31710  -2.820   0.0048 ** 
timegroup3                   -0.89971    1.02908  -0.874   0.3820    
tment_charPlacebo             0.46193    0.34460   1.340   0.1801    
alb                          -0.08640    0.02166  -3.988 6.65e-05 ***
log2bili                      0.64871    0.07367   8.806  &lt; 2e-16 ***
timegroup1:tment_charPlacebo  0.09973    0.44250   0.225   0.8217    
timegroup3:tment_charPlacebo  0.80434    1.27283   0.632   0.5274    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.82  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.82

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"2"</span>)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_12 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>timegroup,</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_12) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * timegroup, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8788  -0.4885  -0.3022  -0.1818   3.0164  

Coefficients: (2 not defined because of singularities)
                              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -8.912206   1.410958  -6.316 2.68e-10 ***
as.factor(timegroup)2         0.899710   1.029079   0.874    0.382    
as.factor(timegroup)1         0.005499   1.026826   0.005    0.996    
tment_charPlacebo             1.266273   1.229390   1.030    0.303    
alb                          -0.086405   0.021665  -3.988 6.65e-05 ***
log2bili                      0.648711   0.073669   8.806  &lt; 2e-16 ***
timegroup2                          NA         NA      NA       NA    
timegroup1                          NA         NA      NA       NA    
tment_charPlacebo:timegroup2 -0.804338   1.272830  -0.632    0.527    
tment_charPlacebo:timegroup1 -0.704610   1.262063  -0.558    0.577    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.82  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.82

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_13 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> tment_char<span class="sc">*</span>timegroup,</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_13) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + tment_char * timegroup, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8788  -0.4885  -0.3022  -0.1818   3.0164  

Coefficients: (2 not defined because of singularities)
                              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -8.906706   0.949577  -9.380  &lt; 2e-16 ***
as.factor(timegroup)3        -0.005499   1.026826  -0.005   0.9957    
as.factor(timegroup)2         0.894211   0.317101   2.820   0.0048 ** 
tment_charPlacebo             0.561662   0.290915   1.931   0.0535 .  
alb                          -0.086405   0.021665  -3.988 6.65e-05 ***
log2bili                      0.648711   0.073669   8.806  &lt; 2e-16 ***
timegroup3                          NA         NA      NA       NA    
timegroup2                          NA         NA      NA       NA    
tment_charPlacebo:timegroup3  0.704610   1.262063   0.558   0.5766    
tment_charPlacebo:timegroup2 -0.099728   0.442503  -0.225   0.8217    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 328.82  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 520.82

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2; </span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"1"</span>)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>poismod_t29_21 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> timegroup <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> alb<span class="sc">*</span>timegroup,</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_21) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + 
    alb + log2bili + alb * timegroup, family = poisson, data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9765  -0.4756  -0.2941  -0.1722   2.9166  

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       -9.30795    1.40949  -6.604 4.01e-11 ***
timegroup1         1.24042    1.59864   0.776   0.4378    
timegroup3         0.01433    6.09060   0.002   0.9981    
tment_charPlacebo  0.56130    0.22300   2.517   0.0118 *  
alb               -0.05231    0.03472  -1.507   0.1319    
log2bili           0.64608    0.07361   8.777  &lt; 2e-16 ***
timegroup1:alb    -0.05795    0.04376  -1.324   0.1854    
timegroup3:alb    -0.01311    0.15739  -0.083   0.9336    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.45  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.45

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"2"</span>)</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_22 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> alb<span class="sc">*</span>timegroup,</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_22) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + alb * timegroup, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9765  -0.4756  -0.2941  -0.1722   2.9166  

Coefficients: (2 not defined because of singularities)
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -9.29362    5.94435  -1.563   0.1179    
as.factor(timegroup)2 -0.01433    6.09060  -0.002   0.9981    
as.factor(timegroup)1  1.22609    6.02995   0.203   0.8389    
tment_charPlacebo      0.56130    0.22300   2.517   0.0118 *  
alb                   -0.06542    0.15336  -0.427   0.6697    
log2bili               0.64608    0.07361   8.777   &lt;2e-16 ***
timegroup2                  NA         NA      NA       NA    
timegroup1                  NA         NA      NA       NA    
alb:timegroup2         0.01311    0.15739   0.083   0.9336    
alb:timegroup1        -0.04484    0.15605  -0.287   0.7739    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.45  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.45

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_23 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> alb<span class="sc">*</span>timegroup,</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_23) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + alb * timegroup, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9765  -0.4756  -0.2941  -0.1722   2.9166  

Coefficients: (2 not defined because of singularities)
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -8.06752    1.11184  -7.256 3.99e-13 ***
as.factor(timegroup)3 -1.22609    6.02995  -0.203   0.8389    
as.factor(timegroup)2 -1.24042    1.59864  -0.776   0.4378    
tment_charPlacebo      0.56130    0.22300   2.517   0.0118 *  
alb                   -0.11026    0.02791  -3.951 7.79e-05 ***
log2bili               0.64608    0.07361   8.777  &lt; 2e-16 ***
timegroup3                  NA         NA      NA       NA    
timegroup2                  NA         NA      NA       NA    
alb:timegroup3         0.04484    0.15605   0.287   0.7739    
alb:timegroup2         0.05795    0.04376   1.324   0.1854    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.45  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.45

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 3; </span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"1"</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>poismod_t29_31 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> timegroup <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili<span class="sc">*</span>timegroup,</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_31) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + timegroup + tment_char + 
    alb + log2bili + log2bili * timegroup, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0280  -0.4825  -0.2965  -0.1821   2.9014  

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)         -7.57166    1.08557  -6.975 3.06e-12 ***
timegroup1          -1.72397    0.88760  -1.942   0.0521 .  
timegroup3           0.69600    2.32124   0.300   0.7643    
tment_charPlacebo    0.51454    0.22373   2.300   0.0215 *  
alb                 -0.08570    0.02174  -3.942 8.10e-05 ***
log2bili             0.55747    0.12113   4.602 4.18e-06 ***
timegroup1:log2bili  0.15296    0.15024   1.018   0.3086    
timegroup3:log2bili -0.25235    0.49539  -0.509   0.6105    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.67  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.67

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"2"</span>)</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_32 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili<span class="sc">*</span>timegroup,</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_32) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + log2bili * timegroup, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0280  -0.4825  -0.2965  -0.1821   2.9014  

Coefficients: (2 not defined because of singularities)
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -6.87566    2.36338  -2.909  0.00362 ** 
as.factor(timegroup)2 -0.69600    2.32124  -0.300  0.76430    
as.factor(timegroup)1 -2.41998    2.30859  -1.048  0.29452    
tment_charPlacebo      0.51454    0.22373   2.300  0.02146 *  
alb                   -0.08570    0.02174  -3.942  8.1e-05 ***
log2bili               0.30512    0.48171   0.633  0.52646    
timegroup2                  NA         NA      NA       NA    
timegroup1                  NA         NA      NA       NA    
log2bili:timegroup2    0.25235    0.49539   0.509  0.61047    
log2bili:timegroup1    0.40532    0.49015   0.827  0.40828    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.67  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.67

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>pbc3mult<span class="sc">$</span>timegroup <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(pbc3mult<span class="sc">$</span>timegroup), <span class="at">ref =</span> <span class="st">"3"</span>)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>poismod_t29_33 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> log2bili<span class="sc">*</span>timegroup,</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poismod_t29_33) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + as.factor(timegroup) + 
    tment_char + alb + log2bili + log2bili * timegroup, family = poisson, 
    data = pbc3mult)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0280  -0.4825  -0.2965  -0.1821   2.9014  

Coefficients: (2 not defined because of singularities)
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -9.29563    1.02069  -9.107  &lt; 2e-16 ***
as.factor(timegroup)3  2.41998    2.30859   1.048   0.2945    
as.factor(timegroup)2  1.72397    0.88760   1.942   0.0521 .  
tment_charPlacebo      0.51454    0.22373   2.300   0.0215 *  
alb                   -0.08570    0.02174  -3.942 8.10e-05 ***
log2bili               0.71044    0.09260   7.672 1.69e-14 ***
timegroup3                  NA         NA      NA       NA    
timegroup2                  NA         NA      NA       NA    
log2bili:timegroup3   -0.40532    0.49015  -0.827   0.4083    
log2bili:timegroup2   -0.15296    0.15024  -1.018   0.3086    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 449.14  on 610  degrees of freedom
Residual deviance: 327.67  on 603  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 519.67

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="do">## LR tests </span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Base model; no interaction</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>poismod_t29_base <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> <span class="fu">as.factor</span>(timegroup) <span class="sc">+</span> tment_char <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3mult,</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> poisson)</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, </span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>       poismod_t29_11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + 
    log2bili + tment_char * timegroup
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   8 -252.41  2 0.4312     0.8061</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, </span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>       poismod_t29_21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + 
    log2bili + alb * timegroup
  #Df  LogLik Df Chisq Pr(&gt;Chisq)
1   6 -252.62                    
2   8 -251.72  2 1.803      0.406</code></pre>
</div>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 3</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poismod_t29_base, </span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>       poismod_t29_31)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail ~ offset(log(risktime)) + as.factor(timegroup) + tment_char + 
    alb + log2bili
Model 2: fail ~ offset(log(risktime)) + timegroup + tment_char + alb + 
    log2bili + log2bili * timegroup
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   6 -252.62                     
2   8 -251.84  2 1.5777     0.4544</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.9 --------------------------------------#</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>coxmod_f29 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(tment) <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_f29)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ strata(tment) + alb + 
    log2bili, data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

             coef exp(coef) se(coef)      z Pr(&gt;|z|)    
alb      -0.09002   0.91391  0.02168 -4.153 3.28e-05 ***
log2bili  0.66328   1.94114  0.07531  8.807  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
alb         0.9139     1.0942    0.8759    0.9536
log2bili    1.9411     0.5152    1.6748    2.2499

Concordance= 0.818  (se = 0.022 )
Likelihood ratio test= 119.3  on 2 df,   p=&lt;2e-16
Wald test            = 109.1  on 2 df,   p=&lt;2e-16
Score (logrank) test = 133.5  on 2 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting cumulative baseline hazards per treatment</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>cumhaz_treat <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(coxmod_f29, <span class="at">centered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>cumhaz_treat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cumhaz_treat)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Per treatment</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>hazard_t0 <span class="ot">&lt;-</span> cumhaz_treat[cumhaz_treat<span class="sc">$</span>strata <span class="sc">==</span> <span class="st">"tment=0"</span>,]</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>hazard_t0[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"tment=0"</span>)</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>hazard_t0<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hazard_t0<span class="sc">$</span>time)</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>hazard_t0<span class="sc">$</span>hazard <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hazard_t0<span class="sc">$</span>hazard)</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>hazard_t1 <span class="ot">&lt;-</span> cumhaz_treat[cumhaz_treat<span class="sc">$</span>strata <span class="sc">==</span> <span class="st">"tment=1"</span>,]</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Match times</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>alltimes <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(cumhaz_treat<span class="sc">$</span>time))</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>hazard_t0_allt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alltimes), <span class="cf">function</span>(k) <span class="fu">tail</span>(hazard_t0<span class="sc">$</span>hazard[hazard_t0<span class="sc">$</span>time <span class="sc">&lt;=</span> alltimes[k]], <span class="dv">1</span>)))</span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a>hazard_t1_allt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alltimes), <span class="cf">function</span>(k) <span class="fu">tail</span>(hazard_t1<span class="sc">$</span>hazard[hazard_t1<span class="sc">$</span>time <span class="sc">&lt;=</span> alltimes[k]], <span class="dv">1</span>))) </span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a>hazards <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(hazard_t0_allt, </span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a>                      hazard_t1_allt)</span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficient</span></span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a>coxmod_f29_t <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili,</span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eps =</span> <span class="fl">1e-8</span>, <span class="at">method =</span> <span class="st">"breslow"</span>,</span>
<span id="cb198-24"><a href="#cb198-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> pbc3)</span>
<span id="cb198-25"><a href="#cb198-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-26"><a href="#cb198-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxmod_f29_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(days, status != 0) ~ tment + alb + log2bili, 
    data = pbc3, method = "breslow", eps = 1e-08)

  n= 343, number of events= 88 
   (6 observations deleted due to missingness)

             coef exp(coef) se(coef)      z Pr(&gt;|z|)    
tment    -0.57406   0.56323  0.22447 -2.557   0.0105 *  
alb      -0.09093   0.91308  0.02164 -4.201 2.65e-05 ***
log2bili  0.66500   1.94449  0.07443  8.935  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
tment       0.5632     1.7755    0.3628    0.8745
alb         0.9131     1.0952    0.8752    0.9526
log2bili    1.9445     0.5143    1.6805    2.2499

Concordance= 0.819  (se = 0.022 )
Likelihood ratio test= 120  on 3 df,   p=&lt;2e-16
Wald test            = 110.4  on 3 df,   p=&lt;2e-16
Score (logrank) test = 133.7  on 3 df,   p=&lt;2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make plot</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>fig29 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hazard_t0_allt, <span class="at">y =</span> hazard_t1_allt), <span class="at">data =</span> hazards) <span class="sc">+</span> </span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(coxmod_f29_t)[[<span class="st">"tment"</span>]]), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cumulative baseline hazard: placebo"</span>) <span class="sc">+</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard: CyA"</span>) <span class="sc">+</span> </span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>fig29</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-8.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3gofplot.pdf"</span>, <span class="at">plot =</span> fig29, </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">21</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.10 -------------------------------------#</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive Aalen models - available with timereg</span></span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(timereg)</span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>nonparmod <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3)</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a>cumhazdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">eventtimes =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">1</span>],</span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">basecumhaz =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">2</span>], </span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>], </span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat_ll =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>]<span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(nonparmod<span class="sc">$</span>var.cum[,<span class="dv">3</span>]),</span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat_ul =</span> nonparmod<span class="sc">$</span>cum[,<span class="dv">3</span>]<span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(nonparmod<span class="sc">$</span>var.cum[,<span class="dv">3</span>])</span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a>cumhazdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   eventtimes  basecumhaz   cumhaztreat cumhaztreat_ll cumhaztreat_ul
1      0.0000 0.000000000  0.000000e+00     0.00000000    0.000000000
2     24.0000 0.005780347 -5.780347e-03    -0.01710983    0.005549133
3     35.0000 0.005780347  3.360667e-05    -0.01603534    0.016102555
4     98.0000 0.011628300 -5.814347e-03    -0.02555234    0.013923644
5    107.0000 0.011628300  6.800639e-05    -0.02279059    0.022926606
6    114.0000 0.017510653 -5.814347e-03    -0.03141597    0.019787273
7    117.0000 0.023427813 -1.173151e-02    -0.03983752    0.016374508
8    133.0000 0.029415837 -1.771953e-02    -0.04817760    0.012738541
9    146.0000 0.029415837 -1.176715e-02    -0.04438318    0.020848877
10   156.0000 0.029415837 -5.779125e-03    -0.04044252    0.028884274
11   169.0000 0.035476443 -1.183973e-02    -0.04848201    0.024802551
12   193.0000 0.041574004 -1.793729e-02    -0.05647933    0.020604743
13   195.0000 0.041574004 -1.187669e-02    -0.05220774    0.028454370
14   199.0000 0.047746843 -1.804953e-02    -0.06015623    0.024057175
15   213.0000 0.053996843 -2.429953e-02    -0.06815197    0.019552917
16   221.0000 0.053996843 -1.820196e-02    -0.06365379    0.027249860
17   235.0000 0.053996843 -1.206700e-02    -0.05908250    0.034948512
18   249.0000 0.060286151 -1.835630e-02    -0.06696097    0.030248366
19   254.0000 0.066615265 -2.468542e-02    -0.07484815    0.025477313
20   261.0000 0.072984692 -3.105484e-02    -0.08274770    0.020638015
21   264.0000 0.072984692 -2.476554e-02    -0.07790787    0.028376799
22   280.0000 0.072984692 -1.843642e-02    -0.07300742    0.036134571
23   286.0000 0.072984692 -1.206700e-02    -0.06804776    0.043913765
24   339.0000 0.079520640 -1.860294e-02    -0.07603075    0.038824866
25   347.0000 0.079520640 -1.210944e-02    -0.07093066    0.046711791
26   351.0000 0.086099587 -1.868838e-02    -0.07890641    0.041529645
27   362.0000 0.086099587 -1.206587e-02    -0.07366696    0.049535227
28   366.0000 0.092948902 -1.891518e-02    -0.08196212    0.044131755
29   367.0000 0.092948902 -1.215843e-02    -0.07658125    0.052264395
30   368.0000 0.099845454 -1.905498e-02    -0.08488062    0.046770668
31   371.0000 0.106789898 -2.599942e-02    -0.09321756    0.041218715
32   378.0000 0.106789898 -1.919670e-02    -0.08772447    0.049331072
33   379.0000 0.113782905 -2.618971e-02    -0.09607474    0.043695328
34   396.0000 0.120977150 -3.338395e-02    -0.10467735    0.037909445
35   413.0000 0.128223527 -4.063033e-02    -0.11332470    0.032064037
36   425.0000 0.135522797 -4.792960e-02    -0.12201839    0.026159190
37   429.0000 0.142875738 -5.528254e-02    -0.13076001    0.020194924
38   430.0000 0.150283145 -6.268995e-02    -0.13955109    0.014171194
39   461.0000 0.150283145 -5.554709e-02    -0.13367286    0.022578674
40   472.0000 0.150283145 -4.830071e-02    -0.12770699    0.031105567
41   487.0000 0.157916733 -5.593430e-02    -0.13673785    0.024869249
42   489.0000 0.165609041 -6.362661e-02    -0.14582471    0.018571489
43   562.0000 0.165609041 -5.616392e-02    -0.13965328    0.027325434
44   592.0000 0.173805762 -6.436064e-02    -0.14938167    0.020660384
45   612.0000 0.173805762 -5.654814e-02    -0.14293708    0.029840790
46   625.0000 0.173805762 -4.867413e-02    -0.13643077    0.039082510
47   639.0000 0.173805762 -4.067413e-02    -0.12982058    0.048472324
48   639.1446 0.173805762 -3.260961e-02    -0.12314653    0.057927308
49   669.0000 0.173805762 -2.420625e-02    -0.11622915    0.067816650
50   679.0000 0.173805762 -1.565924e-02    -0.10919452    0.077876036
51   691.0000 0.173805762 -6.887313e-03    -0.10198961    0.088214985
52   714.0000 0.183065022 -1.614657e-02    -0.11296497    0.080671826
53   743.0000 0.183065022 -7.137563e-03    -0.10555298    0.091277858
54   766.0000 0.183065022  2.477822e-03    -0.09772583    0.102681477
55   786.0000 0.192868943 -7.326100e-03    -0.10935558    0.094703382
56   791.0000 0.202868943 -1.732610e-02    -0.12122112    0.086568920
57   821.0000 0.213621631 -2.807879e-02    -0.13408984    0.077932259
58   865.0000 0.224491196 -3.894835e-02    -0.14707891    0.069182204
59   916.0000 0.224491196 -2.795934e-02    -0.13821415    0.082295466
60   928.0000 0.235985449 -3.945360e-02    -0.15198655    0.073079363
61   931.0000 0.235985449 -2.808996e-02    -0.14280587    0.086625956
62   945.0000 0.247750155 -3.985466e-02    -0.15686514    0.077155807
63   962.0000 0.247750155 -2.780647e-02    -0.14717604    0.091563093
64   978.0000 0.247750155 -1.530647e-02    -0.13716435    0.106551409
65   985.0000 0.260250155 -2.780647e-02    -0.15210286    0.096489920
66   995.0000 0.272908383 -4.046470e-02    -0.16721301    0.086283615
67  1043.0000 0.272908383 -2.747769e-02    -0.15675672    0.101801350
68  1046.0000 0.286066278 -4.063558e-02    -0.17246185    0.091190691
69  1066.0000 0.286066278 -2.712207e-02    -0.16158284    0.107338708
70  1105.0000 0.299764908 -4.082070e-02    -0.17793593    0.096294531
71  1127.0000 0.314257662 -5.531345e-02    -0.19534015    0.084713243
72  1134.0000 0.314257662 -4.082070e-02    -0.18369954    0.102058148
73  1166.0000 0.314257662 -2.519570e-02    -0.17131981    0.120928411
74  1168.0000 0.314257662 -9.322682e-03    -0.15872200    0.140076636
75  1169.0000 0.314257662  6.806350e-03    -0.14590099    0.159513691
76  1171.0000 0.314257662  2.319979e-02    -0.13285130    0.179250883
77  1198.0000 0.330651104  6.806350e-03    -0.15251833    0.166131029
78  1238.0000 0.330651104  2.435021e-02    -0.13864288    0.187343301
79  1249.0000 0.330651104  4.253203e-02    -0.12431131    0.209375363
80  1265.0000 0.350651104  2.253203e-02    -0.14885449    0.193918545
81  1290.0000 0.350651104  4.427116e-02    -0.13233246    0.220874780
82  1324.0000 0.375651104  1.927116e-02    -0.16400415    0.202546468
83  1325.0000 0.401292130 -6.369867e-03    -0.19641077    0.183671039
84  1325.0584 0.427607919 -3.268566e-02    -0.22960171    0.164230401
85  1391.0000 0.427607919 -5.658630e-03    -0.20957545    0.198258191
86  1423.0000 0.457910950 -3.596166e-02    -0.24835213    0.176428805
87  1433.0000 0.457910950 -6.549895e-03    -0.22662464    0.213524849
88  1547.0000 0.457910950  3.511677e-02    -0.19962210    0.269855642
89  1647.0000 0.507910950 -1.488323e-02    -0.26925763    0.239491176
90  1703.0000 0.507910950  5.654534e-02    -0.23381019    0.346900879
91  1859.0000 0.650768092 -8.631180e-02    -0.48968054    0.317056936</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend lines to last observed time</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>cumhazdata[<span class="fu">nrow</span>(cumhazdata)<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">max</span>(pbc3<span class="sc">$</span>days), <span class="fu">tail</span>(cumhazdata, <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure LHS</span></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>cumhazplot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> basecumhaz), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative baseline hazard"</span>) <span class="sc">+</span> </span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-17"><a href="#cb203-17" aria-hidden="true" tabindex="-1"></a>cumhazplot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-9.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure RHS</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>cumhazplot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat_ll), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span>  </span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat_ul), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative treatment effect"</span>) <span class="sc">+</span> </span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a>cumhazplot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-10.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(gridExtra)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>fig210 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(cumhazplot1, cumhazplot2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-11.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>fig210</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TableGrob (1 x 2) "arrange": 2 grobs
  z     cells    name           grob
1 1 (1-1,1-1) arrange gtable[layout]
2 2 (1-1,2-2) arrange gtable[layout]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3aalen1.pdf"</span>, <span class="at">plot =</span> fig210, </span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Figure 2.11 -------------------------------------#</span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Aalen model fit</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>nonparmod2 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.62               0.005
tment                                2.66               0.113
alb                                  3.82               0.001
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.30300                       0.919
tment                             0.12100                       0.713
alb                               0.00666                       0.963
bili                              0.00300                       0.195
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      14.20000                       0.988
tment                             3.29000                       0.817
alb                               0.00826                       0.988
bili                              0.00203                       0.336

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>cumhazdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">eventtimes =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">1</span>],</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">basecumhaz =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">2</span>], </span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhaztreat =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">3</span>], </span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhazalb =</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">4</span>], </span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cumhazbili=</span> nonparmod2<span class="sc">$</span>cum[,<span class="dv">5</span>]</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>cumhazdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   eventtimes basecumhaz  cumhaztreat     cumhazalb   cumhazbili
1      0.0000 0.00000000  0.000000000  0.0000000000 0.000000e+00
2     24.0000 0.01394856 -0.006536732 -0.0002312332 2.575134e-05
3     35.0000 0.05505071 -0.003100732 -0.0013425129 8.683128e-05
4     98.0000 0.06313545 -0.009151576 -0.0013874940 7.981313e-05
5    107.0000 0.08137463 -0.004399829 -0.0018992146 1.242734e-04
6    117.0000 0.11673266 -0.012216073 -0.0027148804 1.897775e-04
7    133.0000 0.13592196 -0.018931704 -0.0030478453 1.910280e-04
8    146.0000 0.15737571 -0.014404836 -0.0036495267 2.456382e-04
9    156.0000 0.15068362 -0.009035299 -0.0035946125 3.559986e-04
10   169.0000 0.17518948 -0.015979791 -0.0040533669 3.503438e-04
11   193.0000 0.17051313 -0.023117904 -0.0039640705 5.303750e-04
12   195.0000 0.19035814 -0.018560390 -0.0045410175 6.038375e-04
13   199.0000 0.21444700 -0.025421238 -0.0049642809 5.767757e-04
14   213.0000 0.20586013 -0.031654919 -0.0046450674 6.367504e-04
15   221.0000 0.23347482 -0.026498602 -0.0053163474 6.087024e-04
16   235.0000 0.25120325 -0.021679924 -0.0058322742 6.760557e-04
17   249.0000 0.30445715 -0.029864050 -0.0069953862 6.540405e-04
18   254.0000 0.27819742 -0.036549109 -0.0063789377 8.667842e-04
19   261.0000 0.32464930 -0.044805140 -0.0073905938 8.695868e-04
20   264.0000 0.31911654 -0.038283205 -0.0072558982 8.748555e-04
21   280.0000 0.29445634 -0.033543989 -0.0069037140 1.162220e-03
22   286.0000 0.28199753 -0.027882467 -0.0067592094 1.343011e-03
23   339.0000 0.31916304 -0.035826493 -0.0075141713 1.328938e-03
24   347.0000 0.30684384 -0.030821463 -0.0075259875 1.671314e-03
25   351.0000 0.33480179 -0.038349568 -0.0080210016 1.629667e-03
26   362.0000 0.34369203 -0.032089062 -0.0082417308 1.626681e-03
27   366.0000 0.34773280 -0.040167535 -0.0084568922 1.932495e-03
28   367.0000 0.39589557 -0.035992756 -0.0097142953 1.985947e-03
29   368.0000 0.40776564 -0.043482197 -0.0098639556 2.019059e-03
30   371.0000 0.33482667 -0.049784256 -0.0083101921 2.531948e-03
31   378.0000 0.34985392 -0.043285733 -0.0086557176 2.492621e-03
32   379.0000 0.36429108 -0.050885783 -0.0088453362 2.501961e-03
33   396.0000 0.35926868 -0.057866175 -0.0085465404 2.518705e-03
34   413.0000 0.36761269 -0.066228105 -0.0086544047 2.622622e-03
35   425.0000 0.42283298 -0.076646031 -0.0099133607 2.695856e-03
36   429.0000 0.44909623 -0.085151706 -0.0103828183 2.696553e-03
37   430.0000 0.48413820 -0.095493519 -0.0111819801 2.837722e-03
38   461.0000 0.53533962 -0.092690779 -0.0125892097 3.000203e-03
39   472.0000 0.56737001 -0.087319612 -0.0134164878 3.033231e-03
40   487.0000 0.53866641 -0.097182730 -0.0128214316 3.444202e-03
41   489.0000 0.53351934 -0.107689662 -0.0127052807 3.733721e-03
42   562.0000 0.58610439 -0.101482575 -0.0139826798 3.666665e-03
43   592.0000 0.58251710 -0.113880257 -0.0139272990 4.017576e-03
44   612.0000 0.62319515 -0.107111037 -0.0149201008 3.972993e-03
45   625.0000 0.64342124 -0.101755836 -0.0155075715 4.093118e-03
46   639.0000 0.63768797 -0.092664358 -0.0153248930 4.035067e-03
47   639.4567 0.65118267 -0.086979550 -0.0157542874 4.170827e-03
48   669.0000 0.65736651 -0.079157726 -0.0159255387 4.196680e-03
49   679.0000 0.67946177 -0.071373308 -0.0164825299 4.199068e-03
50   691.0000 0.75117715 -0.066358538 -0.0183532863 4.306614e-03
51   714.0000 0.73883144 -0.076210756 -0.0178327842 4.359437e-03
52   743.0000 0.74097543 -0.078116312 -0.0183029153 5.035831e-03
53   766.0000 0.80849863 -0.070080180 -0.0199997693 5.032725e-03
54   786.0000 0.81604632 -0.080317612 -0.0199372448 5.039767e-03
55   791.0000 0.83140680 -0.097192484 -0.0203516039 5.510749e-03
56   821.0000 0.81126754 -0.106712019 -0.0195421464 5.461508e-03
57   865.0000 0.82833258 -0.118498611 -0.0197087330 5.497339e-03
58   916.0000 0.85313518 -0.106514302 -0.0202471664 5.354417e-03
59   928.0000 0.91727524 -0.119789600 -0.0215708150 5.374453e-03
60   931.0000 0.74542033 -0.105260476 -0.0172998663 5.437190e-03
61   945.0000 0.86520466 -0.119396326 -0.0199562753 5.367788e-03
62   962.0000 0.89584063 -0.107483475 -0.0206925611 5.317068e-03
63   978.0000 0.93519258 -0.096095065 -0.0216971115 5.349221e-03
64   985.0000 0.99853344 -0.108765416 -0.0229077903 5.248875e-03
65   995.0000 1.03401121 -0.121959180 -0.0234665990 5.235302e-03
66  1043.0000 1.08883557 -0.113395990 -0.0250020013 5.513700e-03
67  1046.0000 1.15524266 -0.128520304 -0.0263560860 5.561507e-03
68  1066.0000 1.12865955 -0.116321503 -0.0258105743 5.760109e-03
69  1105.0000 1.19514484 -0.130058834 -0.0270568853 5.638252e-03
70  1127.0000 1.19486602 -0.146169108 -0.0267768164 5.795780e-03
71  1134.0000 1.14990633 -0.137553360 -0.0260202214 6.415745e-03
72  1166.0000 1.15592311 -0.126984246 -0.0264454044 6.880237e-03
73  1168.0000 1.19637644 -0.112710233 -0.0275101283 6.974088e-03
74  1169.0000 1.17582347 -0.094993323 -0.0269427028 6.881702e-03
75  1171.0000 1.09677175 -0.085982218 -0.0255422063 7.846707e-03
76  1198.0000 1.04530794 -0.105101425 -0.0241851646 8.413561e-03
77  1238.0000 1.22942219 -0.094443867 -0.0291546713 9.014195e-03
78  1249.0000 1.22898854 -0.076702236 -0.0292297612 9.159891e-03
79  1265.0000 1.46822406 -0.097938251 -0.0346505444 9.035487e-03
80  1290.0000 1.49332680 -0.073382184 -0.0351487048 8.787001e-03
81  1324.0000 1.49117976 -0.121225972 -0.0354543606 1.066349e-02
82  1325.0000 1.43574645 -0.152542745 -0.0336213105 1.109927e-02
83  1325.4402 1.34613247 -0.183348544 -0.0308925452 1.148428e-02
84  1391.0000 1.39460106 -0.150791553 -0.0320020495 1.122368e-02
85  1423.0000 1.20182334 -0.183531461 -0.0265037833 1.136448e-02
86  1433.0000 1.57913646 -0.162852451 -0.0362662229 1.204427e-02
87  1647.0000 1.59429369 -0.217581833 -0.0354699184 1.225969e-02
88  1703.0000 1.87059343 -0.133270967 -0.0422965549 1.180620e-02
89  1859.0000 1.96610225 -0.277665109 -0.0411412321 1.189387e-02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend lines to last observed time</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>cumhazdata[<span class="fu">nrow</span>(cumhazdata)<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">max</span>(pbc3<span class="sc">$</span>days), <span class="fu">tail</span>(cumhazdata, <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure treat</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>cumhazplot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaztreat), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative treatment effect"</span>) <span class="sc">+</span> </span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a>cumhazplot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-12.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure albumin</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>cumhazplot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhazalb), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative albumin effect"</span>) <span class="sc">+</span> </span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)), </span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>cumhazplot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-13.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure bilirubin</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>cumhazplot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eventtimes <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhazbili), <span class="at">data =</span> cumhazdata) <span class="sc">+</span> </span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative bilirubin effect"</span>) <span class="sc">+</span> </span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>)),</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>cumhazplot3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-14.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(gridExtra)</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>fig211 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(cumhazplot1, cumhazplot2, cumhazplot3, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch2_files/figure-html/chapter2_pbc3-15.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>fig211</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TableGrob (3 x 1) "arrange": 3 grobs
  z     cells    name           grob
1 1 (1-1,1-1) arrange gtable[layout]
2 2 (2-2,1-1) arrange gtable[layout]
3 3 (3-3,1-1) arrange gtable[layout]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figures/j_pbc3aalen3.pdf"</span>, <span class="at">plot =</span> fig211, </span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">29.7</span>, <span class="at">height =</span> <span class="dv">35</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.10 --------------------------------------#</span></span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Only treatment -- #</span></span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a><span class="co"># In text p-values prior to Table 2.10</span></span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a>nonparmod0 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment, <span class="at">data =</span> pbc3) </span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          5.96               0.000
tment                                1.60               0.726

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.107                       0.529
tment                               0.136                       0.586
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          7.62                       0.412
tment                                4.54                       0.691

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment, data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hypothesis of a time-constant hazard difference for treatment</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant effect of treatment</span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>nonparmod01 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment), <span class="at">data =</span> pbc3) </span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          6.62                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                        0.0914                       0.398
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          4.97                        0.27

Parametric terms :     
                 Coef.       SE Robust SE     z P-val lower2.5% upper97.5%
const(tment) -1.61e-05 5.75e-05  5.74e-05 -0.28 0.779 -0.000129   9.66e-05
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Treatment, albumin, bilirubin -- #</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10, first two columns</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>nonparmod1 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.62               0.005
tment                                2.66               0.147
alb                                  3.82               0.002
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.30300                       0.924
tment                             0.12100                       0.709
alb                               0.00666                       0.962
bili                              0.00301                       0.184
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      14.20000                       0.988
tment                             3.29000                       0.804
alb                               0.00826                       0.986
bili                              0.00203                       0.324

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + alb + bili, 
    data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.10, last columns</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>nonparmod2 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(bili), <span class="at">data =</span> pbc3) </span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          4.03               0.001

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.119                       0.194
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                           9.6                       0.125

Parametric terms :     
                 Coef.       SE Robust SE     z    P-val lower2.5% upper97.5%
const(tment) -1.13e-04 5.90e-05  5.51e-05 -2.05 4.01e-02 -2.29e-04   2.64e-06
const(alb)   -2.30e-05 6.28e-06  6.11e-06 -3.77 1.63e-04 -3.53e-05  -1.07e-05
const(bili)   6.30e-06 1.32e-06  1.05e-06  5.98 2.17e-09  3.71e-06   8.89e-06
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + 
    const(bili), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>nonparmod3 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> alb <span class="sc">+</span> bili, <span class="at">data =</span> pbc3) </span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.60               0.005
alb                                  3.80               0.002
bili                                 4.83               0.000

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                       0.28500                       0.945
alb                               0.00954                       0.811
bili                              0.00315                       0.156
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                      11.50000                       0.989
alb                               0.01920                       0.903
bili                              0.00238                       0.276

Parametric terms :     
                Coef.       SE Robust SE     z P-val lower2.5% upper97.5%
const(tment) -0.00011 5.92e-05  5.58e-05 -1.97 0.049 -0.000226   6.03e-06
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + alb + 
    bili, data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Quadratic effects -- #</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>nonparmod41 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((bili<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod41)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
                Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                              3.94               0.001
tment                                    2.59               0.135
I(alb/10)                                4.04               0.001
I(bili/100)                              3.82               0.000
I((bili/100)^2)                          3.02               0.042

Test for time invariant effects 
                      Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                            0.3080                       0.935
tment                                  0.1230                       0.685
I(alb/10)                              0.0912                       0.834
I(bili/100)                            0.6370                       0.424
I((bili/100)^2)                        0.5160                       0.156
                        Cramer von Mises test p-value H_0:constant effect
(Intercept)                             24.00                       0.941
tment                                    3.94                       0.756
I(alb/10)                                2.38                       0.864
I(bili/100)                            188.00                       0.309
I((bili/100)^2)                        101.00                       0.183

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + I(alb/10) + 
    I(bili/100) + I((bili/100)^2), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>nonparmod42 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((alb<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod42)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
              Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                            3.25               0.024
tment                                  2.74               0.097
I(alb/10)                              3.02               0.046
I(bili/100)                            4.86               0.000
I((alb/10)^2)                          2.79               0.086

Test for time invariant effects 
                    Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                           9.260                       0.194
tment                                 0.096                       0.818
I(alb/10)                             4.880                       0.210
I(bili/100)                           0.371                       0.050
I((alb/10)^2)                         0.626                       0.216
                      Cramer von Mises test p-value H_0:constant effect
(Intercept)                        28500.00                       0.310
tment                                  1.78                       0.915
I(alb/10)                           8370.00                       0.309
I(bili/100)                           32.00                       0.160
I((alb/10)^2)                        144.00                       0.305

   
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ tment + I(alb/10) + 
    I(bili/100) + I((alb/10)^2), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>nonparmod43 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((bili<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod43)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
                Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                              3.82               0.000
I(alb/10)                                4.02               0.001
I(bili/100)                              3.85               0.002
I((bili/100)^2)                          3.01               0.047

Test for time invariant effects 
                      Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                             0.440                       0.662
I(alb/10)                               0.117                       0.616
I(bili/100)                             0.612                       0.428
I((bili/100)^2)                         0.515                       0.169
                        Cramer von Mises test p-value H_0:constant effect
(Intercept)                             48.20                       0.757
I(alb/10)                                4.51                       0.601
I(bili/100)                            169.00                       0.327
I((bili/100)^2)                        105.00                       0.169

Parametric terms :     
                 Coef.       SE Robust SE     z  P-val lower2.5% upper97.5%
const(tment) -0.000108 5.83e-05   5.7e-05 -1.89 0.0582 -0.000222   6.27e-06
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + I(alb/10) + 
    I(bili/100) + I((bili/100)^2), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>nonparmod44 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">I</span>(alb<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fu">I</span>((alb<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> pbc3) </span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod44)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
              Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                            3.23               0.017
I(alb/10)                              3.00               0.038
I(bili/100)                            4.88               0.000
I((alb/10)^2)                          2.77               0.082

Test for time invariant effects 
                    Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                           9.420                       0.239
I(alb/10)                             4.950                       0.241
I(bili/100)                           0.366                       0.061
I((alb/10)^2)                         0.635                       0.248
                      Cramer von Mises test p-value H_0:constant effect
(Intercept)                         30500.0                       0.337
I(alb/10)                            8910.0                       0.332
I(bili/100)                            34.6                       0.158
I((alb/10)^2)                         152.0                       0.333

Parametric terms :     
                 Coef.       SE Robust SE     z  P-val lower2.5% upper97.5%
const(tment) -0.000115 5.89e-05  5.51e-05 -2.09 0.0366  -0.00023   4.42e-07
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + I(alb/10) + 
    I(bili/100) + I((alb/10)^2), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Interactions -- #</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>nonparmod51 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(bili) <span class="sc">+</span> <span class="fu">const</span>(tment <span class="sc">*</span> bili), <span class="at">data =</span> pbc3) </span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod51)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          4.03                   0

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                         0.123                       0.165
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          10.5                       0.099

Parametric terms :     
                        Coef.       SE Robust SE       z    P-val lower2.5%
const(tment)        -5.30e-06 8.06e-05  6.23e-05 -0.0851 9.32e-01 -1.63e-04
const(alb)          -2.35e-05 6.20e-06  6.04e-06 -3.9000 9.69e-05 -3.57e-05
const(bili)          8.18e-06 2.38e-06  1.20e-06  6.8400 7.77e-12  3.52e-06
const(tment * bili) -3.16e-06 2.79e-06  1.80e-06 -1.7600 7.92e-02 -8.63e-06
                    upper97.5%
const(tment)          1.53e-04
const(alb)           -1.13e-05
const(bili)           1.28e-05
const(tment * bili)   2.31e-06
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + 
    const(bili) + const(tment * bili), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>nonparmod52 <span class="ot">&lt;-</span> <span class="fu">aalen</span>(<span class="fu">Surv</span>(days, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">const</span>(tment) <span class="sc">+</span> <span class="fu">const</span>(alb) <span class="sc">+</span> <span class="fu">const</span>(bili) <span class="sc">+</span> <span class="fu">const</span>(tment <span class="sc">*</span> alb), <span class="at">data =</span> pbc3) </span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nonparmod52)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Additive Aalen Model 

Test for nonparametric terms 

Test for non-significant effects 
            Supremum-test of significance p-value H_0: B(t)=0
(Intercept)                          3.06               0.007

Test for time invariant effects 
                  Kolmogorov-Smirnov test p-value H_0:constant effect
(Intercept)                          0.12                       0.186
                    Cramer von Mises test p-value H_0:constant effect
(Intercept)                          9.68                       0.111

Parametric terms :     
                       Coef.       SE Robust SE       z    P-val lower2.5%
const(tment)        2.77e-05 5.45e-04  4.81e-04  0.0576 9.54e-01 -1.04e-03
const(alb)         -2.11e-05 8.63e-06  7.61e-06 -2.7700 5.54e-03 -3.80e-05
const(bili)         6.29e-06 1.32e-06  1.05e-06  5.9600 2.45e-09  3.70e-06
const(tment * alb) -3.60e-06 1.31e-05  1.18e-05 -0.3060 7.59e-01 -2.93e-05
                   upper97.5%
const(tment)         1.10e-03
const(alb)          -4.19e-06
const(bili)          8.88e-06
const(tment * alb)   2.21e-05
   
  Call: 
aalen(formula = Surv(days, status != 0) ~ const(tment) + const(alb) + 
    const(bili) + const(tment * alb), data = pbc3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------- Table 2.11 --------------------------------------#</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="co"># -- In-text -- #</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive hazards model with piecewise constant baseline hazards</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with only treatment as covariate</span></span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pbc3mult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id unit status tment sex age  bili   alb stage tment_char albnorm alb10
1  1    5      1     1   0  58 52.04 36.00     4        CyA    1.00 3.600
2  1    5      1     1   0  58 52.04 36.00     4        CyA    1.00 3.600
3  2    4      0     1   1  54 14.82 38.00     2        CyA    3.00 3.800
4  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271
5  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271
6  3    3      0     0   1  54  7.00 42.71     2    Placebo    7.71 4.271
      alb2 bilihigh bilitoohigh bilimuchtoohigh bili100      bili2 log2bili
1 12.96000    34.94       17.84            0.74  0.5204 0.27081616 5.701549
2 12.96000    34.94       17.84            0.74  0.5204 0.27081616 5.701549
3 14.44000     0.00        0.00            0.00  0.1482 0.02196324 3.889474
4 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355
5 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355
6 18.24144     0.00        0.00            0.00  0.0700 0.00490000 2.807355
  logbilihigh logbilitoohigh logbilimuchtoohigh log2bili2 tstart   days fail
1    1.605625      0.6056246         0.02066214 32.507662    0.0  730.5    0
2    1.605625      0.6056246         0.02066214 32.507662  730.5 1168.0    1
3    0.000000      0.0000000         0.00000000 15.128004    0.0  405.0    0
4    0.000000      0.0000000         0.00000000  7.881242    0.0  730.5    0
5    0.000000      0.0000000         0.00000000  7.881242  730.5 1461.0    0
6    0.000000      0.0000000         0.00000000  7.881242 1461.0 1735.0    0
  timegroup risktime
1         1    730.5
2         2    437.5
3         1    405.0
4         1    730.5
5         2    730.5
6         3    274.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update data set</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>pbc3add <span class="ot">&lt;-</span> pbc3mult</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span>risktime)</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time2 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">*</span>risktime)</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>time3 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (timegroup <span class="sc">==</span> <span class="dv">3</span>)<span class="sc">*</span>risktime)</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>tment0 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (tment <span class="sc">==</span> <span class="dv">0</span>)<span class="sc">*</span>risktime)</span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>tment1 <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (tment <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span>risktime)</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>albny <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (alb<span class="dv">-35</span>)<span class="sc">/</span><span class="dv">100</span><span class="sc">*</span>risktime)</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>pbc3add<span class="sc">$</span>biliny <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3add, (bili<span class="dv">-50</span>)<span class="sc">/</span><span class="dv">1000</span><span class="sc">*</span>risktime)</span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text</span></span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>piece_aalen1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">0</span>),</span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(piece_aalen1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ time1 + time2 + time3 + tment1 - 1, family = poisson(link = "identity"), 
    data = pbc3add, start = c(0.1, 0.1, 0.1, 0))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.7259  -0.6037  -0.5791  -0.3327   2.9876  

Coefficients:
         Estimate Std. Error z value Pr(&gt;|z|)    
time1   2.494e-04  4.498e-05   5.546 2.93e-08 ***
time2   3.607e-04  6.610e-05   5.456 4.87e-08 ***
time3   2.566e-04  1.264e-04   2.031   0.0423 *  
tment1 -1.988e-05  5.683e-05  -0.350   0.7265    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance:    Inf  on 623  degrees of freedom
Residual deviance: 459.54  on 619  degrees of freedom
AIC: 647.54

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.11 - questionable fit</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>piece_aalen2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(fail <span class="sc">~</span> time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3 <span class="sc">+</span> tment1 <span class="sc">+</span> albny <span class="sc">+</span> biliny <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> pbc3add, <span class="at">start =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.35</span>, <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="sc">-</span><span class="fl">0.8</span>, <span class="dv">2</span>),</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: step size truncated: out of bounds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds

Warning: step size truncated: out of bounds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm stopped at boundary value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(piece_aalen2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ time1 + time2 + time3 + tment1 + albny + 
    biliny - 1, family = poisson(link = "identity"), data = pbc3add, 
    start = c(0.3, 0.35, 0.4, -0.05, -0.8, 2))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.2780  -0.8521  -0.6455  -0.4069   2.2893  

Coefficients:
         Estimate Std. Error z value Pr(&gt;|z|)    
time1   7.925e-04  7.346e-05  10.788  &lt; 2e-16 ***
time2   1.029e-03  8.866e-05  11.608  &lt; 2e-16 ***
time3   9.910e-04  1.890e-04   5.244 1.57e-07 ***
tment1 -1.023e-04  6.006e-05  -1.704   0.0883 .  
albny  -1.902e-03  4.274e-04  -4.451 8.56e-06 ***
biliny  9.328e-03  1.360e-03   6.860 6.89e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance:    Inf  on 611  degrees of freedom
Residual deviance: 432.31  on 605  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 620.31

Number of Fisher Scoring iterations: 25</code></pre>
</div>
</div>
</section>
<section id="exercises" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="exercises"><span class="header-section-number">2.1</span> Exercises</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction with data sets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch3.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</div>   
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>