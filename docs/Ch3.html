<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models for Multi-State Survival Data - 3&nbsp; Intensity models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch4.html" rel="next">
<link href="./Ch2.html" rel="prev">
<link href="./corvos.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./MSBfrontbirds.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/multi-state-book/companion" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./errata.html" class="sidebar-item-text sidebar-link">Errata</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pbc3-trial-in-liver-cirrhosis" id="toc-pbc3-trial-in-liver-cirrhosis" class="nav-link active" data-scroll-target="#pbc3-trial-in-liver-cirrhosis">PBC3 trial in liver cirrhosis</a>
  <ul>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">Read data</a></li>
  <li><a href="#table-3.11" id="toc-table-3.11" class="nav-link" data-scroll-target="#table-3.11">Table 3.11</a></li>
  </ul></li>
  <li><a href="#guinea-bissau-childhood-vaccination-study" id="toc-guinea-bissau-childhood-vaccination-study" class="nav-link" data-scroll-target="#guinea-bissau-childhood-vaccination-study">Guinea-Bissau childhood vaccination study</a>
  <ul>
  <li><a href="#read-data-1" id="toc-read-data-1" class="nav-link" data-scroll-target="#read-data-1">Read data</a></li>
  <li><a href="#table-3.1" id="toc-table-3.1" class="nav-link" data-scroll-target="#table-3.1">Table 3.1</a></li>
  <li><a href="#table-3.2" id="toc-table-3.2" class="nav-link" data-scroll-target="#table-3.2">Table 3.2</a></li>
  </ul></li>
  <li><a href="#testis-cancer-incidence-and-maternal-parity" id="toc-testis-cancer-incidence-and-maternal-parity" class="nav-link" data-scroll-target="#testis-cancer-incidence-and-maternal-parity">Testis cancer incidence and maternal parity</a>
  <ul>
  <li><a href="#read-data-2" id="toc-read-data-2" class="nav-link" data-scroll-target="#read-data-2">Read data</a></li>
  <li><a href="#figure-3.1" id="toc-figure-3.1" class="nav-link" data-scroll-target="#figure-3.1">Figure 3.1</a></li>
  <li><a href="#table-3.5" id="toc-table-3.5" class="nav-link" data-scroll-target="#table-3.5">Table 3.5</a></li>
  <li><a href="#in-text-p.-86-cox-models-for-seminomas-and-non-seminomas" id="toc-in-text-p.-86-cox-models-for-seminomas-and-non-seminomas" class="nav-link" data-scroll-target="#in-text-p.-86-cox-models-for-seminomas-and-non-seminomas">In-text, p.&nbsp;86: Cox models for seminomas and non-seminomas</a></li>
  </ul></li>
  <li><a href="#prova-trial-in-liver-cirrhosis" id="toc-prova-trial-in-liver-cirrhosis" class="nav-link" data-scroll-target="#prova-trial-in-liver-cirrhosis">PROVA trial in liver cirrhosis</a>
  <ul>
  <li><a href="#read-data-3" id="toc-read-data-3" class="nav-link" data-scroll-target="#read-data-3">Read data</a></li>
  <li><a href="#table-3.3" id="toc-table-3.3" class="nav-link" data-scroll-target="#table-3.3">Table 3.3</a></li>
  <li><a href="#table-3.4" id="toc-table-3.4" class="nav-link" data-scroll-target="#table-3.4">Table 3.4</a></li>
  <li><a href="#table-3.8" id="toc-table-3.8" class="nav-link" data-scroll-target="#table-3.8">Table 3.8</a></li>
  <li><a href="#figure-3.2" id="toc-figure-3.2" class="nav-link" data-scroll-target="#figure-3.2">Figure 3.2</a></li>
  <li><a href="#figure-3.3" id="toc-figure-3.3" class="nav-link" data-scroll-target="#figure-3.3">Figure 3.3</a></li>
  <li><a href="#table-3.9" id="toc-table-3.9" class="nav-link" data-scroll-target="#table-3.9">Table 3.9</a></li>
  <li><a href="#table-3.10" id="toc-table-3.10" class="nav-link" data-scroll-target="#table-3.10">Table 3.10</a></li>
  <li><a href="#table-3.13" id="toc-table-3.13" class="nav-link" data-scroll-target="#table-3.13">Table 3.13</a></li>
  <li><a href="#figure-3.9" id="toc-figure-3.9" class="nav-link" data-scroll-target="#figure-3.9">Figure 3.9</a></li>
  </ul></li>
  <li><a href="#recurrent-episodes-in-affective-disorders" id="toc-recurrent-episodes-in-affective-disorders" class="nav-link" data-scroll-target="#recurrent-episodes-in-affective-disorders">Recurrent episodes in affective disorders</a>
  <ul>
  <li><a href="#read-data-4" id="toc-read-data-4" class="nav-link" data-scroll-target="#read-data-4">Read data</a></li>
  <li><a href="#table-3.6" id="toc-table-3.6" class="nav-link" data-scroll-target="#table-3.6">Table 3.6</a></li>
  <li><a href="#table-3.7" id="toc-table-3.7" class="nav-link" data-scroll-target="#table-3.7">Table 3.7</a></li>
  </ul></li>
  <li><a href="#leader-cardiovascular-trial-in-type-2-diabetes" id="toc-leader-cardiovascular-trial-in-type-2-diabetes" class="nav-link" data-scroll-target="#leader-cardiovascular-trial-in-type-2-diabetes">LEADER cardiovascular trial in type 2 diabetes</a>
  <ul>
  <li><a href="#table-3.16" id="toc-table-3.16" class="nav-link" data-scroll-target="#table-3.16">Table 3.16</a></li>
  <li><a href="#table-3.17" id="toc-table-3.17" class="nav-link" data-scroll-target="#table-3.17">Table 3.17</a></li>
  </ul></li>
  <li><a href="#bone-marrow-transplantation-in-acute-leukemia" id="toc-bone-marrow-transplantation-in-acute-leukemia" class="nav-link" data-scroll-target="#bone-marrow-transplantation-in-acute-leukemia">Bone marrow transplantation in acute leukemia</a>
  <ul>
  <li><a href="#read-data-5" id="toc-read-data-5" class="nav-link" data-scroll-target="#read-data-5">Read data</a></li>
  <li><a href="#figure-3.5" id="toc-figure-3.5" class="nav-link" data-scroll-target="#figure-3.5">Figure 3.5</a></li>
  <li><a href="#figure-3.6" id="toc-figure-3.6" class="nav-link" data-scroll-target="#figure-3.6">Figure 3.6</a></li>
  <li><a href="#figure-3.7" id="toc-figure-3.7" class="nav-link" data-scroll-target="#figure-3.7">Figure 3.7</a></li>
  <li><a href="#in-text-p.-102-gvhd-as-time-dependent-covariate" id="toc-in-text-p.-102-gvhd-as-time-dependent-covariate" class="nav-link" data-scroll-target="#in-text-p.-102-gvhd-as-time-dependent-covariate">In-text, p.&nbsp;102: GvHD as time-dependent covariate</a>
  <ul>
  <li><a href="#relapse" id="toc-relapse" class="nav-link" data-scroll-target="#relapse">Relapse</a></li>
  <li><a href="#death-in-remission" id="toc-death-in-remission" class="nav-link" data-scroll-target="#death-in-remission">Death in remission</a></li>
  </ul></li>
  <li><a href="#figure-3.8" id="toc-figure-3.8" class="nav-link" data-scroll-target="#figure-3.8">Figure 3.8</a></li>
  <li><a href="#figure-3.4" id="toc-figure-3.4" class="nav-link" data-scroll-target="#figure-3.4">Figure 3.4</a></li>
  <li><a href="#table-3.12" id="toc-table-3.12" class="nav-link" data-scroll-target="#table-3.12">Table 3.12</a></li>
  <li><a href="#table-3.14" id="toc-table-3.14" class="nav-link" data-scroll-target="#table-3.14">Table 3.14</a></li>
  <li><a href="#figure-3.10" id="toc-figure-3.10" class="nav-link" data-scroll-target="#figure-3.10">Figure 3.10</a></li>
  <li><a href="#table-3.15" id="toc-table-3.15" class="nav-link" data-scroll-target="#table-3.15">Table 3.15</a></li>
  <li><a href="#in-text-p.-112-stratified-cox-model-by-center" id="toc-in-text-p.-112-stratified-cox-model-by-center" class="nav-link" data-scroll-target="#in-text-p.-112-stratified-cox-model-by-center">In-text, p.&nbsp;112: stratified Cox model by center</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#exercise-3.1" id="toc-exercise-3.1" class="nav-link" data-scroll-target="#exercise-3.1">Exercise 3.1 (*)</a></li>
  <li><a href="#exercise-3.2" id="toc-exercise-3.2" class="nav-link" data-scroll-target="#exercise-3.2">Exercise 3.2 (*)</a></li>
  <li><a href="#exercise-3.3" id="toc-exercise-3.3" class="nav-link" data-scroll-target="#exercise-3.3">Exercise 3.3 (*)</a></li>
  <li><a href="#exercise-3.4" id="toc-exercise-3.4" class="nav-link" data-scroll-target="#exercise-3.4">Exercise 3.4 (*)</a></li>
  <li><a href="#exercise-3.5" id="toc-exercise-3.5" class="nav-link" data-scroll-target="#exercise-3.5">Exercise 3.5 (*)</a></li>
  <li><a href="#exercise-3.6" id="toc-exercise-3.6" class="nav-link" data-scroll-target="#exercise-3.6">Exercise 3.6 (*)</a></li>
  <li><a href="#exercise-3.7" id="toc-exercise-3.7" class="nav-link" data-scroll-target="#exercise-3.7">Exercise 3.7</a></li>
  <li><a href="#exercise-3.8" id="toc-exercise-3.8" class="nav-link" data-scroll-target="#exercise-3.8">Exercise 3.8</a></li>
  <li><a href="#exercise-3.9" id="toc-exercise-3.9" class="nav-link" data-scroll-target="#exercise-3.9">Exercise 3.9</a></li>
  <li><a href="#exercise-3.10" id="toc-exercise-3.10" class="nav-link" data-scroll-target="#exercise-3.10">Exercise 3.10</a>
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">1.</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">2.</a></li>
  </ul></li>
  <li><a href="#exercise-3.11" id="toc-exercise-3.11" class="nav-link" data-scroll-target="#exercise-3.11">Exercise 3.11</a>
  <ul>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">1.</a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3">2.</a></li>
  </ul></li>
  <li><a href="#exercise-3.12" id="toc-exercise-3.12" class="nav-link" data-scroll-target="#exercise-3.12">Exercise 3.12</a>
  <ul>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4">1.</a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5">2.</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/multi-state-book/companion/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Show/hide all code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="pbc3-trial-in-liver-cirrhosis" class="level2">
<h2 class="anchored" data-anchor-id="pbc3-trial-in-liver-cirrhosis">PBC3 trial in liver cirrhosis</h2>
<section id="read-data" class="level3">
<h3 class="anchored" data-anchor-id="read-data">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="Ch3_cache/html/read-pbc3_8c0323444d55f7ef895668e19f89ed5e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pbc3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/pbc3.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>log2bili <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, <span class="fu">log2</span>(bili))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pbc3<span class="sc">$</span>years <span class="ot">&lt;-</span> <span class="fu">with</span>(pbc3, days<span class="sc">/</span><span class="fl">365.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="Ch3_cache/html/read-pbc3-sas_e21869e752322fc63e57e5f564835c57">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=pbc3</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/pbc3.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> pbc3; </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> pbc3;</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    log2bili=<span class="fu">log2</span>(bili);</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.11" class="level3">
<h3 class="anchored" data-anchor-id="table-3.11">Table 3.11</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.11-r_c1a83a2da53c94d824a0807ad30790e1">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(tment), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3, <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) (x<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>t, <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(tment), data = pbc3, tt = function(x, t, ...) (x == 1) * 
    t, method = "breslow")

              coef exp(coef) se(coef)      z        p
tment     -0.65937   0.51718  0.40576 -1.625    0.104
alb       -0.09136   0.91269  0.02167 -4.216 2.49e-05
log2bili   0.66299   1.94059  0.07478  8.866  &lt; 2e-16
tt(tment)  0.04497   1.04600  0.17811  0.253    0.801

Likelihood ratio test=120.1  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(tment), </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3, <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) (x<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">log</span>(t), <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(tment), data = pbc3, tt = function(x, t, ...) (x == 1) * 
    log(t), method = "breslow")

              coef exp(coef) se(coef)      z        p
tment     -0.61330   0.54156  0.24327 -2.521   0.0117
alb       -0.09152   0.91254  0.02163 -4.232 2.32e-05
log2bili   0.66214   1.93894  0.07462  8.873  &lt; 2e-16
tt(tment)  0.10834   1.11442  0.25424  0.426   0.6700

Likelihood ratio test=120.2  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(tment), </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3, <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) (x<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span>(t<span class="sc">&gt;</span><span class="dv">2</span>), <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(tment), data = pbc3, tt = function(x, t, ...) (x == 1) * 
    (t &gt; 2), method = "breslow")

              coef exp(coef) se(coef)      z        p
tment     -0.58773   0.55559  0.29228 -2.011   0.0443
alb       -0.09104   0.91298  0.02168 -4.199 2.68e-05
log2bili   0.66456   1.94363  0.07466  8.901  &lt; 2e-16
tt(tment)  0.03169   1.03220  0.43384  0.073   0.9418

Likelihood ratio test=120  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Albumin </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(alb), </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3, <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) x<span class="sc">*</span>t, <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(alb), data = pbc3, tt = function(x, t, ...) x * t, method = "breslow")

             coef exp(coef) se(coef)      z        p
tment    -0.59080   0.55389  0.22472 -2.629 0.008562
alb      -0.13296   0.87550  0.03998 -3.326 0.000882
log2bili  0.66405   1.94265  0.07476  8.882  &lt; 2e-16
tt(alb)   0.02317   1.02344  0.01854  1.250 0.211400

Likelihood ratio test=121.6  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(alb), </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3, <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) x<span class="sc">*</span><span class="fu">log</span>(t), <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(alb), data = pbc3, tt = function(x, t, ...) x * log(t), 
    method = "breslow")

             coef exp(coef) se(coef)      z        p
tment    -0.58958   0.55456  0.22460 -2.625  0.00867
alb      -0.10194   0.90308  0.02349 -4.341 1.42e-05
log2bili  0.66488   1.94425  0.07483  8.885  &lt; 2e-16
tt(alb)   0.03347   1.03404  0.02561  1.307  0.19120

Likelihood ratio test=121.8  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(alb), </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3,  <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) (x)<span class="sc">*</span>(t<span class="sc">&gt;</span><span class="dv">2</span>), <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(alb), data = pbc3, tt = function(x, t, ...) (x) * (t &gt; 
    2), method = "breslow")

             coef exp(coef) se(coef)      z       p
tment    -0.59037   0.55412  0.22472 -2.627 0.00861
alb      -0.11369   0.89254  0.02779 -4.091 4.3e-05
log2bili  0.66488   1.94426  0.07470  8.901 &lt; 2e-16
tt(alb)   0.05674   1.05838  0.04330  1.310 0.19005

Likelihood ratio test=121.8  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log2 bilirubin</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(log2bili), </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3, <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) x<span class="sc">*</span>t, <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(log2bili), data = pbc3, tt = function(x, t, ...) x * t, 
    method = "breslow")

                 coef exp(coef) se(coef)      z        p
tment        -0.54631   0.57908  0.22571 -2.420   0.0155
alb          -0.09009   0.91385  0.02173 -4.147 3.37e-05
log2bili      0.77736   2.17571  0.13382  5.809 6.28e-09
tt(log2bili) -0.06299   0.93895  0.06181 -1.019   0.3081

Likelihood ratio test=121.1  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(log2bili), </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3, <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) x<span class="sc">*</span><span class="fu">log</span>(t), <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(log2bili), data = pbc3, tt = function(x, t, ...) x * log(t), 
    method = "breslow")

                 coef exp(coef) se(coef)      z        p
tment        -0.55398   0.57466  0.22536 -2.458    0.014
alb          -0.09050   0.91347  0.02170 -4.170 3.04e-05
log2bili      0.68779   1.98931  0.07968  8.632  &lt; 2e-16
tt(log2bili) -0.07701   0.92588  0.08780 -0.877    0.380

Likelihood ratio test=120.8  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(years, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> tment <span class="sc">+</span> alb <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">tt</span>(log2bili), </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pbc3,  <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...) (x)<span class="sc">*</span>(t<span class="sc">&gt;</span><span class="dv">2</span>), <span class="at">method =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(years, status != 0) ~ tment + alb + log2bili + 
    tt(log2bili), data = pbc3, tt = function(x, t, ...) (x) * 
    (t &gt; 2), method = "breslow")

                 coef exp(coef) se(coef)      z        p
tment        -0.54878   0.57765  0.22521 -2.437   0.0148
alb          -0.09045   0.91352  0.02176 -4.157 3.22e-05
log2bili      0.73519   2.08587  0.09487  7.750 9.22e-15
tt(log2bili) -0.18232   0.83334  0.14910 -1.223   0.2214

Likelihood ratio test=121.5  on 4 df, p=&lt; 2.2e-16
n= 343, number of events= 88 
   (6 observations deleted due to missingness)</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.11-sas_543713f3248e3ed8786b6de4cf8646e7">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Treatment;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili tmenttime/rl;</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    tmenttime=(tment=<span class="dv">1</span>)*days;</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili tmentlogtime/rl;</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    tmentlogtime=(tment=<span class="dv">1</span>)*<span class="fu">log</span>(days);</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili tmentt0/rl;</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    tmentt0=(tment=<span class="dv">1</span>)*(days&gt;<span class="dv">2</span>*<span class="dv">365.25</span>);</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">* Log bilirubin;</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili bilitime/rl;</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    bilitime=log2bili*days;</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili bililogtime/rl;</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    bililogtime=log2bili*<span class="fu">log</span>(days);</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili bilit0/rl;</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    bilit0=log2bili*(days&gt;<span class="dv">2</span>*<span class="dv">365.25</span>);</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="co">* Albumin;</span> </span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili albtime/rl;</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    albtime=alb*days;</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili alblogtime/rl;</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    alblogtime=alb*<span class="fu">log</span>(days);</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=pbc3;</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    class tment (ref=<span class="st">'0'</span>);</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> days*status(<span class="dv">0</span>)=tment alb log2bili albt0/rl;</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    albt0=alb*(days&gt;<span class="dv">2</span>*<span class="dv">365.25</span>);</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="guinea-bissau-childhood-vaccination-study" class="level2">
<h2 class="anchored" data-anchor-id="guinea-bissau-childhood-vaccination-study">Guinea-Bissau childhood vaccination study</h2>
<section id="read-data-1" class="level3">
<h3 class="anchored" data-anchor-id="read-data-1">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-hash="Ch3_cache/html/read-bissau_6f49156956512359c3658a82d5bba1da">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>bissau <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/bissau.csv"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables for age as time scale and dtp binary</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>agein  <span class="ot">&lt;-</span> <span class="fu">with</span>(bissau, age<span class="sc">/</span>(<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>ageout <span class="ot">&lt;-</span> <span class="fu">with</span>(bissau, agein<span class="sc">+</span>fuptime<span class="sc">/</span>(<span class="fl">365.24</span><span class="sc">/</span><span class="dv">12</span>))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>bissau<span class="sc">$</span>dtpany <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span><span class="fu">with</span>(bissau, dtp<span class="sc">&gt;</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-hash="Ch3_cache/html/read-bissau-sas_f6962be2c86e8f996cdd9b6c529229a7">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/bissau.csv"</span> out=bissau</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    dbms = csv <span class="kw">replace</span>;</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> bissau; </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> bissau;</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    agein=age/(<span class="dv">365.24</span>/<span class="dv">12</span>);</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    ageout=agein+fuptime/(<span class="dv">365.24</span>/<span class="dv">12</span>);</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    dtpany=(dtp&gt;<span class="dv">0</span>);</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.1" class="level3">
<h3 class="anchored" data-anchor-id="table-3.1">Table 3.1</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.1-r_d3c5122d4146cfb6b34b41c4b7df8897">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bissau<span class="sc">$</span>bcg, bissau<span class="sc">$</span>dtp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
       0    1    2    3
  0 1942   19    9    3
  1 1159 1299  582  261</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="sc">*</span><span class="fu">table</span>(bissau<span class="sc">$</span>bcg, bissau<span class="sc">$</span>dtp) <span class="sc">/</span> <span class="fu">rowSums</span>(<span class="fu">table</span>(bissau<span class="sc">$</span>bcg, bissau<span class="sc">$</span>dtp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
             0          1          2          3
  0 98.4287886  0.9630005  0.4561581  0.1520527
  1 35.1105726 39.3517116 17.6310209  7.9066949</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.1-sas_321bc5d56733b3627c0dd25d61a926b3">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span>=bissau;</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    tables bcg*dtp bcg*dtpany/ nocol nopercent;</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.2" class="level3">
<h3 class="anchored" data-anchor-id="table-3.2">Table 3.2</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.2-r_42f67778a4a61d8b1f8ebd74f81bdab5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(agein,ageout,dead<span class="sc">!=</span><span class="dv">0</span>)<span class="sc">~</span>bcg,<span class="at">data=</span>bissau,<span class="at">method=</span><span class="st">"breslow"</span>,<span class="at">timefix=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(agein, ageout, dead != 0) ~ bcg, data = bissau, 
    method = "breslow", timefix = F)

       coef exp(coef) se(coef)      z      p
bcg -0.3558    0.7006   0.1407 -2.529 0.0114

Likelihood ratio test=6.28  on 1 df, p=0.01218
n= 5274, number of events= 222 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(agein,ageout,dead<span class="sc">!=</span><span class="dv">0</span>)<span class="sc">~</span>dtpany,<span class="at">data=</span>bissau,<span class="at">method=</span><span class="st">"breslow"</span>,<span class="at">timefix=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(agein, ageout, dead != 0) ~ dtpany, data = bissau, 
    method = "breslow", timefix = F)

           coef exp(coef) se(coef)      z     p
dtpany -0.03855   0.96218  0.14904 -0.259 0.796

Likelihood ratio test=0.07  on 1 df, p=0.7958
n= 5274, number of events= 222 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(agein,ageout,dead<span class="sc">!=</span><span class="dv">0</span>)<span class="sc">~</span>bcg<span class="sc">+</span>dtpany,<span class="at">data=</span>bissau,<span class="at">method=</span><span class="st">"breslow"</span>,<span class="at">timefix=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(agein, ageout, dead != 0) ~ bcg + dtpany, 
    data = bissau, method = "breslow", timefix = F)

          coef exp(coef) se(coef)      z      p
bcg    -0.5585    0.5720   0.1924 -2.902 0.0037
dtpany  0.3286    1.3890   0.2021  1.625 0.1041

Likelihood ratio test=9.01  on 2 df, p=0.01106
n= 5274, number of events= 222 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(agein,ageout,dead<span class="sc">!=</span><span class="dv">0</span>)<span class="sc">~</span>bcg<span class="sc">*</span>dtpany,<span class="at">data=</span>bissau,<span class="at">method=</span><span class="st">"breslow"</span>,<span class="at">timefix=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(agein, ageout, dead != 0) ~ bcg * dtpany, 
    data = bissau, method = "breslow", timefix = F)

              coef exp(coef) se(coef)      z       p
bcg        -0.5764    0.5619   0.2023 -2.849 0.00439
dtpany      0.1252    1.1334   0.7178  0.174 0.86151
bcg:dtpany  0.2212    1.2475   0.7429  0.298 0.76595

Likelihood ratio test=9.1  on 3 df, p=0.02796
n= 5274, number of events= 222 </code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.2-sas_fe7c81d1b93290e6fc759043309729bf">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bissau;</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> ageout*dead(<span class="dv">0</span>) = bcg / entry=agein rl;</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bissau;</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> ageout*dead(<span class="dv">0</span>) = dtpany / entry=agein rl;</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bissau;</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> ageout*dead(<span class="dv">0</span>) = bcg dtpany / entry=agein rl;</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bissau;</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> ageout*dead(<span class="dv">0</span>) = bcg dtpany bcg*dtpany / entry=agein rl;</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="testis-cancer-incidence-and-maternal-parity" class="level2">
<h2 class="anchored" data-anchor-id="testis-cancer-incidence-and-maternal-parity">Testis cancer incidence and maternal parity</h2>
<section id="read-data-2" class="level3">
<h3 class="anchored" data-anchor-id="read-data-2">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-hash="Ch3_cache/html/read-testis-r_c40d3fee73141469ad10db33da83074a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>testis <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/testis.csv"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add extra variables</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>testis<span class="sc">$</span>lpyrs <span class="ot">&lt;-</span> <span class="fu">log</span>(testis<span class="sc">$</span>pyrs)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>testis<span class="sc">$</span>par2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(testis<span class="sc">$</span>parity <span class="sc">&lt;</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-hash="Ch3_cache/html/read-testis-sas_eb664c134367cf59c95fec393a9d87e1">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=testis</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/testis.csv"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> testis; </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> testis; </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    lpyrs = <span class="fu">log</span>(pyrs); </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    par2 = (parity&gt;=<span class="dv">2</span>); </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.1" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.1">Figure 3.1</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-out.widt="66%" data-hash="Ch3_cache/html/figure-3.1-r_439eac3b68e11cbd66826faec90c7454">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frames</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="dv">1900</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">58</span>, <span class="dv">63</span>, <span class="dv">68</span>, <span class="dv">73</span>), </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x2 =</span> <span class="fu">rep</span>(<span class="dv">2000</span>, <span class="dv">5</span>), </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y2 =</span> <span class="dv">100</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">58</span>, <span class="dv">63</span>, <span class="dv">68</span>, <span class="dv">73</span>))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="fl">1968.25</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">73</span><span class="fl">-68.25</span>), </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y1 =</span> <span class="fu">c</span>(<span class="fl">68.25</span> <span class="sc">-</span> <span class="dv">50</span>, <span class="fl">68.25</span> <span class="sc">-</span> <span class="dv">58</span>, <span class="fl">68.25</span> <span class="sc">-</span> <span class="dv">63</span>, <span class="fl">68.25</span> <span class="sc">-</span> <span class="dv">68</span>, <span class="dv">0</span>), </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x2 =</span> <span class="fu">rep</span>(<span class="dv">1993</span>, <span class="dv">5</span>), </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y2 =</span> <span class="dv">100</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">58</span>, <span class="dv">63</span>, <span class="dv">68</span>, <span class="dv">73</span>) <span class="sc">-</span> <span class="dv">7</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="fl">1968.25</span>, <span class="dv">1993</span>, <span class="fl">1968.25</span>, <span class="fl">1968.25</span>, <span class="fl">1968.25</span> <span class="sc">+</span> <span class="fl">1.75</span>, <span class="fl">1968.25</span> <span class="sc">+</span> <span class="fl">6.75</span>, <span class="fl">1968.25</span> <span class="sc">+</span> <span class="fl">11.75</span>), </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>), </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x2 =</span> <span class="fu">c</span>(<span class="fl">1968.25</span>, <span class="dv">1993</span>, <span class="dv">1993</span>, <span class="dv">1993</span>, <span class="dv">1993</span>, <span class="dv">1993</span>, <span class="dv">1993</span>), </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y2 =</span> <span class="fu">c</span>(<span class="fl">68.25</span> <span class="sc">-</span> <span class="dv">50</span>, <span class="dv">100</span> <span class="sc">-</span> <span class="dv">57</span>, <span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>) </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co"># For labels</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">tapply</span>( testis<span class="sc">$</span>cases, <span class="fu">list</span>( testis<span class="sc">$</span>age, testis<span class="sc">$</span>cohort ), sum )</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">tapply</span>( testis<span class="sc">$</span>pyrs, <span class="fu">list</span>( testis<span class="sc">$</span>age, testis<span class="sc">$</span>cohort ), sum )</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">outer</span>( <span class="fu">unique</span>( testis<span class="sc">$</span>age )<span class="sc">+</span><span class="fu">c</span>(<span class="fl">17.5</span>,<span class="fu">rep</span>(<span class="fl">2.5</span>,<span class="dv">4</span>)),</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">unique</span>( testis<span class="sc">$</span>cohort )<span class="sc">+</span><span class="fl">2.5</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"+"</span> )</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>,] <span class="ot">&lt;-</span> x[<span class="dv">1</span>,]<span class="sc">-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">outer</span>( <span class="fu">c</span>(<span class="dv">13</span>,<span class="dv">17</span>,<span class="dv">22</span>,<span class="dv">27</span>,<span class="dv">32</span>), <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">5</span>), <span class="st">"*"</span> )</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x[<span class="sc">!</span><span class="fu">is.na</span>(Y)], </span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> y[<span class="sc">!</span><span class="fu">is.na</span>(Y)], </span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>                         <span class="at">label =</span> <span class="fu">paste</span>( <span class="fu">round</span>( Y<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">4</span> )[<span class="sc">!</span><span class="fu">is.na</span>(Y)] )</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>label_data2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1956</span>, <span class="at">y =</span> <span class="fl">47.5</span>, <span class="at">label =</span> <span class="st">"PY (10,000)"</span>)</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>), </span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>), </span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>))</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df1) <span class="sc">+</span> </span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">1968.25</span>, <span class="dv">1993</span>),</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>),</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y1, </span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> x2, <span class="at">yend =</span> y2), </span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> df1,</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span> </span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y1, </span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> x2, <span class="at">yend =</span> y2), </span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> df2,</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y1, </span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> x2, <span class="at">yend =</span> y2), </span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> df3,</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span> </span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Calendar time"</span>) <span class="sc">+</span> </span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Age (years)"</span>) <span class="sc">+</span> </span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.005</span>)),</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1950</span>, <span class="dv">2000</span>), </span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1950</span>, <span class="dv">2000</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.005</span>)), </span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>), </span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">label.size =</span> <span class="cn">NA</span>,</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="fl">1.1</span>, <span class="at">vjust =</span> <span class="fl">0.7</span>, </span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> label_data) <span class="sc">+</span> </span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin=</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.75</span>, <span class="fl">0.75</span>, <span class="fl">0.75</span>), <span class="st">"cm"</span>))</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.1-r-1.png" class="img-fluid" width="793"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.5" class="level3">
<h3 class="anchored" data-anchor-id="table-3.5">Table 3.5</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.5-r_57b0ad7eb410425b192342c3652c2d76">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts=</span><span class="fu">c</span>(<span class="st">"contr.treatment"</span>, <span class="st">"contr.poly"</span>))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>testis<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(testis<span class="sc">$</span>age)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>testis<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">relevel</span>(testis<span class="sc">$</span>age, <span class="at">ref =</span> <span class="st">'20'</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(cases <span class="sc">~</span> <span class="fu">offset</span>(lpyrs) <span class="sc">+</span> par2 <span class="sc">+</span> age, <span class="at">data =</span> testis, <span class="at">family =</span> poisson))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = cases ~ offset(lpyrs) + par2 + age, family = poisson, 
    data = testis)

Coefficients:
            Estimate Std. Error  z value Pr(&gt;|z|)    
(Intercept) -9.04435    0.08393 -107.757  &lt; 2e-16 ***
par2         0.21663    0.08405    2.577  0.00996 ** 
age0        -4.03084    0.21105  -19.099  &lt; 2e-16 ***
age15       -1.17094    0.11886   -9.851  &lt; 2e-16 ***
age25        0.55962    0.09802    5.709 1.14e-08 ***
age30        0.75263    0.13272    5.671 1.42e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 1647.61  on 236  degrees of freedom
Residual deviance:  201.07  on 231  degrees of freedom
AIC: 540.84

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>testis<span class="sc">$</span>motherage <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(testis<span class="sc">$</span>motherage)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>testis<span class="sc">$</span>motherage <span class="ot">&lt;-</span> <span class="fu">relevel</span>(testis<span class="sc">$</span>motherage, <span class="at">ref =</span> <span class="st">"30"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>testis<span class="sc">$</span>cohort <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(testis<span class="sc">$</span>cohort)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>testis<span class="sc">$</span>cohort <span class="ot">&lt;-</span> <span class="fu">relevel</span>(testis<span class="sc">$</span>cohort, <span class="at">ref =</span> <span class="st">"1973"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poisfull<span class="ot">&lt;-</span><span class="fu">glm</span>(cases <span class="sc">~</span> <span class="fu">offset</span>(lpyrs) <span class="sc">+</span> par2 <span class="sc">+</span> age <span class="sc">+</span> motherage <span class="sc">+</span> cohort, </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> testis,<span class="at">family =</span> poisson))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = cases ~ offset(lpyrs) + par2 + age + motherage + 
    cohort, family = poisson, data = testis)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -9.11684    0.29271 -31.146  &lt; 2e-16 ***
par2         0.22967    0.09112   2.521   0.0117 *  
age0        -4.00398    0.23905 -16.749  &lt; 2e-16 ***
age15       -1.16652    0.12522  -9.316  &lt; 2e-16 ***
age25        0.61710    0.10445   5.908 3.46e-09 ***
age30        0.95356    0.15378   6.201 5.62e-10 ***
motherage12  0.02926    0.24121   0.121   0.9034    
motherage20  0.05796    0.22233   0.261   0.7943    
motherage25 -0.11663    0.22510  -0.518   0.6044    
cohort1950  -0.36275    0.28800  -1.260   0.2078    
cohort1958  -0.08031    0.24838  -0.323   0.7464    
cohort1963   0.12346    0.23712   0.521   0.6026    
cohort1968   0.13376    0.23600   0.567   0.5709    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 1647.6  on 236  degrees of freedom
Residual deviance:  190.2  on 224  degrees of freedom
AIC: 543.98

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(poisfull, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 7
   term        estimate std.error statistic   p.value  conf.low conf.high
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept) 0.000110    0.293    -31.1   5.74e-213 0.0000605  0.000191
 2 par2        1.26        0.0911     2.52  1.17e-  2 1.05       1.51    
 3 age0        0.0182      0.239    -16.7   5.72e- 63 0.0112     0.0286  
 4 age15       0.311       0.125     -9.32  1.21e- 20 0.243      0.397   
 5 age25       1.85        0.104      5.91  3.46e-  9 1.51       2.28    
 6 age30       2.59        0.154      6.20  5.62e- 10 1.91       3.50    
 7 motherage12 1.03        0.241      0.121 9.03e-  1 0.652      1.68    
 8 motherage20 1.06        0.222      0.261 7.94e-  1 0.698      1.68    
 9 motherage25 0.890       0.225     -0.518 6.04e-  1 0.583      1.41    
10 cohort1950  0.696       0.288     -1.26  2.08e-  1 0.398      1.23    
11 cohort1958  0.923       0.248     -0.323 7.46e-  1 0.574      1.52    
12 cohort1963  1.13        0.237      0.521 6.03e-  1 0.720      1.83    
13 cohort1968  1.14        0.236      0.567 5.71e-  1 0.729      1.84    </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for mother's age</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>poismage<span class="ot">&lt;-</span><span class="fu">glm</span>(cases <span class="sc">~</span> <span class="fu">offset</span>(lpyrs) <span class="sc">+</span> par2 <span class="sc">+</span> age <span class="sc">+</span> cohort, </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> testis,<span class="at">family =</span> poisson)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poisfull,poismage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: cases ~ offset(lpyrs) + par2 + age + motherage + cohort
Model 2: cases ~ offset(lpyrs) + par2 + age + cohort
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1  13 -258.99                     
2  10 -260.25 -3 2.5336     0.4692</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for birth cohort of son</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>poiscohort<span class="ot">&lt;-</span><span class="fu">glm</span>(cases <span class="sc">~</span> <span class="fu">offset</span>(lpyrs) <span class="sc">+</span> par2 <span class="sc">+</span> age <span class="sc">+</span> motherage, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> testis,<span class="at">family =</span> poisson)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poisfull,poiscohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: cases ~ offset(lpyrs) + par2 + age + motherage + cohort
Model 2: cases ~ offset(lpyrs) + par2 + age + motherage
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)  
1  13 -258.99                       
2   9 -263.60 -4 9.2204    0.05582 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT parity and age</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>poisinteract<span class="ot">&lt;-</span><span class="fu">glm</span>(cases <span class="sc">~</span> <span class="fu">offset</span>(lpyrs) <span class="sc">+</span> par2 <span class="sc">+</span> age <span class="sc">+</span> motherage <span class="sc">+</span> cohort <span class="sc">+</span> par2<span class="sc">*</span>age, </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> testis, <span class="at">family =</span> poisson)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(poisfull,poisinteract)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: cases ~ offset(lpyrs) + par2 + age + motherage + cohort
Model 2: cases ~ offset(lpyrs) + par2 + age + motherage + cohort + par2 * 
    age
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1  13 -258.99                     
2  17 -255.11  4 7.7606     0.1008</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.5-sas_cb626bcaa199ae6bdbda3a0945a69f6d">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 1;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod;</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    class age (ref=<span class="st">'20'</span>) par2 (ref=<span class="st">'1'</span>);</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> cases=par2 age/dist=poi offset=lpyrs type3;</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'RR'</span> par2 <span class="dv">1</span> -<span class="dv">1</span>/<span class="fu">exp</span>;</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 2;</span> </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod;</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    class age (ref=<span class="st">'20'</span>) motherage(ref=<span class="st">'30'</span>) cohort(ref=<span class="st">'1973'</span>) par2 (ref=<span class="st">'1'</span>);</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> cases=par2 age motherage cohort/dist=poi offset=lpyrs type3;</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'RR'</span> par2 <span class="dv">1</span> -<span class="dv">1</span>/<span class="fu">exp</span>;</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">* In-text interaction test;</span> </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod;</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    class age (ref=<span class="st">'20'</span>) motherage(ref=<span class="st">'30'</span>) cohort(ref=<span class="st">'1973'</span>) par2 (ref=<span class="st">'1'</span>);</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> cases=par2 age motherage cohort par2*age/dist=poi offset=lpyrs type3;</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-86-cox-models-for-seminomas-and-non-seminomas" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-86-cox-models-for-seminomas-and-non-seminomas">In-text, p.&nbsp;86: Cox models for seminomas and non-seminomas</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell" data-hash="Ch3_cache/html/in-text-r_e6ef2a47b6e8adb4d5ef72751f4862df">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HR for seminomas</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">glm</span>(semi <span class="sc">~</span> <span class="fu">offset</span>(lpyrs) <span class="sc">+</span> par2 <span class="sc">+</span> age <span class="sc">+</span> motherage <span class="sc">+</span> cohort, </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> testis, <span class="at">family =</span> poisson),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> T, <span class="at">conf.int =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 7
   term         estimate std.error statistic  p.value   conf.low conf.high
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept) 0.0000297     1.00   -10.4    1.98e-25 0.00000314  0.000178
 2 par2        1.23          0.171    1.23   2.19e- 1 0.886       1.73    
 3 age0        0.00297       1.13    -5.17   2.38e- 7 0.000147    0.0176  
 4 age15       0.0949        0.443   -5.32   1.03e- 7 0.0357      0.209   
 5 age25       2.98          0.200    5.47   4.55e- 8 2.03        4.44    
 6 age30       6.62          0.245    7.71   1.30e-14 4.11       10.8     
 7 motherage12 0.900         0.640   -0.164  8.69e- 1 0.295       3.94    
 8 motherage20 0.978         0.618   -0.0360 9.71e- 1 0.339       4.15    
 9 motherage25 1.23          0.617    0.338  7.35e- 1 0.427       5.22    
10 cohort1950  0.731         0.907   -0.345  7.30e- 1 0.140       5.71    
11 cohort1958  0.966         0.879   -0.0389 9.69e- 1 0.198       7.26    
12 cohort1963  0.862         0.869   -0.171  8.64e- 1 0.180       6.39    
13 cohort1968  0.691         0.879   -0.421  6.74e- 1 0.140       5.18    </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HR for non-seminomas</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">glm</span>(nonsemi <span class="sc">~</span> <span class="fu">offset</span>(lpyrs) <span class="sc">+</span> par2 <span class="sc">+</span> age <span class="sc">+</span> motherage <span class="sc">+</span> cohort, </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> testis, <span class="at">family =</span> poisson),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> T, <span class="at">conf.int =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 7
   term         estimate std.error statistic   p.value  conf.low conf.high
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept) 0.0000860     0.308   -30.4   7.09e-203 0.0000459  0.000154
 2 par2        1.27          0.108     2.19  2.88e-  2 1.03       1.56    
 3 age0        0.0223        0.246   -15.4   9.35e- 54 0.0135     0.0355  
 4 age15       0.369         0.133    -7.48  7.32e- 14 0.283      0.478   
 5 age25       1.49          0.125     3.21  1.35e-  3 1.17       1.91    
 6 age30       1.21          0.229     0.846 3.97e-  1 0.762      1.88    
 7 motherage12 1.09          0.264     0.341 7.33e-  1 0.662      1.87    
 8 motherage20 1.10          0.239     0.382 7.03e-  1 0.700      1.79    
 9 motherage25 0.804         0.244    -0.892 3.72e-  1 0.508      1.33    
10 cohort1950  0.639         0.328    -1.37  1.72e-  1 0.335      1.22    
11 cohort1958  0.828         0.264    -0.718 4.73e-  1 0.499      1.41    
12 cohort1963  1.15          0.247     0.550 5.82e-  1 0.715      1.89    
13 cohort1968  1.19          0.245     0.722 4.70e-  1 0.748      1.96    </code></pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-hash="Ch3_cache/html/in-text-sas_dbfcce39f06ef7becbe4739569fb703e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">* seminomas;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod;</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    class age (ref=<span class="st">'20'</span>) motherage(ref=<span class="st">'30'</span>) cohort(ref=<span class="st">'1973'</span>) par2 (ref=<span class="st">'1'</span>);</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> semi=par2 age motherage cohort/dist=poi offset=lpyrs type3;</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'RR'</span> par2 <span class="dv">1</span> -<span class="dv">1</span>/<span class="fu">exp</span>;</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">* non-seminomas;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod;</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    class age (ref=<span class="st">'20'</span>) motherage(ref=<span class="st">'30'</span>) cohort(ref=<span class="st">'1973'</span>) par2 (ref=<span class="st">'1'</span>);</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> nonsemi=par2 age motherage cohort/dist=poi offset=lpyrs type3;</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'RR'</span> par2 <span class="dv">1</span> -<span class="dv">1</span>/<span class="fu">exp</span>;</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="prova-trial-in-liver-cirrhosis" class="level2">
<h2 class="anchored" data-anchor-id="prova-trial-in-liver-cirrhosis">PROVA trial in liver cirrhosis</h2>
<section id="read-data-3" class="level3">
<h3 class="anchored" data-anchor-id="read-data-3">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-hash="Ch3_cache/html/read-prova-r_de0a060028fac81be9bbd723f5c595c1">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>prova <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/prova.csv"</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"."</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment 2x2 factorial</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>prova<span class="sc">$</span>beh <span class="ot">&lt;-</span> <span class="fu">with</span>(prova, <span class="fu">as.factor</span>(scle <span class="sc">+</span> beta<span class="sc">*</span><span class="dv">2</span>))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extra variables</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>provany <span class="ot">&lt;-</span> prova</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>log2bili <span class="ot">&lt;-</span> <span class="fu">with</span>(provany, <span class="fu">log2</span>(bili))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>btime    <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(provany<span class="sc">$</span>bleed <span class="sc">==</span> <span class="dv">1</span>, provany<span class="sc">$</span>timebleed, provany<span class="sc">$</span>timedeath)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>d0time   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(provany<span class="sc">$</span>bleed <span class="sc">==</span> <span class="dv">1</span>, provany<span class="sc">$</span>timebleed, provany<span class="sc">$</span>timedeath)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>dead0    <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(provany<span class="sc">$</span>bleed <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, provany<span class="sc">$</span>death)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>outof0   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(provany<span class="sc">$</span>bleed <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, provany<span class="sc">$</span>death)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>bdtime   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(provany<span class="sc">$</span>bleed <span class="sc">==</span> <span class="dv">1</span>, provany<span class="sc">$</span>timedeath, <span class="cn">NA</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>deadb    <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(provany<span class="sc">$</span>bleed <span class="sc">==</span> <span class="dv">1</span>, provany<span class="sc">$</span>death, <span class="cn">NA</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>wait     <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(provany<span class="sc">$</span>bleed <span class="sc">==</span> <span class="dv">1</span>, provany<span class="sc">$</span>bdtime <span class="sc">-</span> provany<span class="sc">$</span>timebleed, <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-hash="Ch3_cache/html/read-prova-sas_7e40382ebabe1a0a660d5bacf64b9901">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=prova</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/prova.csv"</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> prova; </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> prova; </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    beh = scle + beta*<span class="dv">2</span>; </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    log2bili = <span class="fu">log2</span>(bili);</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> bleed = <span class="dv">1</span> <span class="kw">then</span> wait = timedeath - timebleed;</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> provany; </span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> prova;</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> bleed=<span class="dv">1</span> <span class="kw">then do</span>; btime=timebleed; d0time=timebleed; dead0=<span class="dv">0</span>; outof0=<span class="dv">1</span>; </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    bdtime=timedeath; deadb=death; wait=bdtime-timebleed; </span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="kw">    end</span>;</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> bleed=<span class="dv">0</span> <span class="kw">then do</span>; btime=timedeath; d0time=timedeath; dead0=death; outof0=death; </span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    bdtime=.; deadb=.; wait=.<span class="kw">; end</span>;</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    log2bili=<span class="fu">log2</span>(bili);</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.3" class="level3">
<h3 class="anchored" data-anchor-id="table-3.3">Table 3.3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.3-r_3d9b345c9b1778d7a77be79ce6f4bc91">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts=</span><span class="fu">c</span>(<span class="st">"contr.treatment"</span>, <span class="st">"contr.poly"</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Column 1</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variceal bleeding</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bleed) <span class="sc">~</span> beh, <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(btime, bleed) ~ beh, data = provany, ties = "breslow")

         coef exp(coef) se(coef)      z     p
beh1  0.05563   1.05721  0.39235  0.142 0.887
beh2 -0.03972   0.96106  0.40039 -0.099 0.921
beh3 -0.03205   0.96846  0.40063 -0.080 0.936

Likelihood ratio test=0.07  on 3 df, p=0.9951
n= 286, number of events= 50 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># logrank test: Variceal bleeding</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>lr<span class="ot">&lt;-</span><span class="fu">survdiff</span>(<span class="fu">Surv</span>(btime, bleed) <span class="sc">~</span> beh, <span class="at">data =</span> provany)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(lr<span class="sc">$</span>chisq,lr<span class="sc">$</span>pvalue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07114524 0.99505932</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Death without bleeding</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>cox1<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(d0time, dead0) <span class="sc">~</span> beh, <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># logrank test: Death without bleeding</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>lr<span class="ot">&lt;-</span><span class="fu">survdiff</span>(<span class="fu">Surv</span>(d0time, dead0) <span class="sc">~</span> beh, <span class="at">data =</span> provany)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(lr<span class="sc">$</span>chisq,lr<span class="sc">$</span>pvalue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.856428541  0.004957601</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Death without bleeding - additive model</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>cox2<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(d0time, dead0) <span class="sc">~</span> scle <span class="sc">+</span> beta, <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Death without bleeding - remove propranolol</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(cox2,cox1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(d0time, dead0) ~ scle + beta
Model 2: Surv(d0time, dead0) ~ beh
  #Df  LogLik Df Chisq Pr(&gt;Chisq)
1   2 -234.19                    
2   3 -233.38  1 1.627     0.2021</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>cox3<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(d0time, dead0) <span class="sc">~</span> scle, <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(cox3,cox2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(d0time, dead0) ~ scle
Model 2: Surv(d0time, dead0) ~ scle + beta
  #Df  LogLik Df Chisq Pr(&gt;Chisq)
1   1 -234.36                    
2   2 -234.19  1 0.348     0.5553</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>cox3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(d0time, dead0) ~ scle, data = provany, ties = "breslow")

       coef exp(coef) se(coef)     z       p
scle 1.0180    2.7677   0.3281 3.103 0.00191

Likelihood ratio test=10.76  on 1 df, p=0.001037
n= 286, number of events= 46 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Column 2</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Variceal bleeding</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bleed) <span class="sc">~</span> beh <span class="sc">+</span> sex <span class="sc">+</span> coag <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">factor</span>(varsize),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(btime, bleed) ~ beh + sex + coag + log2bili + 
    factor(varsize), data = provany, ties = "breslow")

                      coef exp(coef)  se(coef)      z        p
beh1              0.176844  1.193445  0.433336  0.408  0.68320
beh2              0.207005  1.229989  0.424001  0.488  0.62539
beh3              0.030562  1.031034  0.420784  0.073  0.94210
sex              -0.025865  0.974467  0.329095 -0.079  0.93736
coag             -0.020647  0.979565  0.007819 -2.641  0.00827
log2bili          0.191011  1.210473  0.149142  1.281  0.20029
factor(varsize)2  0.741460  2.098998  0.414959  1.787  0.07397
factor(varsize)3  1.884681  6.584252  0.442325  4.261 2.04e-05

Likelihood ratio test=37.67  on 8 df, p=8.654e-06
n= 271, number of events= 47 
   (15 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Death without bleeding</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(d0time, dead0) <span class="sc">~</span> beh <span class="sc">+</span> sex <span class="sc">+</span> coag <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">factor</span>(varsize),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(d0time, dead0) ~ beh + sex + coag + log2bili + 
    factor(varsize), data = provany, ties = "breslow")

                      coef exp(coef)  se(coef)      z       p
beh1              0.826468  2.285233  0.458574  1.802 0.07151
beh2             -0.159630  0.852459  0.575047 -0.278 0.78132
beh3              0.910385  2.485279  0.420391  2.166 0.03034
sex               0.841579  2.320027  0.415722  2.024 0.04293
coag             -0.008112  0.991920  0.006804 -1.192 0.23312
log2bili          0.445359  1.561051  0.136749  3.257 0.00113
factor(varsize)2  0.221738  1.248245  0.347159  0.639 0.52300
factor(varsize)3  0.753294  2.123984  0.448544  1.679 0.09307

Likelihood ratio test=42.13  on 8 df, p=1.283e-06
n= 271, number of events= 46 
   (15 observations deleted due to missingness)</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.3-sas_2d9ba0921ad0cf4ebb9ff94ca72093ef">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Table 3.3 column 1;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">* Variceal bleeding;</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">* logrank test is the score test;</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> btime*bleed(<span class="dv">0</span>)=beh  / type3(lr);</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co">* Death without bleeding;</span> </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co">* logrank test is the score test;</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> d0time*dead0(<span class="dv">0</span>)=beh / type3(lr);</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co">* Death without bleeding - in text LRT for additive model;</span> </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> d0time*dead0(<span class="dv">0</span>)=scle|beta / type3(lr);</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    estimate <span class="st">'both'</span> scle <span class="dv">1</span> beta <span class="dv">1</span> scle*beta <span class="dv">1</span>;</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> d0time*dead0(<span class="dv">0</span>)=scle beta / type3(lr);</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co">* Death without bleeding - remove propranolol;</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> d0time*dead0(<span class="dv">0</span>)=scle / type3(lr);</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="co">* Table 3.3 column 2;</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="co">* Variceal bleeding;</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>) varsize (ref=<span class="st">'1'</span>);</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> btime*bleed(<span class="dv">0</span>)=beh sex coag log2bili varsize / type3(lr);</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="co">* Death without bleeding;</span> </span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>) varsize (ref=<span class="st">'1'</span>);</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> d0time*dead0(<span class="dv">0</span>)=beh sex coag log2bili varsize / type3(lr);</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.4" class="level3">
<h3 class="anchored" data-anchor-id="table-3.4">Table 3.4</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.4-r_ab18d516f65e68ffba4312b0c8da699e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Composite</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>cox<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, outof0) <span class="sc">~</span> beh <span class="sc">+</span> sex <span class="sc">+</span> coag <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">factor</span>(varsize),</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>cox</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(btime, outof0) ~ beh + sex + coag + log2bili + 
    factor(varsize), data = provany, ties = "breslow")

                      coef exp(coef)  se(coef)      z        p
beh1              0.525145  1.690704  0.312502  1.680  0.09287
beh2              0.100189  1.105380  0.337918  0.296  0.76686
beh3              0.494807  1.640181  0.291638  1.697  0.08976
sex               0.360259  1.433701  0.253379  1.422  0.15508
coag             -0.013600  0.986492  0.005287 -2.572  0.01010
log2bili          0.328376  1.388711  0.101761  3.227  0.00125
factor(varsize)2  0.446403  1.562681  0.263275  1.696  0.08997
factor(varsize)3  1.332535  3.790639  0.301391  4.421 9.81e-06

Likelihood ratio test=65.71  on 8 df, p=3.489e-11
n= 271, number of events= 93 
   (15 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for treatment</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>coxreduced<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, outof0) <span class="sc">~</span> sex <span class="sc">+</span> coag <span class="sc">+</span> log2bili <span class="sc">+</span> <span class="fu">factor</span>(varsize),</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxreduced,cox)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(btime, outof0) ~ sex + coag + log2bili + factor(varsize)
Model 2: Surv(btime, outof0) ~ beh + sex + coag + log2bili + factor(varsize)
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   5 -457.74                     
2   8 -455.35  3 4.7717     0.1893</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.4-sas_131a020776defccd5961c666f3e8837e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>) varsize (ref=<span class="st">'1'</span>);</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> btime*outof0(<span class="dv">0</span>)=beh sex coag log2bili varsize  / type3(lr);</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.8" class="level3">
<h3 class="anchored" data-anchor-id="table-3.8">Table 3.8</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.8-r_d9da5ac76de40191545f62dbd97b6cc7">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time since randomization (tsr)</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>coxtsr<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bdtime, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> beh <span class="sc">+</span> sex <span class="sc">+</span> log2bili, </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>coxtsr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(btime, bdtime, deadb != 0) ~ beh + sex + 
    log2bili, data = provany, ties = "breslow")

            coef exp(coef) se(coef)      z      p
beh1     -1.4127    0.2435   0.6787 -2.081 0.0374
beh2     -0.1146    0.8918   0.5952 -0.192 0.8474
beh3      0.7327    2.0807   0.5439  1.347 0.1780
sex       1.1389    3.1234   0.5039  2.260 0.0238
log2bili  0.1088    1.1149   0.2075  0.524 0.6001

Likelihood ratio test=15.35  on 5 df, p=0.008958
n= 48, number of events= 27 
   (238 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>coxtsr0<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bdtime, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> sex <span class="sc">+</span> log2bili, </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>coxtsr0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(btime, bdtime, deadb != 0) ~ sex + log2bili, 
    data = provany, ties = "breslow")

            coef exp(coef) se(coef)      z      p
sex       0.9095    2.4830   0.4807  1.892 0.0585
log2bili -0.1618    0.8506   0.1826 -0.886 0.3758

Likelihood ratio test=4.19  on 2 df, p=0.1232
n= 48, number of events= 27 
   (238 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for beh</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxtsr,coxtsr0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(btime, bdtime, deadb != 0) ~ beh + sex + log2bili
Model 2: Surv(btime, bdtime, deadb != 0) ~ sex + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)  
1   5 -59.626                       
2   2 -65.208 -3 11.164    0.01087 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>coxnoint<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bdtime, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> scle <span class="sc">+</span> beta  <span class="sc">+</span> sex <span class="sc">+</span> log2bili, </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT interaction</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxnoint,coxtsr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(btime, bdtime, deadb != 0) ~ scle + beta + sex + log2bili
Model 2: Surv(btime, bdtime, deadb != 0) ~ beh + sex + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)   
1   4 -63.061                        
2   5 -59.626  1 6.8707   0.008762 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>tsb<span class="ot">&lt;-</span>provany<span class="sc">$</span>btime</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>coxtsr_tt<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bdtime, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> beh <span class="sc">+</span> sex <span class="sc">+</span> log2bili<span class="sc">+</span><span class="fu">tt</span>(tsb), </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">dt1=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&lt;</span><span class="dv">5</span>), <span class="at">dt2=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;=</span><span class="dv">5</span> <span class="sc">&amp;</span> dt<span class="sc">&lt;</span><span class="dv">10</span>))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>coxtsr_tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(btime, bdtime, deadb != 0) ~ beh + sex + 
    log2bili + tt(tsb), data = provany, ties = "breslow", tt = function(x, 
    t, ...) {
    dt &lt;- t - x
    cbind(dt1 = 1 * (dt &lt; 5), dt2 = 1 * (dt &gt;= 5 &amp; dt &lt; 10))
})

               coef exp(coef) se(coef)      z        p
beh1       -1.15606   0.31472  0.68428 -1.689  0.09113
beh2       -0.02371   0.97657  0.63136 -0.038  0.97005
beh3        0.42544   1.53026  0.61129  0.696  0.48645
sex         1.11875   3.06103  0.53261  2.101  0.03568
log2bili   -0.04822   0.95292  0.22285 -0.216  0.82869
tt(tsb)dt1  2.94285  18.96981  0.73891  3.983 6.81e-05
tt(tsb)dt2  2.34525  10.43583  0.80285  2.921  0.00349

Likelihood ratio test=33.65  on 7 df, p=2.005e-05
n= 48, number of events= 27 
   (238 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for time-dependent covariates</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxtsr_tt,coxtsr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(btime, bdtime, deadb != 0) ~ beh + sex + log2bili + tt(tsb)
Model 2: Surv(btime, bdtime, deadb != 0) ~ beh + sex + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   7 -50.478                         
2   5 -59.626 -2 18.295  0.0001065 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for beh</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>coxtsr_tt_reduced<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bdtime, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> sex <span class="sc">+</span> log2bili<span class="sc">+</span><span class="fu">tt</span>(tsb), </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                   dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">cbind</span>(<span class="at">dt1=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&lt;</span><span class="dv">5</span>), <span class="at">dt2=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;=</span><span class="dv">5</span> <span class="sc">&amp;</span> dt<span class="sc">&lt;</span><span class="dv">10</span>))</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>                 })</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxtsr_tt_reduced,coxtsr_tt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(btime, bdtime, deadb != 0) ~ sex + log2bili + tt(tsb)
Model 2: Surv(btime, bdtime, deadb != 0) ~ beh + sex + log2bili + tt(tsb)
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   4 -53.081                     
2   7 -50.478  3 5.2064     0.1573</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In text, model linear effect of time-dependent covariate</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bdtime, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> beh<span class="sc">+</span>sex <span class="sc">+</span> log2bili<span class="sc">+</span><span class="fu">tt</span>(tsb), </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...){t<span class="sc">-</span>x})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(btime, bdtime, deadb != 0) ~ beh + sex + 
    log2bili + tt(tsb), data = provany, ties = "breslow", tt = function(x, 
    t, ...) {
    t - x
})

              coef exp(coef)  se(coef)      z       p
beh1     -1.462260  0.231712  0.685283 -2.134 0.03286
beh2     -0.028375  0.972024  0.620246 -0.046 0.96351
beh3      0.599364  1.820960  0.574135  1.044 0.29651
sex       0.899664  2.458776  0.530853  1.695 0.09012
log2bili  0.349775  1.418749  0.224830  1.556 0.11977
tt(tsb)  -0.005179  0.994834  0.001769 -2.927 0.00342

Likelihood ratio test=25.54  on 6 df, p=0.0002708
n= 48, number of events= 27 
   (238 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Duration</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>coxdur<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> beh <span class="sc">+</span> sex <span class="sc">+</span> log2bili,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>coxdur</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, deadb != 0) ~ beh + sex + log2bili, 
    data = provany, ties = "breslow")

            coef exp(coef) se(coef)      z     p
beh1     -0.9971    0.3689   0.6429 -1.551 0.121
beh2     -0.2995    0.7412   0.5965 -0.502 0.616
beh3      0.8708    2.3889   0.5136  1.695 0.090
sex       0.6497    1.9149   0.5264  1.234 0.217
log2bili  0.2677    1.3070   0.1790  1.496 0.135

Likelihood ratio test=13.24  on 5 df, p=0.0212
n= 48, number of events= 27 
   (238 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>coxdur0<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> sex <span class="sc">+</span> log2bili,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>coxdur0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, deadb != 0) ~ sex + log2bili, data = provany, 
    ties = "breslow")

           coef exp(coef) se(coef)     z     p
sex      0.6742    1.9625   0.4662 1.446 0.148
log2bili 0.1210    1.1286   0.1677 0.721 0.471

Likelihood ratio test=3.03  on 2 df, p=0.2195
n= 48, number of events= 27 
   (238 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for beh</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxdur,coxdur0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(wait, deadb != 0) ~ beh + sex + log2bili
Model 2: Surv(wait, deadb != 0) ~ sex + log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)  
1   5 -86.494                       
2   2 -91.600 -3 10.211    0.01685 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>provany<span class="sc">$</span>tsr<span class="ot">&lt;-</span>provany<span class="sc">$</span>btime</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>coxdur_tt<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(wait, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> beh <span class="sc">+</span> sex <span class="sc">+</span> log2bili<span class="sc">+</span><span class="fu">tt</span>(tsr),</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>,</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> x<span class="sc">+</span>t</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">v1=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&lt;</span><span class="dv">1</span><span class="sc">*</span><span class="fl">365.25</span>), <span class="at">v2=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;=</span><span class="dv">1</span><span class="sc">*</span><span class="fl">365.25</span> <span class="sc">&amp;</span> dt<span class="sc">&lt;</span><span class="dv">2</span><span class="sc">*</span><span class="fl">365.25</span>))</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>coxdur_tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(wait, deadb != 0) ~ beh + sex + log2bili + 
    tt(tsr), data = provany, ties = "breslow", tt = function(x, 
    t, ...) {
    dt &lt;- x + t
    cbind(v1 = 1 * (dt &lt; 1 * 365.25), v2 = 1 * (dt &gt;= 1 * 365.25 &amp; 
        dt &lt; 2 * 365.25))
})

             coef exp(coef) se(coef)      z     p
beh1      -1.0192    0.3609   0.6502 -1.567 0.117
beh2      -0.3116    0.7323   0.6005 -0.519 0.604
beh3       0.8467    2.3320   0.5244  1.615 0.106
sex        0.6441    1.9043   0.5303  1.215 0.225
log2bili   0.2829    1.3269   0.1966  1.439 0.150
tt(tsr)v1 -0.1723    0.8417   0.9096 -0.189 0.850
tt(tsr)v2 -0.2211    0.8016   0.8862 -0.250 0.803

Likelihood ratio test=13.31  on 7 df, p=0.065
n= 48, number of events= 27 
   (238 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for time-dependent covariates</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(coxdur,coxdur_tt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(wait, deadb != 0) ~ beh + sex + log2bili
Model 2: Surv(wait, deadb != 0) ~ beh + sex + log2bili + tt(tsr)
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   5 -86.494                     
2   7 -86.464  2 0.0618     0.9696</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>coxdur_tt_reduced<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(btime, bdtime, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> sex <span class="sc">+</span> log2bili<span class="sc">+</span><span class="fu">tt</span>(tsb), </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> provany, <span class="at">ties =</span> <span class="st">"breslow"</span>,</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>                           dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">cbind</span>(<span class="at">dt1=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&lt;</span><span class="dv">5</span>), <span class="at">dt2=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;=</span><span class="dv">5</span> <span class="sc">&amp;</span> dt<span class="sc">&lt;</span><span class="dv">10</span>))</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>                         })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.8-sas_a2ba18a0f1f346578beac61918a60ad5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Time since randomisation;</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 1;</span> </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany atrisk;</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> bdtime*deadb(<span class="dv">0</span>)=beh sex log2bili / entry=btime rl type3(lr);</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="co">* LRT interaction scle*beta;</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany atrisk;</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> bdtime*deadb(<span class="dv">0</span>)=scle|beta sex log2bili / entry=btime rl type3(lr);</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 2;</span> </span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw">  data</span>=provany;</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> bdtime*deadb(<span class="dv">0</span>)=beh sex log2bili wait1 wait2 / entry=btime rl type3(lr);</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>    wait1=<span class="dv">0</span>; wait2=<span class="dv">0</span>;</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (bdtime-btime&lt;<span class="dv">5</span>) <span class="kw">then</span> wait1=<span class="dv">1</span>;</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (<span class="dv">5</span>&lt;=bdtime-btime&lt;<span class="dv">10</span>) <span class="kw">then</span> wait2=<span class="dv">1</span>;</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>    duration: test wait1=<span class="dv">0</span>, wait2=<span class="dv">0</span>;</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a><span class="co">* In text: Linear effect of time-dependent covariate;</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw">  data</span>=provany;</span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> bdtime*deadb(<span class="dv">0</span>)=beh sex log2bili lin / entry=btime rl type3(lr);</span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>    lin=bdtime-btime;</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a><span class="co">* Duration;</span> </span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 1;</span> </span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> wait*deadb(<span class="dv">0</span>)=beh sex log2bili / type3(lr);</span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>    baseline out=cumhazwait cumhaz=breslowwait covariates=covar;</span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 2;</span></span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> wait*deadb(<span class="dv">0</span>)=beh sex log2bili time1 time2 / type3(lr);</span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a>    time1=<span class="dv">0</span>; time2=<span class="dv">0</span>;</span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (btime+wait&lt;<span class="dv">365.25</span>) <span class="kw">then</span> time1=<span class="dv">1</span>;</span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (<span class="dv">365.25</span>&lt;=btime+wait&lt;<span class="dv">2</span>*<span class="dv">365.25</span>) <span class="kw">then</span> time2=<span class="dv">1</span>;</span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a>    timeeff: test time1=<span class="dv">0</span>, time2=<span class="dv">0</span>;</span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.2" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.2">Figure 3.2</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.2-r_1d281b093e4869d899c1229cd12c77d0">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting style </span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Make zeros print as "0" always for plot axes</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>prettyZero <span class="ot">&lt;-</span> <span class="cf">function</span>(l){</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>  max.decimals <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">nchar</span>(<span class="fu">str_extract</span>(l, <span class="st">"</span><span class="sc">\\</span><span class="st">.[0-9]+"</span>)), <span class="at">na.rm =</span> T)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>  lnew <span class="ot">=</span> <span class="fu">formatC</span>(l, <span class="at">replace.zero =</span> T, <span class="at">zero.print =</span> <span class="st">"0"</span>,</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">digits =</span> max.decimals, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">preserve.width=</span>T)</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lnew)</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">survfit</span>(coxtsr, </span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">sex =</span> <span class="dv">0</span>, </span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beh =</span> <span class="st">"0"</span>, </span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">log2bili =</span> <span class="dv">0</span>))</span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>coxdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> <span class="fu">append</span>(<span class="dv">0</span>,coxcumhaz<span class="sc">$</span>cumhaz), </span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> <span class="fu">append</span>(<span class="dv">0</span>,coxcumhaz<span class="sc">$</span>time), </span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Breslow estimate"</span>, <span class="dv">1</span><span class="sc">+</span><span class="fu">length</span>(coxcumhaz<span class="sc">$</span>time)))</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.2</span></span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz), <span class="at">data =</span> coxdata) <span class="sc">+</span> </span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.2-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.2-sas_a40bd6a34929e24fd54b43f86d0522f9">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> covar; </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> beh sex log2bili; </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines; </span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    0 0 0</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="ot">; </span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany atrisk;</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> bdtime*deadb(<span class="dv">0</span>)=beh sex log2bili/entry=btime rl type3(lr);</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    baseline out=cumhaztime cumhaz=breslowtime covariates=covar;</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> cumhaztime;</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> cumhaztime; </span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>    bdtimeyears = bdtime / <span class="dv">365.25</span>; </span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=cumhaztime;</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    plot breslowtime*bdtimeyears/haxis=axis1 vaxis=axis2;</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">4</span> <span class="kw">by</span> <span class="dv">1</span> minor=none </span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>          <span class="kw">label</span>=(<span class="st">'Time since randomization (Years)'</span>);</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">1.1</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=blue;</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.3" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.3">Figure 3.3</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.3-r_1591c892759b30c2fc888eefb8d1396c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative baseline hazard</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>coxcumhaz <span class="ot">&lt;-</span> <span class="fu">survfit</span>(coxdur, </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">sex =</span> <span class="dv">0</span>, </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beh =</span> <span class="st">"0"</span>, </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">log2bili =</span> <span class="dv">0</span>))</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data for plot</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>coxdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> <span class="fu">append</span>(<span class="dv">0</span>,coxcumhaz<span class="sc">$</span>cumhaz), </span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> <span class="fu">append</span>(<span class="dv">0</span>,coxcumhaz<span class="sc">$</span>time), </span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="fu">rep</span>(<span class="st">"Breslow estimate"</span>, <span class="dv">1</span><span class="sc">+</span><span class="fu">length</span>(coxcumhaz<span class="sc">$</span>time)))</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.3</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz), <span class="at">data =</span> coxdata) <span class="sc">+</span> </span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Duration (years)"</span>) <span class="sc">+</span> </span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), ) <span class="sc">+</span> </span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)),<span class="at">labels =</span> prettyZero) <span class="sc">+</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.3-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.3-sas_6795c7f0b3a528937aec51a8241c15ac">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Duration;</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> covar; </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> beh sex log2bili; </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines; </span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    0 0 0</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="ot">; </span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=provany;</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>);</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> wait*deadb(<span class="dv">0</span>)=beh sex log2bili / type3(lr);</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>    baseline out=cumhazwait cumhaz=breslowwait covariates=covar;</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> cumhazwait;</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> cumhazwait; </span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>    waityears = wait / <span class="dv">365.25</span>; </span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=cumhazwait;</span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>    plot breslowwait*waityears/haxis=axis1 vaxis=axis2;</span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">4</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(<span class="st">'Duration (Years)'</span>);</span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.2</span> <span class="kw">by</span> <span class="dv">0.05</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=blue;</span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.9" class="level3">
<h3 class="anchored" data-anchor-id="table-3.9">Table 3.9</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.9-r_6c4a31314bebe0fd00e9a61efdd3a86a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All bleeds</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>provasplit11 <span class="ot">&lt;-</span> <span class="fu">subset</span>(provany, bleed <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Split by duration</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>provasplit1 <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(wait, deadb <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> ., <span class="at">data =</span> provasplit11, </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cut =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">episode =</span> <span class="st">"wint"</span>)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>provasplit1<span class="sc">$</span>start <span class="ot">&lt;-</span> <span class="fu">with</span>(provasplit1, </span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>                            btime <span class="sc">+</span> <span class="fu">ifelse</span>(wint <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(wint <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">5</span> , <span class="dv">10</span>))</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>provasplit1<span class="sc">$</span>stop <span class="ot">&lt;-</span> <span class="fu">with</span>(provasplit1, btime <span class="sc">+</span> wait)</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>provasplit1<span class="sc">$</span>risktime <span class="ot">&lt;-</span> <span class="fu">with</span>(provasplit1, wait <span class="sc">-</span> tstart)</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>provasplit1<span class="sc">$</span>logrisktime <span class="ot">&lt;-</span> <span class="fu">log</span>(provasplit1<span class="sc">$</span>risktime)</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>provasplit1<span class="sc">$</span>fail <span class="ot">&lt;-</span> provasplit1<span class="sc">$</span>event</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Split by time since rand (t)</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>provasplit2 <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(start, stop, fail) <span class="sc">~</span> ., <span class="at">data =</span> provasplit1, </span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cut =</span> <span class="fu">c</span>((<span class="dv">1</span>) <span class="sc">*</span> <span class="fl">365.25</span>, (<span class="dv">2</span>) <span class="sc">*</span> <span class="fl">365.25</span>),</span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>                           <span class="at">episode =</span> <span class="st">"tint"</span>)</span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>provasplit2<span class="sc">$</span>risktime2 <span class="ot">&lt;-</span> <span class="fu">with</span>(provasplit2, stop <span class="sc">-</span> start)</span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>provasplit2<span class="sc">$</span>risktimeys2 <span class="ot">&lt;-</span> provasplit2<span class="sc">$</span>risktime2 <span class="sc">/</span> <span class="fl">365.25</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>provasplit2<span class="sc">$</span>logrisktime2 <span class="ot">&lt;-</span> <span class="fu">log</span>(provasplit2<span class="sc">$</span>risktime2)</span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>provasplit2<span class="sc">$</span>fail2 <span class="ot">&lt;-</span> provasplit2<span class="sc">$</span>fail</span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data, Table 3.9 output</span></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(fail2, risktimeys2) <span class="sc">~</span> tint <span class="sc">+</span> wint, provasplit2, </span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">count =</span> <span class="fu">length</span>(x),</span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sum =</span> <span class="fu">sum</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  tint wint fail2.count fail2.sum risktimeys2.count risktimeys2.sum
1    1    1          39         8       39.00000000      0.46338125
2    2    1          11         2       11.00000000      0.13073238
3    3    1           1         0        1.00000000      0.01368925
4    1    2          30         2       30.00000000      0.38603696
5    2    2           9         1        9.00000000      0.11635866
6    3    2           1         0        1.00000000      0.01368925
7    1    3          28         7       28.00000000     12.42984257
8    2    3          28         5       28.00000000     19.88227242
9    3    3          19         4       19.00000000     21.56468172</code></pre>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.9-sas_18d30106ceb0e687cf52864e895c92a9">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> provasplit1;</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> provany;</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> bleed=<span class="dv">1</span>;</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    fail=(wait&lt;<span class="dv">5</span>)*(deadb ne <span class="dv">0</span>);</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    risktime=<span class="fu">min</span>(<span class="dv">5</span>,wait);</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); wint=<span class="dv">1</span>; </span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    start=btime; slut=btime+<span class="fu">min</span>(<span class="dv">5</span>,wait); <span class="kw">output</span>;  </span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> wait&gt;=<span class="dv">5</span> <span class="kw">then do</span>;</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>    fail=(wait&lt;<span class="dv">10</span>)*(deadb ne <span class="dv">0</span>);</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    risktime=<span class="fu">min</span>(<span class="dv">5</span>,wait<span class="dv">-5</span>);</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); wint=<span class="dv">2</span>; </span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>    start=btime+<span class="dv">5</span>; slut=btime+<span class="fu">min</span>(<span class="dv">10</span>,wait); <span class="kw">output; end</span>;</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> wait&gt;<span class="dv">10</span> <span class="kw">then do</span>;</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>    fail=deadb ne <span class="dv">0</span>; </span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>    risktime=wait<span class="dv">-10</span>;</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>    logrisk=<span class="fu">log</span>(risktime); wint=<span class="dv">3</span>; </span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>    start=btime+<span class="dv">10</span>; slut=btime+wait; <span class="kw">output; end</span>;</span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> provasplit2; </span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> provasplit1;</span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> start&lt;<span class="dv">365.25</span> <span class="kw">then do</span>; risktime2=<span class="fu">min</span>(slut,<span class="dv">365.25</span>)-start;</span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a>    fail2=fail*(slut&lt;<span class="dv">365.25</span>); logrisk2=<span class="fu">log</span>(risktime2); tint=<span class="dv">1</span>; <span class="kw">output</span>;</span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> slut&gt;<span class="dv">365.25</span> <span class="kw">then do</span>; risktime2=<span class="fu">min</span>(slut,<span class="dv">2</span>*<span class="dv">365.25</span>)-<span class="dv">365.25</span>; logrisk2=<span class="fu">log</span>(risktime2);</span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a>    fail2=fail*(slut&lt;<span class="dv">2</span>*<span class="dv">365.25</span>); tint=<span class="dv">2</span>; <span class="kw">output; end</span>;</span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> slut&gt;<span class="dv">2</span>*<span class="dv">365.25</span> <span class="kw">then do</span>; risktime2=slut<span class="dv">-2</span>*<span class="dv">365.25</span>; logrisk2=<span class="fu">log</span>(risktime2);</span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a>    fail2=fail; tint=<span class="dv">3</span>; <span class="kw">output; end</span>;</span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a><span class="kw">    end</span>;</span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="dv">365.25</span>&lt;=start&lt;<span class="dv">2</span>*<span class="dv">365.25</span> <span class="kw">then do</span>; risktime2=<span class="fu">min</span>(slut,<span class="dv">2</span>*<span class="dv">365.25</span>)-start;</span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a>    fail2=fail*(slut&lt;<span class="dv">2</span>*<span class="dv">365.25</span>); logrisk2=<span class="fu">log</span>(risktime2); tint=<span class="dv">2</span>; <span class="kw">output</span>;</span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> slut&gt;<span class="dv">2</span>*<span class="dv">365.25</span> <span class="kw">then do</span>; risktime2=slut<span class="dv">-2</span>*<span class="dv">365.25</span>; logrisk2=<span class="fu">log</span>(risktime2);</span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a>    fail2=fail; tint=<span class="dv">3</span>; <span class="kw">output; end</span>;</span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a><span class="kw">    end</span>;</span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> start&gt;=<span class="dv">2</span>*<span class="dv">365.25</span> <span class="kw">then do</span>; risktime2=slut-start; logrisk2=<span class="fu">log</span>(risktime2);</span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a>    fail2=fail; tint=<span class="dv">3</span>; <span class="kw">output</span>; </span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> provasplit2; </span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> provasplit2;</span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a>    risktime2ys=risktime2/<span class="dv">365.25</span>;</span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span>=provasplit2 <span class="fu">sum</span>; </span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a>    class wint tint;</span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">var</span> fail2 risktime2ys;</span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.10" class="level3">
<h3 class="anchored" data-anchor-id="table-3.10">Table 3.10</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.10-r_b07eb95fcb6304f72afd767ce2e34eac">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># part (a)</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(fail <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime)) <span class="sc">+</span> beh <span class="sc">+</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(wint), <span class="at">ref =</span> <span class="st">"3"</span>) <span class="sc">+</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>              sex <span class="sc">+</span> log2bili, <span class="at">data =</span> provasplit1, <span class="at">family =</span> poisson))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail ~ offset(log(risktime)) + beh + relevel(as.factor(wint), 
    ref = "3") + sex + log2bili, family = poisson, data = provasplit1)

Coefficients:
                                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                           -8.8925     1.1282  -7.882 3.21e-15 ***
beh1                                  -1.1301     0.6423  -1.759   0.0785 .  
beh2                                  -0.3138     0.5887  -0.533   0.5940    
beh3                                   0.9667     0.5157   1.874   0.0609 .  
relevel(as.factor(wint), ref = "3")1   3.6024     0.4387   8.212  &lt; 2e-16 ***
relevel(as.factor(wint), ref = "3")2   2.8437     0.6373   4.462 8.11e-06 ***
sex                                    0.7327     0.5190   1.412   0.1581    
log2bili                               0.2877     0.1824   1.577   0.1147    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 225.56  on 122  degrees of freedom
Residual deviance: 149.88  on 115  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 219.88

Number of Fisher Scoring iterations: 8</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># part (b)</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(fail2 <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime2)) <span class="sc">+</span> beh <span class="sc">+</span> <span class="fu">relevel</span>(<span class="fu">as.factor</span>(tint), <span class="at">ref =</span> <span class="st">"3"</span>) <span class="sc">+</span> </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>              sex <span class="sc">+</span> log2bili, <span class="at">data =</span> provasplit2, <span class="at">family =</span> poisson))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail2 ~ offset(log(risktime2)) + beh + relevel(as.factor(tint), 
    ref = "3") + sex + log2bili, family = poisson, data = provasplit2)

Coefficients:
                                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                           -8.6775     1.2008  -7.226 4.96e-13 ***
beh1                                  -1.2810     0.6522  -1.964   0.0495 *  
beh2                                  -0.4317     0.5657  -0.763   0.4454    
beh3                                   0.8006     0.5254   1.524   0.1275    
relevel(as.factor(tint), ref = "3")1   1.5068     0.5785   2.605   0.0092 ** 
relevel(as.factor(tint), ref = "3")2   0.4304     0.6482   0.664   0.5067    
sex                                    0.9494     0.4922   1.929   0.0538 .  
log2bili                               0.1792     0.2049   0.875   0.3817    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 237.84  on 160  degrees of freedom
Residual deviance: 202.95  on 153  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 272.95

Number of Fisher Scoring iterations: 8</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># part (c)</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(fail2 <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime2)) <span class="sc">+</span> beh <span class="sc">+</span> </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">relevel</span>(<span class="fu">as.factor</span>(wint), <span class="at">ref =</span> <span class="st">"3"</span>) <span class="sc">+</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">relevel</span>(<span class="fu">as.factor</span>(tint), <span class="at">ref =</span> <span class="st">"3"</span>) <span class="sc">+</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>              sex <span class="sc">+</span> log2bili, <span class="at">data =</span> provasplit2, <span class="at">family =</span> poisson))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail2 ~ offset(log(risktime2)) + beh + relevel(as.factor(wint), 
    ref = "3") + relevel(as.factor(tint), ref = "3") + sex + 
    log2bili, family = poisson, data = provasplit2)

Coefficients:
                                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                           -8.9276     1.1636  -7.673 1.68e-14 ***
beh1                                  -1.1101     0.6475  -1.714   0.0864 .  
beh2                                  -0.3181     0.5788  -0.550   0.5826    
beh3                                   0.8260     0.5138   1.608   0.1079    
relevel(as.factor(wint), ref = "3")1   3.3500     0.4641   7.219 5.25e-13 ***
relevel(as.factor(wint), ref = "3")2   2.5827     0.6593   3.917 8.97e-05 ***
relevel(as.factor(tint), ref = "3")1   0.7325     0.6176   1.186   0.2356    
relevel(as.factor(tint), ref = "3")2   0.1889     0.6546   0.289   0.7729    
sex                                    0.7672     0.5090   1.507   0.1317    
log2bili                               0.2301     0.1900   1.211   0.2260    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 237.84  on 160  degrees of freedom
Residual deviance: 160.21  on 151  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 234.21

Number of Fisher Scoring iterations: 7</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction model, in-text but not shown</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(fail2 <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime2)) <span class="sc">+</span> beh <span class="sc">+</span> <span class="fu">as.factor</span>(tint) <span class="sc">*</span> <span class="fu">as.factor</span>(wint) <span class="sc">+</span> sex <span class="sc">+</span> log2bili, </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> provasplit2, <span class="at">family =</span> poisson)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fail2 ~ offset(log(risktime2)) + beh + as.factor(tint) * 
    as.factor(wint) + sex + log2bili, family = poisson, data = provasplit2)

Coefficients:
                                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                         -4.72678    1.20626  -3.919 8.91e-05 ***
beh1                                -1.09421    0.64703  -1.691   0.0908 .  
beh2                                -0.31016    0.57923  -0.535   0.5923    
beh3                                 0.83850    0.51484   1.629   0.1034    
as.factor(tint)2                    -0.74368    1.06413  -0.699   0.4846    
as.factor(tint)3                   -14.39376 1275.75399  -0.011   0.9910    
as.factor(wint)2                    -1.03184    0.79349  -1.300   0.1935    
as.factor(wint)3                    -3.37183    0.51906  -6.496 8.24e-11 ***
sex                                  0.77074    0.50839   1.516   0.1295    
log2bili                             0.21347    0.18999   1.124   0.2612    
as.factor(tint)2:as.factor(wint)2    1.26419    1.62046   0.780   0.4353    
as.factor(tint)3:as.factor(wint)2    1.03184 1804.18859   0.001   0.9995    
as.factor(tint)2:as.factor(wint)3    0.08176    1.23780   0.066   0.9473    
as.factor(tint)3:as.factor(wint)3   13.70295 1275.75414   0.011   0.9914    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 237.84  on 160  degrees of freedom
Residual deviance: 158.93  on 147  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 240.93

Number of Fisher Scoring iterations: 13</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT for time-dependent covariates</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>glmboth<span class="ot">&lt;-</span><span class="fu">glm</span>(fail2 <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime2)) <span class="sc">+</span> beh <span class="sc">+</span> </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">relevel</span>(<span class="fu">as.factor</span>(wint), <span class="at">ref =</span> <span class="st">"3"</span>) <span class="sc">+</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">relevel</span>(<span class="fu">as.factor</span>(tint), <span class="at">ref =</span> <span class="st">"3"</span>) <span class="sc">+</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>               sex <span class="sc">+</span> log2bili, <span class="at">data =</span> provasplit2, <span class="at">family =</span> poisson)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>glmwint<span class="ot">&lt;-</span><span class="fu">glm</span>(fail2 <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime2)) <span class="sc">+</span> beh <span class="sc">+</span> </span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">relevel</span>(<span class="fu">as.factor</span>(wint), <span class="at">ref =</span> <span class="st">"3"</span>) <span class="sc">+</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>               sex <span class="sc">+</span> log2bili, <span class="at">data =</span> provasplit2, <span class="at">family =</span> poisson)</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>glmtint<span class="ot">&lt;-</span><span class="fu">glm</span>(fail2 <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(risktime2)) <span class="sc">+</span> beh <span class="sc">+</span> </span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">relevel</span>(<span class="fu">as.factor</span>(tint), <span class="at">ref =</span> <span class="st">"3"</span>) <span class="sc">+</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>               sex <span class="sc">+</span> log2bili, <span class="at">data =</span> provasplit2, <span class="at">family =</span> poisson)</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT effect of duration since bleeding</span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmtint,glmboth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail2 ~ offset(log(risktime2)) + beh + relevel(as.factor(tint), 
    ref = "3") + sex + log2bili
Model 2: fail2 ~ offset(log(risktime2)) + beh + relevel(as.factor(wint), 
    ref = "3") + relevel(as.factor(tint), ref = "3") + sex + 
    log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   8 -128.47                         
2  10 -107.11  2 42.736  5.248e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT effect of time since randomization</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmwint,glmboth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: fail2 ~ offset(log(risktime2)) + beh + relevel(as.factor(wint), 
    ref = "3") + sex + log2bili
Model 2: fail2 ~ offset(log(risktime2)) + beh + relevel(as.factor(wint), 
    ref = "3") + relevel(as.factor(tint), ref = "3") + sex + 
    log2bili
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   8 -108.08                     
2  10 -107.11  2 1.9499     0.3772</code></pre>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.10-sas_74980c3145c6d5dbccfd51c6431e7c71">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">* part (a);</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=provasplit1;</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>) wint;</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail=beh wint sex log2bili/dist=poi offset=logrisk type3;</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="co">* part (b);</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=provasplit2;</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>) tint;</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail2=beh tint sex log2bili/dist=poi offset=logrisk2 type3;</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="co">* part (c);</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=provasplit2;</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>) wint tint;</span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail2=beh wint tint sex log2bili/dist=poi offset=logrisk2 type3;</span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a><span class="co">* Interaction model, in-text;</span></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> genmod<span class="kw"> data</span>=provasplit2;</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>    class beh (ref=<span class="st">'0'</span>) wint tint;</span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fail2=beh wint tint wint*tint sex log2bili/dist=poi offset=logrisk2 type3;</span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.13" class="level3">
<h3 class="anchored" data-anchor-id="table-3.13">Table 3.13</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.13-r_c49f788a05b6a20f8aa8456b4252ebce">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data set for analysis - double</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>double1 <span class="ot">&lt;-</span> provany <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">time =</span> d0time, </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">status =</span> dead0, </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">entrytime =</span> <span class="dv">0</span>, </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sex1 =</span> sex, </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sex2 =</span> <span class="dv">0</span>, </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">age1 =</span> age, </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">age2 =</span> <span class="dv">0</span>, </span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">bili1 =</span> log2bili, </span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">bili2 =</span> log2bili <span class="sc">*</span> <span class="dv">0</span>,</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">bleeding =</span> <span class="dv">1</span>)</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>double2 <span class="ot">&lt;-</span> provany <span class="sc">%&gt;%</span> <span class="fu">filter</span>(bleed <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">time =</span> bdtime, </span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">status =</span> deadb, </span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>                              <span class="at">entrytime =</span> btime, </span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sex1 =</span> <span class="dv">0</span>, </span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sex2 =</span> sex, </span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">age1 =</span> <span class="dv">0</span>, </span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">age2 =</span> age, </span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>                              <span class="at">bili1 =</span> log2bili <span class="sc">*</span> <span class="dv">0</span>, </span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>                              <span class="at">bili2 =</span> log2bili,</span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>                              <span class="at">bleeding =</span> <span class="dv">2</span>)</span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>double <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(double1, double2))</span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a><span class="co"># part (a)</span></span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a>Table3<span class="fl">.13</span>a <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(bleeding) <span class="sc">+</span> sex1 <span class="sc">+</span> sex2 <span class="sc">+</span> bili1 <span class="sc">+</span> bili2, </span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a>Table3<span class="fl">.13</span>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entrytime, time, status != 0) ~ strata(bleeding) + 
    sex1 + sex2 + bili1 + bili2, data = double, ties = "breslow")

         coef exp(coef) se(coef)      z        p
sex1   1.0408    2.8316   0.4110  2.532   0.0113
sex2   0.9095    2.4830   0.4807  1.892   0.0585
bili1  0.5275    1.6947   0.1152  4.580 4.64e-06
bili2 -0.1618    0.8506   0.1826 -0.886   0.3758

Likelihood ratio test=32.5  on 4 df, p=1.509e-06
n= 323, number of events= 73 
   (13 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># part (b)</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>Table3<span class="fl">.13</span>b <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(bleeding) <span class="sc">+</span> sex <span class="sc">+</span> bili1 <span class="sc">+</span> bili2, </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>Table3<span class="fl">.13</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entrytime, time, status != 0) ~ strata(bleeding) + 
    sex + bili1 + bili2, data = double, ties = "breslow")

         coef exp(coef) se(coef)      z        p
sex    0.9866    2.6820   0.3115  3.167  0.00154
bili1  0.5269    1.6936   0.1150  4.582 4.61e-06
bili2 -0.1685    0.8449   0.1794 -0.939  0.34767

Likelihood ratio test=32.46  on 3 df, p=4.185e-07
n= 323, number of events= 73 
   (13 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT sex</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(Table3<span class="fl">.13</span>b,Table3<span class="fl">.13</span>a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(entrytime, time, status != 0) ~ strata(bleeding) + sex + 
    bili1 + bili2
Model 2: Surv(entrytime, time, status != 0) ~ strata(bleeding) + sex1 + 
    sex2 + bili1 + bili2
  #Df  LogLik Df Chisq Pr(&gt;Chisq)
1   3 -288.94                    
2   4 -288.92  1 0.043     0.8357</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text: LRT log2(bilirubin)</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>Table3<span class="fl">.13</span>bx <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(bleeding) <span class="sc">+</span> sex1 <span class="sc">+</span> sex2 <span class="sc">+</span> log2bili, </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(Table3<span class="fl">.13</span>bx,Table3<span class="fl">.13</span>a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(entrytime, time, status != 0) ~ strata(bleeding) + sex1 + 
    sex2 + log2bili
Model 2: Surv(entrytime, time, status != 0) ~ strata(bleeding) + sex1 + 
    sex2 + bili1 + bili2
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)   
1   3 -293.86                        
2   4 -288.92  1 9.8962   0.001656 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># part (c)</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>Table3<span class="fl">.13</span>c <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(bleeding) <span class="sc">+</span> sex <span class="sc">+</span> bili1, </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>Table3<span class="fl">.13</span>c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entrytime, time, status != 0) ~ strata(bleeding) + 
    sex + bili1, data = double, ties = "breslow")

        coef exp(coef) se(coef)     z        p
sex   0.9423    2.5659   0.3072 3.067  0.00216
bili1 0.5263    1.6927   0.1149 4.582 4.61e-06

Likelihood ratio test=31.58  on 2 df, p=1.387e-07
n= 323, number of events= 73 
   (13 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text: LRT proportionality</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>ph<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> bleeding <span class="sc">+</span> sex <span class="sc">+</span> bili1, </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>pht<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> bleeding <span class="sc">+</span> <span class="fu">tt</span>(bleeding) </span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>           <span class="sc">+</span> sex <span class="sc">+</span> bili1, </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>,</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...){</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>             bleedt <span class="ot">=</span> x<span class="sc">*</span><span class="fu">log</span>(t)</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>           })</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(ph, pht)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(entrytime, time, status != 0) ~ bleeding + sex + bili1
Model 2: Surv(entrytime, time, status != 0) ~ bleeding + tt(bleeding) + 
    sex + bili1
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   3 -343.23                         
2   4 -335.42  1 15.615  7.764e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.13-sas_0680f253548b387009d6819ae2de850c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Prepare data set for analysis - double;</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> double; </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> provany; </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span>=d0time; </span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    status=dead0; </span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>    entrytime=<span class="dv">0</span>; </span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>    sex1=sex; </span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>    sex2=<span class="dv">0</span>;</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>    age1=age; </span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>    age2=<span class="dv">0</span>; </span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>    bili1=log2bili; </span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>    bili2=log2bili*<span class="dv">0</span>; </span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>    bleeding=<span class="dv">1</span>; </span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span>;</span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> bleed=<span class="dv">1</span> <span class="kw">then do</span>;</span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">time</span>=bdtime; </span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>        status=deadb; </span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a>        entrytime=btime; </span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>        sex1=<span class="dv">0</span>; </span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a>        sex2=sex;</span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a>        age1=<span class="dv">0</span>; </span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a>        age2=age; </span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a>        bili1=log2bili*<span class="dv">0</span>; </span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a>        bili2=log2bili; </span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a>        bleeding=<span class="dv">2</span>; </span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">output</span>; </span>
<span id="cb143-28"><a href="#cb143-28" aria-hidden="true" tabindex="-1"></a><span class="kw">    end</span>;</span>
<span id="cb143-29"><a href="#cb143-29" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-30"><a href="#cb143-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-31"><a href="#cb143-31" aria-hidden="true" tabindex="-1"></a><span class="co">* part (a);</span></span>
<span id="cb143-32"><a href="#cb143-32" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=double;</span>
<span id="cb143-33"><a href="#cb143-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=sex1 sex2 bili1 bili2 /entry=entrytime type3(lr);</span>
<span id="cb143-34"><a href="#cb143-34" aria-hidden="true" tabindex="-1"></a>    strata bleeding;</span>
<span id="cb143-35"><a href="#cb143-35" aria-hidden="true" tabindex="-1"></a>    test sex1=sex2; <span class="co">/* wald tests instead of LRT */</span></span>
<span id="cb143-36"><a href="#cb143-36" aria-hidden="true" tabindex="-1"></a>    test bili1=bili2;</span>
<span id="cb143-37"><a href="#cb143-37" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-38"><a href="#cb143-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-39"><a href="#cb143-39" aria-hidden="true" tabindex="-1"></a><span class="co">* part (b);</span></span>
<span id="cb143-40"><a href="#cb143-40" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=double; </span>
<span id="cb143-41"><a href="#cb143-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=sex bili1 bili2 /entry=entrytime type3(lr);</span>
<span id="cb143-42"><a href="#cb143-42" aria-hidden="true" tabindex="-1"></a>    strata bleeding;</span>
<span id="cb143-43"><a href="#cb143-43" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-44"><a href="#cb143-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-45"><a href="#cb143-45" aria-hidden="true" tabindex="-1"></a><span class="co">* part (c);</span></span>
<span id="cb143-46"><a href="#cb143-46" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=double; </span>
<span id="cb143-47"><a href="#cb143-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=sex bili1 /entry=entrytime type3(lr);</span>
<span id="cb143-48"><a href="#cb143-48" aria-hidden="true" tabindex="-1"></a>    strata bleeding;</span>
<span id="cb143-49"><a href="#cb143-49" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-50"><a href="#cb143-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-51"><a href="#cb143-51" aria-hidden="true" tabindex="-1"></a><span class="co">* In-text: LRT proportionality;</span></span>
<span id="cb143-52"><a href="#cb143-52" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=double; </span>
<span id="cb143-53"><a href="#cb143-53" aria-hidden="true" tabindex="-1"></a>  bleedinglogt=bleeding*<span class="fu">log</span>(<span class="fu">time</span>);</span>
<span id="cb143-54"><a href="#cb143-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=sex bili1 bleeding bleedinglogt /entry=entrytime type3(lr);</span>
<span id="cb143-55"><a href="#cb143-55" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.9" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.9">Figure 3.9</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.9-r_7c2767106d6b4e919d22b9588097139a">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative hazard from r1 </span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>survr1 <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(Table3<span class="fl">.13</span>a, <span class="at">center =</span> F)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>pcumhaz <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cumhaz =</span> <span class="fu">c</span>(survr1<span class="sc">$</span>hazard[survr1<span class="sc">$</span>strata<span class="sc">==</span><span class="st">"stratum=1"</span>],<span class="dv">0</span>,survr1<span class="sc">$</span>hazard[survr1<span class="sc">$</span>strata<span class="sc">==</span><span class="st">"stratum=2"</span>]), </span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">time   =</span> <span class="fu">c</span>(survr1<span class="sc">$</span>time[survr1<span class="sc">$</span>strata<span class="sc">==</span><span class="st">"stratum=1"</span>],<span class="dv">0</span>,survr1<span class="sc">$</span>time[survr1<span class="sc">$</span>strata<span class="sc">==</span><span class="st">"stratum=2"</span>]), </span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="fu">c</span>(survr1<span class="sc">$</span>strata[survr1<span class="sc">$</span>strata<span class="sc">==</span><span class="st">"stratum=1"</span>],<span class="st">"2"</span>,survr1<span class="sc">$</span>strata[survr1<span class="sc">$</span>strata<span class="sc">==</span><span class="st">"stratum=2"</span>])</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.9</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time <span class="sc">/</span> <span class="fl">365.25</span>, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> strata), <span class="at">data =</span> pcumhaz) <span class="sc">+</span> </span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since randomization (years)"</span>) <span class="sc">+</span> </span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Stratum"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>)) <span class="sc">+</span> </span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.9-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.9-sas_553183614ac0c9f97f980f0bd02f01c2">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> covar; </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> sex1 sex2 bili1 bili2; </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines; </span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    0 0 0 0</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="ot">; </span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a><span class="co">* part (a);</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=double;</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=sex1 sex2 bili1 bili2 /entry=entrytime type3(lr);</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>    strata bleeding;</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>    baseline out=<span class="fu">mort</span> cumhaz=breslow covariates=covar;</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="fu">mort</span>; </span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="fu">mort</span>; </span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>    timeyears = <span class="fu">time</span> /<span class="dv">365.25</span>; </span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=<span class="fu">mort</span>; </span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>    plot breslow*timeyears=bleeding/haxis=axis1 vaxis=axis2;</span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">4</span> <span class="kw">by</span> <span class="dv">1</span> minor=none </span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a>          <span class="kw">label</span>=(<span class="st">'Time since randomization (Years)'</span>);</span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">4</span> <span class="kw">by</span> <span class="dv">1</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative hazard'</span>);</span>
<span id="cb145-22"><a href="#cb145-22" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=blue;</span>
<span id="cb145-23"><a href="#cb145-23" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=stepjl c=red;</span>
<span id="cb145-24"><a href="#cb145-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb145-25"><a href="#cb145-25" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="recurrent-episodes-in-affective-disorders" class="level2">
<h2 class="anchored" data-anchor-id="recurrent-episodes-in-affective-disorders">Recurrent episodes in affective disorders</h2>
<section id="read-data-4" class="level3">
<h3 class="anchored" data-anchor-id="read-data-4">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell" data-hash="Ch3_cache/html/read-affective_d3864cfda8845f954f6823dddb15ab59">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>affective <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/affective.csv"</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>affective<span class="sc">$</span>wait <span class="ot">&lt;-</span> <span class="fu">with</span>(affective, stop <span class="sc">-</span> start)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell" data-hash="Ch3_cache/html/read-affective-sas_d0ee1a624db96591ed773be322377391">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=affective</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/affective.csv"</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> affective; </span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> affective; </span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>    wait = <span class="kw">stop</span> - start; </span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.6" class="level3">
<h3 class="anchored" data-anchor-id="table-3.6">Table 3.6</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.6-r_e3482e4e4629eaa2c86fa890fabb3ab9">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip,</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>), <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip, data = subset(affective, 
    state == 0), ties = "breslow")

       coef exp(coef) se(coef)     z        p
bip 0.36593   1.44186  0.09448 3.873 0.000107

Likelihood ratio test=14.24  on 1 df, p=0.0001612
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip <span class="sc">+</span> episode,</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>), <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip + episode, 
    data = subset(affective, state == 0), ties = "breslow")

            coef exp(coef) se(coef)      z        p
bip     0.318455  1.375002 0.094545  3.368 0.000756
episode 0.126230  1.134543 0.008675 14.552  &lt; 2e-16

Likelihood ratio test=177.8  on 2 df, p=&lt; 2.2e-16
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip <span class="sc">+</span> episode <span class="sc">+</span> <span class="fu">I</span>(episode<span class="sc">*</span>episode),</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>), <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip + episode + 
    I(episode * episode), data = subset(affective, state == 0), 
    ties = "breslow")

                          coef exp(coef)  se(coef)      z      p
bip                   0.066935  1.069226  0.097084  0.689  0.491
episode               0.424503  1.528831  0.032315 13.136 &lt;2e-16
I(episode * episode) -0.013617  0.986476  0.001554 -8.764 &lt;2e-16

Likelihood ratio test=283.1  on 3 df, p=&lt; 2.2e-16
n= 626, number of events= 542 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Episode as categorical</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>affective<span class="sc">$</span>epi<span class="ot">&lt;-</span><span class="fu">with</span>(affective, <span class="fu">ifelse</span>(episode<span class="sc">&lt;</span><span class="dv">10</span>,episode,<span class="dv">10</span>))</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip <span class="sc">+</span> <span class="fu">factor</span>(epi),</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>), <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip + factor(epi), 
    data = subset(affective, state == 0), ties = "breslow")

                  coef exp(coef) se(coef)      z        p
bip            0.08048   1.08381  0.09723  0.828    0.408
factor(epi)2   0.85474   2.35077  0.16125  5.301 1.15e-07
factor(epi)3   1.16051   3.19155  0.18519  6.267 3.69e-10
factor(epi)4   1.38768   4.00554  0.20278  6.843 7.75e-12
factor(epi)5   1.93212   6.90414  0.21559  8.962  &lt; 2e-16
factor(epi)6   1.88500   6.58637  0.23483  8.027 9.97e-16
factor(epi)7   2.08122   8.01427  0.24693  8.429  &lt; 2e-16
factor(epi)8   2.37102  10.70835  0.26095  9.086  &lt; 2e-16
factor(epi)9   3.00076  20.10084  0.27006 11.112  &lt; 2e-16
factor(epi)10  2.85119  17.30842  0.18992 15.013  &lt; 2e-16

Likelihood ratio test=298.5  on 10 df, p=&lt; 2.2e-16
n= 626, number of events= 542 </code></pre>
</div>
</div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.6-sas_08a91e3597aa7ab02425d891260ed0b9">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=affective;</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> state=<span class="dv">0</span>; </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">2</span> <span class="dv">3</span>)= bip / entry=start rl type3(lr);</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=affective;</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> state=<span class="dv">0</span>; </span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">2</span> <span class="dv">3</span>)= bip episode / entry=start rl type3(lr);</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a><span class="co">* Episode as categorical;</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> affective2;</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> affective;</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> episode&gt;<span class="dv">10</span> the episode=<span class="dv">10</span>;</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=affective2;</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> state=<span class="dv">0</span>; </span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>    class episode(ref=<span class="st">"1"</span>);</span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">2</span> <span class="dv">3</span>)= bip episode / entry=start rl type3(lr);</span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=affective;</span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> state=<span class="dv">0</span>; </span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">2</span> <span class="dv">3</span>)= bip episode episode*episode / entry=start rl type3(lr);</span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.7" class="level3">
<h3 class="anchored" data-anchor-id="table-3.7">Table 3.7</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.7_0f758696dfdfd2a17d7fc4ade6288a84">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> bip <span class="sc">+</span> <span class="fu">tt</span>(year),</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">subset</span>(affective, state <span class="sc">==</span> <span class="dv">0</span>), <span class="at">ties =</span> <span class="st">"breslow"</span>,</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>         per <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">+</span> t<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">cbind</span>(<span class="at">period1=</span><span class="dv">1</span><span class="sc">*</span>(<span class="dv">66</span><span class="sc">&lt;=</span>per <span class="sc">&amp;</span> per<span class="sc">&lt;</span><span class="dv">71</span>),</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">period2=</span><span class="dv">1</span><span class="sc">*</span>(<span class="dv">71</span><span class="sc">&lt;=</span>per <span class="sc">&amp;</span> per<span class="sc">&lt;</span><span class="dv">76</span>),</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">period3=</span><span class="dv">1</span><span class="sc">*</span>(<span class="dv">76</span><span class="sc">&lt;=</span>per <span class="sc">&amp;</span> per<span class="sc">&lt;</span><span class="dv">81</span>),</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">period4=</span><span class="dv">1</span><span class="sc">*</span>(<span class="dv">81</span><span class="sc">&lt;=</span>per))})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ bip + tt(year), 
    data = subset(affective, state == 0), ties = "breslow", tt = function(x, 
        t, ...) {
        per &lt;- x + 0.5 + t/12
        cbind(period1 = 1 * (66 &lt;= per &amp; per &lt; 71), period2 = 1 * 
            (71 &lt;= per &amp; per &lt; 76), period3 = 1 * (76 &lt;= per &amp; 
            per &lt; 81), period4 = 1 * (81 &lt;= per))
    })

                    coef exp(coef) se(coef)      z        p
bip              0.36123   1.43509  0.09454  3.821 0.000133
tt(year)period1 -0.25060   0.77834  0.20834 -1.203 0.229047
tt(year)period2 -0.17948   0.83570  0.33095 -0.542 0.587596
tt(year)period3 -0.36737   0.69256  0.43858 -0.838 0.402237
tt(year)period4 -1.33241   0.26384  0.55385 -2.406 0.016141

Likelihood ratio test=25.16  on 5 df, p=0.0001299
n= 626, number of events= 542 </code></pre>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.7-sas_e536faaf99981d6c3585e44b86bd0f82">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=affective;</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> state=<span class="dv">0</span>; </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">2</span> <span class="dv">3</span>)= bip period1 period2 period3 period4 / entry=start rl type3(lr);</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    period=<span class="fu">year</span><span class="dv">+0.5</span>+<span class="kw">stop</span>/<span class="dv">12</span>;</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    period1=<span class="dv">0</span>; period2=<span class="dv">0</span>; period3=<span class="dv">0</span>; period4=<span class="dv">0</span>;</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="dv">71</span>&gt;period&gt;=<span class="dv">66</span> <span class="kw">then</span> period1=<span class="dv">1</span>;</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="dv">76</span>&gt;period&gt;=<span class="dv">71</span> <span class="kw">then</span> period2=<span class="dv">1</span>;</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="dv">81</span>&gt;period&gt;=<span class="dv">76</span> <span class="kw">then</span> period3=<span class="dv">1</span>;</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> period&gt;=<span class="dv">81</span> <span class="kw">then</span> period4=<span class="dv">1</span>;</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="leader-cardiovascular-trial-in-type-2-diabetes" class="level2">
<h2 class="anchored" data-anchor-id="leader-cardiovascular-trial-in-type-2-diabetes">LEADER cardiovascular trial in type 2 diabetes</h2>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-44_4bc30d50e9219cbd15ac7099c0c860c1">

</div>
<p>Assume that the LEADER data set is loaded in data set <code>leader_mi</code>.</p>
<section id="table-3.16" class="level3">
<h3 class="anchored" data-anchor-id="table-3.16">Table 3.16</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.16-r_8e69451ee9c819cf9dacbe1ba3b078b4">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model, frailty</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>coxfrail <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> treat <span class="sc">+</span> <span class="fu">frailty</span>(id), </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"breslow"</span>, </span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> leader_mi)</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfrail)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ treat + frailty(id), 
    data = leader_mi, method = "breslow")

  n= 10120, number of events= 780 

            coef    se(coef) se2     Chisq   DF   p     
treat       -0.1773 0.0877   0.07197    4.09    1 0.0430
frailty(id)                          3219.37 3030 0.0084

      exp(coef) exp(-coef) lower .95 upper .95
treat    0.8376      1.194    0.7053    0.9946

Iterations: 7 outer, 28 Newton-Raphson
     Variance of random effect= 5.686665   I-likelihood = -6863.6 
Degrees of freedom for terms=    0.7 3030.1 
Concordance= 0.975  (se = 0.001 )
Likelihood ratio test= 2841  on 3031 df,   p=1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(coxfrail<span class="sc">$</span>fvar[<span class="dv">1</span>]) <span class="co"># frailty SD</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.384874</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PieceWise constant, frailty</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Make cuts </span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>alltimes <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(leader_mi<span class="sc">$</span>stop),<span class="at">length=</span><span class="dv">99</span>)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>FunctionIntervalM <span class="ot">&lt;-</span> <span class="cf">function</span>(a,b) {</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(a), <span class="at">to =</span> <span class="fu">max</span>(a), <span class="at">by =</span> (<span class="fu">max</span>(a)<span class="sc">-</span><span class="fu">min</span>(a))<span class="sc">/</span>b)</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>cuts <span class="ot">&lt;-</span> <span class="fu">FunctionIntervalM</span>(<span class="at">a =</span> alltimes, <span class="at">b =</span> <span class="dv">5</span>)</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a><span class="co"># AG model, piece-wise constant hazards </span></span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>cut_data <span class="ot">&lt;-</span> <span class="fu">survSplit</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> ., </span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>                      leader_mi,</span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cut =</span> cuts[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">episode =</span> <span class="st">"timegroup"</span>)</span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>pwch_frail <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, event) <span class="sc">~</span> </span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a>                    treat <span class="sc">+</span> <span class="fu">strata</span>(timegroup) <span class="sc">+</span> <span class="fu">frailty</span>(id), </span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> cut_data)</span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pwch_frail)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, event) ~ treat + strata(timegroup) + 
    frailty(id), data = cut_data)

  n= 39070, number of events= 780 

            coef    se(coef) se2     Chisq   DF   p     
treat       -0.1773 0.08772  0.07197    4.09    1 0.0430
frailty(id)                          3222.23 3033 0.0085

      exp(coef) exp(-coef) lower .95 upper .95
treat    0.8375      1.194    0.7052    0.9946

Iterations: 7 outer, 28 Newton-Raphson
     Variance of random effect= 5.694404   I-likelihood = -6863.4 
Degrees of freedom for terms=    0.7 3033.3 
Concordance= 0.975  (se = 0.001 )
Likelihood ratio test= 2843  on 3034 df,   p=1</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(pwch_frail<span class="sc">$</span>fvar[<span class="dv">1</span>]) <span class="co"># frailty SD</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.386496</code></pre>
</div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<p>Only Cox-type model.</p>
<div class="cell" data-hash="Ch3_cache/html/table-3.16-sas_5f6fa955c621dfeb15a91afaa1afbe40">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a># very slow!</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=leader_mi covs(aggregate);</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  class id;</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">model</span> <span class="kw">stop</span>*status(<span class="dv">0</span> <span class="dv">2</span>) = treat / entry=start; </span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  random id / dist=<span class="fu">gamma</span>;</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>  title1 <span class="st">'Frailty model for recurrent event data'</span>;</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.17" class="level3">
<h3 class="anchored" data-anchor-id="table-3.17">Table 3.17</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false">SA-NA</a></li></ul>
<div class="tab-content">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.17-r_37ef4f1245334bb4cf3bcd38d85f16a2">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint frailty model, piece-wise constant hazards</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(frailtypack)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>leader_mi<span class="sc">$</span>death <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(leader_mi<span class="sc">$</span>status <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>jointfrail_pc_eq_mi <span class="ot">&lt;-</span> <span class="fu">frailtyPenal</span>(</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="fu">cluster</span>(id)<span class="sc">+</span> treat <span class="sc">+</span> <span class="fu">terminal</span>(death),</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula.terminalEvent =</span> <span class="sc">~</span> treat,<span class="at">data =</span> leader_mi, </span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">hazard =</span> <span class="st">"Piecewise-equi"</span>, <span class="at">nb.int =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="at">recurrentAG =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Be patient. The program is computing ... 
The program took 296.47 seconds </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>jointfrail_pc_eq_mi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
frailtyPenal(formula = Surv(start, stop, status == 1) ~ cluster(id) + 
    treat + terminal(death), formula.terminalEvent = ~treat, 
    data = leader_mi, recurrentAG = TRUE, hazard = "Piecewise-equi", 
    nb.int = c(5, 5))


  Joint gamma frailty model for recurrent and a terminal event processes 
  using a Parametrical approach for the hazard function 

Recurrences:
------------- 
          coef exp(coef) SE coef (H)        z        p
treat -0.18591  0.830349   0.0680109 -2.73353 0.006266

Terminal event:
---------------- 
           coef exp(coef) SE coef (H)        z         p
treat -0.211397  0.809452   0.0784837 -2.69352 0.0070702

 Frailty parameters: 
   theta (variance of Frailties, w): 0.895749 (SE (H): 0.0306499 ) p = &lt; 1e-16 
   alpha (w^alpha for terminal event): 1.85978 (SE (H): 0.115069 ) p = &lt; 1e-16 
 
   marginal log-likelihood = -16965
   Convergence criteria: 
   parameters = 3.07e-08 likelihood = 0.000848 gradient = 2.12e-07 

   AIC = Aikaike information Criterion     = 1.67777 

The expression of the Aikaike Criterion is: 
        'AIC = (1/n)[np - l(.)]' 

   n observations= 10120  n subjects= 9340
   n recurrent events= 780
   n terminal events= 828
   n censored events= 9340
   number of iterations:  37 
   Number of nodes for the Gauss-Laguerre quadrature:  32 
   Exact number of time intervals used:  5 
   Exact number of time intervals used:  5 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(jointfrail_pc_eq_mi<span class="sc">$</span>theta) <span class="co"># Frailty SD</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9464401</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jointfrail_pc_eq_mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recurrences:
------------- 
           hr     95%     C.I. 
 treat   0.83 (   0.73 -   0.95 ) 

Terminal event:
--------------- 
           hr     95%     C.I. 
 treat   0.81 (   0.69 -   0.94 ) </code></pre>
</div>
</div>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">

</div>
</div>
</div>
</section>
</section>
<section id="bone-marrow-transplantation-in-acute-leukemia" class="level2">
<h2 class="anchored" data-anchor-id="bone-marrow-transplantation-in-acute-leukemia">Bone marrow transplantation in acute leukemia</h2>
<section id="read-data-5" class="level3">
<h3 class="anchored" data-anchor-id="read-data-5">Read data</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-25-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<div class="cell" data-hash="Ch3_cache/html/read-bmt-r_c7fc3d04bfcdb0d443bb6067c7a1c8c5">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>bmt <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/bmt.csv"</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>intxsurv<span class="ot">&lt;-</span> bmt<span class="sc">$</span>timedeath</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>intxrel <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bmt<span class="sc">$</span>rel <span class="sc">==</span> <span class="dv">1</span>, bmt<span class="sc">$</span>timerel, bmt<span class="sc">$</span>timedeath)</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>trm     <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bmt<span class="sc">$</span>rel <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> bmt<span class="sc">$</span>death <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>tgvhd   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bmt<span class="sc">$</span>gvhd <span class="sc">==</span> <span class="dv">1</span>, bmt<span class="sc">$</span>timegvhd, bmt<span class="sc">$</span>intxrel)</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>tanc500 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bmt<span class="sc">$</span>anc500 <span class="sc">==</span> <span class="dv">1</span>, bmt<span class="sc">$</span>timeanc500, bmt<span class="sc">$</span>intxrel)</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>state0  <span class="ot">&lt;-</span> bmt<span class="sc">$</span>rel <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>bmt<span class="sc">$</span>trm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-25-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">
<div class="cell" data-hash="Ch3_cache/html/read-bmt-sas_86fcf067f479e04ec29445adc8ad7111">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=bmt</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">"data/bmt.csv"</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> bmt; </span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> bmt;</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>    intxsurv=timedeath; dead=death;</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> rel=<span class="dv">1</span> <span class="kw">then</span> intxrel=timerel; <span class="kw">if</span> rel=<span class="dv">0</span> <span class="kw">then</span> intxrel=timedeath;</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>    trm=<span class="dv">0</span>; <span class="kw">if</span> rel=<span class="dv">0</span> <span class="kw">and</span> death=<span class="dv">1</span> <span class="kw">then</span> trm=<span class="dv">1</span>;</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>    state0=rel+<span class="dv">2</span>*trm;</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> gvhd=<span class="dv">1</span> <span class="kw">then</span> tgvhd=timegvhd; <span class="kw">if</span> gvhd=<span class="dv">0</span> <span class="kw">then</span> tgvhd=intxrel;</span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.5" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.5">Figure 3.5</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-26-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-1" role="tab" aria-controls="tabset-26-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-2" role="tab" aria-controls="tabset-26-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-26-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-26-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.5-r_44908f0a65b26ef57dd5264eb9adf2dc">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General theme</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Model fit and make plot data</span></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(tgvhd, gvhd <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> bmt)</span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>pdata1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit1<span class="sc">$</span>cumhaz, </span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">time =</span> fit1<span class="sc">$</span>time) </span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.5</span></span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">data =</span> pdata1) <span class="sc">+</span> </span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since bone marrow transplantation (months)"</span>) <span class="sc">+</span> </span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative GvHD hazard"</span>) <span class="sc">+</span> </span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">156</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">156</span>, <span class="at">by =</span> <span class="dv">12</span>)) <span class="sc">+</span> </span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb179-22"><a href="#cb179-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.8</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb179-23"><a href="#cb179-23" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb179-24"><a href="#cb179-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-25"><a href="#cb179-25" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.5-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-26-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-26-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.5-sas_f9b88691acc55c24ea0d7b31192dd966">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> tgvhd*gvhd(<span class="dv">0</span>)=;</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>    baseline out=alfagvh cumhaz=naagvh;</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=alfagvh;</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>    plot naagvh*tgvhd/haxis=axis1 vaxis=axis2;</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">156</span> <span class="kw">by</span> <span class="dv">12</span> minor=none</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>=(<span class="st">'Time since bone marrow transplantation (months)'</span>);</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.8</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative GvHD hazard'</span>);</span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=blue;</span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.6" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.6">Figure 3.6</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-27-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-1" role="tab" aria-controls="tabset-27-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-2" role="tab" aria-controls="tabset-27-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-27-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-27-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.6-r_690ffaf1fd934f5eef825cec017480fb">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reformatting</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>nyreltime <span class="ot">&lt;-</span> <span class="fu">with</span>(bmt, <span class="fu">ifelse</span>(tgvhd <span class="sc">&lt;</span> intxrel, tgvhd, intxrel))</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>nyrel <span class="ot">&lt;-</span> <span class="fu">with</span>(bmt, <span class="fu">ifelse</span>(tgvhd <span class="sc">&lt;</span> intxrel, <span class="dv">0</span>, rel))</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>nytrm <span class="ot">&lt;-</span> <span class="fu">with</span>(bmt, <span class="fu">ifelse</span>(tgvhd <span class="sc">&lt;</span> intxrel, <span class="dv">0</span>, trm))</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative relapse rate without GvHD </span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>fit11 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(nyreltime, nyrel <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> bmt)</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative relapse rate after GvHD</span></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>fit12 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(tgvhd, intxrel, rel <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> <span class="fu">subset</span>(bmt, gvhd <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> tgvhd <span class="sc">&lt;</span> intxrel))</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect plot data</span></span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>pdata11 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit11<span class="sc">$</span>cumhaz, <span class="at">time =</span> fit11<span class="sc">$</span>time) </span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>pdata12 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit12<span class="sc">$</span>cumhaz, <span class="at">time =</span> fit12<span class="sc">$</span>time) </span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.6</span></span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">data =</span> pdata11) <span class="sc">+</span> </span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">data =</span> pdata12, </span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since bone marrow transplantation (months)"</span>) <span class="sc">+</span> </span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative relapse hazard"</span>) <span class="sc">+</span> </span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">156</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">156</span>, <span class="at">by =</span> <span class="dv">12</span>)) <span class="sc">+</span> </span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.6-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-27-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.6-sas_9876cbdf078268bb0658a216d5d1e753">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Reformatting;</span> </span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> bmt; </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> bmt; <span class="co">/* Censor at GvHD */</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> tgvhd&lt;intxrel <span class="kw">then do</span>;</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>    nyreltime=tgvhd; nyrel=<span class="dv">0</span>; nytrm=<span class="dv">0</span><span class="kw">; end</span>;</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> tgvhd=intxrel <span class="kw">then do</span>;</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>    nyreltime=intxrel; nyrel=rel; nytrm=trm<span class="kw">; end</span>;</span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="co">* Cumulative relapse rate without gvhd;</span> </span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> nyreltime*nyrel(<span class="dv">0</span>)=;</span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>    baseline out=alfa0rel cumhaz=naa0rel;</span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="co">* Cumulative relapse rate after gvhd;</span> </span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> gvhd=<span class="dv">1</span>;</span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*rel(<span class="dv">0</span>)=/entry=tgvhd;</span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>    baseline out=alfagvhrel cumhaz=naagvhrel;</span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfa0rel; </span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> alfa0rel; </span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a>    reltime=nyreltime; </span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfagvhrel; </span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> alfagvhrel; </span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a>    reltime=intxrel; </span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> rel; </span>
<span id="cb182-31"><a href="#cb182-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">merge</span> alfa0rel alfagvhrel; </span>
<span id="cb182-32"><a href="#cb182-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> reltime; </span>
<span id="cb182-33"><a href="#cb182-33" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb182-34"><a href="#cb182-34" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> relrev; </span>
<span id="cb182-35"><a href="#cb182-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> rel;</span>
<span id="cb182-36"><a href="#cb182-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> reltime;</span>
<span id="cb182-37"><a href="#cb182-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">retain</span> last1 last2;</span>
<span id="cb182-38"><a href="#cb182-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> naa0rel=. <span class="kw">then</span> a02=last1; <span class="kw">if</span> naa0rel ne . <span class="kw">then</span> a02=naa0rel; </span>
<span id="cb182-39"><a href="#cb182-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> naagvhrel=. <span class="kw">then</span> a13=last2; <span class="kw">if</span> naagvhrel ne . <span class="kw">then</span> a13=naagvhrel;</span>
<span id="cb182-40"><a href="#cb182-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span>;</span>
<span id="cb182-41"><a href="#cb182-41" aria-hidden="true" tabindex="-1"></a>    last1=a02; last2=a13; </span>
<span id="cb182-42"><a href="#cb182-42" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb182-43"><a href="#cb182-43" aria-hidden="true" tabindex="-1"></a>legend1 <span class="kw">label</span>=none;</span>
<span id="cb182-44"><a href="#cb182-44" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=relrev;</span>
<span id="cb182-45"><a href="#cb182-45" aria-hidden="true" tabindex="-1"></a>    plot a02*reltime a13*reltime/haxis=axis1 vaxis=axis2 overlay legend=legend1;</span>
<span id="cb182-46"><a href="#cb182-46" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">156</span> <span class="kw">by</span> <span class="dv">12</span> minor=none</span>
<span id="cb182-47"><a href="#cb182-47" aria-hidden="true" tabindex="-1"></a>        <span class="kw">label</span>=(<span class="st">'Time since bone marrow transplantation (months)'</span>);</span>
<span id="cb182-48"><a href="#cb182-48" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.2</span> <span class="kw">by</span> <span class="dv">0.1</span> minor=none</span>
<span id="cb182-49"><a href="#cb182-49" aria-hidden="true" tabindex="-1"></a>        <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative relapse hazard'</span>);</span>
<span id="cb182-50"><a href="#cb182-50" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=red;</span>
<span id="cb182-51"><a href="#cb182-51" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=stepjl c=blue;</span>
<span id="cb182-52"><a href="#cb182-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> a02=<span class="st">"No GvHD"</span>;</span>
<span id="cb182-53"><a href="#cb182-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> a13=<span class="st">"After GvHD"</span>;</span>
<span id="cb182-54"><a href="#cb182-54" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb182-55"><a href="#cb182-55" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.7" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.7">Figure 3.7</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-28-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-1" role="tab" aria-controls="tabset-28-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-2" role="tab" aria-controls="tabset-28-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-28-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-28-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.7-r_11b1688ab420f6b0cbd716d3588c3fe3">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to get the cumulative hazard estimates at the same time points</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All times</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>all_t <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">unique</span>(pdata11<span class="sc">$</span>time), <span class="fu">unique</span>(pdata12<span class="sc">$</span>time))))</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate each step function at these time points </span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>step11 <span class="ot">&lt;-</span> <span class="fu">stepfun</span>(<span class="at">x =</span> pdata11<span class="sc">$</span>time, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, pdata11<span class="sc">$</span>cumhaz))</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>step12 <span class="ot">&lt;-</span> <span class="fu">stepfun</span>(<span class="at">x =</span> pdata12<span class="sc">$</span>time, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, pdata12<span class="sc">$</span>cumhaz))</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>pdata11_a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> all_t, </span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cumhaz =</span> <span class="fu">step11</span>(all_t))</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>pdata12_a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> all_t, </span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cumhaz =</span> <span class="fu">step12</span>(all_t))</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data</span></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>pdata_b <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz1 =</span> pdata11_a<span class="sc">$</span>cumhaz, </span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cumhaz2 =</span> pdata12_a<span class="sc">$</span>cumhaz, </span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> all_t)</span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Make zeros print as "0" always in plots</span></span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a>prettyZero <span class="ot">&lt;-</span> <span class="cf">function</span>(l){</span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>  max.decimals <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">nchar</span>(<span class="fu">str_extract</span>(l, <span class="st">"</span><span class="sc">\\</span><span class="st">.[0-9]+"</span>)), <span class="at">na.rm =</span> T)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>  lnew <span class="ot">=</span> <span class="fu">formatC</span>(l, <span class="at">replace.zero =</span> T, <span class="at">zero.print =</span> <span class="st">"0"</span>,</span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">digits =</span> max.decimals, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">preserve.width=</span>T)</span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lnew)</span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.7</span></span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cumhaz1, <span class="at">y =</span> cumhaz2), <span class="at">data =</span> pdata_b) <span class="sc">+</span> </span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="fl">0.858</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, </span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cumulative relapse hazard: no GvHD"</span>) <span class="sc">+</span> </span>
<span id="cb183-31"><a href="#cb183-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative relapse hazard: GvHD"</span>) <span class="sc">+</span> </span>
<span id="cb183-32"><a href="#cb183-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb183-33"><a href="#cb183-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="at">by =</span> <span class="fl">0.05</span>),</span>
<span id="cb183-34"><a href="#cb183-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> prettyZero) <span class="sc">+</span> </span>
<span id="cb183-35"><a href="#cb183-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb183-36"><a href="#cb183-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="at">by =</span> <span class="fl">0.05</span>),</span>
<span id="cb183-37"><a href="#cb183-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> prettyZero) <span class="sc">+</span></span>
<span id="cb183-38"><a href="#cb183-38" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb183-39"><a href="#cb183-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-40"><a href="#cb183-40" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.7-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-28-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.7-sas_d0f8b5591697a91a5a6c4b68585d4042">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> relrev; </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> relrev;</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>    line=<span class="dv">0.858</span>*a02;</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=relrev;</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>    plot a13*a02 line*a02/haxis=axis1 vaxis=axis2 overlay;</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.2</span> <span class="kw">by</span> <span class="dv">0.05</span> minor=none </span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>=(<span class="st">'Cumulative relapse hazard: no GvHD'</span>);</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.2</span> <span class="kw">by</span> <span class="dv">0.05</span> minor=none </span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative relapse hazard: GvHD'</span>);</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=red;</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=rl c=blue;</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-102-gvhd-as-time-dependent-covariate" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-102-gvhd-as-time-dependent-covariate">In-text, p.&nbsp;102: GvHD as time-dependent covariate</h3>
<section id="relapse" class="level4">
<h4 class="anchored" data-anchor-id="relapse">Relapse</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-29-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-1" role="tab" aria-controls="tabset-29-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-2" role="tab" aria-controls="tabset-29-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-29-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-29-1-tab">
<div class="cell" data-hash="Ch3_cache/html/in-text-tGvHD-relapse-r_44d5e4ada84d7f69f1e2e452b6741f7b">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel,rel<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">~</span> <span class="fu">tt</span>(tgvhd), <span class="at">data =</span> bmt, <span class="at">ties=</span><span class="st">"breslow"</span>,</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">tdcgvhd=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>      }),<span class="at">exp=</span>T, <span class="at">conf.int =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  term      estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 tt(tgvhd)    0.858     0.132     -1.15   0.248    0.663      1.11</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test ph</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel,rel<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">~</span> <span class="fu">tt</span>(tgvhd), <span class="at">data =</span> bmt, <span class="at">ties=</span><span class="st">"breslow"</span>,</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">tdc=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>),<span class="at">tdc_logt=</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span><span class="fu">log</span>(t<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>      }),<span class="at">exp=</span>T, <span class="at">conf.int =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term              estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 tt(tgvhd)tdc         0.599     0.409    -1.25    0.210    0.268      1.34
2 tt(tgvhd)tdc_logt    1.18      0.175     0.936   0.349    0.836      1.66</code></pre>
</div>
</div>
</div>
<div id="tabset-29-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-29-2-tab">
<div class="cell" data-hash="Ch3_cache/html/in-text-tGvHD-relapse-sas_a88fc2d5e1e75b2c869125eb6a5afac0">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*rel(<span class="dv">0</span>)= ttgvhd / rl type3(lr);</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>    ttgvhd=(intxrel-tgvhd)&gt;<span class="dv">0</span>;</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="co">* test ph;</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*rel(<span class="dv">0</span>)= ttgvhd ttgvhdlogt / rl type3(lr);</span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>    ttgvhd=(intxrel-tgvhd)&gt;<span class="dv">0</span>;</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>    ttgvhdlogt=ttgvhd*<span class="fu">log</span>(intxrel+<span class="dv">1</span>);</span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="death-in-remission" class="level4">
<h4 class="anchored" data-anchor-id="death-in-remission">Death in remission</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-30-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-1" role="tab" aria-controls="tabset-30-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-2" role="tab" aria-controls="tabset-30-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-30-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-30-1-tab">
<div class="cell" data-hash="Ch3_cache/html/in-text-tGvHD-death-r_855d5d9c91d1610eb0c61ab3425e9e3f">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel,trm<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">~</span> <span class="fu">tt</span>(tgvhd), <span class="at">data =</span> bmt, <span class="at">ties=</span><span class="st">"breslow"</span>,</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">tdcgvhd=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>      }), <span class="at">exp=</span>T, <span class="at">conf.int =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  term      estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 tt(tgvhd)     3.11    0.0964      11.8 4.88e-32     2.58      3.76</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test ph</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel,trm<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">~</span> <span class="fu">tt</span>(tgvhd), <span class="at">data =</span> bmt, <span class="at">ties=</span><span class="st">"breslow"</span>,</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">tdc=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>),<span class="at">tdc_logt=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span><span class="fu">log</span>(t<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>      }), <span class="at">exp=</span>T, <span class="at">conf.int =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term              estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 tt(tgvhd)tdc         4.10     0.197       7.18 6.99e-13    2.79       6.03
2 tt(tgvhd)tdc_logt    0.872    0.0851     -1.61 1.07e- 1    0.738      1.03</code></pre>
</div>
</div>
</div>
<div id="tabset-30-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-2-tab">
<div class="cell" data-hash="Ch3_cache/html/in-text-tGvHD-death-sas_e0796820d563e13909bfaf48e94fee77">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*trm(<span class="dv">0</span>)= ttgvhd / rl type3(lr);</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>    ttgvhd=(intxrel-tgvhd)&gt;<span class="dv">0</span>;</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="co">* test ph;</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*trm(<span class="dv">0</span>)= ttgvhd ttgvhdlogt / rl type3(lr);</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>    ttgvhd=(intxrel-tgvhd)&gt;<span class="dv">0</span>;</span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>    ttgvhdlogt=ttgvhd*<span class="fu">log</span>(intxrel+<span class="dv">1</span>);</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="figure-3.8" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.8">Figure 3.8</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-31-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-1" role="tab" aria-controls="tabset-31-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-31-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-2" role="tab" aria-controls="tabset-31-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-31-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-31-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.8-r_b9e5b049f249bbd4053fb31ccb9846cb">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative death rate without GvHD </span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>fit11 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(nyreltime, nytrm <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> bmt)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative death rate with GvHD</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>fit12 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(tgvhd, intxrel, trm <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> <span class="fu">subset</span>(bmt, gvhd <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> tgvhd <span class="sc">&lt;</span> intxrel))</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect plot data</span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>pdata11 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit11<span class="sc">$</span>cumhaz, </span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> fit11<span class="sc">$</span>time) </span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a>pdata12 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit12<span class="sc">$</span>cumhaz, </span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> fit12<span class="sc">$</span>time) </span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to get the cumulative hazard estimates at the same time points</span></span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a><span class="co"># All times</span></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a>all_t <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">unique</span>(pdata11<span class="sc">$</span>time), <span class="fu">unique</span>(pdata12<span class="sc">$</span>time))))</span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate each step function at these time points </span></span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a>step11 <span class="ot">&lt;-</span> <span class="fu">stepfun</span>(<span class="at">x =</span> pdata11<span class="sc">$</span>time, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, pdata11<span class="sc">$</span>cumhaz))</span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a>step12 <span class="ot">&lt;-</span> <span class="fu">stepfun</span>(<span class="at">x =</span> pdata12<span class="sc">$</span>time, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, pdata12<span class="sc">$</span>cumhaz))</span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a>pdata11_a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> all_t, </span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cumhaz =</span> <span class="fu">step11</span>(all_t))</span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a>pdata12_a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> all_t, </span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cumhaz =</span> <span class="fu">step12</span>(all_t))</span>
<span id="cb195-28"><a href="#cb195-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-29"><a href="#cb195-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect data</span></span>
<span id="cb195-30"><a href="#cb195-30" aria-hidden="true" tabindex="-1"></a>pdata_b <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz1 =</span> pdata11_a<span class="sc">$</span>cumhaz, </span>
<span id="cb195-31"><a href="#cb195-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cumhaz2 =</span> pdata12_a<span class="sc">$</span>cumhaz, </span>
<span id="cb195-32"><a href="#cb195-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> all_t)</span>
<span id="cb195-33"><a href="#cb195-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-34"><a href="#cb195-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.8</span></span>
<span id="cb195-35"><a href="#cb195-35" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cumhaz1, <span class="at">y =</span> cumhaz2), <span class="at">data =</span> pdata_b) <span class="sc">+</span> </span>
<span id="cb195-36"><a href="#cb195-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb195-37"><a href="#cb195-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="fl">3.113</span>), </span>
<span id="cb195-38"><a href="#cb195-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb195-39"><a href="#cb195-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cumulative death hazard: no GvHD"</span>) <span class="sc">+</span> </span>
<span id="cb195-40"><a href="#cb195-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative death hazard: GvHD"</span>) <span class="sc">+</span> </span>
<span id="cb195-41"><a href="#cb195-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb195-42"><a href="#cb195-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="at">by =</span> <span class="fl">0.05</span>),</span>
<span id="cb195-43"><a href="#cb195-43" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> prettyZero) <span class="sc">+</span> </span>
<span id="cb195-44"><a href="#cb195-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb195-45"><a href="#cb195-45" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb195-46"><a href="#cb195-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> prettyZero) <span class="sc">+</span></span>
<span id="cb195-47"><a href="#cb195-47" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb195-48"><a href="#cb195-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-49"><a href="#cb195-49" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.8-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-31-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-31-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.8-sas_36969f2ebbf6a96affcaf8ac85c0c0b1">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Cumulative death rate without gvhd;</span> </span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt; </span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> nyreltime*nytrm(<span class="dv">0</span>)=;</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>    baseline out=alfa0dead cumhaz=naa0dead;</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="co">* Cumulative death rate with gvhd;</span> </span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> gvhd=<span class="dv">1</span>;</span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*trm(<span class="dv">0</span>)=/entry=tgvhd;</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>    baseline out=alfagvhdead cumhaz=naagvhdead;</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a><span class="co">* Book-keeping for plot;</span></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfa0dead; </span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> alfa0dead; </span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>    deadtime=nyreltime; </span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfagvhdead; </span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> alfagvhdead; </span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>    deadtime=intxrel; </span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> dead; </span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">merge</span> alfa0dead alfagvhdead; </span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> deadtime; </span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> deadrev; </span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> dead;</span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> deadtime;</span>
<span id="cb196-28"><a href="#cb196-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">retain</span> last1 last2;</span>
<span id="cb196-29"><a href="#cb196-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> naa0dead=. <span class="kw">then</span> a02=last1; <span class="kw">if</span> naa0dead ne . <span class="kw">then</span> a02=naa0dead; </span>
<span id="cb196-30"><a href="#cb196-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> naagvhdead=. <span class="kw">then</span> a13=last2; <span class="kw">if</span> naagvhdead ne . <span class="kw">then</span> a13=naagvhdead;</span>
<span id="cb196-31"><a href="#cb196-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span>;</span>
<span id="cb196-32"><a href="#cb196-32" aria-hidden="true" tabindex="-1"></a>    last1=a02; last2=a13; </span>
<span id="cb196-33"><a href="#cb196-33" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb196-34"><a href="#cb196-34" aria-hidden="true" tabindex="-1"></a><span class="co">* Add coefficient;</span> </span>
<span id="cb196-35"><a href="#cb196-35" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> deadrev; </span>
<span id="cb196-36"><a href="#cb196-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> deadrev;</span>
<span id="cb196-37"><a href="#cb196-37" aria-hidden="true" tabindex="-1"></a>    line=<span class="dv">3.113</span>*a02;</span>
<span id="cb196-38"><a href="#cb196-38" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb196-39"><a href="#cb196-39" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=deadrev;</span>
<span id="cb196-40"><a href="#cb196-40" aria-hidden="true" tabindex="-1"></a>    plot a13*a02 line*a02/haxis=axis1 vaxis=axis2 overlay;</span>
<span id="cb196-41"><a href="#cb196-41" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.2</span> <span class="kw">by</span> <span class="dv">0.05</span> minor=none</span>
<span id="cb196-42"><a href="#cb196-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>=(<span class="st">'Cumulative death hazard: no GvHD'</span>);</span>
<span id="cb196-43"><a href="#cb196-43" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">1</span> <span class="kw">by</span> <span class="dv">0.2</span> minor=none</span>
<span id="cb196-44"><a href="#cb196-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative death hazard: GvHD'</span>);</span>
<span id="cb196-45"><a href="#cb196-45" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=red;</span>
<span id="cb196-46"><a href="#cb196-46" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=rl c=blue;;</span>
<span id="cb196-47"><a href="#cb196-47" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb196-48"><a href="#cb196-48" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.4" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.4">Figure 3.4</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-32-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-1" role="tab" aria-controls="tabset-32-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-32-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-2" role="tab" aria-controls="tabset-32-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-32-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-32-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.4-r_73f39d03045d2e87e31ecb9b15a35c0e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative death hazards wrt relapse; </span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative death rate no relapse or GvHD</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>fit11 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(intxrel, trm <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> bmt)</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative death rate after relapse</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>bmt<span class="sc">$</span>intxsurv <span class="ot">&lt;-</span> <span class="fu">with</span>(bmt, <span class="fu">ifelse</span>(intxrel <span class="sc">==</span> intxsurv <span class="sc">&amp;</span> rel <span class="sc">==</span> <span class="dv">1</span>, intxsurv <span class="sc">+</span> <span class="fl">0.01</span>, intxsurv))</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>fit12 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(intxrel, intxsurv, death <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> <span class="fu">subset</span>(bmt, rel <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative death rate after GvHD</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>fit13 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(tgvhd, intxrel, trm <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> <span class="fu">subset</span>(bmt, gvhd <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect plot data</span></span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>pdata11 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit11<span class="sc">$</span>cumhaz, <span class="at">time =</span> fit11<span class="sc">$</span>time) </span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>pdata12 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit12<span class="sc">$</span>cumhaz, <span class="at">time =</span> fit12<span class="sc">$</span>time) </span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>pdata13 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> fit13<span class="sc">$</span>cumhaz, <span class="at">time =</span> fit13<span class="sc">$</span>time) </span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(pdata12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      cumhaz   time
220 7.557091  84.70
221 7.557091  85.43
222 7.557091  96.41
223 8.057091  99.80
224 8.057091  99.87
225 8.057091 105.10</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.4</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">data =</span> pdata11) <span class="sc">+</span> </span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">data =</span> pdata12, </span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz), <span class="at">data =</span> pdata13, </span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span> </span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since bone marrow transplantation (months)"</span>) <span class="sc">+</span> </span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard of death"</span>) <span class="sc">+</span> </span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">156</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">156</span>, <span class="at">by =</span> <span class="dv">12</span>)) <span class="sc">+</span> </span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>  theme_general</span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.4-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-32-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-32-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.4-sas_255160b903b00cdc4ab955e862b1edb1">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Cumulative death hazards wrt relapse ;</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt; </span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*trm(<span class="dv">0</span>)=;</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    baseline out=alfa02 cumhaz=naa02;</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> bmt; </span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> bmt; </span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> intxrel eq intxsurv <span class="kw">and</span> rel eq <span class="dv">1</span> <span class="kw">then</span> intxsurv = intxsurv + <span class="dv">0.01</span>; </span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> rel=<span class="dv">1</span>;</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxsurv*dead(<span class="dv">0</span>)=/entry=intxrel;</span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>    baseline out=alfa13 cumhaz=naa13;</span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a><span class="co">* Book-keeping;</span> </span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfa02; </span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> alfa02; </span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>    deadtime=intxrel; </span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfa13; </span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> alfa13; </span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>    deadtime=intxsurv; </span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfadead; </span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">merge</span> alfa02 alfa13; </span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> deadtime; </span>
<span id="cb200-28"><a href="#cb200-28" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb200-29"><a href="#cb200-29" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfarev; <span class="kw">set</span> alfadead;</span>
<span id="cb200-30"><a href="#cb200-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> deadtime;</span>
<span id="cb200-31"><a href="#cb200-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">retain</span> last1 last2;</span>
<span id="cb200-32"><a href="#cb200-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> naa02=. <span class="kw">then</span> a0rel=last1; <span class="kw">if</span> naa02 ne . <span class="kw">then</span> a0rel=naa02; </span>
<span id="cb200-33"><a href="#cb200-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> naa13=. <span class="kw">then</span> arel=last2; <span class="kw">if</span> naa13 ne . <span class="kw">then</span> arel=naa13;</span>
<span id="cb200-34"><a href="#cb200-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span>;</span>
<span id="cb200-35"><a href="#cb200-35" aria-hidden="true" tabindex="-1"></a>    last1=a0rel; last2=arel; </span>
<span id="cb200-36"><a href="#cb200-36" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb200-37"><a href="#cb200-37" aria-hidden="true" tabindex="-1"></a><span class="co">* 3 mortality rates simultaneously;</span></span>
<span id="cb200-38"><a href="#cb200-38" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> alfa3dead; </span>
<span id="cb200-39"><a href="#cb200-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">merge</span> deadrev alfarev; </span>
<span id="cb200-40"><a href="#cb200-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> deadtime; </span>
<span id="cb200-41"><a href="#cb200-41" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb200-42"><a href="#cb200-42" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=alfa3dead;</span>
<span id="cb200-43"><a href="#cb200-43" aria-hidden="true" tabindex="-1"></a>    plot arel*deadtime a02*deadtime a13*deadtime</span>
<span id="cb200-44"><a href="#cb200-44" aria-hidden="true" tabindex="-1"></a>                     / overlay haxis=axis1 vaxis=axis2 legend=legend1;</span>
<span id="cb200-45"><a href="#cb200-45" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">120</span> <span class="kw">by</span> <span class="dv">10</span> minor=none</span>
<span id="cb200-46"><a href="#cb200-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">label</span>=(<span class="st">'Time since bone marrow transplantation (months)'</span>);</span>
<span id="cb200-47"><a href="#cb200-47" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">9</span> <span class="kw">by</span> <span class="dv">1</span> minor=none</span>
<span id="cb200-48"><a href="#cb200-48" aria-hidden="true" tabindex="-1"></a>        <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative hazard of death'</span>);</span>
<span id="cb200-49"><a href="#cb200-49" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=blue;</span>
<span id="cb200-50"><a href="#cb200-50" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=stepjl c=red;</span>
<span id="cb200-51"><a href="#cb200-51" aria-hidden="true" tabindex="-1"></a>    symbol3  v=none i=stepjl c=black;</span>
<span id="cb200-52"><a href="#cb200-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> arel=<span class="st">"After relapse"</span>;</span>
<span id="cb200-53"><a href="#cb200-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> a02=<span class="st">"No relapse and no GvHD"</span>;</span>
<span id="cb200-54"><a href="#cb200-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> a13=<span class="st">"After GvHD"</span>;</span>
<span id="cb200-55"><a href="#cb200-55" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb200-56"><a href="#cb200-56" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.12" class="level3">
<h3 class="anchored" data-anchor-id="table-3.12">Table 3.12</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-33-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-1" role="tab" aria-controls="tabset-33-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-33-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-2" role="tab" aria-controls="tabset-33-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-33-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-33-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.12-r_ffe7c72f5196a32047eaa1ac6f377523">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relapse</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel,rel<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">~</span> <span class="fu">tt</span>(tgvhd) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> bmonly <span class="sc">+</span> all,</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> bmt, <span class="at">ties=</span><span class="st">"breslow"</span>,</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">tdcgvhd=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>      })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(intxrel, rel != 0) ~ tt(tgvhd) + I(age/10) + 
    bmonly + all, data = bmt, ties = "breslow", tt = function(x, 
    t, ...) {
    dt &lt;- t - x
    cbind(tdcgvhd = 1 * (dt &gt; 0))
})

              coef exp(coef) se(coef)      z        p
tt(tgvhd) -0.18363   0.83225  0.13370 -1.373    0.170
I(age/10) -0.03973   0.96105  0.04450 -0.893    0.372
bmonly    -0.12543   0.88211  0.13504 -0.929    0.353
all        0.56273   1.75546  0.12965  4.340 1.42e-05

Likelihood ratio test=22.52  on 4 df, p=0.0001578
n= 2009, number of events= 259 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel,rel<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">~</span>  <span class="fu">tt</span>(tgvhd) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> bmonly <span class="sc">+</span> all <span class="sc">+</span> <span class="fu">tt</span>(tanc500),</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> bmt, <span class="at">ties=</span><span class="st">"breslow"</span>,</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">tdcgvhd=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>      })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(intxrel, rel != 0) ~ tt(tgvhd) + I(age/10) + 
    bmonly + all + tt(tanc500), data = bmt, ties = "breslow", 
    tt = function(x, t, ...) {
        dt &lt;- t - x
        cbind(tdcgvhd = 1 * (dt &gt; 0))
    })

                coef exp(coef) se(coef)      z        p
tt(tgvhd)   -0.18830   0.82837  0.13374 -1.408   0.1592
I(age/10)   -0.03934   0.96143  0.04452 -0.884   0.3770
bmonly      -0.12979   0.87828  0.13515 -0.960   0.3369
all          0.56216   1.75445  0.12968  4.335 1.46e-05
tt(tanc500) -2.13768   0.11793  1.07729 -1.984   0.0472

Likelihood ratio test=24.91  on 5 df, p=0.0001452
n= 2009, number of events= 259 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Death in remission</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 1</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel,trm<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">~</span> <span class="fu">tt</span>(tgvhd) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> bmonly <span class="sc">+</span> all,</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> bmt, <span class="at">ties=</span><span class="st">"breslow"</span>,</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">tdcgvhd=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>      })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(intxrel, trm != 0) ~ tt(tgvhd) + I(age/10) + 
    bmonly + all, data = bmt, ties = "breslow", tt = function(x, 
    t, ...) {
    dt &lt;- t - x
    cbind(tdcgvhd = 1 * (dt &gt; 0))
})

              coef exp(coef) se(coef)      z        p
tt(tgvhd)  1.04140   2.83318  0.09801 10.626  &lt; 2e-16
I(age/10)  0.26280   1.30056  0.03278  8.016 1.09e-15
bmonly    -0.08546   0.91809  0.09556 -0.894 0.371162
all        0.33359   1.39597  0.09817  3.398 0.000678

Likelihood ratio test=227  on 4 df, p=&lt; 2.2e-16
n= 2009, number of events= 505 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Column 2</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel,trm<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">~</span>  <span class="fu">tt</span>(tgvhd) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> bmonly <span class="sc">+</span> all <span class="sc">+</span> <span class="fu">tt</span>(tanc500),</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> bmt, <span class="at">ties=</span><span class="st">"breslow"</span>,</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">tt=</span><span class="cf">function</span>(x, t, ...) {</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>        dt <span class="ot">&lt;-</span> t<span class="sc">-</span>x</span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(<span class="at">tdcgvhd=</span><span class="dv">1</span><span class="sc">*</span>(dt<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>      })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(intxrel, trm != 0) ~ tt(tgvhd) + I(age/10) + 
    bmonly + all + tt(tanc500), data = bmt, ties = "breslow", 
    tt = function(x, t, ...) {
        dt &lt;- t - x
        cbind(tdcgvhd = 1 * (dt &gt; 0))
    })

                coef exp(coef) se(coef)      z        p
tt(tgvhd)    1.04016   2.82966  0.09854 10.556  &lt; 2e-16
I(age/10)    0.26289   1.30069  0.03288  7.996 1.28e-15
bmonly      -0.14047   0.86895  0.09627 -1.459 0.144550
all          0.33553   1.39868  0.09826  3.415 0.000639
tt(tanc500) -2.22822   0.10772  0.30523 -7.300 2.87e-13

Likelihood ratio test=275.1  on 5 df, p=&lt; 2.2e-16
n= 2009, number of events= 505 </code></pre>
</div>
</div>
</div>
<div id="tabset-33-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-33-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.12-sas_e3f52c34c768f5a3819c1d023b70820e">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">** Relapse **;</span> </span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 1;</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>    class bmonly(ref=<span class="st">"0"</span>) all(ref=<span class="st">"0"</span>);</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*rel(<span class="dv">0</span>)=tdcgvhd age bmonly all/rl;</span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>    tdcgvhd=<span class="dv">0</span>;</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> gvhd=<span class="dv">1</span> <span class="kw">and</span> intxrel&gt;tgvhd <span class="kw">then</span> tdcgvhd=<span class="dv">1</span>;</span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 2;</span></span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a>    class bmonly(ref=<span class="st">"0"</span>) all(ref=<span class="st">"0"</span>);</span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*rel(<span class="dv">0</span>)= tdcgvhd age bmonly all  tdcanc500/rl;</span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a>    tdcanc500=<span class="dv">0</span>;</span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> anc500=<span class="dv">1</span> <span class="kw">and</span> intxrel&gt;timeanc500 <span class="kw">then</span> tdcanc500=<span class="dv">1</span>;</span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a>    tdcgvhd=<span class="dv">0</span>;</span>
<span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> gvhd=<span class="dv">1</span> <span class="kw">and</span> intxrel&gt;tgvhd <span class="kw">then</span> tdcgvhd=<span class="dv">1</span>;</span>
<span id="cb209-17"><a href="#cb209-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb209-18"><a href="#cb209-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-19"><a href="#cb209-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-20"><a href="#cb209-20" aria-hidden="true" tabindex="-1"></a><span class="co">** Death in remission **;</span></span>
<span id="cb209-21"><a href="#cb209-21" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 1;</span> </span>
<span id="cb209-22"><a href="#cb209-22" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb209-23"><a href="#cb209-23" aria-hidden="true" tabindex="-1"></a>    class bmonly(ref=<span class="st">"0"</span>) all(ref=<span class="st">"0"</span>);</span>
<span id="cb209-24"><a href="#cb209-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*trm(<span class="dv">0</span>)=tdcgvhd age bmonly all/rl;</span>
<span id="cb209-25"><a href="#cb209-25" aria-hidden="true" tabindex="-1"></a>    tdcgvhd=<span class="dv">0</span>;</span>
<span id="cb209-26"><a href="#cb209-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> gvhd=<span class="dv">1</span> <span class="kw">and</span> intxrel&gt;tgvhd <span class="kw">then</span> tdcgvhd=<span class="dv">1</span>;</span>
<span id="cb209-27"><a href="#cb209-27" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb209-28"><a href="#cb209-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-29"><a href="#cb209-29" aria-hidden="true" tabindex="-1"></a><span class="co">* Column 2;</span></span>
<span id="cb209-30"><a href="#cb209-30" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb209-31"><a href="#cb209-31" aria-hidden="true" tabindex="-1"></a>    class bmonly(ref=<span class="st">"0"</span>) all(ref=<span class="st">"0"</span>);</span>
<span id="cb209-32"><a href="#cb209-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*trm(<span class="dv">0</span>)=tdcgvhd  age bmonly all tdcanc500 /rl;</span>
<span id="cb209-33"><a href="#cb209-33" aria-hidden="true" tabindex="-1"></a>    tdcanc500=<span class="dv">0</span>;</span>
<span id="cb209-34"><a href="#cb209-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> anc500=<span class="dv">1</span> <span class="kw">and</span> intxrel&gt;timeanc500 <span class="kw">then</span> tdcanc500=<span class="dv">1</span>;</span>
<span id="cb209-35"><a href="#cb209-35" aria-hidden="true" tabindex="-1"></a>    tdcgvhd=<span class="dv">0</span>;</span>
<span id="cb209-36"><a href="#cb209-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> gvhd=<span class="dv">1</span> <span class="kw">and</span> intxrel&gt;tgvhd <span class="kw">then</span> tdcgvhd=<span class="dv">1</span>;</span>
<span id="cb209-37"><a href="#cb209-37" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.14" class="level3">
<h3 class="anchored" data-anchor-id="table-3.14">Table 3.14</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-34-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-1" role="tab" aria-controls="tabset-34-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-34-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-2" role="tab" aria-controls="tabset-34-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-34-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-34-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.14-r_cb6d5de87a50bf3a5e654bd10d9bbb7b">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data set for analysis - double</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>bmtext <span class="ot">&lt;-</span> bmt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nygsource =</span> bmonly, </span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">nydisease =</span> all, </span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">age10 =</span> age<span class="sc">/</span><span class="dv">10</span>,</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">time =</span> <span class="fu">ifelse</span>(gvhd <span class="sc">==</span> <span class="dv">1</span>, tgvhd, intxrel), </span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">status =</span> <span class="fu">ifelse</span>(gvhd <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, trm),</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">entry =</span> <span class="dv">0</span>,</span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>                         ) </span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a>double1 <span class="ot">&lt;-</span> bmtext  <span class="sc">%&gt;%</span> </span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age1 =</span> age10, </span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">age2 =</span> <span class="dv">0</span>,</span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">gsource1 =</span> nygsource, </span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">gsource2 =</span> <span class="dv">0</span>,</span>
<span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">disease1 =</span> nydisease,</span>
<span id="cb210-18"><a href="#cb210-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">disease2 =</span> <span class="dv">0</span>, </span>
<span id="cb210-19"><a href="#cb210-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">stratum =</span> <span class="dv">1</span>)</span>
<span id="cb210-20"><a href="#cb210-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-21"><a href="#cb210-21" aria-hidden="true" tabindex="-1"></a>double2 <span class="ot">&lt;-</span> bmtext <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gvhd <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb210-22"><a href="#cb210-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> intxrel, </span>
<span id="cb210-23"><a href="#cb210-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">status =</span> trm,  </span>
<span id="cb210-24"><a href="#cb210-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">entry =</span> tgvhd,</span>
<span id="cb210-25"><a href="#cb210-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">age1 =</span> <span class="dv">0</span>, </span>
<span id="cb210-26"><a href="#cb210-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">age2 =</span> age10,</span>
<span id="cb210-27"><a href="#cb210-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">gsource1 =</span> <span class="dv">0</span>, </span>
<span id="cb210-28"><a href="#cb210-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">gsource2 =</span> nygsource,</span>
<span id="cb210-29"><a href="#cb210-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">disease1 =</span> <span class="dv">0</span>,</span>
<span id="cb210-30"><a href="#cb210-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">disease2 =</span> nydisease, </span>
<span id="cb210-31"><a href="#cb210-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">stratum =</span> <span class="dv">2</span>)</span>
<span id="cb210-32"><a href="#cb210-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-33"><a href="#cb210-33" aria-hidden="true" tabindex="-1"></a>doubledod <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(double1, double2))</span>
<span id="cb210-34"><a href="#cb210-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-35"><a href="#cb210-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Row 1</span></span>
<span id="cb210-36"><a href="#cb210-36" aria-hidden="true" tabindex="-1"></a>r1<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(entry, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="fu">strata</span>(stratum) <span class="sc">+</span> disease1 <span class="sc">+</span> disease2 <span class="sc">+</span> age1 <span class="sc">+</span> age2, </span>
<span id="cb210-37"><a href="#cb210-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> doubledod, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb210-38"><a href="#cb210-38" aria-hidden="true" tabindex="-1"></a>r1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entry, time, status != 0) ~ strata(stratum) + 
    disease1 + disease2 + age1 + age2, data = doubledod, ties = "breslow")

            coef exp(coef) se(coef)     z        p
disease1 0.26705   1.30610  0.15893 1.680  0.09290
disease2 0.36025   1.43369  0.12492 2.884  0.00393
age1     0.25561   1.29125  0.04791 5.336 9.53e-08
age2     0.28675   1.33209  0.04083 7.023 2.17e-12

Likelihood ratio test=82.11  on 4 df, p=&lt; 2.2e-16
n= 2983, number of events= 505 
   (2 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Row 2</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>doubledod<span class="sc">$</span>type <span class="ot">&lt;-</span> doubledod<span class="sc">$</span>stratum <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>r2<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(entry, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> disease1 <span class="sc">+</span> disease2 <span class="sc">+</span> age1 <span class="sc">+</span> age2 <span class="sc">+</span> type, </span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> doubledod, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>r2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entry, time, status != 0) ~ disease1 + disease2 + 
    age1 + age2 + type, data = doubledod, ties = "breslow")

            coef exp(coef) se(coef)     z        p
disease1 0.26172   1.29916  0.15877 1.648  0.09926
disease2 0.37891   1.46069  0.12478 3.037  0.00239
age1     0.24601   1.27891  0.04754 5.175 2.28e-07
age2     0.29228   1.33948  0.04101 7.128 1.02e-12
type     0.84247   2.32210  0.26891 3.133  0.00173

Likelihood ratio test=226.9  on 5 df, p=&lt; 2.2e-16
n= 2983, number of events= 505 
   (2 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>r2t<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(entry, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> disease1 <span class="sc">+</span> disease2 <span class="sc">+</span> age1 <span class="sc">+</span> age2 <span class="sc">+</span> type</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>           <span class="sc">+</span><span class="fu">tt</span>(type), </span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> doubledod, <span class="at">ties =</span> <span class="st">"breslow"</span>,</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">tt =</span> <span class="cf">function</span>(x,t, ...){</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>             gvhdt <span class="ot">=</span> x<span class="sc">*</span><span class="fu">log</span>(t)</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>           })</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text: LRT proportionality</span></span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(r2, r2t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(entry, time, status != 0) ~ disease1 + disease2 + age1 + 
    age2 + type
Model 2: Surv(entry, time, status != 0) ~ disease1 + disease2 + age1 + 
    age2 + type + tt(type)
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   5 -3542.8                     
2   6 -3541.8  1 2.0768     0.1496</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Row 3</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>r3<span class="ot">&lt;-</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(entry, time, status <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> nydisease <span class="sc">+</span> age10 <span class="sc">+</span> type, </span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> doubledod, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>r3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entry, time, status != 0) ~ nydisease + 
    age10 + type, data = doubledod, ties = "breslow")

             coef exp(coef) se(coef)      z        p
nydisease 0.33159   1.39318  0.09808  3.381 0.000723
age10     0.27230   1.31298  0.03103  8.774  &lt; 2e-16
type      1.04934   2.85577  0.09758 10.754  &lt; 2e-16

Likelihood ratio test=226.2  on 3 df, p=&lt; 2.2e-16
n= 2983, number of events= 505 
   (2 observations deleted due to missingness)</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In-text: LRT common coefficients</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(r3,r2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: Surv(entry, time, status != 0) ~ nydisease + age10 + type
Model 2: Surv(entry, time, status != 0) ~ disease1 + disease2 + age1 + 
    age2 + type
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   3 -3543.2                     
2   5 -3542.8  2 0.7389     0.6911</code></pre>
</div>
</div>
</div>
<div id="tabset-34-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-34-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.14-sas_1609ff30d4b68ff697f7d26e86fcce19">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Make "double" data set;</span> </span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> doubledod; </span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> bmt; </span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    nygsource=bmonly; </span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    nydisease=all; </span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>    age10=age/<span class="dv">10</span>;</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span>=intxrel; </span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>    status=trm; </span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>    entry=<span class="dv">0</span>;</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> gvhd=<span class="dv">1</span> <span class="kw">then do</span>; </span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">time</span>=tgvhd; </span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a>        status=<span class="dv">0</span>; </span>
<span id="cb220-14"><a href="#cb220-14" aria-hidden="true" tabindex="-1"></a><span class="kw">    end</span>;</span>
<span id="cb220-15"><a href="#cb220-15" aria-hidden="true" tabindex="-1"></a>    age1=age10; </span>
<span id="cb220-16"><a href="#cb220-16" aria-hidden="true" tabindex="-1"></a>    age2=<span class="dv">0</span>; </span>
<span id="cb220-17"><a href="#cb220-17" aria-hidden="true" tabindex="-1"></a>    gsource1=nygsource; </span>
<span id="cb220-18"><a href="#cb220-18" aria-hidden="true" tabindex="-1"></a>    gsource2=<span class="dv">0</span>;</span>
<span id="cb220-19"><a href="#cb220-19" aria-hidden="true" tabindex="-1"></a>    disease1=nydisease; </span>
<span id="cb220-20"><a href="#cb220-20" aria-hidden="true" tabindex="-1"></a>    disease2=<span class="dv">0</span>; </span>
<span id="cb220-21"><a href="#cb220-21" aria-hidden="true" tabindex="-1"></a>    stratum=<span class="dv">1</span>; </span>
<span id="cb220-22"><a href="#cb220-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span>;</span>
<span id="cb220-23"><a href="#cb220-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-24"><a href="#cb220-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> gvhd=<span class="dv">1</span> <span class="kw">then do</span>;</span>
<span id="cb220-25"><a href="#cb220-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">time</span>=intxrel; </span>
<span id="cb220-26"><a href="#cb220-26" aria-hidden="true" tabindex="-1"></a>        status=trm; </span>
<span id="cb220-27"><a href="#cb220-27" aria-hidden="true" tabindex="-1"></a>        entry=tgvhd;</span>
<span id="cb220-28"><a href="#cb220-28" aria-hidden="true" tabindex="-1"></a>        age1=<span class="dv">0</span>; </span>
<span id="cb220-29"><a href="#cb220-29" aria-hidden="true" tabindex="-1"></a>        age2=age10; </span>
<span id="cb220-30"><a href="#cb220-30" aria-hidden="true" tabindex="-1"></a>        gsource1=<span class="dv">0</span>; </span>
<span id="cb220-31"><a href="#cb220-31" aria-hidden="true" tabindex="-1"></a>        gsource2=nygsource;</span>
<span id="cb220-32"><a href="#cb220-32" aria-hidden="true" tabindex="-1"></a>        disease1=<span class="dv">0</span>; </span>
<span id="cb220-33"><a href="#cb220-33" aria-hidden="true" tabindex="-1"></a>        disease2=nydisease; </span>
<span id="cb220-34"><a href="#cb220-34" aria-hidden="true" tabindex="-1"></a>        stratum=<span class="dv">2</span>; </span>
<span id="cb220-35"><a href="#cb220-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">output</span>; </span>
<span id="cb220-36"><a href="#cb220-36" aria-hidden="true" tabindex="-1"></a><span class="kw">    end</span>;</span>
<span id="cb220-37"><a href="#cb220-37" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb220-38"><a href="#cb220-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-39"><a href="#cb220-39" aria-hidden="true" tabindex="-1"></a><span class="co">* Row 1;</span> </span>
<span id="cb220-40"><a href="#cb220-40" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=doubledod; </span>
<span id="cb220-41"><a href="#cb220-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=disease1 disease2 </span>
<span id="cb220-42"><a href="#cb220-42" aria-hidden="true" tabindex="-1"></a>    age1 age2 /entry=entry type3(lr);</span>
<span id="cb220-43"><a href="#cb220-43" aria-hidden="true" tabindex="-1"></a>    strata stratum;</span>
<span id="cb220-44"><a href="#cb220-44" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb220-45"><a href="#cb220-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-46"><a href="#cb220-46" aria-hidden="true" tabindex="-1"></a><span class="co">* Row 2;</span> </span>
<span id="cb220-47"><a href="#cb220-47" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=doubledod; </span>
<span id="cb220-48"><a href="#cb220-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=disease1 disease2 </span>
<span id="cb220-49"><a href="#cb220-49" aria-hidden="true" tabindex="-1"></a>    age1 age2 type /entry=entry type3(lr);</span>
<span id="cb220-50"><a href="#cb220-50" aria-hidden="true" tabindex="-1"></a>    type=stratum<span class="dv">-1</span>;</span>
<span id="cb220-51"><a href="#cb220-51" aria-hidden="true" tabindex="-1"></a>    test age1=age2, disease1=disease2; <span class="co">/* Wald test instead of LRT */</span></span>
<span id="cb220-52"><a href="#cb220-52" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb220-53"><a href="#cb220-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-54"><a href="#cb220-54" aria-hidden="true" tabindex="-1"></a><span class="co">* In-text: LRT proportionality variable 'typelogt';</span></span>
<span id="cb220-55"><a href="#cb220-55" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=doubledod; </span>
<span id="cb220-56"><a href="#cb220-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=disease1 disease2 </span>
<span id="cb220-57"><a href="#cb220-57" aria-hidden="true" tabindex="-1"></a>    age1 age2 type typelogt  /entry=entry type3(lr);</span>
<span id="cb220-58"><a href="#cb220-58" aria-hidden="true" tabindex="-1"></a>    type=stratum<span class="dv">-1</span>;</span>
<span id="cb220-59"><a href="#cb220-59" aria-hidden="true" tabindex="-1"></a>    typelogt=type*<span class="fu">log</span>(<span class="fu">time</span>);</span>
<span id="cb220-60"><a href="#cb220-60" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb220-61"><a href="#cb220-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-62"><a href="#cb220-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-63"><a href="#cb220-63" aria-hidden="true" tabindex="-1"></a><span class="co">* Row 3;</span> </span>
<span id="cb220-64"><a href="#cb220-64" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=doubledod; </span>
<span id="cb220-65"><a href="#cb220-65" aria-hidden="true" tabindex="-1"></a>    class stratum (ref=<span class="st">'1'</span>) nydisease (ref=<span class="st">'0'</span>);</span>
<span id="cb220-66"><a href="#cb220-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=nydisease age10 type /entry=entry type3(lr);</span>
<span id="cb220-67"><a href="#cb220-67" aria-hidden="true" tabindex="-1"></a>    type=stratum<span class="dv">-1</span>;</span>
<span id="cb220-68"><a href="#cb220-68" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="figure-3.10" class="level3">
<h3 class="anchored" data-anchor-id="figure-3.10">Figure 3.10</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-35-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-1" role="tab" aria-controls="tabset-35-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-35-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-2" role="tab" aria-controls="tabset-35-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-35-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-35-1-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.10-r_6b46595046c4900e7195881afa868106">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cumulative hazard from r1 </span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>survr1 <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(r1, <span class="at">center =</span> F)</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>pcumhaz <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cumhaz =</span> survr1<span class="sc">$</span>hazard, </span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> survr1<span class="sc">$</span>time, </span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">strata =</span> survr1<span class="sc">$</span>strata) </span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 3.10</span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cumhaz, <span class="at">linetype =</span> strata), <span class="at">data =</span> pcumhaz) <span class="sc">+</span> </span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time since bone marrow transplantation (months)"</span>) <span class="sc">+</span> </span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative hazard"</span>) <span class="sc">+</span> </span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">156</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">156</span>, <span class="at">by =</span> <span class="dv">12</span>)) <span class="sc">+</span> </span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Stratum"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>)) <span class="sc">+</span> </span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>fig3<span class="fl">.10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/figure-3.10-r-1.png" class="img-fluid" style="width:90.0%"></p>
</div>
</div>
</div>
<div id="tabset-35-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-35-2-tab">
<div class="cell" data-hash="Ch3_cache/html/figure-3.10-sas_9a5fbb25fa403d0b0d6f13ca568d5046">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> covar; </span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">input</span> disease1 disease2 age1 age2; </span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="ot">    datalines; </span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    0 0 0 0</span></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="ot">; </span></span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>; </span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=doubledod; </span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> <span class="fu">time</span>*status(<span class="dv">0</span>)=disease1 disease2 age1 age2 / entry=entry ;</span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>    strata stratum;</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>    baseline out=trm cumhaz=breslow covariates=covar;</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=trm;</span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a>    plot breslow*<span class="fu">time</span>=stratum/haxis=axis1 vaxis=axis2;</span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">156</span> <span class="kw">by</span> <span class="dv">12</span> minor=none</span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">label</span>=(<span class="st">'Time since bone marrow transplantation (months)'</span>);</span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.3</span> <span class="kw">by</span> <span class="dv">0.05</span> minor=none</span>
<span id="cb222-17"><a href="#cb222-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative hazard of death in remission'</span>);</span>
<span id="cb222-18"><a href="#cb222-18" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=blue;</span>
<span id="cb222-19"><a href="#cb222-19" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=stepjl c=red;;</span>
<span id="cb222-20"><a href="#cb222-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb222-21"><a href="#cb222-21" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="table-3.15" class="level3">
<h3 class="anchored" data-anchor-id="table-3.15">Table 3.15</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-36-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-1" role="tab" aria-controls="tabset-36-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-36-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-2" role="tab" aria-controls="tabset-36-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-36-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-36-1-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.15-r_90af78ac6817b591778f53df44ad8490">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel, state0 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> bmonly <span class="sc">+</span> all <span class="sc">+</span> age </span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">+</span> <span class="fu">frailty.gamma</span>(team, <span class="at">eps =</span> <span class="fl">1e-09</span>), <span class="at">data =</span> bmt, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(intxrel, state0 != 0) ~ bmonly + all + age + 
    frailty.gamma(team, eps = 1e-09), data = bmt, ties = "breslow")

                              coef se(coef)      se2    Chisq DF       p
bmonly                    -0.17512  0.08704  0.08178  4.04856  1  0.0442
all                        0.47196  0.07965  0.07829 35.11425  1 3.1e-09
age                        0.01873  0.00275  0.00263 46.44972  1 9.4e-12
frailty.gamma(team, eps =                            84.11745 51  0.0024

Iterations: 9 outer, 43 Newton-Raphson
     Variance of random effect= 0.117   I-likelihood = -5495.9 
Degrees of freedom for terms=  0.9  1.0  0.9 51.0 
Likelihood ratio test=214  on 53.7 df, p=&lt;2e-16
n= 2009, number of events= 764 </code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel, state0 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> bmonly <span class="sc">+</span> all <span class="sc">+</span> age</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">+</span> <span class="fu">frailty.gaussian</span>(team, <span class="at">eps =</span> <span class="fl">1e-09</span>, <span class="at">sparse=</span>F), <span class="at">data =</span> bmt, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(intxrel, state0 != 0) ~ bmonly + all + age + 
    frailty.gaussian(team, eps = 1e-09, sparse = F), data = bmt, 
    ties = "breslow")

                              coef se(coef)      se2    Chisq   DF       p
bmonly                    -0.17683  0.08755  0.08208  4.08010  1.0  0.0434
all                        0.47435  0.07989  0.07844 35.25576  1.0 2.9e-09
age                        0.01891  0.00278  0.00265 46.42018  1.0 9.5e-12
frailty.gaussian(team, ep                            90.71464 55.1  0.0018

Iterations: 8 outer, 22 Newton-Raphson
     Variance of random effect= 0.139 
Degrees of freedom for terms=  0.9  1.0  0.9 55.2 
Likelihood ratio test=695  on 57.9 df, p=&lt;2e-16
n= 2009, number of events= 764 </code></pre>
</div>
</div>
</div>
<div id="tabset-36-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-36-2-tab">
<div class="cell" data-hash="Ch3_cache/html/table-3.15-sas_dce59182c7dcece4e82b915f43fda083">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Gamma;</span> </span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    class bmonly(ref=<span class="st">"0"</span>) all(ref=<span class="st">"0"</span>) team;</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*state0(<span class="dv">0</span>)=bmonly all age/rl;</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>    random team/dist=<span class="fu">gamma</span>;</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a><span class="co">* Log-normal;</span> </span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a>    class bmonly(ref=<span class="st">"0"</span>) all(ref=<span class="st">"0"</span>) team;</span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*state0(<span class="dv">0</span>)=bmonly all age/rl;</span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a>    random team;</span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="in-text-p.-112-stratified-cox-model-by-center" class="level3">
<h3 class="anchored" data-anchor-id="in-text-p.-112-stratified-cox-model-by-center">In-text, p.&nbsp;112: stratified Cox model by center</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-37-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-1" role="tab" aria-controls="tabset-37-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-37-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-2" role="tab" aria-controls="tabset-37-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-37-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-37-1-tab">
<div class="cell" data-hash="Ch3_cache/html/in-text-stratified-r_8b9c8d1a8df4ff206b0985ec0b411b7c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(intxrel, state0 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">~</span> bmonly <span class="sc">+</span> all <span class="sc">+</span> age </span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">+</span> <span class="fu">strata</span>(team), <span class="at">data =</span> bmt, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(intxrel, state0 != 0) ~ bmonly + all + age + 
    strata(team), data = bmt, ties = "breslow")

            coef exp(coef)  se(coef)      z        p
bmonly -0.196894  0.821277  0.114392 -1.721   0.0852
all     0.470582  1.600926  0.090822  5.181 2.20e-07
age     0.020946  1.021167  0.003539  5.918 3.26e-09

Likelihood ratio test=61.1  on 3 df, p=3.424e-13
n= 2009, number of events= 764 </code></pre>
</div>
</div>
</div>
<div id="tabset-37-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-37-2-tab">
<div class="cell" data-hash="Ch3_cache/html/in-text-stratified-sas_de55cb611582f148b7a6451a8d01592c">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bmt;</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>    class bmonly(ref=<span class="st">"0"</span>) all(ref=<span class="st">"0"</span>) team;</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> intxrel*state0(<span class="dv">0</span>)=bmonly all age/rl;</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>    strata team;</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<p>The SAS solutions are available as single files for download:</p>
<ul>
<li><p><a href="./SAS/chapter3_solutions_cphholter.sas">Exercises 3.7 - 3.10 (The Copenhagen Holter study)</a></p></li>
<li><p><a href="./SAS/chapter3_solutions_affective.sas">Exercise 3.11 (Recurrent episodes in affective disorders)</a></p></li>
<li><p><a href="./SAS/chapter3_solutions_bissau.sas">Exercise 3.12 (Guinea-Bissau childhood vaccination study)</a></p></li>
</ul>
<section id="exercise-3.1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.1">Exercise 3.1 (*)</h3>
<p><em>Show that, under the null hypothesis <span class="math inline">\(H_0 : A_0(t) = A_1(t)\)</span>, the test statistic</em> <span class="math inline">\(\int_0^t K(u)\left( d\widehat{A}_1(u)-d\widehat{A}_0(u)\right)\)</span> <em>is a martingale (Section 3.2.2).</em></p>
<p>The counting processes can be decomposed as <span class="math inline">\(N_h(t)=\int_0^tY_h(u)\alpha_h(u)du + M_h(t), h=0,1\)</span>, so under <span class="math inline">\(H_0\)</span>, <span class="math display">\[d\widehat{A}_h(u)=\frac{dN_h(u)}{Y_h(u)}=\alpha(u)du+\frac{dM_h(u)}{Y_h(u)},\]</span> and the test statistic reduces to the martingale integral <span class="math display">\[\int_0^tK(u)\left(\frac{dM_1(u)}{Y_1(u)}-\frac{dM_0(u)}{Y_0(u)}\right),\]</span> which is itself a martingale.</p>
</section>
<section id="exercise-3.2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.2">Exercise 3.2 (*)</h3>
<p><em>Show that, when evaluated at the true parameter vector</em> <span class="math inline">\(\mathbf{\beta}_0\)</span><em>, the Cox partial likelihood score</em> <span class="math display">\[
\int_0^t\sum_i \bigl(\mathbf{Z}_i-\frac{\sum_jY_j(u)\mathbf{Z}_j\exp(\mathbf{\beta}_0^{\sf T}\mathbf{Z}_j)}{\sum_jY_j(u)\exp(\mathbf{\beta}_0^{\sf T}\mathbf{Z}_j)}\bigr)dN_i(u)
\]</span> <em>is a martingale (Section 3.3).</em></p>
<p>Each individual counting process can be decomposed as <span class="math display">\[N_i(t)=\int_0^t \alpha_0(u)Y_i(u)\exp(\mathbf{\beta}_0^{\sf T}\mathbf{Z}_i)du + M_i(t)\]</span> and with <span class="math inline">\(S_0(\mathbf{\beta},t)=\sum_iY_i(t)\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_i)\)</span>, <span class="math inline">\(\mathbf{S}_1(\mathbf{\beta},t)=\sum_iY_i(t)\mathbf{Z}_i\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_i)\)</span>, the integrand in the Cox score becomes <span class="math display">\[\sum_i \bigl(\mathbf{Z}_i-\frac{\mathbf{S}_1(\mathbf{\beta},u)}{S_0(\mathbf{\beta},u)}\bigr)(\alpha_0(u)Y_i(u)\exp(\mathbf{\beta}_0^{\sf T}\mathbf{Z}_i)du + dM_i(u))
\]</span> <span class="math display">\[=\alpha_0(u)\bigl(\mathbf{S}_1(\mathbf{\beta},u)-\frac{\mathbf{S}_1(\mathbf{\beta},u)}{{S}_0(\mathbf{\beta},u)}{S}_0({\beta},u)\bigr)du
+ \sum_i(\mathbf{Z}_i-\frac{\mathbf{S}_1(\mathbf{\beta},u)}{S_0(\mathbf{\beta},u)}\bigr)dM_i(u)\]</span> and the Cox score is then the martingale integral <span class="math display">\[\int_0^t \sum_i(\mathbf{Z}_i-\frac{\mathbf{S}_1(\mathbf{\beta},u)}{S_0(\mathbf{\beta},u)}\bigr)dM_i(u).\]</span></p>
</section>
<section id="exercise-3.3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.3">Exercise 3.3 (*)</h3>
<p><em>Show that, for a Cox model with a single binary covariate, the score test for the hypothesis</em> <span class="math inline">\(\beta=0\)</span> <em>based on the first and second derivative of</em> <span class="math inline">\(\log\mbox{PL}(\beta)\)</span> <em>(Equation (3.16)) is equal to the logrank test.</em>}</p>
<p>With a single binary covariate <span class="math inline">\(Z_i=I(i\mbox{ is in group 1})\)</span>, the Cox score <span class="math display">\[\sum_i \int_0^t\left(Z_i-\frac{S_1(\beta,u)}{S_0(\beta,u)}\right)dN_i(u)\]</span> (with <span class="math inline">\(S_0, S_1\)</span> defined in Exercise 3.2) reduces to <span class="math display">\[N_1(\infty)-\int_0^{\infty}\frac{Y_1(u)}{Y_0(u)+Y_1(u)}d(N_0+N_1)(u)\]</span> when <span class="math inline">\(\beta=0\)</span> and <span class="math inline">\(t=\infty\)</span>. This is the numerator in the logrank test, <span class="math inline">\(\mbox{LR}(\infty)\)</span>, Section 3.2.2. With <span class="math inline">\(S_2(\beta,t)=\sum_jZ_j^2Y_j(t)\exp(\beta Z_j)\)</span>, minus the derivative of the Cox score is <span class="math display">\[\sum_i\int_0^t\frac{S_0(\beta,u)S_2(\beta,u)-S_1(\beta,u)^2}{S_0(\beta,u)^2}dN_i(u)\]</span> which for <span class="math inline">\(\beta=0\)</span> and <span class="math inline">\(t=\infty\)</span> (when there are no ties) reduces to the hypergeometric variance, <span class="math inline">\(v\)</span> (Section 3.2.2) <span class="math display">\[\int_0^{\infty}\frac{Y_0(u)Y_1(u)}{(Y_0(u)+Y_1(u))^2}d(N_0+N_1)(u)\]</span> and the resulting score test is the logrank test.</p>
</section>
<section id="exercise-3.4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.4">Exercise 3.4 (*)</h3>
<p><em>Show that, for the stratified Cox model (3.20), the profile likelihood is given by (3.21) and the resulting Breslow estimator by (3.22).</em></p>
<p>The log-likelihood for the stratified Cox model based on the Jacod formula is <span class="math display">\[\sum_j\sum_{i\in S_j}\left(\int_0^{\infty}\log\bigl(Y_i(t)\alpha_{0j}(t)\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_i)\bigr)dN_i(t)-\int_0^{\infty}Y_i(t)\alpha_{0j}(t)\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_i)dt\right)\]</span> (Section 3.3). Taking derivative with respect to a single <span class="math inline">\(\alpha_{0j}(t)\)</span>, we get <span class="math display">\[\sum_{i \in S_j}\left(\frac{1}{\alpha_{0j}(t)}dN_i(t)-Y_i(t)\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_i)dt\right),\]</span> and equating to 0 and solving leads to <span class="math display">\[\widehat{\alpha_{0j}(t)dt}=\frac{\sum_{i\in S_j}dN_i(t)}{\sum_{i \in S_j}Y_i(t)\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_i)},\]</span> the jump in the Breslow estimator (3.22).</p>
<p>Inserting this into the Jacod formula leads to the profile likelihood <span class="math display">\[\prod_j\prod_{i\in S_j}\exp\left(-\int_0^{\infty}Y_i(t)\frac{\sum_{\ell\in S_j}dN_\ell(t)}{\sum_{\ell \in S_j}Y_\ell(t)\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_\ell)}\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_i)dt\right)\]</span> <span class="math display">\[\times \prod_j\prod_{i\in S_j}\prod_t \left(Y_i(t)\frac{\sum_{\ell\in S_j}dN_\ell(t)}{\sum_{\ell \in S_j}Y_\ell(t)\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_\ell)}\exp(\mathbf{\beta}^{\sf T}\mathbf{Z}_i)\right)^{dN_i(t)},\]</span> where, in the first line, factors depending on <span class="math inline">\(\mathbf{\beta}\)</span> cancel, and the remaining factors depending on <span class="math inline">\(\mathbf{\beta}\)</span> are exactly (3.21).</p>
</section>
<section id="exercise-3.5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.5">Exercise 3.5 (*)</h3>
<p><em>Consider the situation in Section 3.4 with categorical covariates and show that the likelihood is given by</em> <span class="math display">\[
\prod_{\ell=1}^L\prod_{\mathbf{c}\in {\cal C}}(\alpha_{0\ell}\theta_{\mathbf{c}})^{N_{\ell \mathbf{c}}}\exp(-\alpha_{0\ell}\theta_{\mathbf{c}} Y_{\ell \mathbf{c}}).
\]</span></p>
<p>The starting point is the Jacod formula where factor <span class="math inline">\(i\)</span> is <span class="math display">\[\prod_t (Y_i(t)\alpha_i(t))^{dN_i(t)}\exp(-\int_0^{\infty}Y_i(t)\alpha_i(t)dt),\]</span> and when <span class="math inline">\(\alpha_i(t)=\alpha_{0\ell}\mathbf{\theta}_{\mathbf{c}}\)</span> if <span class="math inline">\(t\in [s_{\ell -1},s_{\ell})\)</span> and <span class="math inline">\(i\)</span> has covariates in category <span class="math inline">\(\mathbf{c}\)</span>, this is proportional to <span class="math display">\[\prod_{\ell=1}^L(\alpha_{0\ell}\mathbf{\theta}_{\mathbf{c}})^{N_{\ell\mathbf{c}}^i}\exp(-\sum_{\ell=1}^LY_{\ell\mathbf{c}}^i\mathbf{\theta}_{\mathbf{c}}),\]</span> where <span class="math inline">\(N_{\ell\mathbf{c}}^i\)</span> is the number of events for subject <span class="math inline">\(i\)</span> in <span class="math inline">\([s_{\ell -1},s_{\ell})\)</span> and <span class="math inline">\(Y_{\ell\mathbf{c}}^i\)</span> the time spent by subject <span class="math inline">\(i\)</span> in <span class="math inline">\([s_{\ell -1},s_{\ell})\)</span>. Collecting factors from all subjects with covariates in category <span class="math inline">\(\mathbf{c}\)</span>, the joint likelihood contribution from those subjects is <span class="math display">\[\prod_{\ell=1}^L(\alpha_{0\ell}\mathbf{\theta}_{\mathbf{c}})^{N_{\ell\mathbf{c}}}\exp(-\sum_{\ell=1}^LY_{\ell\mathbf{c}}\mathbf{\theta}_{\mathbf{c}}),\]</span> where <span class="math inline">\(N_{\ell\mathbf{c}}\)</span> and <span class="math inline">\(Y_{\ell\mathbf{c}}\)</span> are the sums over those subjects of the individual values of <span class="math inline">\(N_{\ell\mathbf{c}}^i\)</span> and <span class="math inline">\(Y_{\ell\mathbf{c}}^i\)</span>, respectively. The total likelihood is now the product over all categories <span class="math inline">\(\mathbf{c}\)</span>.</p>
</section>
<section id="exercise-3.6" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.6">Exercise 3.6 (*)</h3>
<p><em>Derive the estimating equations for the model studied in Section 3.8.4</em></p>
<p>The arguments are, in fact, identical to those used for the stratified Cox model in Exercise 3.4. The only difference appears due to the fact that the likelihood does not factorize over types, <span class="math inline">\(\nu\)</span>.</p>
</section>
<section id="exercise-3.7" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.7">Exercise 3.7</h3>
<p><em>Consider the Cox model for stroke-free survival in the Copenhagen Holter study including the covariates ESVEA, sex, age, and systolic blood pressure (Exercise 4 in Chapter 2). Test, using time-dependent covariates, whether the effects of these covariates may be described as time-constant hazard ratios</em>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-38-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-1" role="tab" aria-controls="tabset-38-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-38-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-2" role="tab" aria-controls="tabset-38-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-38-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-38-1-tab">
<p>The data should be loaded as <strong>chs_data</strong> and we convert the time variables to years and add a time and censoring variable for the composite end-point stroke-free survival.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-74_8b7dc6f7de0074d895b9bc15484dfd3f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/cphholter.csv"</span>)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">timeafib =</span> timeafib<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timestroke =</span> timestroke<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timedeath =</span> timedeath<span class="sc">/</span><span class="fl">365.25</span>,</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">timestrokeordeath =</span> <span class="fu">ifelse</span>(stroke <span class="sc">==</span> <span class="dv">1</span>, timestroke, timedeath),</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">strokeordeath =</span> <span class="fu">ifelse</span>(stroke <span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>, death))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-75_88b82e0aa7bc2731d11bcbe35ee9ff50">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co">#Data manipulations and plots</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co">#Core survival analysis routines</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer) <span class="co">#Plots of survival curves</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We fit the Cox proportional hazards model for stroke-free survival including the covariates ESVEA, sex, age, and systolic blood pressure using the function <strong>coxph</strong> from the survival package (just like we did in exercise 2.4.1).</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-76_6929cf9216e92bb1f65093e0c2dfcb46">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox model for stroke-free survival including ESVEA, sex, age and systolic blood pressure</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>cox241 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp , <span class="at">data =</span> chs_data, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox241)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea + 
    sex + age + sbp, data = chs_data, method = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

          coef exp(coef) se(coef)     z Pr(&gt;|z|)    
esvea 0.318284  1.374767 0.152587 2.086   0.0370 *  
sex   0.577585  1.781731 0.126946 4.550 5.37e-06 ***
age   0.076658  1.079673 0.009362 8.189 2.64e-16 ***
sbp   0.005152  1.005165 0.002438 2.113   0.0346 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
esvea     1.375     0.7274     1.019     1.854
sex       1.782     0.5613     1.389     2.285
age       1.080     0.9262     1.060     1.100
sbp       1.005     0.9949     1.000     1.010

Concordance= 0.672  (se = 0.016 )
Likelihood ratio test= 99.45  on 4 df,   p=&lt;2e-16
Wald test            = 104.1  on 4 df,   p=&lt;2e-16
Score (logrank) test = 110  on 4 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>To investigate if the covariate effects may be described as time-constant hazard ratios, we will compare our model from 2.4.1 with models where one of the covariates is allowed to have a time-dependent effect.</p>
<p>This can be done using the time-transform functionality of <strong>coxph</strong>. To make a time-dependent variable the covariate, x, is added together with tt(x) on the right side of ‘~’ in the formula argument. Then tt = function(x,t,…) should be followed by the desired function format of the covariate, x, and time, t. It is also possible to have a function with multiple terms with the use of cbind.</p>
<p>We will investigate the assumption of a time-constant effect of ESVEA by fitting a model with a time-dependent effect of ESVEA allowing for a change in the effect after t=5 years. Multiple other forms of the function could be chosen but we will only illustrate one choice for each covariate.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-77_2b7d724450906c60ca4555058aa37bed">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model including a time-dependent effect of ESVEA</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>cox37_esvea <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">tt</span>(esvea), <span class="at">tt =</span> <span class="cf">function</span>(x,t,...) x<span class="sc">*</span>(t <span class="sc">&gt;</span> <span class="dv">5</span>), <span class="at">data =</span> chs_data, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox37_esvea)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea + 
    sex + age + sbp + tt(esvea), data = chs_data, tt = function(x, 
    t, ...) x * (t &gt; 5), method = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

               coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
esvea      0.778676  2.178587  0.247005  3.152  0.00162 ** 
sex        0.571769  1.771397  0.127045  4.501 6.78e-06 ***
age        0.076059  1.079027  0.009374  8.114 4.89e-16 ***
sbp        0.005220  1.005234  0.002437  2.142  0.03220 *  
tt(esvea) -0.703300  0.494949  0.312607 -2.250  0.02446 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

          exp(coef) exp(-coef) lower .95 upper .95
esvea        2.1786     0.4590    1.3425    3.5353
sex          1.7714     0.5645    1.3809    2.2723
age          1.0790     0.9268    1.0594    1.0990
sbp          1.0052     0.9948    1.0004    1.0100
tt(esvea)    0.4949     2.0204    0.2682    0.9134

Concordance= 0.674  (se = 0.016 )
Likelihood ratio test= 104.4  on 5 df,   p=&lt;2e-16
Wald test            = 110.3  on 5 df,   p=&lt;2e-16
Score (logrank) test = 118.2  on 5 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>We estimate the coefficient of the time-dependent effect of ESVEA to be <span class="math inline">\(\beta_{ESVEA}(t) = 0.7787 - 0.7033 \cdot I(t &gt;5)\)</span>.The model thus predicts a decrease in the effect of having ESVEA on the stroke-free survival hazard after 5 years.</p>
<p>We cannot compare two models using the <strong>anova</strong> function when one of the models contains a tt function. Thus, we must manually calculate the likelihood ratio test. We can use the <strong>logLik</strong> method for a Cox model to extract the log likelihood values. The corresponding p-value is calculated using the chi-squared distribution with, in this case, 1 degree of freedom. The chi-squared distribution function is implemented as <strong>pchisq</strong>.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-78_3c7ced069ffe65a9d26a7606e258ee8e">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood ratio score</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>(LR <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(<span class="fu">logLik</span>(cox241)<span class="sc">-</span><span class="fu">logLik</span>(cox37_esvea))[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.988536</code></pre>
</div>
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Corresponding p-value</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>(pval <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(LR, <span class="at">df =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02551579</code></pre>
</div>
</div>
<p>We get a likelihood ratio test statistic of 4.9885 and a p-value of 0.0255. Thus, allowing ESVEA to have a time-dependent effect is significant. The same conclusion is arrived at when looking at the Wald test for the time-dependent variable</p>
<p>Likewise, we can investigate the assumption of time-constant effect of sex by fitting a model with <span class="math inline">\(\beta_{sex}(t) = \beta_1\log(t) + \beta_2\)</span> and compare it with the model from 2.4.1 using a likelihood ratio test.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-79_0864d4ecb6e7487c16a06cbed8cab039">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model including time-dependent effect of sex </span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>cox37_sex <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">tt</span>(sex), <span class="at">tt =</span> <span class="cf">function</span>(x,t,...) x<span class="sc">*</span><span class="fu">log</span>(t), <span class="at">data =</span> chs_data, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox37_sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea + 
    sex + age + sbp + tt(sex), data = chs_data, tt = function(x, 
    t, ...) x * log(t), method = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

             coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
esvea    0.317259  1.373358  0.152637  2.079   0.0377 *  
sex      0.678261  1.970448  0.320259  2.118   0.0342 *  
age      0.076592  1.079601  0.009364  8.179 2.85e-16 ***
sbp      0.005159  1.005172  0.002437  2.116   0.0343 *  
tt(sex) -0.053603  0.947808  0.156076 -0.343   0.7313    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
esvea      1.3734     0.7281     1.018     1.852
sex        1.9704     0.5075     1.052     3.691
age        1.0796     0.9263     1.060     1.100
sbp        1.0052     0.9949     1.000     1.010
tt(sex)    0.9478     1.0551     0.698     1.287

Concordance= 0.671  (se = 0.016 )
Likelihood ratio test= 99.56  on 5 df,   p=&lt;2e-16
Wald test            = 104.2  on 5 df,   p=&lt;2e-16
Score (logrank) test = 110.2  on 5 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>We estimate the coefficient of the time-dependent effect of sex to be <span class="math inline">\(\beta_{sex}(t) = -0.0536 \log(t) + 0.6783\)</span>.</p>
<p>Then, we can compare this model with the one from exercise 2.4.1 with a likelihood ratio test.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-80_a18c4eb32163e14336e6e3850df9fa96">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>(LR <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(<span class="fu">logLik</span>(cox241)<span class="sc">-</span><span class="fu">logLik</span>(cox37_sex))[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1193583</code></pre>
</div>
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Corresponding p-value</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>(pval <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(LR, <span class="at">df =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7297315</code></pre>
</div>
</div>
<p>We get a likelihood ratio test statistic of 0.1194 and a p-value of 0.7297. Thus, we do not find evidence against the assumption of a time-constant effect of sex. The Wald test leads to the same conclusion.</p>
<p>We will check the assumption of a time-constant effect of age by including an indicator of whether the current age is greater than 70, i.e.&nbsp;<span class="math inline">\(\beta_{age}(t) = \beta_1 + \beta_2\cdot I((age + t) &gt; 70)\)</span>.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-81_aff3971d4a2baf8cf332608324f9da0b">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model including a time-dependent effect of age</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>cox37_age <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span>  esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">tt</span>(age), <span class="at">tt =</span> <span class="cf">function</span>(x,t,...) {cur_age <span class="ot">&lt;-</span> (x <span class="sc">+</span> t) </span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">age70=</span><span class="dv">1</span><span class="sc">*</span>(cur_age<span class="sc">&gt;</span><span class="dv">70</span>))}, <span class="at">data =</span> chs_data, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox37_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ esvea + 
    sex + age + sbp + tt(age), data = chs_data, tt = function(x, 
    t, ...) {
    cur_age &lt;- (x + t)
    cbind(age70 = 1 * (cur_age &gt; 70))
}, method = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

            coef exp(coef) se(coef)     z Pr(&gt;|z|)    
esvea   0.311458  1.365414 0.152621 2.041   0.0413 *  
sex     0.593524  1.810357 0.127159 4.668 3.05e-06 ***
age     0.058507  1.060252 0.014310 4.089 4.34e-05 ***
sbp     0.005063  1.005076 0.002446 2.069   0.0385 *  
tt(age) 0.375266  1.455379 0.223680 1.678   0.0934 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
esvea       1.365     0.7324    1.0124     1.842
sex         1.810     0.5524    1.4110     2.323
age         1.060     0.9432    1.0309     1.090
sbp         1.005     0.9950    1.0003     1.010
tt(age)     1.455     0.6871    0.9388     2.256

Concordance= 0.671  (se = 0.016 )
Likelihood ratio test= 102.3  on 5 df,   p=&lt;2e-16
Wald test            = 103.5  on 5 df,   p=&lt;2e-16
Score (logrank) test = 111.1  on 5 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>We estimate the coefficient of the time-dependent effect of age to be <span class="math inline">\(\beta_{age}(t) = 0.0585 + 0.3753 \cdot I(age + t &gt; 70)\)</span>.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-82_ecd7b049e14976e6eef6114aadacb85b">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>(LR <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(<span class="fu">logLik</span>(cox241)<span class="sc">-</span><span class="fu">logLik</span>(cox37_age))[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.819952</code></pre>
</div>
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Corresponding p-value</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>(pval <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(LR, <span class="at">df =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09309917</code></pre>
</div>
</div>
<p>We get a likelihood ratio test statistic of 2.8206 and a p-value of 0.0931. Thus, there is no evidence against the assumption of a time-constant effect of age.</p>
<p>Lastly, we will check the assumption of time-constant effect of systolic blood pressure. We will investigate a model where <span class="math inline">\(\beta_{sbp}(t) = \beta_1\cdot t + \beta_2\)</span>.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-83_3ed947d524a7cd5e89a9dd75abe7fae2">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model including time-dependent effect of systolic blood pressure</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>cox37_sbp <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> age <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">tt</span>(sbp), <span class="at">tt =</span> <span class="cf">function</span>(x,t,...) x<span class="sc">*</span>t, <span class="at">data =</span> chs_data, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox37_sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ age + 
    esvea + sex + sbp + tt(sbp), data = chs_data, tt = function(x, 
    t, ...) x * t, method = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

              coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    
age      7.665e-02  1.080e+00  9.363e-03  8.187 2.67e-16 ***
esvea    3.184e-01  1.375e+00  1.526e-01  2.086    0.037 *  
sex      5.776e-01  1.782e+00  1.269e-01  4.550 5.37e-06 ***
sbp      5.321e-03  1.005e+00  5.354e-03  0.994    0.320    
tt(sbp) -2.107e-05  1.000e+00  5.960e-04 -0.035    0.972    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
age         1.080     0.9262    1.0600     1.100
esvea       1.375     0.7273    1.0194     1.854
sex         1.782     0.5613    1.3892     2.285
sbp         1.005     0.9947    0.9948     1.016
tt(sbp)     1.000     1.0000    0.9988     1.001

Concordance= 0.672  (se = 0.016 )
Likelihood ratio test= 99.45  on 5 df,   p=&lt;2e-16
Wald test            = 104.1  on 5 df,   p=&lt;2e-16
Score (logrank) test = 110  on 5 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>We get an estimated time-dependent coefficient for the effect of systolic blood pressure of <span class="math inline">\(\beta_{sbp}(t) = 5.321 \cdot 10^{-3} - 2.107 \cdot 10^{-5} \cdot t\)</span>.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-84_53ce2c0e4dcf166e674d0d683056e4d9">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRT</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>(LR <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(<span class="fu">logLik</span>(cox241) <span class="sc">-</span> <span class="fu">logLik</span>(cox37_sbp))[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.001249678</code></pre>
</div>
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Corresponding p-value</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>(pval <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(LR, <span class="at">df =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9718</code></pre>
</div>
</div>
<p>We get a likelihood ratio test statistic of 0.0012 and a corresponding p-value of 0.9718 Thus, we cannot reject the hypothesis that the effect of systolic blood pressure is time-constant.</p>
</div>
<div id="tabset-38-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-38-2-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-85_7ae3bec6590fc7e410f180f546818828">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We fit the Cox proportional hazards model for stroke-free survival including the covariates ESVEA, sex, age, and </span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="co">  systolic blood pressure like we did in exercise 2.4.1.;</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.7: Cox model from exercise 2.4.1"</span>;</span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=chs_<span class="kw">data</span>;</span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> timestrokeordeath*strokeordeath(<span class="dv">0</span>)=esvea sex age sbp;</span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a><span class="co">* To investigate if the covariates may be described as time-constant hazard ratios, we will compare our model from exercise 2.4.1 </span></span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a><span class="co">  with models where one of the covariates, Z, is assumed time-dependent, i.e. Z(t) = Z*f(t) for some function t of time.;</span></span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a><span class="co">* We will investigate the assumption of a time-constant effect of ESVEA by fitting a Cox model with a time-dependent effect of ESVEA </span></span>
<span id="cb259-13"><a href="#cb259-13" aria-hidden="true" tabindex="-1"></a><span class="co">  described by Z(t) = x1*I(t &gt; 5 years) + x2. Multiple other forms of the function could be chosen but we will only illustrate one </span></span>
<span id="cb259-14"><a href="#cb259-14" aria-hidden="true" tabindex="-1"></a><span class="co">  choice of f(t) for each covariate.;</span></span>
<span id="cb259-15"><a href="#cb259-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-16"><a href="#cb259-16" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.7: Cox model with time-dependent effect of ESVEA"</span>;</span>
<span id="cb259-17"><a href="#cb259-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=chs_<span class="kw">data</span>;</span>
<span id="cb259-18"><a href="#cb259-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> timestrokeordeath*strokeordeath(<span class="dv">0</span>)=esvea sex age sbp esveat0;</span>
<span id="cb259-19"><a href="#cb259-19" aria-hidden="true" tabindex="-1"></a>    esveat0 = (esvea=<span class="dv">1</span>)*(timestrokeordeath &gt; <span class="dv">5</span>);</span>
<span id="cb259-20"><a href="#cb259-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-21"><a href="#cb259-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-22"><a href="#cb259-22" aria-hidden="true" tabindex="-1"></a><span class="co">* We estimate the coefficient of the time-dependent effect of ESVEA to be Z(t) = 0.7788 - 0.0734*I(t &gt; 5). The model thus predicts a decrease </span></span>
<span id="cb259-23"><a href="#cb259-23" aria-hidden="true" tabindex="-1"></a><span class="co">  in the effect of having ESVEA on the stroke-free survival hazard after 5 years.;</span></span>
<span id="cb259-24"><a href="#cb259-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-25"><a href="#cb259-25" aria-hidden="true" tabindex="-1"></a><span class="co">* We can then compare the model with the one from exercise 2.4.1 using a likelihood ratio test. This is done by comparing the likelihood </span></span>
<span id="cb259-26"><a href="#cb259-26" aria-hidden="true" tabindex="-1"></a><span class="co">  scores for the two models and then calculating the p-value using the Chi-square distribution with 1 degrees of freedom. The likelihood </span></span>
<span id="cb259-27"><a href="#cb259-27" aria-hidden="true" tabindex="-1"></a><span class="co">  scores are found in the 'Model Fit Statistics' table;</span></span>
<span id="cb259-28"><a href="#cb259-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-29"><a href="#cb259-29" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.7: Likelihood ratio test investigating the assumption of a time-constant effect of ESVEA"</span>;</span>
<span id="cb259-30"><a href="#cb259-30" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb259-31"><a href="#cb259-31" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">3457.955-3452.967</span>;</span>
<span id="cb259-32"><a href="#cb259-32" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">1</span>);</span>
<span id="cb259-33"><a href="#cb259-33" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb259-34"><a href="#cb259-34" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-35"><a href="#cb259-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-36"><a href="#cb259-36" aria-hidden="true" tabindex="-1"></a><span class="co">*  We get a Chi-square statistic of 4.988 on 1 degree of freedom and a correpsonding p-value of 0.0255. Thus, including ESVEA as a time-</span></span>
<span id="cb259-37"><a href="#cb259-37" aria-hidden="true" tabindex="-1"></a><span class="co">   dependent covariate is significant on a 0.05 significance level. The same conclusion appears when studying the Wald test.;</span> </span>
<span id="cb259-38"><a href="#cb259-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-39"><a href="#cb259-39" aria-hidden="true" tabindex="-1"></a><span class="co">* Likewise, we can investigate the assumption of time-constant effect of sex by fitting a Cox model with Z(t) = x1*log(t) + x2.;</span> </span>
<span id="cb259-40"><a href="#cb259-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-41"><a href="#cb259-41" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.7: Cox model with a time-dependent effect of sex"</span>;</span>
<span id="cb259-42"><a href="#cb259-42" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=chs_<span class="kw">data</span>;</span>
<span id="cb259-43"><a href="#cb259-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> timestrokeordeath*strokeordeath(<span class="dv">0</span>)=esvea sex age sbp sexlogtime;</span>
<span id="cb259-44"><a href="#cb259-44" aria-hidden="true" tabindex="-1"></a>    sexlogtime = (sex=<span class="dv">1</span>)*<span class="fu">log</span>(timestrokeordeath);</span>
<span id="cb259-45"><a href="#cb259-45" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-46"><a href="#cb259-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-47"><a href="#cb259-47" aria-hidden="true" tabindex="-1"></a><span class="co">* We estimate the coefficient of the time-dependent effect of sex to be Z(t) = -0.0536*log(t) + 0.6783.;</span></span>
<span id="cb259-48"><a href="#cb259-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-49"><a href="#cb259-49" aria-hidden="true" tabindex="-1"></a><span class="co">*Then, we can compare this model with the one from exercise 2.4.1 with a likelihood ratio test.;</span></span>
<span id="cb259-50"><a href="#cb259-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-51"><a href="#cb259-51" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.7: Likelihood ratio test investigating the assumption of a time-constant effect of sex"</span>;</span>
<span id="cb259-52"><a href="#cb259-52" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb259-53"><a href="#cb259-53" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">3457.955-3457.836</span>;</span>
<span id="cb259-54"><a href="#cb259-54" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">1</span>);</span>
<span id="cb259-55"><a href="#cb259-55" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb259-56"><a href="#cb259-56" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-57"><a href="#cb259-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-58"><a href="#cb259-58" aria-hidden="true" tabindex="-1"></a><span class="co">* We get a Chi-square statistic of 0.119 on 1 degree of freedom and a correpsonding p-value of 0.7301. We conclude that we do not have </span></span>
<span id="cb259-59"><a href="#cb259-59" aria-hidden="true" tabindex="-1"></a><span class="co">  evidence against the assumption of a time-constant hazard ratio for sex. Same conclusion for the Wald test.;</span></span>
<span id="cb259-60"><a href="#cb259-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-61"><a href="#cb259-61" aria-hidden="true" tabindex="-1"></a><span class="co">* We will check the assumption of a time-constant effect of age by including an indicator of whether the current age is greater than 70, </span></span>
<span id="cb259-62"><a href="#cb259-62" aria-hidden="true" tabindex="-1"></a><span class="co">  i.e. Z(t) = x1 + x2*I((age + t) &gt; 70), in our Cox model.;</span></span>
<span id="cb259-63"><a href="#cb259-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-64"><a href="#cb259-64" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.7: Cox model with a time-dependent effect of age"</span>;</span>
<span id="cb259-65"><a href="#cb259-65" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=chs_<span class="kw">data</span>;</span>
<span id="cb259-66"><a href="#cb259-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> timestrokeordeath*strokeordeath(<span class="dv">0</span>)=esvea sex age sbp aget0;</span>
<span id="cb259-67"><a href="#cb259-67" aria-hidden="true" tabindex="-1"></a>    aget0 = ((age + timestrokeordeath) &gt; <span class="dv">70</span>);</span>
<span id="cb259-68"><a href="#cb259-68" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-69"><a href="#cb259-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-70"><a href="#cb259-70" aria-hidden="true" tabindex="-1"></a><span class="co">* We estimate the coefficient of the time-dependent effect of age to be  Z(t) = 0.0585  +  0.3753*I(age + t &gt; 70).;</span></span>
<span id="cb259-71"><a href="#cb259-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-72"><a href="#cb259-72" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, we can compare this model with the one from exercise 2.4.1 using a likelihood ratio test.;</span></span>
<span id="cb259-73"><a href="#cb259-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-74"><a href="#cb259-74" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb259-75"><a href="#cb259-75" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">3457.955-3455.135</span>;</span>
<span id="cb259-76"><a href="#cb259-76" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">1</span>);</span>
<span id="cb259-77"><a href="#cb259-77" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb259-78"><a href="#cb259-78" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-79"><a href="#cb259-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-80"><a href="#cb259-80" aria-hidden="true" tabindex="-1"></a><span class="co">* We get a Chi-square statistic of 2.82 on 1 degree of freedom and a correpsonding p-value of 0.0931. Thus, our inclusion of age as a</span></span>
<span id="cb259-81"><a href="#cb259-81" aria-hidden="true" tabindex="-1"></a><span class="co">  time-dependent covariate does not provide evidence against the assumption of a time-constant hazard ratio of age.</span></span>
<span id="cb259-82"><a href="#cb259-82" aria-hidden="true" tabindex="-1"></a><span class="co">  Same conclusion for the Wald test.;</span></span>
<span id="cb259-83"><a href="#cb259-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-84"><a href="#cb259-84" aria-hidden="true" tabindex="-1"></a><span class="co">* Lastly, we will check the assumption of time-constant effect of systolic blood pressure. We will investigate a model where </span></span>
<span id="cb259-85"><a href="#cb259-85" aria-hidden="true" tabindex="-1"></a><span class="co">  Z(t) = x1* + x2.;</span></span>
<span id="cb259-86"><a href="#cb259-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-87"><a href="#cb259-87" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=chs_<span class="kw">data</span>;</span>
<span id="cb259-88"><a href="#cb259-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> timestrokeordeath*strokeordeath(<span class="dv">0</span>)=esvea sex age sbp sbptime;</span>
<span id="cb259-89"><a href="#cb259-89" aria-hidden="true" tabindex="-1"></a>    sbptime = sbp*timestrokeordeath;</span>
<span id="cb259-90"><a href="#cb259-90" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-91"><a href="#cb259-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-92"><a href="#cb259-92" aria-hidden="true" tabindex="-1"></a><span class="co">* We get an estimated time-dependent coefficient for the effect of systolic blood pressure of Z(t) = 5.32*10^{-3} - 2.11*10^{-5}*t.;</span></span>
<span id="cb259-93"><a href="#cb259-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-94"><a href="#cb259-94" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, we can compare this model with the one from exercise 2.4.1 using a likelihood ratio test.;</span></span>
<span id="cb259-95"><a href="#cb259-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-96"><a href="#cb259-96" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb259-97"><a href="#cb259-97" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">3457.955-3457.954</span>;</span>
<span id="cb259-98"><a href="#cb259-98" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">1</span>);</span>
<span id="cb259-99"><a href="#cb259-99" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb259-100"><a href="#cb259-100" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb259-101"><a href="#cb259-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-102"><a href="#cb259-102" aria-hidden="true" tabindex="-1"></a><span class="co">* We get a Chi-square statistic of 0.001 on 1 degree of freedom and a correpsonding p-value of 0.9748.Thus, we do not have evidence </span></span>
<span id="cb259-103"><a href="#cb259-103" aria-hidden="true" tabindex="-1"></a><span class="co">  against the assumption of a time-constant effect of systolic blood pressure.  Same conclusion for the Wald test.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-3.8" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.8">Exercise 3.8</h3>
<p><em>Consider the Cox model for stroke-free survival in the Copenhagen Holter study including the covariates ESVEA, sex, age, and systolic blood pressure. Add to that model the time-dependent covariate I(AF <span class="math inline">\(\leq\)</span> t). How does this affect the effect of ESVEA?</em>.</p>
<p>Since the following exercises investigate the effect of AF on stroke-free survival, we will neglect diagnoses of AF after a stroke. Furthermore, we will replace the NA’s in <strong>timeafib</strong> with 15.5, i.e.&nbsp;longer than any observation time in the study.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-39-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-1" role="tab" aria-controls="tabset-39-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-39-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-2" role="tab" aria-controls="tabset-39-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-39-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-39-1-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-86_b84d3e9ec86a0fd51cafd59d3ba4cfc1">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span>  </span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">afib =</span> <span class="fu">ifelse</span>(afib <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timeafib <span class="sc">&gt;</span> timestrokeordeath, <span class="dv">0</span>, afib),</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#timestroke = ifelse(stroke == 1, timestroke, timedeath),</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">timeafib =</span> <span class="fu">ifelse</span>(afib <span class="sc">==</span> <span class="dv">1</span>, timeafib, <span class="fl">15.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we can include the time-dependent covariate I(AF <span class="math inline">\(\leq\)</span> t) using the tt functionality described in exercise 3.7.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-87_7ef30085ded44dcf33a7a72efd070448">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cox model including time-dependent covariate I(AF &lt;= t)</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>cox38 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> age <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> sbp <span class="sc">+</span> <span class="fu">tt</span>(timeafib), <span class="at">tt =</span> <span class="cf">function</span>(x,t,...)</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">*</span>(x <span class="sc">&lt;=</span> t), <span class="at">data =</span> chs_data, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox38)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ age + 
    esvea + sex + sbp + tt(timeafib), data = chs_data, tt = function(x, 
    t, ...) 1 * (x &lt;= t), method = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

                 coef exp(coef) se(coef)     z Pr(&gt;|z|)    
age          0.075481  1.078403 0.009389 8.039 9.05e-16 ***
esvea        0.225996  1.253571 0.154934 1.459   0.1447    
sex          0.568302  1.765267 0.127591 4.454 8.42e-06 ***
sbp          0.004936  1.004948 0.002441 2.022   0.0432 *  
tt(timeafib) 0.977881  2.658815 0.192421 5.082 3.74e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

             exp(coef) exp(-coef) lower .95 upper .95
age              1.078     0.9273    1.0587     1.098
esvea            1.254     0.7977    0.9253     1.698
sex              1.765     0.5665    1.3747     2.267
sbp              1.005     0.9951    1.0002     1.010
tt(timeafib)     2.659     0.3761    1.8235     3.877

Concordance= 0.683  (se = 0.016 )
Likelihood ratio test= 120.2  on 5 df,   p=&lt;2e-16
Wald test            = 131.5  on 5 df,   p=&lt;2e-16
Score (logrank) test = 143.4  on 5 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>We get a hazard ratio of exp(0.226) = 1.2536 for ESVEA with a Wald test of 1.459 and a corresponding p-value of 0.1447. Thus, having ESVEA is (insignificantly) associated with a higher rate of stroke or death.</p>
<p>The effect of being diagnosed with AF before time t is highly significant and associated with a much higher rate for the composite end-point compared to those not diagnosed with AF at time t.</p>
</div>
<div id="tabset-39-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-39-2-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-88_1eb83a4aa983a5c3b2604b485d54401f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co">* Since the following exercises investigates the effect of AF on stroke-free survival, we will neglect diagnoses of AF </span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="co">  after a stroke. ;</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> afib = <span class="dv">1</span> <span class="kw">and</span> timeafib &gt; timestrokeordeath <span class="kw">then</span> afib = <span class="dv">0</span>;</span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a><span class="co">* We will include a time-dependent covariate I(AF &lt;= t) to our Cox model.;</span></span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.8: Cox model including the time-dependent covariate I(AF &lt; t)"</span>;</span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=chs_<span class="kw">data</span>;</span>
<span id="cb263-13"><a href="#cb263-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> timestrokeordeath*strokeordeath(<span class="dv">0</span>) = esvea sex age sbp timeaf;</span>
<span id="cb263-14"><a href="#cb263-14" aria-hidden="true" tabindex="-1"></a>    timeaf = <span class="dv">0</span>;</span>
<span id="cb263-15"><a href="#cb263-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> afib = <span class="dv">1</span> <span class="kw">and</span> timeafib &lt;= timestrokeordeath <span class="kw">then</span> timeaf=<span class="dv">1</span>;</span>
<span id="cb263-16"><a href="#cb263-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb263-17"><a href="#cb263-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-18"><a href="#cb263-18" aria-hidden="true" tabindex="-1"></a><span class="co">* We get a hazard ratio of 1.254 for ESVEA with a Chi-square statistic of 2.1277 on 1 degree of freedom and a correpsonding p-value of </span></span>
<span id="cb263-19"><a href="#cb263-19" aria-hidden="true" tabindex="-1"></a><span class="co">  0.1447. Thus, having ESVEA is associated with shorter stroke-free survival. However, this effect is not significant!;</span> </span>
<span id="cb263-20"><a href="#cb263-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-21"><a href="#cb263-21" aria-hidden="true" tabindex="-1"></a><span class="co">* The effect of being diagnosed with AF before time t is highly significant and associated with a much smaller rate of</span></span>
<span id="cb263-22"><a href="#cb263-22" aria-hidden="true" tabindex="-1"></a><span class="co">  stroke-free survival compared to those not diagnosed with AF at time t.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-3.9" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.9">Exercise 3.9</h3>
<p><em>Consider the Cox model for stroke-free survival in the Copenhagen Holter study including the covariates ESVEA, sex, age, and systolic blood pressure. Add to that model, incorrectly, the covariate AF – now considered as time-fixed. How does this affect the AF-effect?</em>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-40-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-1" role="tab" aria-controls="tabset-40-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-40-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-2" role="tab" aria-controls="tabset-40-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-40-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-40-1-tab">
<p>We will now fit a model where AF is considered a time-fixed covariate which will lead to so-called immortal time bias.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-89_ba5a61ba06e163ed5177e3c01f228516">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>cox39 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timestrokeordeath, strokeordeath) <span class="sc">~</span> age <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> sbp <span class="sc">+</span> afib, <span class="at">data =</span> chs_data, <span class="at">method =</span> <span class="st">"breslow"</span>)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox39)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(timestrokeordeath, strokeordeath) ~ age + 
    esvea + sex + sbp + afib, data = chs_data, method = "breslow")

  n= 675, number of events= 285 
   (3 observations deleted due to missingness)

           coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
age    0.077012  1.080055  0.009372  8.217  &lt; 2e-16 ***
esvea  0.326924  1.386696  0.153014  2.137   0.0326 *  
sex    0.581483  1.788689  0.127007  4.578 4.69e-06 ***
sbp    0.005266  1.005280  0.002455  2.145   0.0319 *  
afib  -0.153165  0.857988  0.186411 -0.822   0.4113    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
age       1.080     0.9259    1.0604     1.100
esvea     1.387     0.7211    1.0274     1.872
sex       1.789     0.5591    1.3945     2.294
sbp       1.005     0.9947    1.0005     1.010
afib      0.858     1.1655    0.5954     1.236

Concordance= 0.673  (se = 0.016 )
Likelihood ratio test= 100.2  on 5 df,   p=&lt;2e-16
Wald test            = 105  on 5 df,   p=&lt;2e-16
Score (logrank) test = 111  on 5 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>We get a hazard ratio of <span class="math inline">\(\exp(-0.1532) = 0.8580\)</span> for being diagnosed with AF. The effect of being diagnosed with AF in this model is thus associated with a lower rate of the composite end-point compared to those not diagnosed. The associated Wald test is -0.822 and the p-value is 0.4113.</p>
<p>This contradicts the result from exercise 3.8 where AF was (correctly) included as an time-dependent covariate.</p>
</div>
<div id="tabset-40-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-40-2-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-90_ba283fbc58b1c6676004447657c19564">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We will include AF as a time-fixed covariate to our Cox model which will lead to so-called immortal time bias.;</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.9: Cox model including AF as a time-fixed covariate"</span>;</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=chs_<span class="kw">data</span>;</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> timestrokeordeath*strokeordeath(<span class="dv">0</span>)= esvea sex age sbp afib;</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a><span class="co">* We get a hazard ratio of 0.858 for being diagnosed with AF. The effect of being diagnosed with AF during the study is associated </span></span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a><span class="co">  with a slightly shorter expected stroke-free survival compared to those not diagnosed. However we get a Chi-square statistic of </span></span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a><span class="co">  0.06751 on 1 degree and the p-value is 0.4113. Thus, the effect is not significant.;</span></span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a><span class="co">* This contradicts the result from exercise 3.7 where AF was (correctly) included as an time-dependent covariate.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-3.10" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.10">Exercise 3.10</h3>
<p><em>Consider an illness-death model for the Copenhagen Holter study with states ‘0: Alive without AF or stroke’, ‘1: Alive with AF and no stroke’, ‘2: Dead or stroke’, see Figures 1.3 and 1.7</em>.</p>
<section id="section" class="level4">
<h4 class="anchored" data-anchor-id="section">1.</h4>
<p><em>Fit separate Cox models for the rates of the composite end-point for subjects without or with AF, i.e.&nbsp;for the 0-&gt;2 and 1-&gt;2 transitions including the covariates ESVEA, sex, age, and systolic blood pressure. The time variable in both models should be time since recruitment</em>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-41-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-1" role="tab" aria-controls="tabset-41-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-41-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-2" role="tab" aria-controls="tabset-41-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-41-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-41-1-tab">
<p>We will fit two separate Cox models for the 0-&gt;2 and 1-&gt;2 transitions including ESVEA, sex, age, and systolic blood pressure using the procedure described in Section 3.8.</p>
<p>We must first add two new time variables, <strong>timeoutof0</strong> and <strong>timeoutof1</strong> which will indicate time last seen in state 0 and state 1, respectively, and a new censoring variable, <strong>strokeordeath0</strong> indicating whether a subject transited to state 2 directly from state 0.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-91_1a31c5d2895109dfb88dea44bea80b62">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span>  </span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">timeoutof0 =</span> <span class="fu">ifelse</span>(afib <span class="sc">==</span> <span class="dv">1</span>, timeafib, timestrokeordeath),</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strokeordeath0 =</span> <span class="fu">ifelse</span>(afib <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, strokeordeath),</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">timeoutof1 =</span> <span class="fu">ifelse</span>(afib <span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> timeafib <span class="sc">==</span> timestrokeordeath, timestrokeordeath <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">/</span><span class="fl">365.25</span>, timestrokeordeath))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we can make the duplicated data set. All potential 0-&gt;2 transitions will be represented by a row where <strong>stratum</strong> is 0 whereas potential 1-&gt;2 transitions will have <strong>stratum</strong> equal to 1; <strong>entrytime</strong> and <strong>time</strong> will denote the time of entry and the last time seen in state 0 or 1 while <strong>status</strong> indicates whether a stroke or death occurred at time <strong>time</strong>. Furthermore, the covariates associated with the 0-&gt;2 transition are denoted <strong>esvea0</strong>, <strong>sex0</strong>, <strong>age0</strong>, and <strong>sbp0</strong> while the covariates associated with the 1-&gt;2 transition are denoted <strong>esvea1</strong>, <strong>sex1</strong>, <strong>age1</strong>, and <strong>sbp1</strong>.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-92_9e51fbe02be85404264f795e4793be88">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data set for 0 -&gt; 2 transition</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>double0 <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">stratum =</span> <span class="dv">0</span>,</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">entrytime =</span> <span class="dv">0</span>,</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">time =</span> timeoutof0,</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">status =</span> strokeordeath0,</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sex0 =</span> sex,</span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">age0 =</span> age,</span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">esvea0 =</span> esvea,</span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sbp0 =</span> sbp,</span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sex1 =</span> <span class="dv">0</span>,</span>
<span id="cb268-11"><a href="#cb268-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">age1 =</span> <span class="dv">0</span>, </span>
<span id="cb268-12"><a href="#cb268-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">esvea1 =</span> <span class="dv">0</span>,</span>
<span id="cb268-13"><a href="#cb268-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sbp1 =</span> <span class="dv">0</span>)</span>
<span id="cb268-14"><a href="#cb268-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-15"><a href="#cb268-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Data set for 1 -&gt; 2 transition</span></span>
<span id="cb268-16"><a href="#cb268-16" aria-hidden="true" tabindex="-1"></a>double1 <span class="ot">&lt;-</span> chs_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(afib <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb268-17"><a href="#cb268-17" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">stratum =</span> <span class="dv">1</span>,</span>
<span id="cb268-18"><a href="#cb268-18" aria-hidden="true" tabindex="-1"></a>                               <span class="at">entrytime =</span> timeafib,</span>
<span id="cb268-19"><a href="#cb268-19" aria-hidden="true" tabindex="-1"></a>                               <span class="at">time =</span> timeoutof1,</span>
<span id="cb268-20"><a href="#cb268-20" aria-hidden="true" tabindex="-1"></a>                               <span class="at">status =</span> strokeordeath,</span>
<span id="cb268-21"><a href="#cb268-21" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sex0 =</span> <span class="dv">0</span>,</span>
<span id="cb268-22"><a href="#cb268-22" aria-hidden="true" tabindex="-1"></a>                               <span class="at">age0 =</span> <span class="dv">0</span>,</span>
<span id="cb268-23"><a href="#cb268-23" aria-hidden="true" tabindex="-1"></a>                               <span class="at">esvea0 =</span> <span class="dv">0</span>,</span>
<span id="cb268-24"><a href="#cb268-24" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sbp0 =</span> <span class="dv">0</span>,</span>
<span id="cb268-25"><a href="#cb268-25" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sex1 =</span> sex,</span>
<span id="cb268-26"><a href="#cb268-26" aria-hidden="true" tabindex="-1"></a>                               <span class="at">age1 =</span> age, </span>
<span id="cb268-27"><a href="#cb268-27" aria-hidden="true" tabindex="-1"></a>                               <span class="at">esvea1 =</span> esvea,</span>
<span id="cb268-28"><a href="#cb268-28" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sbp1 =</span> sbp)</span>
<span id="cb268-29"><a href="#cb268-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-30"><a href="#cb268-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicated data set as described in section 3.8.1</span></span>
<span id="cb268-31"><a href="#cb268-31" aria-hidden="true" tabindex="-1"></a>double <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(double0, double1))                          </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, we will use <strong>coxph</strong> to fit the two separate Cox models; <strong>entrytime</strong>, <strong>time</strong> and <strong>status</strong> are given to the <strong>Surv</strong> object and <strong>strata(stratum)</strong>, <strong>esvea0</strong>, <strong>sex0</strong>, <strong>age0</strong>, <strong>sbp0</strong>, <strong>esvea1</strong>, <strong>sex1</strong>, <strong>age1</strong>, and <strong>sbp1</strong> are included on the right side of ‘~’.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-93_6a6c6363eeff82a935ec3d02543518c1">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Different covariate effects and non-proportional hazards</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>cox3101 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status) <span class="sc">~</span> <span class="fu">strata</span>(stratum) <span class="sc">+</span> esvea0 <span class="sc">+</span> sex0 <span class="sc">+</span> age0 <span class="sc">+</span> sbp0 <span class="sc">+</span> esvea1 <span class="sc">+</span> sex1 <span class="sc">+</span> age1 <span class="sc">+</span> sbp1, <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox3101)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entrytime, time, status) ~ strata(stratum) + 
    esvea0 + sex0 + age0 + sbp0 + esvea1 + sex1 + age1 + sbp1, 
    data = double, ties = "breslow")

  n= 745, number of events= 285 
   (3 observations deleted due to missingness)

            coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
esvea0  0.340371  1.405468  0.164122  2.074   0.0381 *  
sex0    0.638729  1.894071  0.135913  4.700 2.61e-06 ***
age0    0.073487  1.076254  0.009901  7.422 1.15e-13 ***
sbp0    0.004901  1.004913  0.002608  1.879   0.0602 .  
esvea1 -0.215942  0.805782  0.458157 -0.471   0.6374    
sex1    0.132627  1.141824  0.400110  0.331   0.7403    
age1    0.089863  1.094024  0.033608  2.674   0.0075 ** 
sbp1    0.003389  1.003395  0.007783  0.435   0.6632    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

       exp(coef) exp(-coef) lower .95 upper .95
esvea0    1.4055     0.7115    1.0189     1.939
sex0      1.8941     0.5280    1.4511     2.472
age0      1.0763     0.9291    1.0556     1.097
sbp0      1.0049     0.9951    0.9998     1.010
esvea1    0.8058     1.2410    0.3283     1.978
sex1      1.1418     0.8758    0.5212     2.501
age1      1.0940     0.9141    1.0243     1.169
sbp1      1.0034     0.9966    0.9882     1.019

Concordance= 0.671  (se = 0.017 )
Likelihood ratio test= 94.23  on 8 df,   p=&lt;2e-16
Wald test            = 98.8  on 8 df,   p=&lt;2e-16
Score (logrank) test = 104.1  on 8 df,   p=&lt;2e-16</code></pre>
</div>
</div>
</div>
<div id="tabset-41-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-41-2-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-94_284f49e31ece6e1949fcac9880479e26">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We will fit two separate Cox models for 0-&gt;2/3 and 1-&gt;2/3 transitions including ESVEA, sex, age, and systolic blood pressure using </span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="co">  the procedure described in section 3.8. Thus, we will first make the duplicated data set.</span></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="co">  We must first add two new time variables, 'timeoutof0' and 'timeoutof1' which will indicate time last seen in state 0 and state 1,</span></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a><span class="co">  respectively, and a new censoring variable, 'strokeordeath0' indicating whether a subject transitioned to state 2 or 3 directly </span></span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a><span class="co">  from state 0.;</span></span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> chs_<span class="kw">data</span>;</span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a>    timeoutof0 = timestrokeordeath;</span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> afib = <span class="dv">1</span> <span class="kw">then</span> timeoutof0 = timeafib;</span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a>    strokeordeath0 = strokeordeath;</span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> afib = <span class="dv">1</span> <span class="kw">then</span> strokeordeath0 = <span class="dv">0</span>;</span>
<span id="cb271-14"><a href="#cb271-14" aria-hidden="true" tabindex="-1"></a>    timeoutof1 = timestrokeordeath;</span>
<span id="cb271-15"><a href="#cb271-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> afib = <span class="dv">1</span> <span class="kw">and</span> timeafib = timestrokeordeath <span class="kw">then</span> timeoutof1 = timestrokeordeath + <span class="dv">0.5</span>/<span class="dv">365.25</span>;</span>
<span id="cb271-16"><a href="#cb271-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb271-17"><a href="#cb271-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-18"><a href="#cb271-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-19"><a href="#cb271-19" aria-hidden="true" tabindex="-1"></a><span class="co">/* Then, we can make the duplicated data set. All potential 0-&gt;2/3 transitions will be represented by a row where 'stratum' is 0</span></span>
<span id="cb271-20"><a href="#cb271-20" aria-hidden="true" tabindex="-1"></a><span class="co">  whereas potential 1-&gt;2/3 transitions will have 'stratum' equal to 1. 'entrytime' and 'time' will denote the time of entry </span></span>
<span id="cb271-21"><a href="#cb271-21" aria-hidden="true" tabindex="-1"></a><span class="co">  and the last time seen in state 0 or 1 while 'status' indicates whether a stroke or death occurred at time 'time'. Furthermore, </span></span>
<span id="cb271-22"><a href="#cb271-22" aria-hidden="true" tabindex="-1"></a><span class="co">  the covariates associated with the 0-&gt;2/3 transition are denoted 'esvea0', 'sex0', age0', and 'sbp0' while the covariates </span></span>
<span id="cb271-23"><a href="#cb271-23" aria-hidden="true" tabindex="-1"></a><span class="co">  associated with the 1-&gt;2/3 transition are denoted 'esvea1', 'sex1', 'age1', and 'sbp1'.;</span></span>
<span id="cb271-24"><a href="#cb271-24" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb271-25"><a href="#cb271-25" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> double0;</span>
<span id="cb271-26"><a href="#cb271-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb271-27"><a href="#cb271-27" aria-hidden="true" tabindex="-1"></a>    entrytime = <span class="dv">0</span>;</span>
<span id="cb271-28"><a href="#cb271-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span> = timeoutof0;</span>
<span id="cb271-29"><a href="#cb271-29" aria-hidden="true" tabindex="-1"></a>    status = strokeordeath0;</span>
<span id="cb271-30"><a href="#cb271-30" aria-hidden="true" tabindex="-1"></a>    esvea0 = esvea;</span>
<span id="cb271-31"><a href="#cb271-31" aria-hidden="true" tabindex="-1"></a>    sex0 = sex;</span>
<span id="cb271-32"><a href="#cb271-32" aria-hidden="true" tabindex="-1"></a>    age0 = age;</span>
<span id="cb271-33"><a href="#cb271-33" aria-hidden="true" tabindex="-1"></a>    sbp0 = sbp;</span>
<span id="cb271-34"><a href="#cb271-34" aria-hidden="true" tabindex="-1"></a>    esvea1 = <span class="dv">0</span>;</span>
<span id="cb271-35"><a href="#cb271-35" aria-hidden="true" tabindex="-1"></a>    sex1 = <span class="dv">0</span>;</span>
<span id="cb271-36"><a href="#cb271-36" aria-hidden="true" tabindex="-1"></a>    age1 = <span class="dv">0</span>;</span>
<span id="cb271-37"><a href="#cb271-37" aria-hidden="true" tabindex="-1"></a>    sbp1 = <span class="dv">0</span>;</span>
<span id="cb271-38"><a href="#cb271-38" aria-hidden="true" tabindex="-1"></a>    stratum = <span class="dv">0</span>;</span>
<span id="cb271-39"><a href="#cb271-39" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb271-40"><a href="#cb271-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-41"><a href="#cb271-41" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> double1;</span>
<span id="cb271-42"><a href="#cb271-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> chs_<span class="kw">data</span>;</span>
<span id="cb271-43"><a href="#cb271-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> afib = <span class="dv">1</span>;</span>
<span id="cb271-44"><a href="#cb271-44" aria-hidden="true" tabindex="-1"></a>    entrytime = timeafib;</span>
<span id="cb271-45"><a href="#cb271-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">time</span> = timeoutof1;</span>
<span id="cb271-46"><a href="#cb271-46" aria-hidden="true" tabindex="-1"></a>    status = strokeordeath;</span>
<span id="cb271-47"><a href="#cb271-47" aria-hidden="true" tabindex="-1"></a>    esvea0 = <span class="dv">0</span>;</span>
<span id="cb271-48"><a href="#cb271-48" aria-hidden="true" tabindex="-1"></a>    sex0 = <span class="dv">0</span>;</span>
<span id="cb271-49"><a href="#cb271-49" aria-hidden="true" tabindex="-1"></a>    age0 = <span class="dv">0</span>;</span>
<span id="cb271-50"><a href="#cb271-50" aria-hidden="true" tabindex="-1"></a>    sbp0 = <span class="dv">0</span>;</span>
<span id="cb271-51"><a href="#cb271-51" aria-hidden="true" tabindex="-1"></a>    esvea1 = esvea;</span>
<span id="cb271-52"><a href="#cb271-52" aria-hidden="true" tabindex="-1"></a>    sex1 = sex;</span>
<span id="cb271-53"><a href="#cb271-53" aria-hidden="true" tabindex="-1"></a>    age1 = age;</span>
<span id="cb271-54"><a href="#cb271-54" aria-hidden="true" tabindex="-1"></a>    sbp1 = sbp;</span>
<span id="cb271-55"><a href="#cb271-55" aria-hidden="true" tabindex="-1"></a>    stratum = <span class="dv">1</span>;</span>
<span id="cb271-56"><a href="#cb271-56" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb271-57"><a href="#cb271-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-58"><a href="#cb271-58" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> double;</span>
<span id="cb271-59"><a href="#cb271-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> double0 double1;</span>
<span id="cb271-60"><a href="#cb271-60" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb271-61"><a href="#cb271-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-62"><a href="#cb271-62" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb271-63"><a href="#cb271-63" aria-hidden="true" tabindex="-1"></a><span class="co">Finally, we will use **phreg** to fit the two separate Cox models. 'entrytime', 'time' and 'status' are given to the left of '=' and</span></span>
<span id="cb271-64"><a href="#cb271-64" aria-hidden="true" tabindex="-1"></a><span class="co">and 'esvea0', 'sex0', 'age0', 'sbp0', 'esvea1', 'sex1', 'age1', and 'sbp1' are included on the right side of '='. Furthermore, 'stratum' </span></span>
<span id="cb271-65"><a href="#cb271-65" aria-hidden="true" tabindex="-1"></a><span class="co">is given in the strata statement</span></span>
<span id="cb271-66"><a href="#cb271-66" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb271-67"><a href="#cb271-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-68"><a href="#cb271-68" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.10.1: Separate Cox models for stroke-free survival for subjects</span></span>
<span id="cb271-69"><a href="#cb271-69" aria-hidden="true" tabindex="-1"></a>with <span class="kw">or</span> without AF<span class="st">";</span></span>
<span id="cb271-70"><a href="#cb271-70" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span> = double;</span>
<span id="cb271-71"><a href="#cb271-71" aria-hidden="true" tabindex="-1"></a>    strata stratum;</span>
<span id="cb271-72"><a href="#cb271-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> (entrytime, <span class="fu">time</span>)*status(<span class="dv">0</span>)= esvea0 sex0 age0 sbp0 esvea1 sex1 age1 sbp1; </span>
<span id="cb271-73"><a href="#cb271-73" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-1" class="level4">
<h4 class="anchored" data-anchor-id="section-1">2.</h4>
<p><em>Examine to what extent a combined model for the two intensities (i.e., possibly with common regression coefficients and/or proportional hazards between the 0-&gt;2 and 1-&gt;2 transition rates) may be fitted</em>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-42-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-1" role="tab" aria-controls="tabset-42-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-42-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-2" role="tab" aria-controls="tabset-42-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-42-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-42-1-tab">
<p>We will examine whether a model that assumes the same covariate effect for the two transitions describes our data just as well as the model we fitted in exercise 3.10.1.</p>
<p>Thus, we will fit a model where <strong>esvea0</strong>, <strong>sex0</strong>, <strong>age0</strong>, <strong>sbp0</strong>, <strong>esvea1</strong>, <strong>sex1</strong>, <strong>age1</strong>, and <strong>sbp1</strong> are replaced with <strong>esvea</strong>, <strong>sex</strong>, <strong>age</strong>, and <strong>sbp</strong>.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-95_83b14727c843f3f29463b188804de272">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Non-proportional hazards same covariate effects</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>cox3102_cov <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status) <span class="sc">~</span> <span class="fu">strata</span>(stratum) <span class="sc">+</span> esvea <span class="sc">+</span> sex <span class="sc">+</span> age <span class="sc">+</span> sbp, <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox3102_cov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entrytime, time, status) ~ strata(stratum) + 
    esvea + sex + age + sbp, data = double, ties = "breslow")

  n= 745, number of events= 285 
   (3 observations deleted due to missingness)

          coef exp(coef) se(coef)     z Pr(&gt;|z|)    
esvea 0.239402  1.270489 0.155198 1.543   0.1229    
sex   0.570975  1.769993 0.127545 4.477 7.58e-06 ***
age   0.075759  1.078703 0.009403 8.057 7.80e-16 ***
sbp   0.004721  1.004732 0.002441 1.934   0.0531 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      exp(coef) exp(-coef) lower .95 upper .95
esvea     1.270     0.7871    0.9373     1.722
sex       1.770     0.5650    1.3785     2.273
age       1.079     0.9270    1.0590     1.099
sbp       1.005     0.9953    0.9999     1.010

Concordance= 0.67  (se = 0.017 )
Likelihood ratio test= 89.42  on 4 df,   p=&lt;2e-16
Wald test            = 93.38  on 4 df,   p=&lt;2e-16
Score (logrank) test = 98.05  on 4 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>Then, we can compare this model with the one from exercise 3.10.1 using a likelihood ratio test.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-96_dbe87c52f727131ac2d314046cdff5c1">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing whether the effect of the covariate is the same for the two transitions</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(cox3101, cox3102_cov, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(entrytime, time, status)
 Model 1: ~ strata(stratum) + esvea0 + sex0 + age0 + sbp0 + esvea1 + sex1 + age1 + sbp1
 Model 2: ~ strata(stratum) + esvea + sex + age + sbp
   loglik Chisq Df Pr(&gt;|Chi|)
1 -1624.4                    
2 -1626.8 4.811  4     0.3072</code></pre>
</div>
</div>
<p>We get a chi-squared statistic of 4.811 on 4 degrees of freedom and a corresponding p-value of 0.3072. Thus, it seems like the new model with common regression coefficients describes our data as well as the one from exercise 3.10.1.</p>
<p>We will now examine the assumption of non-proportional hazards. Thus, we must first fit a Cox model where the hazards for subjects with or without AF are assumed proportional. This is done by including AF as a time-dependent covariate like we did in exercise 3.8.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-97_67a67672edf45fb2206d6fff5e0d0273">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>cox3102_ph <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status) <span class="sc">~</span>  esvea0 <span class="sc">+</span> sex0 <span class="sc">+</span> age0 <span class="sc">+</span> sbp0 <span class="sc">+</span> esvea1 <span class="sc">+</span> sex1 <span class="sc">+</span> age1 <span class="sc">+</span> sbp1 <span class="sc">+</span> <span class="fu">tt</span>(timeafib), <span class="at">tt =</span> <span class="cf">function</span>(x,t,...) <span class="dv">1</span><span class="sc">*</span>(x<span class="sc">&lt;</span>t), <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox3102_ph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entrytime, time, status) ~ esvea0 + sex0 + 
    age0 + sbp0 + esvea1 + sex1 + age1 + sbp1 + tt(timeafib), 
    data = double, ties = "breslow", tt = function(x, t, ...) 1 * 
        (x &lt; t))

  n= 745, number of events= 285 
   (3 observations deleted due to missingness)

                  coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
esvea0        0.341970  1.407718  0.164133  2.083  0.03721 *  
sex0          0.636327  1.889528  0.135926  4.681 2.85e-06 ***
age0          0.073566  1.076339  0.009898  7.432 1.07e-13 ***
sbp0          0.004914  1.004926  0.002608  1.884  0.05953 .  
esvea1       -0.283100  0.753444  0.443362 -0.639  0.52313    
sex1          0.179135  1.196182  0.406807  0.440  0.65969    
age1          0.090772  1.095019  0.033689  2.694  0.00705 ** 
sbp1          0.005282  1.005296  0.008090  0.653  0.51380    
tt(timeafib)  0.200521  1.222040  3.063985  0.065  0.94782    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

             exp(coef) exp(-coef) lower .95 upper .95
esvea0          1.4077     0.7104  1.020483     1.942
sex0            1.8895     0.5292  1.447616     2.466
age0            1.0763     0.9291  1.055660     1.097
sbp0            1.0049     0.9951  0.999803     1.010
esvea1          0.7534     1.3272  0.315981     1.797
sex1            1.1962     0.8360  0.538918     2.655
age1            1.0950     0.9132  1.025051     1.170
sbp1            1.0053     0.9947  0.989482     1.021
tt(timeafib)    1.2220     0.8183  0.003013   495.626

Concordance= 0.683  (se = 0.016 )
Likelihood ratio test= 125.4  on 9 df,   p=&lt;2e-16
Wald test            = 137.1  on 9 df,   p=&lt;2e-16
Score (logrank) test = 158.9  on 9 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>Then the baseline hazards from the Cox model fitted in exercise 3.10.1 are plotted against each other (solid line). Furthermore, a (dashed) straight line through (0,0) with a slope equal to the hazard ratio for the time-dependent covariate AF is added to the plot.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-98_345fd03b27566a094145c80ee480780c">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cumulative hazard for subjects without AF</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>from0_haz <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="fu">subset</span>(<span class="fu">basehaz</span>(cox3101, <span class="at">centered =</span> <span class="cn">FALSE</span>), strata <span class="sc">==</span> <span class="st">"stratum=0"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(from0_haz) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"haz0"</span>, <span class="st">"time"</span>)</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Cumulative hazard for subjects with AF</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>from1_haz <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="fu">subset</span>(<span class="fu">basehaz</span>(cox3101, <span class="at">centered =</span> <span class="cn">FALSE</span>), strata <span class="sc">==</span> <span class="st">"stratum=1"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(from1_haz) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"haz1"</span>, <span class="st">"time"</span>)</span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Data frame with time column and both hazards</span></span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>ph_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(from0_haz, from1_haz, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a>ph_data <span class="ot">&lt;-</span> ph_data <span class="sc">%&gt;%</span> <span class="fu">fill</span>(haz0,haz1)</span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the hazards against each other</span></span>
<span id="cb278-14"><a href="#cb278-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ph_data) <span class="sc">+</span> <span class="fu">geom_step</span>(<span class="fu">aes</span>(haz0, haz1)) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="fl">1.222040</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Cumulative hazard for subjects without AF"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Cumulative hazard for subjects with AF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid" width="1122"></p>
</div>
</div>
<p>The model assuming proportional hazards does not seem to fit the data well, since the dashed straight line does not coincide nicely with the solid curve.</p>
<p>We now investigate this further by adding a (linear) time-dependent effect of <strong>afib</strong>.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-99_f217adfe7c5a5a51df933f0b318fec37">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>cox3103_ph <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(entrytime, time, status) <span class="sc">~</span>  esvea0 <span class="sc">+</span> sex0 <span class="sc">+</span> age0 <span class="sc">+</span> sbp0 <span class="sc">+</span> esvea1 <span class="sc">+</span> sex1 <span class="sc">+</span> age1 <span class="sc">+</span> sbp1 <span class="sc">+</span> <span class="fu">tt</span>(timeafib), <span class="at">tt =</span> <span class="cf">function</span>(x,t,...) <span class="fu">cbind</span>(<span class="at">af=</span><span class="dv">1</span><span class="sc">*</span>(x<span class="sc">&lt;</span>t), <span class="at">taf=</span><span class="dv">1</span><span class="sc">*</span>(x<span class="sc">&lt;</span>t)<span class="sc">*</span>(t<span class="sc">-</span>x)), <span class="at">data =</span> double, <span class="at">ties =</span> <span class="st">"breslow"</span>)</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox3103_ph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(entrytime, time, status) ~ esvea0 + sex0 + 
    age0 + sbp0 + esvea1 + sex1 + age1 + sbp1 + tt(timeafib), 
    data = double, ties = "breslow", tt = function(x, t, ...) cbind(af = 1 * 
        (x &lt; t), taf = 1 * (x &lt; t) * (t - x)))

  n= 745, number of events= 285 
   (3 observations deleted due to missingness)

                     coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
esvea0           0.343335  1.409642  0.164130  2.092  0.03645 *  
sex0             0.637169  1.891119  0.135922  4.688 2.76e-06 ***
age0             0.073679  1.076462  0.009898  7.444 9.75e-14 ***
sbp0             0.004925  1.004937  0.002607  1.889  0.05891 .  
esvea1          -0.148546  0.861961  0.442120 -0.336  0.73688    
sex1             0.224451  1.251636  0.402565  0.558  0.57715    
age1             0.092251  1.096640  0.032720  2.819  0.00481 ** 
sbp1             0.005316  1.005330  0.007869  0.676  0.49936    
tt(timeafib)af   0.442310  1.556298  2.888679  0.153  0.87830    
tt(timeafib)taf -0.121806  0.885320  0.067670 -1.800  0.07186 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

                exp(coef) exp(-coef) lower .95 upper .95
esvea0             1.4096     0.7094  1.021882     1.945
sex0               1.8911     0.5288  1.448845     2.468
age0               1.0765     0.9290  1.055781     1.098
sbp0               1.0049     0.9951  0.999815     1.010
esvea1             0.8620     1.1601  0.362372     2.050
sex1               1.2516     0.7990  0.568610     2.755
age1               1.0966     0.9119  1.028521     1.169
sbp1               1.0053     0.9947  0.989943     1.021
tt(timeafib)af     1.5563     0.6426  0.005411   447.653
tt(timeafib)taf    0.8853     1.1295  0.775353     1.011

Concordance= 0.683  (se = 0.016 )
Likelihood ratio test= 129.1  on 10 df,   p=&lt;2e-16
Wald test            = 144.8  on 10 df,   p=&lt;2e-16
Score (logrank) test = 171.1  on 10 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>This results in a p-value of 0.07186, thus emphasizing that the proportional hazards assumption is questionable.</p>
</div>
<div id="tabset-42-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-42-2-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-100_ac84a5cfb29a20dcc66d60b57200a321">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* We will examine whether a model that assumes the same covariate effect for the two transitions describes our data just as good as </span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="co">  the model we fitted in exercise 3.10.1.</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="co"> Thus, we will fit a model where 'esvea0', 'sex0', 'age0', 'sbp0', 'esvea1', 'sex1', 'age1', and 'sbp1' are replaced with 'esvea', </span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a><span class="co">  'sex', 'age', and 'sbp'.</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-8"><a href="#cb281-8" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.10.2: Cox model assuming the same effect of the covariates for 0-&gt;2/3 and 1-&gt;2/3"</span>;</span>
<span id="cb281-9"><a href="#cb281-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span> = double;</span>
<span id="cb281-10"><a href="#cb281-10" aria-hidden="true" tabindex="-1"></a>    strata stratum;</span>
<span id="cb281-11"><a href="#cb281-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> (entrytime, <span class="fu">time</span>)*status(<span class="dv">0</span>) = esvea sex age sbp;</span>
<span id="cb281-12"><a href="#cb281-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-13"><a href="#cb281-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-14"><a href="#cb281-14" aria-hidden="true" tabindex="-1"></a><span class="co">/* Then we can compare this model with the one from exercise 3.10.1 with a likelihood ratio test using the scores from the tables </span></span>
<span id="cb281-15"><a href="#cb281-15" aria-hidden="true" tabindex="-1"></a><span class="co">  'Model Fit Statistics'</span></span>
<span id="cb281-16"><a href="#cb281-16" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb281-17"><a href="#cb281-17" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.10.2: Examining the assumption of same covariate effect"</span>;</span>
<span id="cb281-18"><a href="#cb281-18" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> p;</span>
<span id="cb281-19"><a href="#cb281-19" aria-hidden="true" tabindex="-1"></a>    chi2=<span class="dv">3253.556-3248.745</span>;</span>
<span id="cb281-20"><a href="#cb281-20" aria-hidden="true" tabindex="-1"></a>    p=<span class="dv">1</span>-<span class="fu">probchi</span>(chi2,<span class="dv">4</span>);</span>
<span id="cb281-21"><a href="#cb281-21" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print;</span>
<span id="cb281-22"><a href="#cb281-22" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-23"><a href="#cb281-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-24"><a href="#cb281-24" aria-hidden="true" tabindex="-1"></a><span class="co">* We get a Chi-square statistics of 4.811 on 4 degrees of freedom and a corresponding p-value of 0.3072. Thus, it seems like the </span></span>
<span id="cb281-25"><a href="#cb281-25" aria-hidden="true" tabindex="-1"></a><span class="co">  new model with common regression coefficients describes our data as good as the one from exercise 3.10.1.;</span></span>
<span id="cb281-26"><a href="#cb281-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-27"><a href="#cb281-27" aria-hidden="true" tabindex="-1"></a><span class="co">* We will now examine the assumption of proportional hazards. We must extract the baseline hazards for subjects with or without AF </span></span>
<span id="cb281-28"><a href="#cb281-28" aria-hidden="true" tabindex="-1"></a><span class="co">  in the model where the hazards are assumed non-proportional. Thus, we fit a model from exercise 3.10.1 once more and specify that </span></span>
<span id="cb281-29"><a href="#cb281-29" aria-hidden="true" tabindex="-1"></a><span class="co">  all covariates should be 0.;</span>  </span>
<span id="cb281-30"><a href="#cb281-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-31"><a href="#cb281-31" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> covstr;</span>
<span id="cb281-32"><a href="#cb281-32" aria-hidden="true" tabindex="-1"></a>    esvea0 = <span class="dv">0</span>; sex0 = <span class="dv">0</span>; age0 = <span class="dv">0</span>; sbp0 = <span class="dv">0</span>;</span>
<span id="cb281-33"><a href="#cb281-33" aria-hidden="true" tabindex="-1"></a>    esvea1 = <span class="dv">0</span>; sex1 = <span class="dv">0</span>; age1 = <span class="dv">0</span>; sbp1 = <span class="dv">0</span>;</span>
<span id="cb281-34"><a href="#cb281-34" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-35"><a href="#cb281-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-36"><a href="#cb281-36" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span> = double;</span>
<span id="cb281-37"><a href="#cb281-37" aria-hidden="true" tabindex="-1"></a>    strata stratum;</span>
<span id="cb281-38"><a href="#cb281-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> (entrytime, <span class="fu">time</span>)*status(<span class="dv">0</span>)= esvea0 sex0 age0 sbp0 esvea1 sex1 age1 sbp1;</span>
<span id="cb281-39"><a href="#cb281-39" aria-hidden="true" tabindex="-1"></a>    baseline out=hazdata cumhaz = breslow covariates = covstr;</span>
<span id="cb281-40"><a href="#cb281-40" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-41"><a href="#cb281-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-42"><a href="#cb281-42" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow023;</span>
<span id="cb281-43"><a href="#cb281-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> hazdata; </span>
<span id="cb281-44"><a href="#cb281-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stratum=<span class="dv">0</span>; </span>
<span id="cb281-45"><a href="#cb281-45" aria-hidden="true" tabindex="-1"></a>    a023=breslow; </span>
<span id="cb281-46"><a href="#cb281-46" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-47"><a href="#cb281-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-48"><a href="#cb281-48" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow123;</span>
<span id="cb281-49"><a href="#cb281-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> hazdata;</span>
<span id="cb281-50"><a href="#cb281-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stratum=<span class="dv">1</span>;</span>
<span id="cb281-51"><a href="#cb281-51" aria-hidden="true" tabindex="-1"></a>    a123=breslow;</span>
<span id="cb281-52"><a href="#cb281-52" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-53"><a href="#cb281-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-54"><a href="#cb281-54" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow; </span>
<span id="cb281-55"><a href="#cb281-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">merge</span> breslow023 breslow123; </span>
<span id="cb281-56"><a href="#cb281-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> <span class="fu">time</span>; </span>
<span id="cb281-57"><a href="#cb281-57" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-58"><a href="#cb281-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-59"><a href="#cb281-59" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, the empty cells of the cumulative hazards are replaced with the previous values;</span></span>
<span id="cb281-60"><a href="#cb281-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-61"><a href="#cb281-61" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow; </span>
<span id="cb281-62"><a href="#cb281-62" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> breslow;</span>
<span id="cb281-63"><a href="#cb281-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">by</span> <span class="fu">time</span>;</span>
<span id="cb281-64"><a href="#cb281-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">retain</span> last1 last2;</span>
<span id="cb281-65"><a href="#cb281-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> a023=. <span class="kw">then</span> cumhaz0=last1; <span class="kw">if</span> a023 ne . <span class="kw">then</span> cumhaz0=a023; </span>
<span id="cb281-66"><a href="#cb281-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> a123=. <span class="kw">then</span> cumhaz1=last2; <span class="kw">if</span> a123 ne . <span class="kw">then</span> cumhaz1=a123;</span>
<span id="cb281-67"><a href="#cb281-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span>;</span>
<span id="cb281-68"><a href="#cb281-68" aria-hidden="true" tabindex="-1"></a>    last1=cumhaz0; last2=cumhaz1; </span>
<span id="cb281-69"><a href="#cb281-69" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-70"><a href="#cb281-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-71"><a href="#cb281-71" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, we must fit a Cox model where the hazards for subjects with or without AF are assumed proportional. This is done by </span></span>
<span id="cb281-72"><a href="#cb281-72" aria-hidden="true" tabindex="-1"></a><span class="co">  including AF as an time-dependent covariate like we did in exercise 3.7.;</span></span>
<span id="cb281-73"><a href="#cb281-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-74"><a href="#cb281-74" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span> = double;</span>
<span id="cb281-75"><a href="#cb281-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> (entrytime, <span class="fu">time</span>)*status(<span class="dv">0</span>) = esvea0 sex0 age0 sbp0 esvea1 sex1 age1 sbp1 timedepaf;</span>
<span id="cb281-76"><a href="#cb281-76" aria-hidden="true" tabindex="-1"></a>    timedepaf = <span class="dv">0</span>;</span>
<span id="cb281-77"><a href="#cb281-77" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> afib = <span class="dv">1</span> <span class="kw">and</span> <span class="fu">time</span> &gt; timeafib <span class="kw">then</span> timedepaf = <span class="dv">1</span>;</span>
<span id="cb281-78"><a href="#cb281-78" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-79"><a href="#cb281-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-80"><a href="#cb281-80" aria-hidden="true" tabindex="-1"></a><span class="co">* Lastly, the predicted hazard ratio for the time-dependent covariate is added to the data as the slope of a straigth line </span></span>
<span id="cb281-81"><a href="#cb281-81" aria-hidden="true" tabindex="-1"></a><span class="co">  through (0,0);</span></span>
<span id="cb281-82"><a href="#cb281-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-83"><a href="#cb281-83" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> breslow; </span>
<span id="cb281-84"><a href="#cb281-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> breslow;</span>
<span id="cb281-85"><a href="#cb281-85" aria-hidden="true" tabindex="-1"></a>    line=<span class="dv">1.222</span>*cumhaz0;</span>
<span id="cb281-86"><a href="#cb281-86" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-87"><a href="#cb281-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-88"><a href="#cb281-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-89"><a href="#cb281-89" aria-hidden="true" tabindex="-1"></a><span class="co">* Finally, we can check the assumption of proportional hazards by plotting the hazards from the model assuming non-</span></span>
<span id="cb281-90"><a href="#cb281-90" aria-hidden="true" tabindex="-1"></a><span class="co">  proportional hazards against each other together with the straigth line through (0,0) with a slope equal to the hazard ratio of </span></span>
<span id="cb281-91"><a href="#cb281-91" aria-hidden="true" tabindex="-1"></a><span class="co">  AF.;</span></span>
<span id="cb281-92"><a href="#cb281-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-93"><a href="#cb281-93" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">"3.10.2: Examining the assumption of proportional hazards"</span>;</span>
<span id="cb281-94"><a href="#cb281-94" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> gplot<span class="kw"> data</span>=breslow;</span>
<span id="cb281-95"><a href="#cb281-95" aria-hidden="true" tabindex="-1"></a>    plot cumhaz1*cumhaz0 line*cumhaz0/haxis=axis1 vaxis=axis2 overlay;</span>
<span id="cb281-96"><a href="#cb281-96" aria-hidden="true" tabindex="-1"></a>    axis1 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.0014</span> <span class="kw">by</span> <span class="dv">0.0001</span> minor=none <span class="kw">label</span>=(<span class="st">'Cumulative baseline hazard for subjects without AF'</span>);</span>
<span id="cb281-97"><a href="#cb281-97" aria-hidden="true" tabindex="-1"></a>    axis2 <span class="kw">order</span>=<span class="dv">0</span> <span class="kw">to</span> <span class="dv">0.0022</span> <span class="kw">by</span> <span class="dv">0.0001</span> minor=none <span class="kw">label</span>=(a=<span class="dv">90</span> <span class="st">'Cumulative baseline hazard for subjects with AF'</span>);</span>
<span id="cb281-98"><a href="#cb281-98" aria-hidden="true" tabindex="-1"></a>    symbol1  v=none i=stepjl c=red;</span>
<span id="cb281-99"><a href="#cb281-99" aria-hidden="true" tabindex="-1"></a>    symbol2  v=none i=rl c=blue;</span>
<span id="cb281-100"><a href="#cb281-100" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-101"><a href="#cb281-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-102"><a href="#cb281-102" aria-hidden="true" tabindex="-1"></a><span class="co">*The model assuming proportional hazards does not seem to fit the data well, since the straigth blue line does not coincide nicely </span></span>
<span id="cb281-103"><a href="#cb281-103" aria-hidden="true" tabindex="-1"></a><span class="co"> with the red curve.;</span> </span>
<span id="cb281-104"><a href="#cb281-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-105"><a href="#cb281-105" aria-hidden="true" tabindex="-1"></a><span class="co">*The proportional hazards assumption may also be investigated using a time-dependent covariate: duration since af.;</span></span>
<span id="cb281-106"><a href="#cb281-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-107"><a href="#cb281-107" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span> = double;</span>
<span id="cb281-108"><a href="#cb281-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> (entrytime, <span class="fu">time</span>)*status(<span class="dv">0</span>) = esvea0 sex0 age0 sbp0 esvea1 sex1 age1 sbp1 timedepaf duration;</span>
<span id="cb281-109"><a href="#cb281-109" aria-hidden="true" tabindex="-1"></a>    timedepaf = <span class="dv">0</span>;</span>
<span id="cb281-110"><a href="#cb281-110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> afib = <span class="dv">1</span> <span class="kw">and</span> <span class="fu">time</span> &gt; timeafib <span class="kw">then</span> timedepaf = <span class="dv">1</span>;</span>
<span id="cb281-111"><a href="#cb281-111" aria-hidden="true" tabindex="-1"></a>    duration=<span class="dv">0</span>;</span>
<span id="cb281-112"><a href="#cb281-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> timedepaf = <span class="dv">1</span> <span class="kw">then</span> duration = <span class="fu">time</span> - timeafib;</span>
<span id="cb281-113"><a href="#cb281-113" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb281-114"><a href="#cb281-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-115"><a href="#cb281-115" aria-hidden="true" tabindex="-1"></a><span class="co">*This, once more, suggests borderline deviations from proportional hazards.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise-3.11" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.11">Exercise 3.11</h3>
<p><em>Consider the data on repeated episodes in affective disorder, Example 1.1.5</em>.</p>
<section id="section-2" class="level4">
<h4 class="anchored" data-anchor-id="section-2">1.</h4>
<p><em>Fit separate gamma frailty models for unipolar and bipolar patients including the covariate ‘number of previous events’ <span class="math inline">\(N(t-)\)</span> assuming (not quite satisfactorily!) that the mortality rate is independent of frailty</em>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-43-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-43-1" role="tab" aria-controls="tabset-43-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-43-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-43-2" role="tab" aria-controls="tabset-43-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-43-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-43-1-tab">
<p>The data should be loaded as <strong>affective_data</strong></p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-101_ee89cc1ccdc327a42f194afffc048173">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>affective_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/affective.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then load the relevant packages</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-102_3ae24a2a1ba41578471cfa350f7431b9">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co">#Data manipulations and plots</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co">#Core survival analysis routines</span></span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can fit a gamma frailty model including the number of previous events assuming that the mortality rate is independent of frailty using the <strong>coxph</strong> function and adding <strong>fraily(id)</strong> and <strong>episode</strong> in the formula argument.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-103_7b6957ac8e82714296cff9dd525b4d96">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting a gamma frailty model for patients with unipolar disorder</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>frailty3111_uni <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> episode <span class="sc">+</span> <span class="fu">frailty</span>(id), </span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"breslow"</span>, </span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">subset</span>(affective_data, bip <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(frailty3111_uni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ episode + frailty(id), 
    data = subset(affective_data, bip == 0), method = "breslow")

  n= 927, number of events= 381 

            coef    se(coef) se2     Chisq  DF    p      
episode     0.02813 0.01756  0.01497   2.57  1.00 1.1e-01
frailty(id)                          228.73 66.27 9.8e-20

        exp(coef) exp(-coef) lower .95 upper .95
episode     1.029     0.9723    0.9937     1.065

Iterations: 6 outer, 26 Newton-Raphson
     Variance of random effect= 0.7084416   I-likelihood = -1535.1 
Degrees of freedom for terms=  0.7 66.3 
Concordance= 0.775  (se = 0.016 )
Likelihood ratio test= 338.1  on 66.99 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p>Thus, we obtain a hazard ratio of <span class="math inline">\(\exp(0.0281) = 1.029\)</span> for the number of previous episodes for patients with unipolar disorder.</p>
<p>We will now fit a gamma frailty model for the patients with bipolar disorder</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-104_6a7986775d1cb7ce667bc6959764e700">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting a gamma frailty model for patients with bipolar disorder</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>frailty3111_bip <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(start, stop, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> episode <span class="sc">+</span> <span class="fu">frailty</span>(id), </span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"breslow"</span>, </span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">subset</span>(affective_data, bip <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(frailty3111_bip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(start, stop, status == 1) ~ episode + frailty(id), 
    data = subset(affective_data, bip == 1), method = "breslow")

  n= 360, number of events= 161 

            coef    se(coef) se2     Chisq DF   p    
episode     0.07605 0.03179  0.02665  5.72 1.00 0.017
frailty(id)                          18.92 9.79 0.038

        exp(coef) exp(-coef) lower .95 upper .95
episode     1.079     0.9268     1.014     1.148

Iterations: 7 outer, 30 Newton-Raphson
     Variance of random effect= 0.1391285   I-likelihood = -448 
Degrees of freedom for terms= 0.7 9.8 
Concordance= 0.657  (se = 0.034 )
Likelihood ratio test= 49.91  on 10.5 df,   p=4e-07</code></pre>
</div>
</div>
<p>We get an estimate of the hazard ratio for the number of episodes of <span class="math inline">\(\exp(0.0761) = 1.079\)</span> for patients diagnosed with bipolar disorder.</p>
</div>
<div id="tabset-43-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-43-2-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-105_e232b3804b7a489e223ffd09fdbebdeb">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We first load the data;</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=affective_<span class="kw">data</span></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>    datafile=<span class="st">'data/affective.csv'</span> </span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>    dbms=csv <span class="kw">replace</span>;</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>    getnames=yes;</span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a><span class="co">* We can fit a gamma frailty model using the phreg procedure where we include a random statement where we specify </span></span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a><span class="co">'dist = gamma'.;</span> </span>
<span id="cb288-11"><a href="#cb288-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-12"><a href="#cb288-12" aria-hidden="true" tabindex="-1"></a><span class="co">* We will first fit a frailty model for the subset of patients with unipolar disorder.;</span></span>
<span id="cb288-13"><a href="#cb288-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-14"><a href="#cb288-14" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'3.11.1 - unipolar disorder'</span>;</span>
<span id="cb288-15"><a href="#cb288-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=affective_<span class="kw">data</span>;</span>
<span id="cb288-16"><a href="#cb288-16" aria-hidden="true" tabindex="-1"></a>    class id;</span>
<span id="cb288-17"><a href="#cb288-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> (start,<span class="kw">stop</span>)*status(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">3</span>)=episode;</span>
<span id="cb288-18"><a href="#cb288-18" aria-hidden="true" tabindex="-1"></a>    random id/dist=<span class="fu">gamma</span>;</span>
<span id="cb288-19"><a href="#cb288-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> state = <span class="dv">0</span> <span class="kw">and</span> bip = <span class="dv">0</span>;</span>
<span id="cb288-20"><a href="#cb288-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb288-21"><a href="#cb288-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-22"><a href="#cb288-22" aria-hidden="true" tabindex="-1"></a><span class="co">* Thus, we obtain a hazard ratio of exp(0.028) = 1.028 for the number of previous episodes for patients with unipolar disorder.;</span></span>
<span id="cb288-23"><a href="#cb288-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-24"><a href="#cb288-24" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, we will fit a frailty model for the patients with bipolar disorder;</span></span>
<span id="cb288-25"><a href="#cb288-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-26"><a href="#cb288-26" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'3.11.1 - bipolar disorder'</span>;</span>
<span id="cb288-27"><a href="#cb288-27" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=affective_<span class="kw">data</span>;</span>
<span id="cb288-28"><a href="#cb288-28" aria-hidden="true" tabindex="-1"></a>    class id;</span>
<span id="cb288-29"><a href="#cb288-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> (start,<span class="kw">stop</span>)*status(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">3</span>)=episode;</span>
<span id="cb288-30"><a href="#cb288-30" aria-hidden="true" tabindex="-1"></a>    random id/dist=<span class="fu">gamma</span>;</span>
<span id="cb288-31"><a href="#cb288-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> state = <span class="dv">0</span> <span class="kw">and</span>  bip = <span class="dv">1</span>;</span>
<span id="cb288-32"><a href="#cb288-32" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb288-33"><a href="#cb288-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-34"><a href="#cb288-34" aria-hidden="true" tabindex="-1"></a><span class="co">* We get an estimate of the hazard ratio for the number of episodes of exp(0.077) = 1.08 for patients diagnosed with bipolar  disorder.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-3" class="level4">
<h4 class="anchored" data-anchor-id="section-3">2.</h4>
<p><em>Do the recurrence rates tend to increase with number of previous episodes?</em>.</p>
<p>The recurrence rates tend to increase with the number of previous episodes both for patients diagnosed with unipolar and bipolar disorder.</p>
</section>
</section>
<section id="exercise-3.12" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3.12">Exercise 3.12</h3>
<p><em>Consider the data on mortality in relation to childhood vaccinations in Guinea-Bissau, Example 1.1.2</em>.</p>
<section id="section-4" class="level4">
<h4 class="anchored" data-anchor-id="section-4">1.</h4>
<p><em>Fit a gamma frailty model with a random effect of cluster (‘village’) including binary variables for BCG and DTP vaccination and adjusting for age at recruitment (i.e., using time since recruitment as time-variable). Compare the results with those in Table 2.12</em>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-44-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-44-1" role="tab" aria-controls="tabset-44-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-44-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-44-2" role="tab" aria-controls="tabset-44-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-44-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-44-1-tab">
<p>The data should be loaded as <strong>bissau_data</strong>:</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-106_78743f47936f80fc0b4d8dd1942e3f93">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>bissau_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/bissau.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then load the relevant packages</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-107_1eb8266b337ea3920707cb16535193cc">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co">#Data manipulations and plots</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co">#Core survival analysis routines</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To make our results comparable to Table 2.12 we must first convert the age variable from days to months.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-108_c9052d2fd9acae65572a3902eca56298">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Age in months</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>bissau_data<span class="sc">$</span>agem <span class="ot">&lt;-</span> bissau_data<span class="sc">$</span>age<span class="sc">/</span><span class="fl">30.4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we will fit a gamma frailty model using the <strong>coxph</strong> function from the <em>survival</em> package where we adjust for age, BCG and DTP and a random effect of cluster. This is done by adding <strong>frailty(cluster)</strong> in the formula argument.</p>
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-109_50470ad2d97582c339db117c5a1fdd7f">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting gamma frailty model</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>fit3121 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fuptime, dead) <span class="sc">~</span> <span class="fu">frailty</span>(cluster) <span class="sc">+</span> bcg <span class="sc">+</span> dtp <span class="sc">+</span> agem, </span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"breslow"</span>, </span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> bissau_data)</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3121)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fuptime, dead) ~ frailty(cluster) + bcg + 
    dtp + agem, data = bissau_data, method = "breslow")

  n= 5274, number of events= 222 

                 coef     se(coef) se2     Chisq DF p    
frailty(cluster)                           0.00  0  0.910
bcg              -0.40977 0.16685  0.16685 6.03  1  0.014
dtp               0.07330 0.10366  0.10366 0.50  1  0.480
agem              0.04006 0.04337  0.04337 0.85  1  0.360

     exp(coef) exp(-coef) lower .95 upper .95
bcg     0.6638     1.5065    0.4786    0.9206
dtp     1.0761     0.9293    0.8782    1.3185
agem    1.0409     0.9607    0.9561    1.1332

Iterations: 6 outer, 20 Newton-Raphson
     Variance of random effect= 5e-07   I-likelihood = -1879.6 
Degrees of freedom for terms= 0 1 1 1 
Concordance= 0.55  (se = 0.018 )
Likelihood ratio test= 6.7  on 3 df,   p=0.08</code></pre>
</div>
</div>
<p>The coefficient for age (month) is estimated to be 0.04 and the coefficient for BCG vaccination is -0.41. In table 2.12 the coefficient for age (month) was 0.055 and the coefficient for BCG was -0.353. Thus, an increasing age increase the hazard and being vaccinated with BCG decrease the hazard in both models in both models.</p>
<p>We furthermore note that our model also adjust for the effect of DTP vaccination unlike the model from Table 2.12. We could also compare with Table 3.2 where dtp is included. Both models suggest an effect of BCG but not DTP.</p>
</div>
<div id="tabset-44-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-44-2-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-110_660efed7f9f03cf43e1a7002e338cb84">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We first load the data;</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> import out=bissau_<span class="kw">data</span></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>  datafile=<span class="st">'data/bissau.csv'</span> </span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>  dbms=csv <span class="kw">replace</span>;</span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a>  getnames=yes;</span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="co">* To make our results comparable to table 2.12 we must first convert the age variable from days to months.;</span></span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-10"><a href="#cb294-10" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> bissau_<span class="kw">data</span>;</span>
<span id="cb294-11"><a href="#cb294-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> bissau_<span class="kw">data</span>;</span>
<span id="cb294-12"><a href="#cb294-12" aria-hidden="true" tabindex="-1"></a>    agem = age/<span class="dv">30.4</span>;</span>
<span id="cb294-13"><a href="#cb294-13" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb294-14"><a href="#cb294-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-15"><a href="#cb294-15" aria-hidden="true" tabindex="-1"></a><span class="co">* Then, we will fit the gamma frailty model using the 'phreg' procedure where we include a random statement with 'dist = gamma' </span></span>
<span id="cb294-16"><a href="#cb294-16" aria-hidden="true" tabindex="-1"></a><span class="co">  included.;</span></span>
<span id="cb294-17"><a href="#cb294-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-18"><a href="#cb294-18" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'3.12.1'</span>;</span>
<span id="cb294-19"><a href="#cb294-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bissau_<span class="kw">data</span>;</span>
<span id="cb294-20"><a href="#cb294-20" aria-hidden="true" tabindex="-1"></a>    class cluster;</span>
<span id="cb294-21"><a href="#cb294-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fuptime*dead(<span class="dv">0</span>)=bcg dtp agem;</span>
<span id="cb294-22"><a href="#cb294-22" aria-hidden="true" tabindex="-1"></a>    random cluster/dist=<span class="fu">gamma</span>;</span>
<span id="cb294-23"><a href="#cb294-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb294-24"><a href="#cb294-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-25"><a href="#cb294-25" aria-hidden="true" tabindex="-1"></a><span class="co">* The coefficient for age (month) is estimated to be 0.04 and the coefficient for BCG vaccination is -0.41. In table 2.12 the </span></span>
<span id="cb294-26"><a href="#cb294-26" aria-hidden="true" tabindex="-1"></a><span class="co">  coefficient for age (month) was 0.055 and the coefficient for BCG was -0.353. Thus, an increasing age increase the hazard and </span></span>
<span id="cb294-27"><a href="#cb294-27" aria-hidden="true" tabindex="-1"></a><span class="co">  being vaccinated with BCG decrease the hazard in both models in both models.;</span></span>
<span id="cb294-28"><a href="#cb294-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-29"><a href="#cb294-29" aria-hidden="true" tabindex="-1"></a><span class="co">* We furthermore note that our model also adjust for the effect of DTP vaccination unlike the model from table 2.12. </span></span>
<span id="cb294-30"><a href="#cb294-30" aria-hidden="true" tabindex="-1"></a><span class="co">  We could also compare with Table 3.2 where dtp is included. Both models suggest an effect of BCG but not DTP.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="section-5" class="level4">
<h4 class="anchored" data-anchor-id="section-5">2.</h4>
<p><em>We fit a Cox model stratified on cluster with the <strong>coxph</strong> function by including <strong>strata(cluster)</strong> in the formula argument</em>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-45-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-45-1" role="tab" aria-controls="tabset-45-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-45-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-45-2" role="tab" aria-controls="tabset-45-2" aria-selected="false">SAS</a></li></ul>
<div class="tab-content">
<div id="tabset-45-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-45-1-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-111_1f1a25dc20969acad443523f91e5804c">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting a Cox model statified on cluster</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>fit3122 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fuptime, dead) <span class="sc">~</span> <span class="fu">strata</span>(cluster) <span class="sc">+</span> bcg <span class="sc">+</span> dtp <span class="sc">+</span> agem, </span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"breslow"</span>, </span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> bissau_data)</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3122)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fuptime, dead) ~ strata(cluster) + bcg + 
    dtp + agem, data = bissau_data, method = "breslow")

  n= 5274, number of events= 222 

         coef exp(coef) se(coef)      z Pr(&gt;|z|)  
bcg  -0.33293   0.71682  0.17832 -1.867   0.0619 .
dtp   0.14412   1.15502  0.11122  1.296   0.1950  
agem  0.02086   1.02108  0.04520  0.462   0.6444  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     exp(coef) exp(-coef) lower .95 upper .95
bcg     0.7168     1.3951    0.5054     1.017
dtp     1.1550     0.8658    0.9288     1.436
agem    1.0211     0.9794    0.9345     1.116

Concordance= 0.537  (se = 0.021 )
Likelihood ratio test= 4.44  on 3 df,   p=0.2
Wald test            = 4.38  on 3 df,   p=0.2
Score (logrank) test = 4.39  on 3 df,   p=0.2</code></pre>
</div>
</div>
<p>The Cox model stratified on cluster and the gamma frailty model agree in the direction BCG, DTP and age change the hazard. However, the gamma frailty model estimates a bigger decrease by being vaccinated with BCG, a smaller increase by being vaccinated with DTP and a larger increase of a positive change in age of the hazard compared to the stratified Cox model.</p>
</div>
<div id="tabset-45-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-45-2-tab">
<div class="cell" data-hash="Ch3_cache/html/unnamed-chunk-112_ce7809c2e90f350c9678baaa6ca0206d">
<details open="">
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode sas code-with-copy"><code class="sourceCode highlightsas"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co">* We fit a Cox model stratified on cluster by adding a 'strata' statement in the 'phreg' procedure;</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="kw">title</span> <span class="st">'3.12.2'</span>;</span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> phreg<span class="kw"> data</span>=bissau_<span class="kw">data</span>;</span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">model</span> fuptime*dead(<span class="dv">0</span>)=bcg dtp agem;</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>    strata cluster;</span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb297-8"><a href="#cb297-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-9"><a href="#cb297-9" aria-hidden="true" tabindex="-1"></a><span class="co">* The Cox model stratified on cluster and the gamma frailty model agree in the direction BCG, DTP and age change the hazard. </span></span>
<span id="cb297-10"><a href="#cb297-10" aria-hidden="true" tabindex="-1"></a><span class="co">  However, the gamma frailty model estimates a bigger decrease by being vaccinated with BCG, a smaller increase by being vaccinated </span></span>
<span id="cb297-11"><a href="#cb297-11" aria-hidden="true" tabindex="-1"></a><span class="co">  with DTP and a larger increase of a positive change in age of the hazard compared to the stratified Cox model.;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch4.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</div>   
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a> and <a href="https://posit.co/products/open-source/rstudio/">RStudio</a></div>
  </div>
</footer>



</body></html>