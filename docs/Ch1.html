<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models for Multi-State Survival Data - 1&nbsp; Introduction and data sets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch2.html" rel="next">
<link href="./index.html" rel="prev">
<link href="./corvos.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./MSBfrontbirds.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Models for Multi-State Survival Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/multi-state-book/companion" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intensity models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intuition for marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Marginal models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pseudo-values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Further topics</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pbc3-trial-in-liver-cirrhosis-pbc3.csv" id="toc-pbc3-trial-in-liver-cirrhosis-pbc3.csv" class="nav-link active" data-scroll-target="#pbc3-trial-in-liver-cirrhosis-pbc3.csv">1.1 PBC3 trial in liver cirrhosis (<code>pbc3.csv</code>)</a></li>
  <li><a href="#guinea-bissau-childhood-vaccination-study-bissau.csv" id="toc-guinea-bissau-childhood-vaccination-study-bissau.csv" class="nav-link" data-scroll-target="#guinea-bissau-childhood-vaccination-study-bissau.csv">1.2 Guinea-Bissau childhood vaccination study (<code>bissau.csv</code>)</a></li>
  <li><a href="#testis-cancer-incidence-and-maternal-parity-testis.csv" id="toc-testis-cancer-incidence-and-maternal-parity-testis.csv" class="nav-link" data-scroll-target="#testis-cancer-incidence-and-maternal-parity-testis.csv">1.3 Testis cancer incidence and maternal parity (<code>testis.csv</code>)</a></li>
  <li><a href="#prova-trial-in-liver-cirrhosis-prova.csv" id="toc-prova-trial-in-liver-cirrhosis-prova.csv" class="nav-link" data-scroll-target="#prova-trial-in-liver-cirrhosis-prova.csv">1.4 PROVA trial in liver cirrhosis (<code>prova.csv</code>)</a></li>
  <li><a href="#recurrent-episodes-in-affective-disorders-affective.csv" id="toc-recurrent-episodes-in-affective-disorders-affective.csv" class="nav-link" data-scroll-target="#recurrent-episodes-in-affective-disorders-affective.csv">1.5 Recurrent episodes in affective disorders (<code>affective.csv</code>)</a></li>
  <li><a href="#leader-cardiovascular-trial-in-type-2-diabetes" id="toc-leader-cardiovascular-trial-in-type-2-diabetes" class="nav-link" data-scroll-target="#leader-cardiovascular-trial-in-type-2-diabetes">1.6 LEADER cardiovascular trial in type 2 Diabetes</a></li>
  <li><a href="#bone-marrow-transplantation-in-acute-leukemia-bmt.csv" id="toc-bone-marrow-transplantation-in-acute-leukemia-bmt.csv" class="nav-link" data-scroll-target="#bone-marrow-transplantation-in-acute-leukemia-bmt.csv">1.7 Bone marrow transplantation in acute leukemia (<code>bmt.csv</code>)</a></li>
  <li><a href="#the-copenhagen-holter-study-cphholter.csv" id="toc-the-copenhagen-holter-study-cphholter.csv" class="nav-link" data-scroll-target="#the-copenhagen-holter-study-cphholter.csv">1.8 The Copenhagen Holter study (<code>cphholter.csv</code>)</a></li>
  <li><a href="#small-set-of-survival-data" id="toc-small-set-of-survival-data" class="nav-link" data-scroll-target="#small-set-of-survival-data">1.9 Small set of survival data</a>
  <ul>
  <li><a href="#create-data" id="toc-create-data" class="nav-link" data-scroll-target="#create-data">Create data</a></li>
  <li><a href="#figure-1.8" id="toc-figure-1.8" class="nav-link" data-scroll-target="#figure-1.8">Figure 1.8</a></li>
  <li><a href="#figure-1.9" id="toc-figure-1.9" class="nav-link" data-scroll-target="#figure-1.9">Figure 1.9</a></li>
  <li><a href="#figure-1.10" id="toc-figure-1.10" class="nav-link" data-scroll-target="#figure-1.10">Figure 1.10</a></li>
  <li><a href="#figure-1.13" id="toc-figure-1.13" class="nav-link" data-scroll-target="#figure-1.13">Figure 1.13</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#exercise-1.1" id="toc-exercise-1.1" class="nav-link" data-scroll-target="#exercise-1.1">Exercise 1.1</a></li>
  <li><a href="#exercise-1.2" id="toc-exercise-1.2" class="nav-link" data-scroll-target="#exercise-1.2">Exercise 1.2</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">1.</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">2.</a></li>
  </ul></li>
  <li><a href="#exercise-1.3" id="toc-exercise-1.3" class="nav-link" data-scroll-target="#exercise-1.3">Exercise 1.3</a>
  <ul class="collapse">
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">1.</a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3">2.</a></li>
  </ul></li>
  <li><a href="#exercise-1.4" id="toc-exercise-1.4" class="nav-link" data-scroll-target="#exercise-1.4">Exercise 1.4 (*)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and data sets</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In the book, examples of event history data are used to illustrate different methods, models and approaches. All the data sets, except the LEADER data, are available for download as CSV files and description of the variables is given below.</p>
<!-- ```{r downloadthis, echo=FALSE} -->
<!-- library(downloadthis) -->
<!-- download_dir( -->
<!--   path = "data", -->
<!--   output_name = "DataFromMSB", -->
<!--   button_label = "Download data sets", -->
<!--   button_type = "success", -->
<!--   has_icon = TRUE, -->
<!--   icon = "fa fa-save", -->
<!--   self_contained = FALSE -->
<!-- ) -->
<!-- ``` -->
<section id="pbc3-trial-in-liver-cirrhosis-pbc3.csv" class="level2">
<h2 class="anchored" data-anchor-id="pbc3-trial-in-liver-cirrhosis-pbc3.csv">1.1 PBC3 trial in liver cirrhosis (<code>pbc3.csv</code>)</h2>
<table class="table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>patient id</td>
</tr>
<tr class="even">
<td><code>unit</code></td>
<td>hospital</td>
</tr>
<tr class="odd">
<td><code>days</code></td>
<td>follow-up time in days</td>
</tr>
<tr class="even">
<td><code>status</code></td>
<td>0 = censoring, 1 = transplantation, 2 = death without transplantation</td>
</tr>
<tr class="odd">
<td><code>tment</code></td>
<td>0 = placebo, 1 = CyA</td>
</tr>
<tr class="even">
<td><code>sex</code></td>
<td>0 = female, 1 = male</td>
</tr>
<tr class="odd">
<td><code>age</code></td>
<td>age (years)</td>
</tr>
<tr class="even">
<td><code>bili</code></td>
<td>bilirubin (micromoles/L)</td>
</tr>
<tr class="odd">
<td><code>alb</code></td>
<td>albumin (g/L)</td>
</tr>
<tr class="even">
<td><code>stage</code></td>
<td>disease stage: 2 = I-II, 3 = III, 4 = IV</td>
</tr>
</tbody>
</table>
</section>
<section id="guinea-bissau-childhood-vaccination-study-bissau.csv" class="level2">
<h2 class="anchored" data-anchor-id="guinea-bissau-childhood-vaccination-study-bissau.csv">1.2 Guinea-Bissau childhood vaccination study (<code>bissau.csv</code>)</h2>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>child id</td>
</tr>
<tr class="even">
<td><code>cluster</code></td>
<td>cluster id</td>
</tr>
<tr class="odd">
<td><code>fuptime</code></td>
<td>follow-up time (days)</td>
</tr>
<tr class="even">
<td><code>dead</code></td>
<td>0 = alive, 1 = dead</td>
</tr>
<tr class="odd">
<td><code>bcg</code></td>
<td>bcg vaccination status at initial visit: 0 = no, 1 = yes</td>
</tr>
<tr class="even">
<td><code>dtp</code></td>
<td>no of dtp vaccinations at initial visit</td>
</tr>
<tr class="odd">
<td><code>sex</code></td>
<td>0 = female, 1 = male</td>
</tr>
<tr class="even">
<td><code>age</code></td>
<td>age in days at initial visit</td>
</tr>
</tbody>
</table>
</section>
<section id="testis-cancer-incidence-and-maternal-parity-testis.csv" class="level2">
<h2 class="anchored" data-anchor-id="testis-cancer-incidence-and-maternal-parity-testis.csv">1.3 Testis cancer incidence and maternal parity (<code>testis.csv</code>)</h2>
<table class="table">
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>age</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>pyrs</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>cases</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>semi</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>nonsemi</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>parity</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>cohort</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>motherage</code></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="prova-trial-in-liver-cirrhosis-prova.csv" class="level2">
<h2 class="anchored" data-anchor-id="prova-trial-in-liver-cirrhosis-prova.csv">1.4 PROVA trial in liver cirrhosis (<code>prova.csv</code>)</h2>
<table class="table">
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>patient id</td>
</tr>
<tr class="even">
<td><code>timedeath</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>death</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>timebleed</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>bleed</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>beta</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>scle</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>sex</code></td>
<td>0 = female, 1 = male</td>
</tr>
<tr class="odd">
<td><code>age</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>bili</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>coag</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>varsize</code></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="recurrent-episodes-in-affective-disorders-affective.csv" class="level2">
<h2 class="anchored" data-anchor-id="recurrent-episodes-in-affective-disorders-affective.csv">1.5 Recurrent episodes in affective disorders (<code>affective.csv</code>)</h2>
<table class="table">
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>patient id</td>
</tr>
<tr class="even">
<td><code>episode</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>state</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>start</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stop</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>status</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>bip</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>sex</code></td>
<td>0 = female, 1 = male</td>
</tr>
<tr class="odd">
<td><code>age</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>year</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>wait</code></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="leader-cardiovascular-trial-in-type-2-diabetes" class="level2">
<h2 class="anchored" data-anchor-id="leader-cardiovascular-trial-in-type-2-diabetes">1.6 LEADER cardiovascular trial in type 2 Diabetes</h2>
<p>Data not available for download.</p>
<table class="table">
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>patient id</td>
</tr>
<tr class="even">
<td><code>start</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stop</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>status</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>type</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>eventtype</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>eventno</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>treat</code></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="bone-marrow-transplantation-in-acute-leukemia-bmt.csv" class="level2">
<h2 class="anchored" data-anchor-id="bone-marrow-transplantation-in-acute-leukemia-bmt.csv">1.7 Bone marrow transplantation in acute leukemia (<code>bmt.csv</code>)</h2>
<table class="table">
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>patient id</td>
</tr>
<tr class="even">
<td><code>team</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>timedeath</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>death</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>timerel</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>rel</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>timegvhd</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>gvhd</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>timeanc500</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>anc500</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>sex</code></td>
<td>0 = female, 1 = male</td>
</tr>
<tr class="even">
<td><code>age</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>all</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>bmonly</code></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="the-copenhagen-holter-study-cphholter.csv" class="level2">
<h2 class="anchored" data-anchor-id="the-copenhagen-holter-study-cphholter.csv">1.8 The Copenhagen Holter study (<code>cphholter.csv</code>)</h2>
<table class="table">
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>patient id</td>
</tr>
<tr class="even">
<td><code>timedeath</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>death</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>timeafib</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>afib</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>timestroke</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stroke</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>sex</code></td>
<td>0 = female, 1 = male</td>
</tr>
<tr class="odd">
<td><code>age</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>smkoer</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>esvea</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>chol</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>diabet</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>bmi</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>aspirin</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>probnp</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>sbp</code></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="small-set-of-survival-data" class="level2">
<h2 class="anchored" data-anchor-id="small-set-of-survival-data">1.9 Small set of survival data</h2>
<section id="create-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="create-data">Create data</h3>
<div class="cell" data-hash="Ch1_cache/html/create-data_e514c5974c390ca08fb3480aeb17d237">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">20</span>,<span class="dv">22</span>,<span class="dv">23</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>exitage <span class="ot">&lt;-</span> age <span class="sc">+</span> times</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>simpledata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(id, times, event, age, exitage))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure-1.8" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="figure-1.8">Figure 1.8</h3>
<div class="cell" data-hash="Ch1_cache/html/figure-1.8_6bc82265a8c18560d2eae97e370e658d">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># General plotting styles </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>theme_general <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>theme_general_x <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>), </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>), </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">26</span>)) </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.8, part (a)</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.8</span>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> times, <span class="at">y =</span> id), <span class="at">data =</span> simpledata) <span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> id, <span class="at">xend =</span> times <span class="sc">-</span> <span class="fl">0.25</span>, <span class="at">yend =</span> id), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> times, <span class="at">y =</span> id), <span class="at">data =</span> <span class="fu">subset</span>(simpledata,event<span class="sc">==</span><span class="dv">0</span>),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">color=</span><span class="st">'black'</span>, <span class="at">fill=</span><span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> times, <span class="at">y =</span> id), <span class="at">data =</span> <span class="fu">subset</span>(simpledata,event<span class="sc">==</span><span class="dv">1</span>),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (t)"</span>) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Subject number"</span>) <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">12</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  theme_general_x <span class="sc">+</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.8, part (b)</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.8</span>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> exitage, <span class="at">y =</span> id), <span class="at">data =</span> simpledata) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> id, <span class="at">xend =</span> exitage <span class="sc">-</span> <span class="fl">0.25</span>, <span class="at">yend =</span> id), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> exitage, <span class="at">y =</span> id), <span class="at">data =</span> <span class="fu">subset</span>(simpledata,event<span class="sc">==</span><span class="dv">0</span>),</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">color=</span><span class="st">'black'</span>, <span class="at">fill=</span><span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> exitage, <span class="at">y =</span> id), <span class="at">data =</span> <span class="fu">subset</span>(simpledata,event<span class="sc">==</span><span class="dv">1</span>),</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Subject number"</span>) <span class="sc">+</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.05</span>)), </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">12</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  theme_general_x <span class="sc">+</span> </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.8</span>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.8-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.8</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.8-2.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="figure-1.9" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="figure-1.9">Figure 1.9</h3>
<div class="cell" data-hash="Ch1_cache/html/figure-1.9_6b08312fc8465f4db67fd7fba87f85ef">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 1.9 </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier time as time variable</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>kmfit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(times, event) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>simpledata_km <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">surv =</span> <span class="fu">c</span>(<span class="dv">1</span>, kmfit<span class="sc">$</span>surv), </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>, kmfit<span class="sc">$</span>time))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.9, part (a)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.9</span>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> surv), <span class="at">data =</span> simpledata_km) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (t)"</span>) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimate of S(t)"</span>) <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  theme_general_x</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier age as time variable</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>kmfit2 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(age, exitage, event) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>simpledata_km_age <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">surv =</span> <span class="fu">c</span>(<span class="dv">1</span>, kmfit2<span class="sc">$</span>surv), </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>, kmfit2<span class="sc">$</span>time))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.9, part (b)</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.9</span>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> surv), <span class="at">data =</span> simpledata_km_age) <span class="sc">+</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimate of S(age)"</span>) <span class="sc">+</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  theme_general_x</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.9</span>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.9-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.9</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.9-2.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="figure-1.10" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="figure-1.10">Figure 1.10</h3>
<div class="cell" data-hash="Ch1_cache/html/figure-1.10_5c0ded3af5b88f9e28993f50faaed4a4">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 1.10 </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier time as time variable</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>kmfit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(times, event) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>simpledata_km <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">surv =</span> <span class="fu">c</span>(<span class="dv">1</span>, kmfit<span class="sc">$</span>surv), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>, kmfit<span class="sc">$</span>time))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>subdata<span class="ot">&lt;-</span>simpledata_km[simpledata_km<span class="sc">$</span>time<span class="sc">&lt;=</span><span class="dv">12</span>,]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.10</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> surv), <span class="at">data =</span> simpledata_km) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data=</span>subdata,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> time, <span class="at">xmax =</span> <span class="fu">lead</span>(time),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> surv),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype=</span><span class="dv">0</span>,<span class="at">fill=</span><span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">12</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xend =</span> <span class="dv">12</span>, <span class="at">yend =</span> <span class="fl">0.733</span>),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="dv">1</span>,<span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (t)"</span>) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimate of S(t)"</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  theme_general <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">"text"</span>,<span class="at">x=</span><span class="dv">6</span>, <span class="at">y=</span><span class="fl">0.45</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span><span class="fu">expression</span>(epsilon[<span class="dv">0</span>](<span class="dv">12</span>)),<span class="at">size=</span><span class="dv">8</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.10-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
<section id="figure-1.13" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="figure-1.13">Figure 1.13</h3>
<div class="cell" data-hash="Ch1_cache/html/figure-1.13_e1be5262d4d61fef7a663db449319015">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 1.13 </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------#</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># N(t)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>sfit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(times, event) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>, sfit<span class="sc">$</span>time, <span class="dv">26</span>), </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(sfit<span class="sc">$</span>n.event), <span class="fu">tail</span>(<span class="fu">cumsum</span>(sfit<span class="sc">$</span>n.event),<span class="dv">1</span>)))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> sfit<span class="sc">$</span>time[sfit<span class="sc">$</span>n.event<span class="sc">==</span><span class="dv">1</span>], </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="fu">cumsum</span>(sfit<span class="sc">$</span>n.event)[sfit<span class="sc">$</span>n.event<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> sfit<span class="sc">$</span>time[sfit<span class="sc">$</span>n.event<span class="sc">==</span><span class="dv">1</span>], </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="fu">cumsum</span>(sfit<span class="sc">$</span>n.event)[sfit<span class="sc">$</span>n.event<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.13, part (a)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.13</span>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n), <span class="at">data =</span> p1) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n), <span class="at">data =</span> p2, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">6</span>, </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">'black'</span>, <span class="at">fill=</span><span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n), <span class="at">data =</span> p3, <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (t)"</span>) <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"N(t)"</span>) <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.005</span>)), </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">26</span>)) <span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  theme_general_x</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Y(t)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>sfit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(times, event) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>, sfit<span class="sc">$</span>time, <span class="dv">26</span>), </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">risk =</span> <span class="fu">c</span>(sfit<span class="sc">$</span>n.risk, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> sfit<span class="sc">$</span>time, </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">risk =</span> sfit<span class="sc">$</span>n.risk <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> sfit<span class="sc">$</span>time, </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">risk =</span> sfit<span class="sc">$</span>n.risk)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.13, part (b)</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.13</span>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> risk), <span class="at">data =</span> p1) <span class="sc">+</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> risk), <span class="at">data =</span> p2, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">6</span>, </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">'black'</span>, <span class="at">fill=</span><span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> risk), <span class="at">data =</span> p3, <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (t)"</span>) <span class="sc">+</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Y(t)"</span>) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.005</span>)), </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">26</span>)) <span class="sc">+</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  theme_general_x</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co"># N(age)</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>asfit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(age, exitage, event) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>, asfit<span class="sc">$</span>time, <span class="dv">26</span>), </span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(asfit<span class="sc">$</span>n.event),<span class="fu">tail</span>(<span class="fu">cumsum</span>(asfit<span class="sc">$</span>n.event), <span class="dv">1</span>)))</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> asfit<span class="sc">$</span>time[asfit<span class="sc">$</span>n.event <span class="sc">&gt;</span> <span class="dv">0</span>], </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="fu">cumsum</span>(asfit<span class="sc">$</span>n.event)[asfit<span class="sc">$</span>n.event <span class="sc">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> asfit<span class="sc">$</span>time[asfit<span class="sc">$</span>n.event <span class="sc">&gt;</span> <span class="dv">0</span>], </span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.13, part (c)</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.13</span>c <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n), <span class="at">data =</span> p1) <span class="sc">+</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n), <span class="at">data =</span> p2, <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n), <span class="at">data =</span> p3, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">6</span>, </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">'black'</span>, <span class="at">fill=</span><span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"N(age)"</span>) <span class="sc">+</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.005</span>)), </span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">26</span>)) <span class="sc">+</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  theme_general_x </span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Y(age)</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>atriskage <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length=</span><span class="dv">25</span>)</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>){</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>  atriskage[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>((age<span class="sc">&lt;=</span>i <span class="sc">&amp;</span> exitage<span class="sc">&gt;</span>i))</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">26</span>, </span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>                 <span class="at">risk =</span> <span class="fu">c</span>(atriskage[<span class="dv">1</span>], atriskage, <span class="dv">0</span>))</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">20</span>,<span class="dv">22</span>,<span class="dv">24</span>,<span class="dv">25</span>), </span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>                 <span class="at">risk =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>, <span class="dv">9</span>,<span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">20</span>,<span class="dv">22</span>,<span class="dv">24</span>,<span class="dv">25</span>), </span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>                 <span class="at">risk =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">6</span>,<span class="dv">7</span>, <span class="dv">8</span>,<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure 1.13, part (d)</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.13</span>d <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> risk), <span class="at">data =</span> p1) <span class="sc">+</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> risk), <span class="at">data =</span> p2, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">6</span>, </span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">'black'</span>, <span class="at">fill=</span><span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> risk), <span class="at">data =</span> p3, <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Y(age)"</span>) <span class="sc">+</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.005</span>)), </span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">26</span>)) <span class="sc">+</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>)), </span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>  theme_general_x</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.13</span>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.13-1.png" class="img-fluid" style="width:66.0%"></p>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.13</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.13-2.png" class="img-fluid" style="width:66.0%"></p>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.13</span>c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.13-3.png" class="img-fluid" style="width:66.0%"></p>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fig1<span class="fl">.13</span>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ch1_files/figure-html/figure-1.13-4.png" class="img-fluid" style="width:66.0%"></p>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise-1.1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1.1">Exercise 1.1</h3>
<p><em>Consider the small data set in Table 1.6 and argue why both the average of all (12) observation times and the average of the (7) uncensored times will likely underestimate the true mean survival time from entry into the study</em>.</p>
<p>The average of all 12 observation times: <span class="math display">\[\frac{5+6+7+8+9+12+13+15+16+20+22+23}{12} = \frac{156}{12} = 13.00\]</span> will under-estimate the mean survival time because 5 of the terms in the sum, i.e., those corresponding to right-censored observations, are known to be smaller than the true survival times.</p>
<p>The average of the 7 uncensored observations: <span class="math display">\[\frac{5+7+8+13+15+16+23}{7}=\frac{87}{7} = 12.43\]</span> is also likely to under-estimate the mean because right-censoring will typically cause the longer survival times in the population to be incompletely observed. E.g., survival times longer than the time elapsed from the beginning of the study to its end will always be right-censored.</p>
</section>
<section id="exercise-1.2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1.2">Exercise 1.2</h3>
<section id="section" class="level4">
<h4 class="anchored" data-anchor-id="section">1.</h4>
<p><em>Consider the following records mimicking the Copenhagen Holter study (Example 1.1.8) in wide format and transform them into long format, i.e., create one data set for each of the possible six transitions in Figure 1.7.</em></p>
<p>Data can be converted to long format using the <strong>msprep</strong> function from the <strong>mstate</strong> package. However, we must first add indicators of whether the subjects transitioned to AF, stroke and death during the study. Furthermore, we have to fill in <strong>timeafib</strong>, <strong>timestroke</strong> and <strong>timedeath</strong> for all subjects, such that they correspond to the last time where transitions to the states AF, stroke and death are possible. Lastly, we need to specify a transition matrix.</p>
<div class="cell" data-hash="Ch1_cache/html/packages_91b5557ae3be509c2efe61e736990439">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>chs_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/cphholter.csv"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mstate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Ch1_cache/html/exercise-1.2.1_5a2e5d8c29645a44e0eb3b9acfc47b77">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The table from the exercise</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>timeafib <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">10</span>, <span class="cn">NA</span>, <span class="dv">15</span>, <span class="cn">NA</span>, <span class="dv">30</span>, <span class="cn">NA</span>, <span class="dv">25</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>timestroke <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">35</span>, <span class="dv">50</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>timedeath <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">70</span>, <span class="dv">75</span>, <span class="dv">95</span>, <span class="dv">65</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>lastobs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">80</span>, <span class="dv">85</span>, <span class="dv">70</span>, <span class="dv">75</span>, <span class="dv">95</span>, <span class="dv">65</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(id, timeafib, timestroke, timedeath, lastobs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     id timeafib timestroke timedeath lastobs
[1,]  1       NA         NA        NA     100
[2,]  2       10         NA        NA      90
[3,]  3       NA         20        NA      80
[4,]  4       15         30        NA      85
[5,]  5       NA         NA        70      70
[6,]  6       30         NA        75      75
[7,]  7       NA         35        95      95
[8,]  8       25         50        65      65</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating status indicators</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>afib <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(timeafib), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>stroke <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(timestroke), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>death <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(timedeath), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Last time point at risk for a transition to each state</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>timedeath <span class="ot">&lt;-</span> lastobs</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>timestroke <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(timestroke), timedeath, timestroke)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>timeafib <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(timeafib), timestroke, timeafib)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(id, timeafib, timestroke, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                                 timedeath, afib, stroke, death))</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the transition matrix</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>tmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">4</span>,<span class="dv">4</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>tmat[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>tmat[<span class="dv">2</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>tmat[<span class="dv">3</span>, <span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tmat) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">from =</span> <span class="fu">c</span>(<span class="st">"No event"</span>, <span class="st">"AF"</span>, <span class="st">"Stroke"</span>, <span class="st">"Death"</span>), </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">to =</span> <span class="fu">c</span>(<span class="st">"No event"</span>, <span class="st">"AF"</span>, <span class="st">"Stroke"</span>, <span class="st">"Death"</span>))</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>tmat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          to
from       No event AF Stroke Death
  No event       NA  1      2     3
  AF             NA NA      4     5
  Stroke         NA NA     NA     6
  Death          NA NA     NA    NA</code></pre>
</div>
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using msprep to create data in long format</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> <span class="fu">msprep</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"timeafib"</span>, <span class="st">"timestroke"</span>, <span class="st">"timedeath"</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">status =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"afib"</span>, <span class="st">"stroke"</span>, <span class="st">"death"</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trans =</span> tmat, <span class="at">data =</span> wide_data) </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>long_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class 'msdata'

Data:
   id from to trans Tstart Tstop time status
1   1    1  2     1      0   100  100      0
2   1    1  3     2      0   100  100      0
3   1    1  4     3      0   100  100      0
4   2    1  2     1      0    10   10      1
5   2    1  3     2      0    10   10      0
6   2    1  4     3      0    10   10      0
7   2    2  3     4     10    90   80      0
8   2    2  4     5     10    90   80      0
9   3    1  2     1      0    20   20      0
10  3    1  3     2      0    20   20      1
11  3    1  4     3      0    20   20      0
12  3    3  4     6     20    80   60      0
13  4    1  2     1      0    15   15      1
14  4    1  3     2      0    15   15      0
15  4    1  4     3      0    15   15      0
16  4    2  3     4     15    30   15      1
17  4    2  4     5     15    30   15      0
18  4    3  4     6     30    85   55      0
19  5    1  2     1      0    70   70      0
20  5    1  3     2      0    70   70      0
21  5    1  4     3      0    70   70      1
22  6    1  2     1      0    30   30      1
23  6    1  3     2      0    30   30      0
24  6    1  4     3      0    30   30      0
25  6    2  3     4     30    75   45      0
26  6    2  4     5     30    75   45      1
27  7    1  2     1      0    35   35      0
28  7    1  3     2      0    35   35      1
29  7    1  4     3      0    35   35      0
30  7    3  4     6     35    95   60      1
31  8    1  2     1      0    25   25      1
32  8    1  3     2      0    25   25      0
33  8    1  4     3      0    25   25      0
34  8    2  3     4     25    50   25      1
35  8    2  4     5     25    50   25      0
36  8    3  4     6     50    65   15      1</code></pre>
</div>
</div>
</section>
<section id="section-1" class="level4">
<h4 class="anchored" data-anchor-id="section-1">2.</h4>
<p><em>Do the same for the entire data set</em>.</p>
<p>We can then repeat the procedure for the Copenhagen Holter Study data set.</p>
<div class="cell" data-hash="Ch1_cache/html/exercise-1.2.2_6b91c11c47ed38866f0c1af612642db8">
<details>
<summary>Code show/hide</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>timestroke <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(chs_data<span class="sc">$</span>timestroke),</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                              chs_data<span class="sc">$</span>timedeath, chs_data<span class="sc">$</span>timestroke)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>chs_data<span class="sc">$</span>timeafib <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(chs_data<span class="sc">$</span>timeafib),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                            chs_data<span class="sc">$</span>timestroke, chs_data<span class="sc">$</span>timeafib)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>chs_long <span class="ot">&lt;-</span> <span class="fu">msprep</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"timeafib"</span>, <span class="st">"timestroke"</span>, <span class="st">"timedeath"</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">status =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"afib"</span>, <span class="st">"stroke"</span>, <span class="st">"death"</span>),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trans =</span> tmat, <span class="at">data =</span> chs_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>NB: We get a warning because 5 subjects have two events on the same day. This will be handled if necessary for further analyses.</p>
</section>
</section>
<section id="exercise-1.3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1.3">Exercise 1.3</h3>
<section id="section-2" class="level4">
<h4 class="anchored" data-anchor-id="section-2">1.</h4>
<p><em>Derive Equations (1.2) and (1.3) for, respectively, the survival function in the two-state model (Figure 1.1) and the cumulative incidence function in the competing risks model (Figure 1.2).</em></p>
<p>The hazard function <span class="math display">\[\alpha(t)=\lim_{dt\rightarrow 0}P(T\leq t+dt\mid T&gt;t)/dt\]</span> equals <span class="math display">\[\alpha(t)=\frac{f(t)}{S(t)}=\frac{-(d/dt) S(t)}{S(t)}=-(d/dt)\log S(t)\]</span> where <span class="math inline">\(f(t)\)</span> is the density function for <span class="math inline">\(T\)</span> and, thereby, <span class="math inline">\(S(t)=\exp(-\int_0^t\alpha(u)du)\)</span>.</p>
<p>The cause <span class="math inline">\(h\)</span> cumulative incidence is the probability of failing from cause <span class="math inline">\(h\)</span> during <span class="math inline">\([0,t]\)</span>. This is the integral of the infinitesimal probabilities of failing in <span class="math inline">\((u,u+du)\)</span> for <span class="math inline">\(0\leq u\leq t\)</span>. The probability of failing in <span class="math inline">\((u,u+du)\)</span> is, by definition of the cause-<span class="math inline">\(h\)</span>-specific hazard, equal to <span class="math inline">\(S(u)\alpha_h(u)du\)</span> and the desired result <span class="math display">\[Q_h(t)=\int_0^tS(u)\alpha_h(u)du\]</span> follows.</p>
</section>
<section id="section-3" class="level4">
<h4 class="anchored" data-anchor-id="section-3">2.</h4>
<p><em>Show, for the Markov illness-death model (Figure 1.3), that the state occupation probability for state 1 at time</em> <span class="math inline">\(t\)</span><em>,</em> <span class="math inline">\(Q_1(t)\)</span><em>, is</em> <span class="math display">\[\int_0^t\exp\left(-\int_0^u(\alpha_{01}(x)+\alpha_{02}(x))dx\right)\alpha_{01}(u)\exp\left(-\int_u^t\alpha_{12}(x)dx\right)du.\]</span></p>
<p>The probability <span class="math inline">\(P_{11}(u,t)\)</span> of staying in state 1 from time <span class="math inline">\(u\)</span> to time <span class="math inline">\(t\)</span> is given by <span class="math inline">\(\exp(-\int_u^t\alpha_{12}(x)dx)\)</span> and combining this with the argument from the previous question, i.e., that the (infinitesimal) probability <span class="math inline">\(\exp(-\int_0^u(\alpha_{01}(x)+\alpha_{02}(x))dx)\alpha_{01}(u)du\)</span>, of moving from state 0 to state 1 during <span class="math inline">\((u, u+du)\)</span>, the desired result is obtained by integration over <span class="math inline">\(u\)</span> from 0 to <span class="math inline">\(t\)</span>.</p>
</section>
</section>
<section id="exercise-1.4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1.4">Exercise 1.4 (*)</h3>
<p><em>Argue (intuitively) how the martingale property</em> <span class="math inline">\(E(M(t)\mid {\cal H}_{s})=M(s)\)</span> <em>follows from</em> <span class="math inline">\(E(dM(t)\mid {\cal H}_{t-})=0\)</span> <em>(Section 1.4.3).</em></p>
<p>Because <span class="math inline">\(M(s)\)</span> is adapted to the history <span class="math inline">\({\cal H}_s\)</span> we get <span class="math display">\[E(M(t)\mid {\cal F}_s)-M(s)=E(M(t)-M(s)\mid {\cal H}_s).\]</span> We write the difference <span class="math inline">\(M(t)-M(s)\)</span> as the sum of increments <span class="math display">\[=E(\int_{(s,t]}dM(u)\mid {\cal H}_s)\]</span> and change the order of integration and expectation <span class="math display">\[=\int_{(s,t]}E(dM(u)\mid {\cal H}_s).\]</span> We finally use the `principle of repeated conditioning’ to obtain the desired result of 0 <span class="math display">\[=\int_{(s,t]}E(E(dM(u)\mid {\cal H}_{u-})\mid {\cal H}_s)=0.\]</span></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch2.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intuition for intensity models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Models for Multi-State Survival Data: Rates, Risks, and Pseudo-Values</div>   
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>