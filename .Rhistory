tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=1*(dt>0))
})
coxph(Surv(intxrel,rel!=0) ~ tt(tgvhd) + I(age/10) + bmonly + all,
data = bmt, ties="breslow",
tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=(gvhd==1)*(dt>0))
})
coxph(Surv(intxrel,rel!=0) ~ tt(tgvhd) + I(age/10) + bmonly + all,
data = bmt, ties="breslow",
tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=(bmt$gvhd==1)*(dt>0))
})
bmt$timeanc500
bmt$tgvhd
bmt$tanc500 <- ifelse(bmt$anc500 == 1, bmt$timeanc500, bmt$intxrel)
coxph(Surv(intxrel,rel!=0) ~ tt(tgvhd) + I(age/10) + bmonly + all,
data = bmt, ties="breslow",
tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=1*(dt>0))
})
coxph(Surv(intxrel,rel!=0) ~ tt(tanc500) + I(age/10) + bmonly + all,
data = bmt, ties="breslow",
tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=1*(dt>0))
})
coxph(Surv(intxrel,rel!=0) ~  tt(tgvhd)+ tt(tanc500) + I(age/10) + bmonly + all,
data = bmt, ties="breslow",
tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=1*(dt>0))
})
coxph(Surv(intxrel,rel!=0) ~  tt(tgvhd) + I(age/10) + bmonly + all + tt(tanc500),
data = bmt, ties="breslow",
tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=1*(dt>0))
})
coxph(Surv(intxrel,trm!=0) ~ tt(tgvhd) + I(age/10) + bmonly + all,
data = bmt, ties="breslow",
tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=1*(dt>0))
})
coxph(Surv(intxrel,trm!=0) ~  tt(tgvhd) + I(age/10) + bmonly + all + tt(tanc500),
data = bmt, ties="breslow",
tt=function(x, t, ...) {
dt <- t-x
cbind(tdcgvhd=1*(dt>0))
})
#| label: read-bissau
bissau <- data.frame(read.csv("data/bissau.csv"))
# Variables for age as time scale and dtp binary
bissau$agein  <- with(bissau, age/(365.24/12))
bissau$ageout <- with(bissau, agein+fuptime/(365.24/12))
bissau$dtpany <- 1*with(bissau, dtp>0)
#| label: table-3.1
table(bissau$bcg, bissau$dtp)
100*table(bissau$bcg, bissau$dtp) / rowSums(table(bissau$bcg, bissau$dtp))
#| label: table-3.2
library(survival)
coxph(Surv(agein,ageout,dead!=0)~bcg,data=bissau,method="breslow",timefix=F)
coxph(Surv(agein,ageout,dead!=0)~dtpany,data=bissau,method="breslow",timefix=F)
coxph(Surv(agein,ageout,dead!=0)~bcg+dtpany,data=bissau,method="breslow",timefix=F)
coxph(Surv(agein,ageout,dead!=0)~bcg*dtpany,data=bissau,method="breslow",timefix=F)
#| label: read-pbc3
pbc3 <- data.frame(read.csv("data/pbc3.csv"))
pbc3$log2bili <- with(pbc3, log2(bili))
pbc3$years <- with(pbc3, days/365.25)
#| label: table-3.11
library(survival)
# Treatment
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(tment),
data = pbc3, tt = function(x,t, ...) (x==1)*t, method = "breslow")
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(tment),
data = pbc3, tt = function(x,t, ...) (x==1)*log(t), method = "breslow")
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(tment),
data = pbc3, tt = function(x,t, ...) (x==1)*(t>2), method = "breslow")
# Albumin
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(alb),
data = pbc3, tt = function(x,t, ...) x*t, method = "breslow")
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(alb),
data = pbc3, tt = function(x,t, ...) x*log(t), method = "breslow")
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(alb),
data = pbc3,  tt = function(x,t, ...) (x)*(t>2), method = "breslow")
# Log2 bilirubin
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(log2bili),
data = pbc3, tt = function(x,t, ...) x*t, method = "breslow")
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(log2bili),
data = pbc3, tt = function(x,t, ...) x*log(t), method = "breslow")
coxph(Surv(years, status != 0) ~ tment + alb + log2bili + tt(log2bili),
data = pbc3,  tt = function(x,t, ...) (x)*(t>2), method = "breslow")
#| label: read-bmt
bmt <- data.frame(read.csv("data/bmt.csv"))
#| label: table-1.4
with(bmt, table(rel))
with(bmt, table(rel)) / sum(with(bmt, table(rel)))
with(bmt, table(death))
with(bmt, table(death)) / sum(with(bmt, table(death)))
with(bmt, table(rel,death))
with(bmt, table(rel,death)) / rowSums(with(bmt, table(rel,death)))
with(bmt, table(gvhd))
with(bmt, table(gvhd)) / sum(with(bmt, table(gvhd)))
with(bmt, table(gvhd, rel))
with(bmt, table(gvhd, rel)) / rowSums(with(bmt, table(gvhd, rel)))
with(bmt, table(gvhd, death))
with(bmt, table(gvhd, death)) / rowSums(with(bmt, table(gvhd, death)))
#| label: read-cphholter
holter <- data.frame(read.csv("data/cphholter.csv"))
#| label: table-1.5
with(holter, table(esvea))
with(holter, table(afib, esvea))
with(holter, table(stroke, esvea))
with(holter, table(death, esvea))
with(holter, table(afib, stroke, death, esvea))
with(subset(holter, timeafib < timestroke), table(afib, stroke, death, esvea))
with(subset(holter, timestroke < timeafib), table(afib, stroke, death, esvea))
#| label: read-prova
prova <- data.frame(read.csv("data/prova.csv", na.strings = c(".")))
#| label: table-1.2
prova$beh <- with(prova, scle*2 + beta)
with(prova, table(beh))
# Bleeding
with(prova, table(beh, bleed))
# Death
with(prova, table(beh, death))
# Death w/o bleed
with(subset(prova, bleed == 0), table(beh, death))
# Death after bleed
with(subset(prova, bleed == 1), table(beh, death))
#| label: create-data
times <- c(5,6,7,8,9,12,13,15,16,20,22,23)
age <- c(12,0,0,10,6,6,9,3,8,0,0,2)
event <- c(1,0,1,1,0,0,1,1,1,0,0,1)
id <- 1:12
exitage <- age + times
simpledata <- as.data.frame(cbind(id, times, event, age, exitage))
#| label: figure-1.8
#------------------------------------------------------------------#
# General plotting styles
#------------------------------------------------------------------#
library(ggplot2)
theme_general <- theme_bw() +
theme(legend.position = "none",
text = element_text(size = 20),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20))
theme_general_x <- theme_bw() +
theme(legend.position = "none",
text = element_text(size = 26),
axis.text.x = element_text(size = 26),
axis.text.y = element_text(size = 26))
# Create Figure 1.8, part (a)
fig1.8a <- ggplot(aes(x = times, y = id), data = simpledata) +
geom_segment(aes(x = 0, y = id, xend = times - 0.25, yend = id), size = 1) +
geom_point(aes(x = times, y = id), data = subset(simpledata,event==0),
shape = 21, size = 6, color='black', fill='white') +
geom_point(aes(x = times, y = id), data = subset(simpledata,event==1),
shape = 16, size = 6) +
xlab("Time (t)") +
ylab("Subject number") +
scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)),
limits = c(0, 25)) +
scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)),
limits = c(0.5, 12), breaks = seq(1, 12, 1)) +
theme_general_x +
theme(panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank())
# Create Figure 1.8, part (b)
fig1.8b <- ggplot(aes(x = exitage, y = id), data = simpledata) +
geom_segment(aes(x = age, y = id, xend = exitage - 0.25, yend = id), size = 1) +
geom_point(aes(x = exitage, y = id), data = subset(simpledata,event==0),
shape = 21, size = 6, color='black', fill='white') +
geom_point(aes(x = exitage, y = id), data = subset(simpledata,event==1),
shape = 16, size = 6) +
xlab("Age") +
ylab("Subject number") +
scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)),
limits = c(0, 25)) +
scale_y_continuous(expand = expansion(mult = c(0.005, 0.05)),
limits = c(0.5, 12), breaks = seq(1, 12, 1)) +
theme_general_x +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank())
fig1.8a
fig1.8b
#| label: figure-1.9
#------------------------------------------------------------------#
# Figure 1.9
#------------------------------------------------------------------#
library(survival)
# Kaplan-Meier time as time variable
kmfit <- survfit(Surv(times, event) ~ 1)
simpledata_km <- data.frame(surv = c(1, kmfit$surv),
time = c(0, kmfit$time))
# Create Figure 1.9, part (a)
fig1.9a <- ggplot(aes(x = time, y = surv), data = simpledata_km) +
geom_step(size = 1) +
xlab("Time (t)") +
ylab("Estimate of S(t)") +
scale_x_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 25)) +
scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 1), breaks = seq(0, 1, 0.1)) +
theme_general_x
# Kaplan-Meier age as time variable
kmfit2 <- survfit(Surv(age, exitage, event) ~ 1)
simpledata_km_age <- data.frame(surv = c(1, kmfit2$surv),
time = c(0, kmfit2$time))
# Create Figure 1.9, part (b)
fig1.9b <- ggplot(aes(x = time, y = surv), data = simpledata_km_age) +
geom_step(size = 1) +
xlab("Age") +
ylab("Estimate of S(age)") +
scale_x_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 25)) +
scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 1), breaks = seq(0, 1, 0.1)) +
theme_general_x
fig1.9a
fig1.9b
#| label: figure-1.10
#------------------------------------------------------------------#
# Figure 1.10
#------------------------------------------------------------------#
# Kaplan-Meier time as time variable
kmfit <- survfit(Surv(times, event) ~ 1)
simpledata_km <- data.frame(surv = c(1, kmfit$surv),
time = c(0, kmfit$time))
subdata<-simpledata_km[simpledata_km$time<=12,]
# Create Figure 1.10
library(dplyr)
fig1.10 <- ggplot(mapping=aes(x = time, y = surv), data = simpledata_km) +
geom_rect(data=subdata,
aes(xmin = time, xmax = lead(time),
ymin = 0, ymax = surv),
linetype=0,fill="grey")+
geom_segment(aes(x = 12, y = -Inf, xend = 12, yend = 0.733),
size=1,linetype="dashed")+
geom_step(size = 1) +
xlab("Time (t)") +
ylab("Estimate of S(t)") +
scale_x_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 25)) +
scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 1), breaks = seq(0, 1, 0.1)) +
theme_general +
annotate(geom="text",x=6, y=0.45,
label=expression(epsilon[0](12)),size=8)
fig1.10
#| label: figure-1.13
#------------------------------------------------------------------#
# Figure 1.13
#------------------------------------------------------------------#
# N(t)
sfit <- survfit(Surv(times, event) ~ 1)
p1 <- data.frame(time = c(0, sfit$time, 26),
n = c(0, cumsum(sfit$n.event), tail(cumsum(sfit$n.event),1)))
p2 <- data.frame(time = sfit$time[sfit$n.event==1],
n = cumsum(sfit$n.event)[sfit$n.event==1]-1)
p3 <- data.frame(time = sfit$time[sfit$n.event==1],
n = cumsum(sfit$n.event)[sfit$n.event==1])
# Create Figure 1.13, part (a)
fig1.13a <- ggplot(aes(x = time, y = n), data = p1) +
geom_step(size = 1) +
geom_point(aes(x = time, y = n), data = p2, shape = 21, size = 6,
color='black', fill='white') +
geom_point(aes(x = time, y = n), data = p3, shape = 16, size = 6) +
xlab("Time (t)") +
ylab("N(t)") +
scale_x_continuous(expand = expansion(mult = c(0.005, 0.005)),
limits = c(0, 26)) +
scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 12), breaks = seq(0, 12, 1)) +
theme_general_x
# Y(t)
sfit <- survfit(Surv(times, event) ~ 1)
p1 <- data.frame(time = c(0, sfit$time, 26),
risk = c(sfit$n.risk, 0, 0))
p2 <- data.frame(time = sfit$time,
risk = sfit$n.risk - 1)
p3 <- data.frame(time = sfit$time,
risk = sfit$n.risk)
# Create Figure 1.13, part (b)
fig1.13b <- ggplot(aes(x = time, y = risk), data = p1) +
geom_step(size = 1) +
geom_point(aes(x = time, y = risk), data = p2, shape = 21, size = 6,
color='black', fill='white') +
geom_point(aes(x = time, y = risk), data = p3, shape = 16, size = 6) +
xlab("Time (t)") +
ylab("Y(t)") +
scale_x_continuous(expand = expansion(mult = c(0.005, 0.005)),
limits = c(0, 26)) +
scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 12), breaks = seq(0, 12, 1)) +
theme_general_x
# N(age)
asfit <- survfit(Surv(age, exitage, event) ~ 1)
p1 <- data.frame(time = c(0, asfit$time, 26),
n = c(0, cumsum(asfit$n.event),tail(cumsum(asfit$n.event), 1)))
p2 <- data.frame(time = asfit$time[asfit$n.event > 0],
n = cumsum(asfit$n.event)[asfit$n.event > 0])
p3 <- data.frame(time = asfit$time[asfit$n.event > 0],
n = c(0, 1, 2, 4, 5, 6))
# Create Figure 1.13, part (c)
fig1.13c <- ggplot(aes(x = time, y = n), data = p1) +
geom_step(size = 1) +
geom_point(aes(x = time, y = n), data = p2, shape = 16, size = 6) +
geom_point(aes(x = time, y = n), data = p3, shape = 21, size = 6,
color='black', fill='white') +
xlab("Age") +
ylab("N(age)") +
scale_x_continuous(expand = expansion(mult = c(0.005, 0.005)),
limits = c(0, 26)) +
scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 12), breaks = seq(0, 12, 1)) +
theme_general_x
# Y(age)
atriskage <- vector(length=25)
for(i in 1:25){
atriskage[i] <- sum((age<=i & exitage>i))
}
p1 <- data.frame(time = 0:26,
risk = c(atriskage[1], atriskage, 0))
p2 <- data.frame(time = c(2,3,6,7,8,9,10,12,15,17,18,20,22,24,25),
risk = c(5,6,7,6,7,8, 9,10, 9, 8, 5, 4, 2, 1,0))
p3 <- data.frame(time = c(2,3,6,7,8,9,10,12,15,17,18,20,22,24,25),
risk = c(4,5,6,7,6,7, 8,9, 10, 9, 8, 5, 4, 2,1))
# Create Figure 1.13, part (d)
fig1.13d <- ggplot(aes(x = time, y = risk), data = p1) +
geom_step(size = 1) +
geom_point(aes(x = time, y = risk), data = p2, shape = 21, size = 6,
color='black', fill='white') +
geom_point(aes(x = time, y = risk), data = p3, shape = 16, size = 6) +
xlab("Age") +
ylab("Y(age)") +
scale_x_continuous(expand = expansion(mult = c(0.005, 0.005)),
limits = c(0, 26)) +
scale_y_continuous(expand = expansion(mult = c(0.05, 0.05)),
limits = c(0, 12), breaks = seq(0, 12, 1)) +
theme_general_x
fig1.13a
fig1.13b
fig1.13c
fig1.13d
#| label: read-affective
affective <- data.frame(read.csv("data/affective.csv"))
affective$wait <- with(affective, stop - start)
#| label: table-2.13
# Cox model for 1., 2., 3., 4. episode 'Markov': Column 1
library(survival)
tidy(coxph(Surv(start, stop, status == 1) ~ bip,
data = subset(affective, episode == 1 & state == 0),
method = "breslow"))
#| label: table-2.13
# Cox model for 1., 2., 3., 4. episode 'Markov': Column 1
library(survival)
coxph(Surv(start, stop, status == 1) ~ bip, method = "breslow",
data = subset(affective, episode == 1 & state == 0))
coxph(Surv(start, stop, status == 1) ~ bip, method = "breslow",
data = subset(affective, episode == 2 & state == 0))
coxph(Surv(start, stop, status == 1) ~ bip, method = "breslow",
data = subset(affective, episode == 3 & state == 0))
coxph(Surv(start, stop, status == 1) ~ bip, method = "breslow",
data = subset(affective, episode == 4 & state == 0))
# Cox model for 1., 2., 3., 4. episode 'Gap time': Column 2
coxph(Surv(wait, status == 1) ~ bip, method = "breslow",
data = subset(affective, episode == 1 & state == 0))
coxph(Surv(wait, status == 1) ~ bip, method = "breslow",
data = subset(affective, episode == 2 & state == 0))
coxph(Surv(wait, status == 1) ~ bip, method = "breslow",
data = subset(affective, episode == 3 & state == 0))
coxph(Surv(wait, status == 1) ~ bip, method = "breslow",
data = subset(affective, episode == 4 & state == 0))
# AG cox model, total time
coxph(Surv(start, stop, status == 1) ~ bip, method = "breslow",
data = subset(affective, state == 0))
# AG cox model, gap time
coxph(Surv(wait, status == 1) ~ bip, method = "breslow",
data = subset(affective, state == 0))
# PWP cox model, total time
coxph(Surv(start, stop, status == 1) ~ strata(episode) + bip, method = "breslow",
data = subset(affective, state == 0))
# PWP cox model, gap time
coxph(Surv(wait, status == 1) ~ strata(episode) + bip, method = "breslow",
data = subset(affective, state == 0))
#| label: read-bissau
bissau <- data.frame(read.csv("data/bissau.csv"))
#| label: table-2.12
library(survival)
# Cox model in column 1
bissau$agem <- as.integer(bissau$age/30.44)
coxfit0 <- coxph(Surv(fuptime, dead) ~ bcg,
data = bissau, method = "breslow")
coxfit0
# Cox model in column 1
coxfit1 <- coxph(Surv(fuptime, dead) ~ bcg + agem,
data = bissau, method = "breslow")
coxfit1
# Make age the time variable instead
bissau$agein <- bissau$age/(365.24/12)
bissau$ageout <- bissau$agein + bissau$fuptime/(365.24/12)
# Cox model in column 2
# option timefix=F aligns to SAS calculation
# see vignette 'Roundoff error and tied times' for survival package
coxfit2 <- coxph(Surv(agein, ageout, dead) ~ bcg,
data = bissau, method = "breslow",timefix=F)
coxfit2
#| label: figure-2.12
# General plotting style
library(ggplot2)
theme_general <- theme_bw() +
theme(text = element_text(size = 20),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
legend.position = "bottom",
legend.title=element_blank(),
legend.text = element_text(size = 20),
legend.key.size = unit(2,"line"))
# Extract cumulative baseline hazard
coxcumhaz <- basehaz(coxfit1, centered = FALSE)
# Collect data for plot
coxdata <- data.frame(cumhaz = coxcumhaz$hazard,
time = coxcumhaz$time,
bcg = rep("1", nrow(coxcumhaz)),
type = rep("Breslow estimate", nrow(coxcumhaz)))
# Create figure
fig2.12 <- ggplot(aes(x = time / (365.24/12), y = cumhaz), data = coxdata) +
geom_step(size = 1) +
xlab("Follow-up time (months)") +
ylab("Cumulative hazard") +
scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)), breaks = seq(0, 7, by = 1)) +
scale_y_continuous(expand = expansion(mult = c(0.005, 0.05))) +
theme_general
fig2.12
#| label: figure-2.13
# Extract cumulative baseline hazard
coxcumhaz <- basehaz(coxfit2, centered = FALSE)
# Collect data for plot
coxdata <- data.frame(cumhaz = coxcumhaz$hazard,
time = coxcumhaz$time,
bcg = rep("1", nrow(coxcumhaz)),
type = rep("Breslow estimate", nrow(coxcumhaz)))
# Create figure
fig2.13 <- ggplot(aes(x = time, y = cumhaz), data = coxdata) +
geom_step(size = 1) +
xlab("Age (months)") +
ylab("Cumulative hazard") +
scale_x_continuous(expand = expansion(mult = c(0.005, 0.05)), breaks = seq(0, 15, by = 1)) +
scale_y_continuous(expand = expansion(mult = c(0.005, 0.1)), breaks = seq(0, 0.15, by = 0.05),
labels = c("0", "0.05", "0.10", "0.15")) +
theme_general
fig2.13
#| label: figure-2.12
# Make Aalen model fit
nonparmod2 <- aalen(Surv(days, status != 0) ~ tment + alb + bili, data = pbc3)
#| label: figure-2.12
# Make Aalen model fit
library(timereg)
nonparmod2 <- aalen(Surv(days, status != 0) ~ tment + alb + bili, data = pbc3)
cumhazdata <- data.frame(eventtimes = nonparmod2$cum[,1],
basecumhaz = nonparmod2$cum[,2],
cumhaztreat = nonparmod2$cum[,3],
cumhazalb = nonparmod2$cum[,4],
cumhazbili= nonparmod2$cum[,5])
# Extend lines to last observed time
cumhazdata[nrow(cumhazdata)+1,] <- c(max(pbc3$days), tail(cumhazdata, 1)[-1])
# Figure treatment
fig2.12.1 <- ggplot(aes(x = eventtimes / 365.25, y = cumhaztreat), data = cumhazdata) +
geom_step(size = 1) +
xlab("Time since randomization (years)") +
ylab("Cumulative treatment effect") +
scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)),
limits = c(0, 6), breaks = seq(0, 6, 1)) +
scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +
theme_general
# Figure albumin
fig2.12.2 <- ggplot(aes(x = eventtimes / 365.25, y = cumhazalb), data = cumhazdata) +
geom_step(size = 1) +
xlab("Time since randomization (years)") +
ylab("Cumulative albumin effect") +
scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)),
limits = c(0, 6), breaks = seq(0, 6, 1)) +
scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +
theme_general
# Figure bilirubin
fig2.12.3 <- ggplot(aes(x = eventtimes / 365.25, y = cumhazbili), data = cumhazdata) +
geom_step(size = 1) +
xlab("Time since randomization (years)") +
ylab("Cumulative bilirubin effect") +
scale_x_continuous(expand = expansion(mult = c(0.03, 0.05)),
limits = c(0, 6), breaks = seq(0, 6, 1)) +
scale_y_continuous(expand = expansion(mult = c(0.03, 0.05))) +
theme_general
fig2.12.1
fig2.12.2
fig2.12.3
bmt <- data.frame(read.csv("data/bmt.csv"))
library(tidyverse)
bmt$intxsurv <- bmt$timedeath
bmt$dead <- bmt$death
bmt$intxrel <- ifelse(bmt$rel == 1, bmt$timerel, bmt$timedeath)
bmt$trm <- ifelse(bmt$rel == 0 & bmt$death == 1, 1, 0)
bmt$tgvhd <- ifelse(bmt$gvhd == 1, bmt$timegvhd, bmt$intxrel)
bmt$tanc500 <- ifelse(bmt$anc500 == 1, bmt$timeanc500, bmt$intxrel)
bmt$state0 <- bmt$rel + 2*bmt$trm
